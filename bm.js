const _0xcb3954=_0x31f7;(function(_0x29a260,_0x317bb7){const _0x4ddc4e=_0x31f7,_0x50a860=_0x29a260();while(!![]){try{const _0x4e9719=-parseInt(_0x4ddc4e(0x2c1))/0x1*(parseInt(_0x4ddc4e(0x246))/0x2)+-parseInt(_0x4ddc4e(0x338))/0x3+parseInt(_0x4ddc4e(0x2a9))/0x4+parseInt(_0x4ddc4e(0x325))/0x5*(-parseInt(_0x4ddc4e(0x310))/0x6)+parseInt(_0x4ddc4e(0x322))/0x7*(parseInt(_0x4ddc4e(0x208))/0x8)+-parseInt(_0x4ddc4e(0x30e))/0x9+parseInt(_0x4ddc4e(0x298))/0xa*(parseInt(_0x4ddc4e(0x367))/0xb);if(_0x4e9719===_0x317bb7)break;else _0x50a860['push'](_0x50a860['shift']());}catch(_0x9d8082){_0x50a860['push'](_0x50a860['shift']());}}}(_0x3a27,0x3900c));const _0x3d067c=function(){let _0x2ede7a=!![];return function(_0x2e92b5,_0x4ea62b){const _0x23133e=_0x2ede7a?function(){const _0x4b0b1b=_0x31f7;if(_0x4ea62b){const _0x2dbe4d=_0x4ea62b[_0x4b0b1b(0x312)](_0x2e92b5,arguments);return _0x4ea62b=null,_0x2dbe4d;}}:function(){};return _0x2ede7a=![],_0x23133e;};}(),_0x5d7422=_0x3d067c(this,function(){const _0x5a6dc3=_0x31f7;return _0x5d7422[_0x5a6dc3(0x2fb)]()[_0x5a6dc3(0x265)](_0x5a6dc3(0x264))[_0x5a6dc3(0x2fb)]()[_0x5a6dc3(0x2cc)](_0x5d7422)[_0x5a6dc3(0x265)]('(((.+)+)+)+$');});_0x5d7422();'use strict';process[_0xcb3954(0x22f)][_0xcb3954(0x33c)]=0x1;const childProcess=require(_0xcb3954(0x1bc)),fs=require('fs'),fns=require(_0xcb3954(0x280)),low=require(_0xcb3954(0x29e)),FileSync=require(_0xcb3954(0x2da)),path=require(_0xcb3954(0x1e0)),crypto=require(_0xcb3954(0x20d)),Crypt=require(_0xcb3954(0x213))[_0xcb3954(0x1c3)],RSA=require(_0xcb3954(0x213))[_0xcb3954(0x20b)],bcrypt=require(_0xcb3954(0x1ac)),jwt=require(_0xcb3954(0x375)),ipaddr=require('ipaddr.js'),argv=require('yargs/yargs')(process[_0xcb3954(0x313)][_0xcb3954(0x1b3)](0x2))[_0xcb3954(0x313)],uuidRandom=require(_0xcb3954(0x2ef)),TelegramBot=require(_0xcb3954(0x26e)),Mixpanel=require('mixpanel'),axios=require('axios'),{GraphQLClient,gql}=require(_0xcb3954(0x2aa)),util=require(_0xcb3954(0x1ca)),fileUpload=require(_0xcb3954(0x26f)),{networkInterfaces}=require('os'),PORT=argv['port']||'3000',pattern=/^[0-9]{2,4}$/;!pattern[_0xcb3954(0x1ed)](PORT)&&(console[_0xcb3954(0x1b5)](_0xcb3954(0x27c)+PORT+',\x20must\x20be\x20a\x204\x20digit\x20number'),process[_0xcb3954(0x2e7)](0x1));const HOST=argv[_0xcb3954(0x1dd)]||null,userID=argv[_0xcb3954(0x2ab)]||'',debugging=argv['d']||![],nodeversion=process[_0xcb3954(0x282)][_0xcb3954(0x1fd)],environment=require(_0xcb3954(0x1f6))['environment']||_0xcb3954(0x2d2);let bbpath=_0xcb3954(0x234),bbpath2='';const botfile=_0xcb3954(0x25e),configfile='bb-config.json',settingsfile=_0xcb3954(0x2ff),securefile=_0xcb3954(0x262),maxBackups=0xa;let validInstallation=!![];!fs[_0xcb3954(0x33e)](bbpath+botfile)&&(bbpath='',validInstallation=![]);const {addClient,getAllClients,removeClient,getClient,getClientsWithBotID,getClientsWithUuid}=require('./'+bbpath2+_0xcb3954(0x1c4)),configpath=userID?bbpath+_0xcb3954(0x1e9)+userID+'/':bbpath+_0xcb3954(0x1e9),configbackuppath=configpath+'backup/',logspath=userID?bbpath+'logs/'+userID+'/':bbpath+_0xcb3954(0x1c8),zippath=userID?bbpath+_0xcb3954(0x36f)+userID+'/':bbpath+_0xcb3954(0x36f),loggerfile=fs[_0xcb3954(0x24f)](logspath+_0xcb3954(0x2b8),{'flags':'a'}),temppath=userID?bbpath+_0xcb3954(0x2a1)+userID+'/':bbpath+_0xcb3954(0x2a1);!fs['existsSync'](configpath)&&fs[_0xcb3954(0x33a)](configpath);!fs[_0xcb3954(0x33e)](configbackuppath)&&fs[_0xcb3954(0x33a)](configbackuppath);!fs['existsSync'](logspath)&&fs[_0xcb3954(0x33a)](logspath);!fs[_0xcb3954(0x33e)](zippath)&&fs[_0xcb3954(0x33a)](zippath);!fs[_0xcb3954(0x33e)](temppath)&&fs['mkdirSync'](temppath);const adapter=new FileSync(configpath+configfile),dbConfig=low(adapter);dbConfig[_0xcb3954(0x353)]({'bots':[]})[_0xcb3954(0x2be)]();function _0x3a27(){const _0x1c2ebd=['argv','2FA\x20login\x20required','sortBy','order','Are\x20you\x20sure\x20you\x20want\x20to\x20update\x20Balance\x20Bot\x20now?','Of\x20which\x20events\x20do\x20you\x20want\x20to\x20be\x20notified?','Restoring\x20bot(s)\x20from\x20backup','\x1b[34m','get-starting-balances','\x1b[0m','password','Unauthorized\x20login\x20attempt\x20(timeout)','tkn','Unauthorized\x20attempt\x20to\x20store\x20headless\x20configuration','\x20|\x20client:\x20...','250929uxvYYv','0.0.0','2FA\x20login\x20rejected','108095RwuDfn','f2aRequired','pidRefreshToken','getMonth','https://api.ipify.org?format=json','Which\x20bot\x20do\x20you\x20want\x20to\x20stop?','/:bot','messages','add-bot','title','access\x20timeout','store','secret','127.0.0.1','lastmsgtelegram','bbvNew','.zip','Logged\x20out\x20user\x20...','update','517206kmhOKD','botname','mkdirSync','/config\x20-\x20notification\x20types\x20to\x20receive\x0a','NTBA_FIX_319','loginRequired','existsSync','family','Bot\x20Mgr\x20>\x20','handshake','Ok,\x20will\x20send\x20alert\x20notifications\x20only','whitelistEnabled','Your\x20installation\x20does\x20not\x20support\x20updating\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20update','add','push','success','sign','listen','accept','uuid','staging','Network\x20Interfaces:','Notifications\x20enabled','Unauthorized\x20attempt\x20to\x20get\x20messages','reload','hex','whitelist','defaults','Invalid\x20authentication\x20token\x20(1)','Bot\x20Mgr\x20>\x20toggling\x20Bot\x20','manual','Notifications\x20disabled\x0a','bbvReceive','status','chat','************','internal','output-002.log','orders','Unauthorized\x20attempt\x20to\x20store\x20fiat\x20configuration','::ffff:127.0.0.1','get','Logged\x20in\x20user\x20...','server','function','full','binary','11BpTith','all','Unauthorized\x20attempt\x20to\x20update\x20bot','SIGTERM','warning','updatebotmanager','set','login\x20token\x20generated','zip/','simple','telegram2FaApproval','latestversion','telegrammsg','unlinkSync','jsonwebtoken','For\x20which\x20bot\x20do\x20you\x20want\x20the\x20metrics?','Yes','temporaryAccessAllowed','0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@-#$','data','Unauthorized\x20attempt\x20to\x20get\x20starting\x20balances',':\x20Bot\x20Mgr\x20>\x20','length','Are\x20you\x20sure\x20you\x20want\x20to\x20reinstall\x20Balance\x20Bot\x20now?','stopPolling','version.json','/status\x20-\x20show\x20bot(s)\x20status\x0a','Node.js\x20v','pidExpireLogin','blacklist','update-bb','Temporary\x20access\x20rejected','request','alias','answerCallbackQuery','Unauthorized\x20attempt\x20to\x20update\x20Balance\x20Bot','range','All','event','Ok,\x20consider\x20updating\x20Balance\x20Bot\x20later','store-headless','bcryptjs','Bot\x20Mgr\x20>\x20starting\x20all\x20bots','filter','Which\x20bot\x20do\x20you\x20want\x20to\x20toggle?','exec','storeFiat','temporary\x20access\x20rejected','slice','join','log','delete-alerts','-config.json','</b>\x20?','Do\x20you\x20want\x20to\x20reset\x20your\x20password?','sha256','socket','child_process','NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bots\x20are\x20disabled\x20by\x20default\x20-\x20enable\x20those\x20you\x20want\x20to\x20run','telegramChatId','bots','getFullYear','socket.io','login\x20required','Crypt','clients','then','http','Unauthorized\x20attempt\x20to\x20add\x20bot','logs/','referer','util','stringify','backup-full@','***','HTML','keys','Ok,\x20will\x20send\x20order\x20notifications\x20only','exp','bot','replace','kind','\x20mode','get-messages','=>\x20Go\x20to\x20#CYA#http://127.0.0.1:','encryptedUuid','restore-backup-file','-events.json','temporary\x20access\x20not\x20allowed','use','host','connected','reason','path','/names\x20-\x20show\x20bot\x20names\x0a','getSeconds','output-000.log','build','lastmsgemitted','15\x20min','message','alerts','config/','params','disabled','headless','test','Restarting\x20Bot\x20','User\x20has\x20been\x20validated','restart','node-zip','sockets','logged\x20out','copyFileSync','name','./version.json','/:bot/portfolio','backupfile','\x20minutes','parse','secure','sendMessage','node','apiKey','sort','confirm-message','/:bot/coins','Invalid\x20IP\x20address','update-bot','telegramEnabled','\x20to\x20','removeListener','showConfig','24ugMdpH','private','notification','RSA','format','crypto','Unauthorized\x20attempt\x20to\x20delete\x20bot','stopped','map','Unauthorized\x20attempt\x20to\x20store\x20configuration','settings','hybrid-crypto-js','isDirectory','min','remoteAddress','/:bot/configuration','yes','Password\x20reset\x20rejected','headers','reset-password','/help\x20-\x20show\x20available\x20commands\x0a','Unauthorized\x20attempt\x20to\x20upload\x20file\x20(1)','Enabled\x20Bot\x20','exchange','build2','\x20only\x0a','split','placeOrder','storeConfiguration','<b>Telegram\x20Bot\x20Status:</b>\x0a','botID','https://api-eu-central-1.graphcms.com/v2/ckoytzv3lotky01w59glace7y/master','timestamp','#RES#\x20if\x20running\x20on\x20server','login','timeshift','initclient','hasOwnProperty','catch','env','deleteHistoryAlerts','includes','-results.json','reinstall-bb','bb/','Deleted\x20Bot\x20','botmanager','emit','track','Setting\x20access:\x20','Starting\x20Balance\x20Bot\x20update','/upload-backup','show','once','Error\x20removing\x20old\x20backup\x20files:','send','toIPv4Address','output-003.log','new-disabled','Your\x20installation\x20does\x20not\x20support\x20reinstalling\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20reinstallation','For\x20which\x20bot\x20do\x20you\x20want\x20the\x20portfolio?','running','32282nbtqCZ','All\x20bots','username','address','onepagemode','Disabled\x20Bot\x20','Bot\x20Mgr\x20>\x20starting\x20Bot\x20','createServer','get-logs','createWriteStream','toggleBotMode','Your\x20installation\x20is\x20already\x20up\x20to\x20date','backup-full','value','new','Unauthorized\x20attempt\x20to\x20log\x20out','getTime','startsWith','expiry','\x1b[33m','bbUsername','file','auto','any','bot.js','statSync','Invalid\x20authentication\x20token\x20(2)','randomBytes','bb-secure.json','/:bot/support','(((.+)+)+)+$','search','Note:\x20notifications\x20are\x20currently\x20disabled\x20-\x20to\x20enable\x20notifications,\x20type\x20/enable','cancelLoading','download','max','inherit','Unauthorized\x20attempt\x20to\x20restore\x20backup\x20file','/enable\x20-\x20enable\x20notifications\x0a','backup','node-telegram-bot-api','express-fileupload','2FA','404\x20Not\x20Found','cancel-loading','find','Unauthorized\x20attempt\x20to\x20delete\x20alerts','Unauthorized\x20attempt\x20to\x20upload\x20file\x20(2)','getMinutes','bbPassword','All\x20bots\x20running\x20right\x20now','Orders','*$1*','reject','Error:\x20Invalid\x20argument\x20','5\x20min','size','onText','date-fns','telegramIpApproval','versions','live','type','Bot\x20Mgr\x20>\x20stopping\x20all\x20bots','from','[ip-address]','Restore\x20backup\x20file\x20','readdirSync','Backup\x20file\x20uploaded','Bot\x20','Unauthorized\x20attempt\x20to\x20reinstall\x20Balance\x20Bot','forEach','_data','index.html','clientip','-performance.json','\x1b[35m','cloneDeep','remove','Access\x20enabled\x20for\x20','version','login\x20not\x20required','6702450XmRXkN','telegramEvents','\x20|\x20user:\x20...','telegramToken','2FA\x20login\x20token\x20generated','place-order','lowdb','Error\x20while\x20deleting\x20config\x20files:\x20','\x20>\x20','temp/','Restore\x20process\x20aborted','sendMetricsTelegram','Which\x20bot\x20do\x20you\x20want\x20to\x20restart?','toggle-bot-mode','Login\x20accepted','getHours','access','5628rbZfzR','graphql-request','user','auth','Which\x20bot\x20do\x20you\x20want\x20to\x20start?','emitHistory','enabled','api-eu.mixpanel.com','telegram','<b>Balance\x20Bot\x20Status:</b>\x0a','Do\x20you\x20want\x20to\x20restore\x20your\x20installation?\x20NOTE:\x20this\x20will\x20replace\x20your\x20current\x20settings\x20and\x20bot(s)','files','No\x20bots\x20running\x20right\x20now','static','ipv6','/output-000.log','Bearer\x20eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImdjbXMtbWFpbi1wcm9kdWN0aW9uIn0.eyJ2ZXJzaW9uIjozLCJpYXQiOjE2MjE2NjgzMzgsImF1ZCI6WyJodHRwczovL2FwaS1ldS1jZW50cmFsLTEuZ3JhcGhjbXMuY29tL3YyL2Nrb3l0enYzbG90a3kwMXc1OWdsYWNlN3kvbWFzdGVyIiwiaHR0cHM6Ly9tYW5hZ2VtZW50LW5leHQuZ3JhcGhjbXMuY29tIl0sImlzcyI6Imh0dHBzOi8vbWFuYWdlbWVudC5ncmFwaGNtcy5jb20vIiwic3ViIjoiYjZlOTBmODAtZmEzYS00ODJmLWE0NTAtMTY3YTFmZTliNzIzIiwianRpIjoiY2tvemZnaWE0Mno4bTAxdzU5bHU5ZTA3NSJ9.cEJ5isSubzX1ymlpkfyvfgZ6zyUMFiFOVaD4N84NoEOxwGZ8DtYM1k4DlCjoeCcTR8Ftr43bIGDxR4apANAG_-wf9Nge9T2MAuKa9z2sCWA5jnYtTHYU-x1Hx_ShpHAl1wPjrSpTMquV3bRlKQBm6EQTreoaQZgBXY25ClLbVzXFcohcDn3RGi3hHVRvxNLr0F7ETwFJnbowm9UX66vz2SP-5-u-CBKUxSipKMO5za0MZiIWoprSdE0f22xVXp8up3k_6-5x22mS88P2OFgMXoA-UBFS8nz6jRE_fRULzCouKYyJG3oQ10ovuZ1M729GQ0rMv9fkJroVKyS4i8KgglwPPBwQbaD2LCJXINKXYC65DmKyJ9UjWxQ9Lv6akcnkT7CkeqEqzwLnCEQgZEmJS_PBFDu40LMS8UbnwDcntJznA8rH_jsD7IkMdyRyXmns6fbLOc91Q1idBCk-VqUzkL0FzfscCVpkg1J7kGtGeW4YEWhWyPze4ZO4IxM9WRoSsCDUOx3EXklA0WSdR2M6IRnoFL-qoawOLQaaPACy8-QGmaAL6N6fuMIHUWavOTYnyLip0oyy74sUHz4S4sx4mAf5pexlvDcxM_6RIRnCQ84THsM2KwpoWkpR-F2s4pIyfYYn-4R7MNENfPGxNm4INjBYrCOWyZN_vXHGBa4uw2U','express','sendPortfolioTelegram','privateKey','userid','write','assign','settings.','3EPAjjQ','reset-history','entries','getDate','\x20(1)','mode','telegramUsername','Unauthorized\x20attempt\x20to\x20reset\x20bot\x20history','bot-','Notifications\x20types:\x20','Unauthorized\x20attempt\x20to\x20download\x20','constructor','::1','invalid\x20credentials','debug','(staging)','Alerts','production','-----------------------------------------------------------------------------------','Unauthorized\x20attempt\x20to\x20confirm\x20message','/on\x20-\x20start\x20bot(s)\x0a','Starting\x20#RED#Balance\x20Bot\x20v','Starting\x20Balance\x20Bot\x20reinstallation','disconnect','removeAllListeners','lowdb/adapters/FileSync','sendFile','/disable\x20-\x20disable\x20notifications\x0a','ipc','conn','Starting\x20new\x20bot\x20|\x20Bot\x20','/reinstall\x20-\x20reinstall\x20Balance\x20Bot\x0a','post','temporary\x20access\x20timeout','$1_$2_$3','writeFileSync','match','logout','exit','init','Notifications\x20disabled','\x20|\x20','temporary\x20token\x20generated','rmSync','NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bot\x20is\x20disabled\x20by\x20default\x20-\x20enable\x20if\x20you\x20want\x20it\x20to\x20run','padStart','uuid-random','allow','Invalid\x20Telegram\x20token','Server','callback_query','File\x20uploaded','Ok,\x20will\x20send\x20both\x20order\x20and\x20alert\x20notifications','decrypt','hashSync','stop','output-001.log','apiPassword','toString','kill','randomFillSync','Backup\x20file\x20unzipped\x20and\x20stored','bb-settings.json','Unknown\x20client\x20attempting\x20to\x20retrieve\x20list\x20of\x20backup\x20files','readFileSync','No\x20authentication\x20token','reinstall','You\x20can\x20use\x20the\x20following\x20commands:\x0a','token','verify','uncaughtException','/off\x20-\x20stop\x20bot(s)\x0a','publicKey','SIGINT','apiSecret','DEFLATE','\x1b[36m','783675YZLdNP','\x20(2)','66HTxdCE','connection','apply'];_0x3a27=function(){return _0x1c2ebd;};return _0x3a27();}const adapter2=new FileSync(configpath+settingsfile),dbSettings=low(adapter2);dbSettings[_0xcb3954(0x353)]({'settings':{'timeshift':0x0,'loginRequired':![],'bbUsername':'','bbPassword':'','f2aRequired':![],'lastmsgtelegram':0x0,'lastmsgemitted':0x0,'latestversion':_0xcb3954(0x323),'onepagemode':![]}})[_0xcb3954(0x2be)]();const adapter3=new FileSync(configpath+securefile),dbSecure=low(adapter3);dbSecure['defaults']({'secure':{},'blacklist':[]})[_0xcb3954(0x2be)]();let crypt=new Crypt({'md':_0xcb3954(0x1ba),'rsaStandard':'RSA-OAEP'});const saltRounds=0xa,mixpanel=Mixpanel[_0xcb3954(0x2e8)]('6b67f3d61ee94b8f5c80b4affef4c4d9',{'host':_0xcb3954(0x2b0)});let config=getConfiguration(),settings=getSettings(),secure=getSecure(),blacklist=getBlacklist(),tgBot;if(settings[_0xcb3954(0x29b)]&&settings['telegramToken']!=''&&settings[_0xcb3954(0x2c7)]&&settings[_0xcb3954(0x2c7)]!='')initTelegram();const parseColor=(_0x5292f6,_0x269407)=>{const _0x5bed9d=_0xcb3954,_0x3d84d7=/#[A-Z]{3}#/g;if(typeof _0x5292f6=='string'){!_0x269407?_0x5292f6=_0x5292f6[_0x5bed9d(0x1d3)](_0x3d84d7,''):(_0x5292f6=_0x5292f6[_0x5bed9d(0x1d3)](/#BLU#/g,_0x5bed9d(0x31a)),_0x5292f6=_0x5292f6['replace'](/#RED#/g,'\x1b[31m'),_0x5292f6=_0x5292f6['replace'](/#YEL#/g,_0x5bed9d(0x259)),_0x5292f6=_0x5292f6[_0x5bed9d(0x1d3)](/#MAG#/g,_0x5bed9d(0x292)),_0x5292f6=_0x5292f6[_0x5bed9d(0x1d3)](/#CYA#/g,_0x5bed9d(0x30d)),_0x5292f6=_0x5292f6[_0x5bed9d(0x1d3)](/#RES#/g,_0x5bed9d(0x31c)));;}return _0x5292f6;},logger={'screen':_0x236d37=>{const _0x562a34=_0xcb3954;console[_0x562a34(0x1b5)](parseColor(_0x236d37,!![]));},'simple':_0x2071e2=>{const _0x25baa4=_0xcb3954;console[_0x25baa4(0x1b5)](parseColor(_0x2071e2,!![])),loggerfile[_0x25baa4(0x2be)](util[_0x25baa4(0x20c)](parseColor(_0x2071e2,![]))+'\x0a');},'full':async _0x10b201=>{const _0x1c1cf7=_0xcb3954,_0x22de95=getTimeStamp()+_0x1c1cf7(0x37c)+_0x10b201;console[_0x1c1cf7(0x1b5)](parseColor(_0x22de95,!![])),loggerfile['write'](util['format'](parseColor(_0x22de95,![]))+'\x0a');if(tgBot&&settings['telegramChatId']&&settings[_0x1c1cf7(0x299)]!='orders')await tgBot['sendMessage'](settings['telegramChatId'],_0x1c1cf7(0x340)+parseColor(_0x10b201,![]))[_0x1c1cf7(0x22e)](_0x4fd92e=>{telegramError(_0x4fd92e);});},'debug':async(_0x3b188b,_0x15af1e='')=>{const _0x3e81df=_0xcb3954,_0x283deb=getTimeStamp()+':\x20Bot\x20Mgr\x20>\x20[DEBUG]\x20'+_0x3b188b;if(debugging)console['log'](parseColor(_0x283deb,!![]));loggerfile[_0x3e81df(0x2be)](util[_0x3e81df(0x20c)](parseColor(_0x283deb,![]))+'\x0a');if(_0x15af1e){if(debugging)console[_0x3e81df(0x1b5)](_0x15af1e);loggerfile[_0x3e81df(0x2be)](util[_0x3e81df(0x20c)](_0x15af1e)+'\x0a');}}};process['on'](_0xcb3954(0x307),function(_0x211fa7){logger['simple'](_0x211fa7);});let restoredConfigFile=0x0,newBot=![],pid=[];const serverversion=require('./'+bbpath2+_0xcb3954(0x380))[_0xcb3954(0x296)],maxSecretAge=0xa,loginExpiry=0x4*0x3c,tokenRefresh=0x5;let devices=[],lastIpApproval,pidScheduler,installingUpdate=![],publicip,newMessages=[],updateAvailable=![];const express=require(_0xcb3954(0x2ba)),app=express(),http=require(_0xcb3954(0x1c6))[_0xcb3954(0x24d)](app);app[_0xcb3954(0x1dc)](fileUpload({'useTempFiles':!![]})),app[_0xcb3954(0x361)]('/download/:type',async(_0x4b16cf,_0x5c34d3)=>{const _0x2f30db=_0xcb3954,_0x59a1a4=_0x4b16cf[_0x2f30db(0x1ea)][_0x2f30db(0x284)],_0x4f3162=getClientsWithBotID(_0x2f30db(0x236)),_0x15f26b=_0x4b16cf[_0x2f30db(0x21a)]['uuid'],_0x6a53f1=timelyDecrypt(_0x15f26b,![]),_0x2fbbbe=_0x4f3162['find'](_0x3e50b7=>_0x3e50b7['uuid']==_0x6a53f1);if(_0x2fbbbe){const _0x9578e1=normalizeIP(_0x4b16cf[_0x2f30db(0x1bb)][_0x2f30db(0x216)])['store'],_0x2f7614=_0x4b16cf[_0x2f30db(0x21a)]['tkn'];if(validateAccess(_0x2f7614,_0x6a53f1,_0x9578e1)[_0x2f30db(0x2f0)])_0x59a1a4==_0x2f30db(0x26d)&&await backupConfigFiles(),await zipFiles(_0x59a1a4),_0x5c34d3[_0x2f30db(0x268)](zippath+(_0x59a1a4+_0x2f30db(0x335)),_0x48f1dc=>{const _0x153a21=_0x2f30db;_0x48f1dc&&(logger[_0x153a21(0x365)]('Failed\x20to\x20download\x20'+_0x59a1a4),logger[_0x153a21(0x370)](_0x48f1dc));});else logger[_0x2f30db(0x365)](_0x2f30db(0x2cb)+_0x59a1a4+_0x2f30db(0x2c5));}else logger[_0x2f30db(0x365)](_0x2f30db(0x2cb)+_0x59a1a4+_0x2f30db(0x30f));}),app[_0xcb3954(0x2e1)](_0xcb3954(0x23b),async(_0x2b0a27,_0x1d1359)=>{const _0x506552=_0xcb3954,_0x1d8555=getClientsWithBotID(_0x506552(0x236)),_0x583583=_0x2b0a27[_0x506552(0x21a)][_0x506552(0x34b)],_0x3e3452=timelyDecrypt(_0x583583,![]),_0x5468d7=_0x1d8555[_0x506552(0x273)](_0x3a300f=>_0x3a300f[_0x506552(0x34b)]==_0x3e3452);logger[_0x506552(0x2cf)](_0x506552(0x28a));if(_0x5468d7){const _0x103bdb=normalizeIP(_0x2b0a27[_0x506552(0x1bb)]['remoteAddress'])[_0x506552(0x330)],_0x33aaae=_0x2b0a27['headers'][_0x506552(0x31f)];if(validateAccess(_0x33aaae,_0x3e3452,_0x103bdb)[_0x506552(0x2f0)]){if(_0x2b0a27['files']){const _0x1b10f4=_0x2b0a27[_0x506552(0x2b4)][_0x506552(0x1f8)];await _0x1b10f4['mv'](temppath+_0x1b10f4[_0x506552(0x1f5)]),_0x1d1359[_0x506552(0x23f)]({'status':!![],'message':_0x506552(0x2f4)});const _0x7fc2d2=getBotsWithMode();_0x7fc2d2[_0x506552(0x37d)]>0x0?confirmRestore(temppath,_0x1b10f4['name']):unzipFile(temppath,_0x1b10f4[_0x506552(0x1f5)]);}}else logger[_0x506552(0x365)](_0x506552(0x21d));}else logger[_0x506552(0x365)](_0x506552(0x275));}),app['use'](express[_0xcb3954(0x2b6)](path[_0xcb3954(0x1b4)](__dirname,bbpath2,_0xcb3954(0x220)))),app[_0xcb3954(0x1dc)](express[_0xcb3954(0x2b6)](path[_0xcb3954(0x1b4)](__dirname,bbpath2,_0xcb3954(0x1e4)))),app[_0xcb3954(0x361)]('/',function(_0x37ad70,_0x45bf7b){const _0x570339=_0xcb3954;_0x45bf7b[_0x570339(0x2db)](path[_0x570339(0x1b4)](__dirname,bbpath2,_0x570339(0x220),_0x570339(0x28f)));}),app['get'](_0xcb3954(0x32b),function(_0x1f87c0,_0x543ab5){const _0x5c020a=_0xcb3954;_0x543ab5['sendFile'](path[_0x5c020a(0x1b4)](__dirname,bbpath2,'build',_0x5c020a(0x28f)));}),app[_0xcb3954(0x361)](_0xcb3954(0x1f7),(_0x35591e,_0x5c5309)=>{const _0x3a4c3c=_0xcb3954;_0x5c5309[_0x3a4c3c(0x2db)](path['join'](__dirname,bbpath2,'build','index.html'));}),app[_0xcb3954(0x361)]('/:bot/performance',(_0x118239,_0x3ef338)=>{const _0x265744=_0xcb3954;_0x3ef338[_0x265744(0x2db)](path['join'](__dirname,bbpath2,'build',_0x265744(0x28f)));}),app[_0xcb3954(0x361)](_0xcb3954(0x201),(_0x3412bd,_0x4c1b4b)=>{const _0x47bc2f=_0xcb3954;_0x4c1b4b['sendFile'](path['join'](__dirname,bbpath2,_0x47bc2f(0x1e4),'index.html'));}),app[_0xcb3954(0x361)]('/:bot/history',(_0x407b4f,_0x168dff)=>{const _0x2b5d50=_0xcb3954;_0x168dff[_0x2b5d50(0x2db)](path[_0x2b5d50(0x1b4)](__dirname,bbpath2,_0x2b5d50(0x1e4),_0x2b5d50(0x28f)));}),app['get'](_0xcb3954(0x217),(_0xb74770,_0x40132c)=>{const _0x4b272d=_0xcb3954;_0x40132c[_0x4b272d(0x2db)](path[_0x4b272d(0x1b4)](__dirname,bbpath2,_0x4b272d(0x1e4),_0x4b272d(0x28f)));}),app[_0xcb3954(0x361)](_0xcb3954(0x263),(_0x508b97,_0x2fdb84)=>{const _0x2b57c0=_0xcb3954;_0x2fdb84[_0x2b57c0(0x2db)](path[_0x2b57c0(0x1b4)](__dirname,bbpath2,_0x2b57c0(0x1e4),_0x2b57c0(0x28f)));});if(HOST)http[_0xcb3954(0x349)](PORT,HOST);else http[_0xcb3954(0x349)](PORT);const io=require(_0xcb3954(0x1c1))(http,{});init();async function init(){await validateConfigFile(),await initUser(),await initSecure(),oneTimeMigration(),cleanBlacklist(),initStates(),await startServer();if(restoredConfigFile)restoreConfigNotify(![]);startSocket(),startScheduler(),triggerAnalytics(),getMessages(),reloadBotManager();}function getServerIP(){const _0x33d2f6=_0xcb3954;let _0x5ccdd8=_0x33d2f6(0x287);const _0x1fd7d5=networkInterfaces(),_0x5e2c33={};for(const _0x1ae19f of Object['keys'](_0x1fd7d5)){for(const _0x55befb of _0x1fd7d5[_0x1ae19f]){if((_0x55befb[_0x33d2f6(0x33f)]=='IPv4'||_0x55befb[_0x33d2f6(0x33f)]==0x4)&&!_0x55befb[_0x33d2f6(0x35c)]){const _0x38196d=ipaddr[_0x33d2f6(0x1fa)](_0x55befb['address'])[_0x33d2f6(0x1a7)]();_0x38196d!=_0x33d2f6(0x209)&&(!_0x5e2c33[_0x1ae19f]&&(_0x5e2c33[_0x1ae19f]=[]),_0x5e2c33[_0x1ae19f][_0x33d2f6(0x346)](_0x55befb[_0x33d2f6(0x249)]),_0x5ccdd8=_0x55befb[_0x33d2f6(0x249)]);}}}return{'serverip':_0x5ccdd8,'netinterfaces':_0x5e2c33};}async function startServer(){const _0x46faee=_0xcb3954,{serverip:_0x20e379,netinterfaces:_0x4a00c1}=getServerIP();logger['simple'](''),logger[_0x46faee(0x370)]('-----------------------------------------------------------------------------------'),await logger[_0x46faee(0x365)](_0x46faee(0x2d6)+serverversion+'#RES#\x20'+(environment==_0x46faee(0x34c)?_0x46faee(0x2d0):'')+'\x0a'+(_0x46faee(0x1d7)+PORT+'#RES#\x20if\x20running\x20locally\x0a')+('=>\x20Go\x20to\x20#CYA#http://'+_0x20e379+':'+PORT+_0x46faee(0x229))),logger['simple'](_0x46faee(0x2d3));if(config[_0x46faee(0x37d)]!=0x0)for(const _0x411fec of config){if(_0x411fec[_0x46faee(0x359)]==_0x46faee(0x2af)||_0x411fec[_0x46faee(0x359)]==_0x46faee(0x254))await logger[_0x46faee(0x365)]('Starting\x20bot\x20|\x20Bot\x20'+_0x411fec[_0x46faee(0x226)]+_0x46faee(0x2ea)+_0x411fec[_0x46faee(0x339)]),startBot([_0x411fec[_0x46faee(0x226)],userID],{'cwd':bbpath},function(_0x52fe1e){const _0x51a0c9=_0x46faee;if(_0x52fe1e)logger[_0x51a0c9(0x365)](_0x52fe1e);});else(_0x411fec[_0x46faee(0x359)]==_0x46faee(0x1eb)||_0x411fec[_0x46faee(0x359)]==_0x46faee(0x242))&&await logger[_0x46faee(0x365)]('Idling\x20bot\x20\x20\x20|\x20Bot\x20'+_0x411fec[_0x46faee(0x226)]+_0x46faee(0x2ea)+_0x411fec[_0x46faee(0x339)]);}else!newBot&&logger[_0x46faee(0x370)]('>\x20Set\x20up\x20your\x20first\x20bot\x20in\x20the\x20Bot\x20Manager!');if(newBot)addBot();logger['simple'](_0x46faee(0x2d3)),logger['simple'](''),await logger[_0x46faee(0x2cf)](_0x46faee(0x382)+nodeversion),await logger[_0x46faee(0x2cf)](_0x46faee(0x34d),_0x4a00c1);}function startSocket(){const _0x118b59=_0xcb3954;io['on'](_0x118b59(0x311),_0x45117d=>{const _0x26f18c=_0x118b59;let _0x34d2d2,_0x5e95c2,_0x40d206,_0x373a9b,_0x156d0f;const _0x41b6b2=_0x45117d['handshake'][_0x26f18c(0x21a)][_0x26f18c(0x1c9)];_0x5e95c2=_0x41b6b2[_0x26f18c(0x2e5)](/bot[0-9]{3}/);if(_0x5e95c2)_0x40d206=_0x5e95c2[0x0][_0x26f18c(0x2e5)](/[0-9]{3}/);if(_0x40d206)_0x34d2d2=_0x40d206[0x0];else _0x34d2d2='botmanager';const _0x10a8cc=_0x45117d[_0x26f18c(0x341)][_0x26f18c(0x2ac)][_0x26f18c(0x1d8)];if(!_0x10a8cc)_0x45117d['emit'](_0x26f18c(0x359),{'publicKey':secure[_0x26f18c(0x309)]});else{_0x373a9b=timelyDecrypt(_0x10a8cc,![]);if(!_0x373a9b)_0x45117d[_0x26f18c(0x237)]('status',{'publicKey':secure['publicKey']});else{_0x156d0f=normalizeIP(_0x45117d[_0x26f18c(0x2de)]['remoteAddress'])[_0x26f18c(0x330)];if(!devices[_0x373a9b])devices[_0x373a9b]={'uuid':_0x373a9b,'access':{'token':null}};devices[_0x373a9b]['ip']=_0x156d0f;const _0x79062b=addClient(_0x45117d['id'],_0x373a9b,_0x34d2d2);setAccess(_0x79062b),emitMessages(),_0x45117d['on'](_0x26f18c(0x22a),_0x2fccb3=>{const _0x535867=_0x26f18c,_0x5411f6=timelyDecrypt(_0x2fccb3[_0x535867(0x31d)]);if(_0x5411f6){_0x2fccb3={'username':_0x2fccb3[_0x535867(0x248)],'password':_0x5411f6},devices[_0x373a9b]['access']=validateCredentials(_0x2fccb3,_0x373a9b);if(devices[_0x373a9b]['access']['allow']==![]&&devices[_0x373a9b]['access'][_0x535867(0x1df)]==_0x535867(0x314))_0x45117d[_0x535867(0x237)](_0x535867(0x359),{'access':devices[_0x373a9b][_0x535867(0x2a8)]}),loginAccess2FA(_0x373a9b,_0x156d0f);else{if(devices[_0x373a9b]['access'][_0x535867(0x2f0)]==![]&&devices[_0x373a9b][_0x535867(0x2a8)]['reason']==_0x535867(0x2ce))_0x45117d['emit'](_0x535867(0x359),{'access':devices[_0x373a9b][_0x535867(0x2a8)]});else devices[_0x373a9b][_0x535867(0x2a8)][_0x535867(0x2f0)]&&devices[_0x373a9b][_0x535867(0x2a8)][_0x535867(0x1df)]==_0x535867(0x36e)&&(getClientsWithUuid(_0x373a9b)[_0x535867(0x28d)](_0x66ecb6=>{setAccess(_0x66ecb6);}),logger[_0x535867(0x2cf)](_0x535867(0x362)+_0x373a9b[_0x535867(0x1b3)](-0x8)),setTokenRefresh(_0x373a9b),setSessionTimeout(_0x535867(0x22a),_0x373a9b));}}else logger['full'](_0x535867(0x31e));}),_0x45117d['on'](_0x26f18c(0x21b),()=>{resetPassword();}),_0x45117d['on'](_0x26f18c(0x2d8),_0x285f42=>{removeClient(_0x45117d['id']);}),_0x34d2d2==_0x26f18c(0x236)&&(restoredConfigFile&&(restoreConfigNotify(!![]),restoredConfigFile=0x0));}}});}function initClient(_0x43d047){const _0x46b6f9=_0xcb3954;if(_0x43d047!=_0x46b6f9(0x236)&&config[_0x46b6f9(0x1fe)]!=''){if(pid[_0x43d047])pid[_0x43d047][_0x46b6f9(0x23f)]({'function':_0x46b6f9(0x22c),'args':null});}_0x43d047!=_0x46b6f9(0x236)&&broadcastToBots(_0x46b6f9(0x1bf),JSON[_0x46b6f9(0x1cb)](config));}function reloadBotManager(){const _0x10d497=_0xcb3954;getClientsWithBotID('botmanager')[_0x10d497(0x28d)](_0x305dff=>{const _0x7ca7fb=_0x10d497;getSocket(_0x305dff['id'])[_0x7ca7fb(0x237)](_0x7ca7fb(0x359),{'access':{'allow':![],'reason':_0x7ca7fb(0x350),'token':null}});});}function getSocket(_0xb8417c){const _0x4ecf31=_0xcb3954;return io[_0x4ecf31(0x1f2)]['sockets']['get'](_0xb8417c);}function setAccess(_0xba7909){const _0x5814b6=_0xcb3954,_0x106c5b=getSocket(_0xba7909['id']),_0x10471f=_0xba7909[_0x5814b6(0x34b)],_0x3e0b0d=_0xba7909[_0x5814b6(0x1d2)];devices[_0x10471f][_0x5814b6(0x2a8)]=validateAccess(devices[_0x10471f][_0x5814b6(0x2a8)][_0x5814b6(0x305)],_0x10471f),logger['debug'](_0x5814b6(0x239)+devices[_0x10471f][_0x5814b6(0x2a8)][_0x5814b6(0x1df)]+_0x5814b6(0x321)+_0xba7909['id'][_0x5814b6(0x1b3)](-0x8)+_0x5814b6(0x29a)+_0x10471f['slice'](-0x8)),_0x106c5b[_0x5814b6(0x1b4)](_0x10471f);if(devices[_0x10471f][_0x5814b6(0x2a8)]['allow']){_0x106c5b[_0x5814b6(0x1b4)](_0x3e0b0d);if(_0x3e0b0d=='botmanager')initializeSocketBotManager(_0x106c5b);else initializeSocketBot(_0x106c5b);initClient(_0x3e0b0d);}devices[_0x10471f]['access'][_0x5814b6(0x305)]&&devices[_0x10471f][_0x5814b6(0x2a8)][_0x5814b6(0x1df)]==_0x5814b6(0x2eb)&&setSessionTimeout(_0x5814b6(0x270),_0x10471f),devices[_0x10471f]['access'][_0x5814b6(0x305)]&&devices[_0x10471f][_0x5814b6(0x2a8)][_0x5814b6(0x1df)]==_0x5814b6(0x29c)&&setSessionTimeout(_0x5814b6(0x22a),_0x10471f),_0x106c5b[_0x5814b6(0x237)](_0x5814b6(0x359),{'status':_0xba7909[_0x5814b6(0x363)],'serverversion':serverversion,'environment':environment,'servertime':getServerTime(),'access':devices[_0x10471f][_0x5814b6(0x2a8)],'externalip':devices[_0x10471f]['ip'],'publicKey':secure[_0x5814b6(0x309)],'userid':settings[_0x5814b6(0x2bd)],'validInstallation':validInstallation}),devices[_0x10471f][_0x5814b6(0x2a8)][_0x5814b6(0x2f0)]==![]&&devices[_0x10471f]['access'][_0x5814b6(0x1df)]=='2FA\x20required'&&temporaryAccess2FA(_0x10471f,devices[_0x10471f]['ip']);}function setSessionTimeout(_0x5d6b30,_0x5d760f){const _0x3083f0=_0xcb3954;let _0x3c0d0f;if(_0x5d6b30==_0x3083f0(0x22a))_0x3c0d0f=loginExpiry*0x3c*0x3e8;else _0x3c0d0f=devices[_0x5d760f][_0x3083f0(0x281)][_0x3083f0(0x258)]*0x3c*0x3e8-(new Date()[_0x3083f0(0x256)]()-devices[_0x5d760f][_0x3083f0(0x281)][_0x3083f0(0x228)]);if(devices[_0x5d760f][_0x3083f0(0x19f)])clearTimeout(devices[_0x5d760f][_0x3083f0(0x19f)]);devices[_0x5d760f][_0x3083f0(0x19f)]=setTimeout(()=>{const _0x39f6d0=_0x3083f0;if(devices[_0x5d760f][_0x39f6d0(0x327)])clearTimeout(devices[_0x5d760f][_0x39f6d0(0x327)]);removeSocketListeners(_0x5d760f),addBlacklist(_0x5d760f),devices[_0x5d760f][_0x39f6d0(0x281)]=null,devices[_0x5d760f]['telegram2FaApproval']=null,devices[_0x5d760f]['access']['token']=null,logger[_0x39f6d0(0x2cf)]('Session\x20expired\x20for\x20user\x20...'+_0x5d760f['slice'](-0x8)),devices[_0x5d760f][_0x39f6d0(0x2a8)]=validateAccess(devices[_0x5d760f]['access'][_0x39f6d0(0x305)],_0x5d760f),!(devices[_0x5d760f][_0x39f6d0(0x2a8)][_0x39f6d0(0x2f0)]&&devices[_0x5d760f]['access']['reason']==_0x39f6d0(0x297))&&(_0x5d6b30==_0x39f6d0(0x22a)?io['to'](_0x5d760f)['emit'](_0x39f6d0(0x359),{'access':{'allow':![],'reason':_0x39f6d0(0x32f),'token':null}}):io['to'](_0x5d760f)[_0x39f6d0(0x237)](_0x39f6d0(0x359),{'access':{'allow':![],'reason':_0x39f6d0(0x2e2),'token':null}})),devices[_0x5d760f][_0x39f6d0(0x2a8)][_0x39f6d0(0x305)]=null;},_0x3c0d0f);}function setTokenRefresh(_0x2c08e2){const _0x28798f=_0xcb3954;if(devices[_0x2c08e2][_0x28798f(0x327)])clearTimeout(devices[_0x2c08e2][_0x28798f(0x327)]);devices[_0x2c08e2][_0x28798f(0x327)]=setTimeout(()=>{const _0x2aac7d=_0x28798f;getClientsWithUuid(_0x2c08e2)[_0x2aac7d(0x37d)]!=0x0?(devices[_0x2c08e2]['access']=refreshToken(_0x2c08e2),io['to'](_0x2c08e2)[_0x2aac7d(0x237)]('status',{'status':_0x2aac7d(0x1de),'serverversion':serverversion,'environment':environment,'servertime':getServerTime(),'access':devices[_0x2c08e2]['access'],'externalip':devices[_0x2c08e2]['ip'],'publicKey':secure[_0x2aac7d(0x309)],'validInstallation':validInstallation}),setTokenRefresh(_0x2c08e2)):clearTimeout(devices[_0x2c08e2]['pidRefreshToken']);},(tokenRefresh-0x1)*0x3c*0x3e8);}function initializeSocketBotManager(_0x12628e){const _0xb5a8ec=_0xcb3954,_0x14a136=getClient(_0x12628e['id'])[_0xb5a8ec(0x34b)];_0x12628e[_0xb5a8ec(0x237)](_0xb5a8ec(0x1bf),config),_0x12628e['emit'](_0xb5a8ec(0x212),cleanSettings()),_0x12628e['on'](_0xb5a8ec(0x32d),_0x98f8d8=>{const _0x16566b=_0xb5a8ec;if(validateAccess(_0x98f8d8,_0x14a136)[_0x16566b(0x2f0)])addBot();else logger['full'](_0x16566b(0x1c7));}),_0x12628e['on'](_0xb5a8ec(0x203),(_0x409530,_0x2139dc)=>{const _0x3440b3=_0xb5a8ec;if(validateAccess(_0x2139dc,_0x14a136)['allow'])toggleBot(_0x409530[_0x3440b3(0x226)],_0x409530[_0x3440b3(0x359)],_0x409530[_0x3440b3(0x283)]);else logger[_0x3440b3(0x365)](_0x3440b3(0x369));}),_0x12628e['on'](_0xb5a8ec(0x2a5),(_0x3caefe,_0x3fe58e)=>{const _0xf69966=_0xb5a8ec;if(validateAccess(_0x3fe58e,_0x14a136)[_0xf69966(0x2f0)])toggleBotMode(_0x3caefe);else logger[_0xf69966(0x365)]('Unauthorized\x20attempt\x20to\x20update\x20bot');}),_0x12628e['on']('delete-bot',(_0x3f7cc3,_0x4d4fa6)=>{const _0xb39415=_0xb5a8ec;if(validateAccess(_0x4d4fa6,_0x14a136)[_0xb39415(0x2f0)])deleteBot(_0x3f7cc3);else logger['full'](_0xb39415(0x20e));}),_0x12628e['on']('store-settings',(_0x4d55c6,_0x3519cc)=>{const _0x265405=_0xb5a8ec;if(validateAccess(_0x3519cc,_0x14a136)[_0x265405(0x2f0)])storeSettings(_0x4d55c6,!![]);else logger['full']('Unauthorized\x20attempt\x20to\x20update\x20settings');}),_0x12628e['on'](_0xb5a8ec(0x1a1),_0x509854=>{const _0x2ed604=_0xb5a8ec;if(validateAccess(_0x509854,_0x14a136)[_0x2ed604(0x2f0)])updateBB(_0x2ed604(0x337));else logger[_0x2ed604(0x365)](_0x2ed604(0x1a6));}),_0x12628e['on'](_0xb5a8ec(0x233),_0x3e0855=>{const _0x44cac9=_0xb5a8ec;if(validateAccess(_0x3e0855,_0x14a136)['allow'])updateBB(_0x44cac9(0x303));else logger['full'](_0x44cac9(0x28c));}),_0x12628e['on']('get-backup-files',_0xf3a9cc=>{const _0x3daafa=_0xb5a8ec;if(validateAccess(_0xf3a9cc,_0x14a136)[_0x3daafa(0x2f0)]){const _0x59e2d2=getClient(_0x12628e['id']);if(_0x59e2d2)getBackupFiles(_0x59e2d2[_0x3daafa(0x34b)]);else logger['full'](_0x3daafa(0x300));}else logger[_0x3daafa(0x365)]('Unauthorized\x20attempt\x20to\x20retrieve\x20list\x20of\x20backup\x20files');}),_0x12628e['on'](_0xb5a8ec(0x1d9),(_0x186a9f,_0x2328d0)=>{const _0x1bc3d7=_0xb5a8ec;if(validateAccess(_0x2328d0,_0x14a136)['allow'])restoreBackupFile(_0x186a9f);else logger[_0x1bc3d7(0x365)](_0x1bc3d7(0x26b));}),_0x12628e['on'](_0xb5a8ec(0x1d6),_0x234396=>{const _0x2c556d=_0xb5a8ec;if(validateAccess(_0x234396,_0x14a136)[_0x2c556d(0x2f0)])getMessages();else logger[_0x2c556d(0x365)]('Unauthorized\x20attempt\x20to\x20get\x20messages');}),_0x12628e['on']('confirm-message',(_0x10ee8e,_0x2990f6)=>{const _0x47abc5=_0xb5a8ec;if(validateAccess(_0x2990f6,_0x14a136)[_0x47abc5(0x2f0)])confirmMessage(_0x10ee8e);else logger[_0x47abc5(0x365)]('Unauthorized\x20attempt\x20to\x20confirm\x20message');}),_0x12628e['on'](_0xb5a8ec(0x2e6),_0x1679a6=>{const _0x3fcaa9=_0xb5a8ec;if(validateAccess(_0x1679a6,_0x14a136)['allow']){if(devices[_0x14a136]['pidRefreshToken'])clearTimeout(devices[_0x14a136][_0x3fcaa9(0x327)]);if(devices[_0x14a136]['pidExpireLogin'])clearTimeout(devices[_0x14a136][_0x3fcaa9(0x19f)]);removeSocketListeners(getClient(_0x12628e['id'])['uuid']),addBlacklist(_0x14a136),devices[_0x14a136]['telegramIpApproval']=null,devices[_0x14a136][_0x3fcaa9(0x371)]=null,devices[_0x14a136][_0x3fcaa9(0x2a8)]['token']=null,logger[_0x3fcaa9(0x2cf)](_0x3fcaa9(0x336)+_0x14a136[_0x3fcaa9(0x1b3)](-0x8)),io['to'](getClient(_0x12628e['id'])['uuid'])['emit'](_0x3fcaa9(0x359),{'access':{'allow':![],'reason':_0x3fcaa9(0x1f3),'token':null}});}else logger['full'](_0x3fcaa9(0x255));});}function initializeSocketBot(_0x24ba24){const _0x59f44a=_0xcb3954,_0x12f9ed=getClient(_0x24ba24['id'])[_0x59f44a(0x1d2)],_0x3c444b=getClient(_0x24ba24['id'])['uuid'];_0x24ba24['on'](_0x59f44a(0x24e),(_0x3fad19,_0x19b9b8)=>{const _0x3cb6d2=_0x59f44a;if(validateAccess(_0x19b9b8,_0x3c444b)[_0x3cb6d2(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed][_0x3cb6d2(0x23f)]({'function':_0x3cb6d2(0x2ae),'args':_0x3fad19});}else logger[_0x3cb6d2(0x365)]('Unauthorized\x20attempt\x20to\x20get\x20events');}),_0x24ba24['on'](_0x59f44a(0x1b6),(_0x2df2f2,_0x576834)=>{const _0x14405c=_0x59f44a;if(validateAccess(_0x576834,_0x3c444b)[_0x14405c(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed][_0x14405c(0x23f)]({'function':_0x14405c(0x230),'args':_0x2df2f2});}else logger[_0x14405c(0x365)](_0x14405c(0x274));}),_0x24ba24['on']('get-portfolio',(_0x8575d5,_0x169c31)=>{const _0x49d868=_0x59f44a;if(validateAccess(_0x169c31,_0x3c444b)['allow']){if(pid[_0x12f9ed])pid[_0x12f9ed][_0x49d868(0x23f)]({'function':'getPortfolio','args':_0x8575d5});}else logger[_0x49d868(0x365)]('Unauthorized\x20attempt\x20to\x20get\x20portfolio');}),_0x24ba24['on']('store-configuration',(_0x45473b,_0xc11792)=>{const _0x4c6e3f=_0x59f44a;if(validateAccess(_0xc11792,_0x3c444b)[_0x4c6e3f(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed]['send']({'function':_0x4c6e3f(0x224),'args':_0x45473b});}else logger[_0x4c6e3f(0x365)](_0x4c6e3f(0x211));}),_0x24ba24['on'](_0x59f44a(0x1ab),(_0xd58027,_0x15a89c)=>{const _0x594f63=_0x59f44a;if(validateAccess(_0x15a89c,_0x3c444b)[_0x594f63(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed][_0x594f63(0x23f)]({'function':'storeHeadless','args':_0xd58027});}else logger[_0x594f63(0x365)](_0x594f63(0x320));}),_0x24ba24['on']('store-fiat',(_0xe3d5d0,_0x33c97f)=>{const _0xb60b81=_0x59f44a;if(validateAccess(_0x33c97f,_0x3c444b)[_0xb60b81(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed][_0xb60b81(0x23f)]({'function':_0xb60b81(0x1b1),'args':_0xe3d5d0});}else logger[_0xb60b81(0x365)](_0xb60b81(0x35f));}),_0x24ba24['on'](_0x59f44a(0x2c2),_0x3c5377=>{const _0x2fbeb2=_0x59f44a;if(validateAccess(_0x3c5377,_0x3c444b)[_0x2fbeb2(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed]['send']({'function':'resetHistory','args':null});}else logger[_0x2fbeb2(0x365)](_0x2fbeb2(0x2c8));}),_0x24ba24['on'](_0x59f44a(0x31b),_0x5ae319=>{const _0x20ed89=_0x59f44a;if(validateAccess(_0x5ae319,_0x3c444b)[_0x20ed89(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed][_0x20ed89(0x23f)]({'function':'getStartingBalances','args':null});}else logger['full'](_0x20ed89(0x37b));}),_0x24ba24['on'](_0x59f44a(0x29d),(_0x4c61f1,_0x22b185)=>{const _0x20da85=_0x59f44a;if(validateAccess(_0x22b185,_0x3c444b)[_0x20da85(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed][_0x20da85(0x23f)]({'function':_0x20da85(0x223),'args':_0x4c61f1});}else logger[_0x20da85(0x365)]('Unauthorized\x20attempt\x20to\x20place\x20market\x20order');}),_0x24ba24['on'](_0x59f44a(0x272),_0x1afd5b=>{const _0x12fe96=_0x59f44a;if(validateAccess(_0x1afd5b,_0x3c444b)[_0x12fe96(0x2f0)]){if(pid[_0x12f9ed])pid[_0x12f9ed]['send']({'function':_0x12fe96(0x267),'args':null});}else logger['full']('Unauthorized\x20attempt\x20to\x20cancel\x20loading\x20coins');}),_0x24ba24['on']('show-config',_0x24b89f=>{const _0x5f6e31=_0x59f44a;if(validateAccess(_0x24b89f,_0x3c444b)['allow']){if(pid[_0x12f9ed])pid[_0x12f9ed][_0x5f6e31(0x23f)]({'function':_0x5f6e31(0x207),'args':null});}else logger[_0x5f6e31(0x365)]('Unauthorized\x20attempt\x20to\x20show\x20configuration');}),_0x24ba24['on']('update-bb',_0x41a233=>{const _0x1e9c51=_0x59f44a;if(validateAccess(_0x41a233,_0x3c444b)[_0x1e9c51(0x2f0)])updateBB('update');else logger[_0x1e9c51(0x365)]('Unauthorized\x20attempt\x20to\x20update\x20Balance\x20Bot');}),_0x24ba24['on'](_0x59f44a(0x1d6),_0x36ff77=>{const _0x27f46c=_0x59f44a;if(validateAccess(_0x36ff77,_0x3c444b)[_0x27f46c(0x2f0)])getMessages();else logger[_0x27f46c(0x365)](_0x27f46c(0x34f));}),_0x24ba24['on'](_0x59f44a(0x200),(_0xfa3f1d,_0x2569c6)=>{const _0x461a8c=_0x59f44a;if(validateAccess(_0x2569c6,_0x3c444b)[_0x461a8c(0x2f0)])confirmMessage(_0xfa3f1d);else logger['full'](_0x461a8c(0x2d4));}),_0x24ba24['on'](_0x59f44a(0x2e6),_0x4c058b=>{const _0x43eb80=_0x59f44a;if(validateAccess(_0x4c058b,_0x3c444b)[_0x43eb80(0x2f0)]){if(devices[_0x3c444b][_0x43eb80(0x327)])clearTimeout(devices[_0x3c444b][_0x43eb80(0x327)]);if(devices[_0x3c444b]['pidExpireLogin'])clearTimeout(devices[_0x3c444b][_0x43eb80(0x19f)]);removeSocketListeners(getClient(_0x24ba24['id'])[_0x43eb80(0x34b)]),addBlacklist(_0x3c444b),devices[_0x3c444b]['telegramIpApproval']=null,devices[_0x3c444b][_0x43eb80(0x371)]=null,devices[_0x3c444b][_0x43eb80(0x2a8)][_0x43eb80(0x305)]=null,logger[_0x43eb80(0x2cf)](_0x43eb80(0x336)+_0x3c444b[_0x43eb80(0x1b3)](-0x8)),io['to'](getClient(_0x24ba24['id'])['uuid'])['emit'](_0x43eb80(0x359),{'access':{'allow':![],'reason':_0x43eb80(0x1f3),'token':null}});}else logger['full'](_0x43eb80(0x255));});}function removeSocketListeners(_0x215f10){getClientsWithUuid(_0x215f10)['forEach'](_0x3cb47b=>{const _0x364fe6=_0x31f7;getSocket(_0x3cb47b['id'])[_0x364fe6(0x2d9)]();});}function cleanSettings(){const _0x45db4b=_0xcb3954;let _0x2e9766=settings;return settings[_0x45db4b(0x29b)]&&settings['telegramToken']!=''&&(_0x2e9766={..._0x2e9766,'telegramToken':_0x45db4b(0x35b)}),settings[_0x45db4b(0x277)]&&settings[_0x45db4b(0x277)]!=''&&(_0x2e9766={..._0x2e9766,'bbPassword':_0x45db4b(0x35b)}),(settings[_0x45db4b(0x277)]&&settings[_0x45db4b(0x277)]=='***'||settings['telegramToken']&&settings[_0x45db4b(0x29b)]==_0x45db4b(0x1cd))&&(_0x2e9766={..._0x2e9766,'restored':{'password':settings[_0x45db4b(0x277)]==_0x45db4b(0x1cd),'telegram':settings['telegramToken']=='***'}}),_0x2e9766;}async function updateBB(_0x5e6169){const _0x19a38f=_0xcb3954;await backupConfigFiles(),installingUpdate=!![],config[_0x19a38f(0x28d)](_0x2dacab=>{restartBot(_0x2dacab['botID']);});if(_0x5e6169==_0x19a38f(0x337))process[_0x19a38f(0x23f)]({'update':!![],'environment':environment},_0x37a312=>{});else _0x5e6169==_0x19a38f(0x303)&&process['send']({'reinstall':!![],'environment':environment},_0x5361b7=>{});}function startBot(_0xcf3dfe,_0x152f31,_0x3a97c1){const _0x4d6df0=_0xcb3954;if(debugging)_0xcf3dfe[_0x4d6df0(0x346)]('-d');let _0x12e27a=![];const _0x1e8c22=_0xcf3dfe[0x0];_0x152f31={..._0x152f31,'stdio':[_0x4d6df0(0x26a),_0x4d6df0(0x26a),_0x4d6df0(0x26a),_0x4d6df0(0x2dd)]},pid[_0x1e8c22]=childProcess['fork'](botfile,_0xcf3dfe,_0x152f31),pid[_0x1e8c22]['on'](_0x4d6df0(0x1e7),_0x5146ec=>{const _0x3c9940=_0x4d6df0;switch(Object[_0x3c9940(0x1cf)](_0x5146ec)[0x0]){case _0x3c9940(0x339):updateBotName(_0x1e8c22,_0x5146ec[_0x3c9940(0x339)]);break;case _0x3c9940(0x36c):updateBotManager();break;case _0x3c9940(0x359):updateStatus(_0x1e8c22,_0x5146ec[_0x3c9940(0x359)]);break;case _0x3c9940(0x283):updateLive(_0x1e8c22,_0x5146ec['live']);break;case'started':updateLive(_0x1e8c22,_0x5146ec['started']),io['to'](_0x1e8c22)[_0x3c9940(0x237)](_0x3c9940(0x359),{'access':{'allow':![],'reason':'reload','token':null}});break;case _0x3c9940(0x2f8):_0x5146ec[_0x3c9940(0x2f8)]==_0x3c9940(0x1f0)&&restartBot(_0x1e8c22);_0x5146ec['stop']==_0x3c9940(0x2fc)&&toggleBot(_0x1e8c22,'disabled',_0x3c9940(0x20f));break;case _0x3c9940(0x2b1):sendTelegram(_0x1e8c22,_0x5146ec[_0x3c9940(0x2b1)]);break;case _0x3c9940(0x373):sendTelegramMsg(_0x5146ec[_0x3c9940(0x373)]);break;case'function':io['to'](_0x1e8c22)[_0x3c9940(0x237)](_0x5146ec[_0x3c9940(0x364)],_0x5146ec['args']);break;}}),pid[_0x1e8c22]['on']('error',function(_0x1d2e55){if(_0x12e27a)return;_0x12e27a=!![],_0x3a97c1(_0x1d2e55);}),pid[_0x1e8c22]['on'](_0x4d6df0(0x2e7),async function(_0x43bca6){const _0x5b8b1c=_0x4d6df0;if(installingUpdate)return;if(_0x12e27a)return;_0x12e27a=!![],_0x3a97c1(null);const _0x50064c=dbConfig[_0x5b8b1c(0x361)](_0x5b8b1c(0x1bf))[_0x5b8b1c(0x273)]({'botID':_0x1e8c22})[_0x5b8b1c(0x253)]();_0x50064c&&(_0x50064c[_0x5b8b1c(0x359)]==_0x5b8b1c(0x2af)||_0x50064c[_0x5b8b1c(0x359)]==_0x5b8b1c(0x254))&&(await sleep(0x3e8),updateLive(_0x1e8c22,'stopped'),logger['full'](_0x5b8b1c(0x1ee)+_0x1e8c22),startBot([_0x1e8c22,userID],{'cwd':bbpath},function(_0x417dd7){const _0x4f5ff4=_0x5b8b1c;if(_0x417dd7)logger[_0x4f5ff4(0x365)](_0x417dd7);}));});}function stopBot(_0x495892){const _0x158c65=_0xcb3954;getClientsWithBotID(_0x495892)[_0x158c65(0x28d)](_0x505a25=>{const _0x113506=_0x158c65;getSocket(_0x505a25['id'])[_0x113506(0x2d8)](!![]),removeClient(_0x505a25['id']);}),pid[_0x495892]&&(pid[_0x495892][_0x158c65(0x2fc)](),pid[_0x495892]=null);}function restartBot(_0x505358){const _0x4a49b3=_0xcb3954;if(pid[_0x505358])pid[_0x505358][_0x4a49b3(0x2fc)]();}function addBot(){const _0x1f31e8=_0xcb3954;let _0x40e8b6;for(let _0x6b51c8=0x1;_0x6b51c8<0x3e9;_0x6b51c8++){_0x40e8b6=_0x6b51c8[_0x1f31e8(0x2fb)]()[_0x1f31e8(0x2ee)](0x3,'0');let _0x20e9b8=config[_0x1f31e8(0x273)](_0x34adb7=>_0x34adb7[_0x1f31e8(0x226)]==_0x40e8b6);if(!_0x20e9b8)break;}if(_0x40e8b6==='1000'){logger[_0x1f31e8(0x365)]('The\x20maximum\x20of\x20999\x20bots\x20has\x20been\x20reached');return;}logger[_0x1f31e8(0x365)](_0x1f31e8(0x2df)+_0x40e8b6),dbConfig[_0x1f31e8(0x361)]('bots')[_0x1f31e8(0x346)]({'botID':_0x40e8b6,'botname':_0x1f31e8(0x28b)+_0x40e8b6,'status':_0x1f31e8(0x254),'live':''})[_0x1f31e8(0x2be)](),startBot([_0x40e8b6,userID],{'cwd':bbpath},function(_0x567b1e){if(_0x567b1e)logger['full'](_0x567b1e);}),config=getConfiguration(),io['to'](_0x1f31e8(0x236))[_0x1f31e8(0x237)](_0x1f31e8(0x1bf),config),broadcastToBots(_0x1f31e8(0x1bf),JSON[_0x1f31e8(0x1cb)](config));}function deleteBot(_0x459091){const _0x268c71=_0xcb3954;getClientsWithBotID(_0x459091)[_0x268c71(0x28d)](_0x34c602=>{const _0x21f43a=_0x268c71;getSocket(_0x34c602['id'])[_0x21f43a(0x2d8)](!![]),removeClient(_0x34c602['id']);}),dbConfig[_0x268c71(0x361)]('bots')['remove']({'botID':_0x459091})[_0x268c71(0x2be)](),logger[_0x268c71(0x365)](_0x268c71(0x235)+_0x459091),stopBot(_0x459091);try{if(fs['existsSync'](path[_0x268c71(0x1b4)](configpath,'bot-'+_0x459091+_0x268c71(0x1b7))))fs[_0x268c71(0x374)](path[_0x268c71(0x1b4)](configpath,'bot-'+_0x459091+_0x268c71(0x1b7)));if(fs[_0x268c71(0x33e)](path['join'](configpath,'bot-'+_0x459091+_0x268c71(0x1da))))fs[_0x268c71(0x374)](path['join'](configpath,_0x268c71(0x2c9)+_0x459091+'-events.json'));if(fs[_0x268c71(0x33e)](path[_0x268c71(0x1b4)](configpath,_0x268c71(0x2c9)+_0x459091+_0x268c71(0x291))))fs[_0x268c71(0x374)](path[_0x268c71(0x1b4)](configpath,_0x268c71(0x2c9)+_0x459091+'-performance.json'));if(fs[_0x268c71(0x33e)](path['join'](configpath,'bot-'+_0x459091+_0x268c71(0x232))))fs['unlinkSync'](path['join'](configpath,_0x268c71(0x2c9)+_0x459091+'-results.json'));}catch(_0xd483a8){if(_0xd483a8)logger[_0x268c71(0x365)](_0x268c71(0x29f),_0xd483a8);}config=getConfiguration(),io['to'](_0x268c71(0x236))['emit']('bots',config),broadcastToBots(_0x268c71(0x1bf),JSON['stringify'](config));}function toggleBot(_0x3a71b5,_0x51ff74,_0x222cb9){const _0x473406=_0xcb3954;dbConfig[_0x473406(0x361)](_0x473406(0x1bf))[_0x473406(0x273)]({'botID':_0x3a71b5})[_0x473406(0x2bf)]({'status':_0x51ff74})[_0x473406(0x2bf)]({'live':_0x222cb9})[_0x473406(0x2be)]();if(_0x51ff74==_0x473406(0x2af)||_0x51ff74==_0x473406(0x254))logger[_0x473406(0x365)](_0x473406(0x21e)+_0x3a71b5),startBot([_0x3a71b5,userID],{'cwd':bbpath},function(_0x5a1866){const _0x1aadbb=_0x473406;if(_0x5a1866)logger[_0x1aadbb(0x365)](_0x5a1866);});else(_0x51ff74==_0x473406(0x1eb)||_0x51ff74=='new-disabled')&&(logger[_0x473406(0x365)](_0x473406(0x24b)+_0x3a71b5),stopBot(_0x3a71b5));config=getConfiguration(),io['to']('botmanager')[_0x473406(0x237)](_0x473406(0x1bf),config),broadcastToBots('bots',JSON[_0x473406(0x1cb)](config));}function toggleStatus(_0x273692){const _0x4537b0=_0xcb3954;let _0x32e249=dbConfig[_0x4537b0(0x361)](_0x4537b0(0x1bf))['find']({'botID':_0x273692})[_0x4537b0(0x253)](),_0x2f1b1c;if(_0x32e249[_0x4537b0(0x359)]==='enabled')_0x2f1b1c=_0x4537b0(0x1eb);else{if(_0x32e249[_0x4537b0(0x359)]==='new')_0x2f1b1c=_0x4537b0(0x242);else{if(_0x32e249[_0x4537b0(0x359)]===_0x4537b0(0x242))_0x2f1b1c=_0x4537b0(0x254);else{if(_0x32e249[_0x4537b0(0x359)]==='disabled')_0x2f1b1c='enabled';}}}return _0x2f1b1c;}function updateStatus(_0x5d61fa,_0x49b0ea){const _0x3d04ea=_0xcb3954;dbConfig['get'](_0x3d04ea(0x1bf))[_0x3d04ea(0x273)]({'botID':_0x5d61fa})['assign']({'status':_0x49b0ea})['write'](),config=getConfiguration(),io['to'](_0x3d04ea(0x236))['emit'](_0x3d04ea(0x1bf),config),broadcastToBots(_0x3d04ea(0x1bf),JSON[_0x3d04ea(0x1cb)](config));}function updateLive(_0x1647d8,_0xbf0d72){const _0xa59c71=_0xcb3954;dbConfig['get'](_0xa59c71(0x1bf))[_0xa59c71(0x273)]({'botID':_0x1647d8})['assign']({'live':_0xbf0d72})[_0xa59c71(0x2be)](),config=getConfiguration(),io['to'](_0xa59c71(0x236))[_0xa59c71(0x237)](_0xa59c71(0x1bf),config),broadcastToBots('bots',JSON[_0xa59c71(0x1cb)](config));}function updateBotName(_0x44fc0c,_0x1fd8f7){const _0x24de00=_0xcb3954;dbConfig[_0x24de00(0x361)](_0x24de00(0x1bf))[_0x24de00(0x273)]({'botID':_0x44fc0c})[_0x24de00(0x2bf)]({'botname':_0x1fd8f7})[_0x24de00(0x2be)](),config=getConfiguration(),io['to']('botmanager')[_0x24de00(0x237)]('bots',config),broadcastToBots(_0x24de00(0x1bf),JSON[_0x24de00(0x1cb)](config));}function updateBotManager(){const _0x47bdc2=_0xcb3954;config=getConfiguration(),io['to'](_0x47bdc2(0x236))['emit']('bots',config),broadcastToBots(_0x47bdc2(0x1bf),JSON[_0x47bdc2(0x1cb)](config));}function toggleBotMode(_0x3794b3){const _0x7fc605=_0xcb3954;if(pid[_0x3794b3])pid[_0x3794b3][_0x7fc605(0x23f)]({'function':_0x7fc605(0x250),'args':null});else{const _0x1594d4=configpath+_0x7fc605(0x2c9)+_0x3794b3+_0x7fc605(0x1b7),_0x282c5e=fs['readFileSync'](_0x1594d4),_0x286f67=JSON['parse'](_0x282c5e),_0xa086b8=_0x286f67[_0x7fc605(0x1d2)][0x0][_0x7fc605(0x1ec)];_0x286f67[_0x7fc605(0x1d2)][0x0][_0x7fc605(0x1ec)]=!_0xa086b8;const _0x3b4146=JSON[_0x7fc605(0x1cb)](_0x286f67,null,0x2);fs[_0x7fc605(0x2e4)](_0x1594d4,_0x3b4146),config=getConfiguration(),io['to']('botmanager')['emit'](_0x7fc605(0x1bf),config),broadcastToBots('bots',JSON[_0x7fc605(0x1cb)](config));}}function telegramError(_0x5ae80b){const _0x2073e3=_0xcb3954;logger[_0x2073e3(0x370)](getTimeStamp()+':\x20Bot\x20Mgr\x20>\x20Sending\x20Telegram\x20message\x20failed');}function validateTelegram(_0x4ad9bc){const _0x4df2a4=_0xcb3954;if(_0x4ad9bc[_0x4df2a4(0x286)][_0x4df2a4(0x248)]!=settings['telegramUsername']&&'@'+_0x4ad9bc[_0x4df2a4(0x286)]['username']!=settings['telegramUsername'])return tgBot[_0x4df2a4(0x1fc)](_0x4ad9bc[_0x4df2a4(0x35a)]['id'],'Unauthorized\x20user\x20-\x20make\x20sure\x20you\x27ve\x20entered\x20your\x20<b>personal</b>\x20Telegram\x20username\x20in\x20the\x20Bot\x20Manager\x27s\x20settings',{'parse_mode':_0x4df2a4(0x1ce)})[_0x4df2a4(0x22e)](_0x1f595c=>{telegramError(_0x1f595c);}),![];return!![];}async function initTelegram(){const _0x17d9e6=_0xcb3954;if(tgBot)tgBot[_0x17d9e6(0x37f)](),tgBot=null,initTelegram();else{tgBot=new TelegramBot(settings['telegramToken'],{'polling':!![]});let _0x2a77f4=_0x17d9e6(0x304);_0x2a77f4+='\x0a',_0x2a77f4+=_0x17d9e6(0x26c),_0x2a77f4+=_0x17d9e6(0x2dc),_0x2a77f4+=_0x17d9e6(0x33b),_0x2a77f4+='/restart\x20-\x20restart\x20bot(s)\x0a',_0x2a77f4+=_0x17d9e6(0x2d5),_0x2a77f4+=_0x17d9e6(0x308),_0x2a77f4+='/toggle\x20-\x20toggle\x20manual\x20vs\x20auto\x20mode\x0a',_0x2a77f4+=_0x17d9e6(0x1e1),_0x2a77f4+=_0x17d9e6(0x381),_0x2a77f4+='/metrics\x20-\x20show\x20bot\x20performance\x0a',_0x2a77f4+='/portfolio\x20-\x20show\x20bot\x20portfolio\x0a',_0x2a77f4+='/update\x20-\x20update\x20Balance\x20Bot\x0a',_0x2a77f4+=_0x17d9e6(0x2e0),_0x2a77f4+=_0x17d9e6(0x21c);let _0x2768ad='Welcome\x20to\x20your\x20personal\x20Balance\x20Bot\x20Telegram\x20bot!\x0a';_0x2768ad+='\x0a',_0x2768ad+=_0x2a77f4,tgBot[_0x17d9e6(0x27f)](/\/start/,_0x4b429d=>{const _0x16885f=_0x17d9e6;if(!validateTelegram(_0x4b429d))return;if(settings[_0x16885f(0x1be)]!=_0x4b429d[_0x16885f(0x35a)]['id'])updateSetting(_0x16885f(0x1be),_0x4b429d['chat']['id']);updateSetting('telegramEnabled',!![]),tgBot['sendMessage'](_0x4b429d[_0x16885f(0x35a)]['id'],_0x2768ad)[_0x16885f(0x22e)](_0x2cc31b=>{telegramError(_0x2cc31b);});}),tgBot['onText'](/\/enable/,_0x2029f7=>{const _0x45161a=_0x17d9e6;if(!validateTelegram(_0x2029f7))return;if(settings[_0x45161a(0x1be)]!=_0x2029f7[_0x45161a(0x35a)]['id'])updateSetting(_0x45161a(0x1be),_0x2029f7['chat']['id']);updateSetting(_0x45161a(0x204),!![]),tgBot['sendMessage'](_0x2029f7[_0x45161a(0x35a)]['id'],_0x45161a(0x34e))[_0x45161a(0x22e)](_0x7d7fdf=>{telegramError(_0x7d7fdf);});}),tgBot['onText'](/\/config/,async _0x3e45c6=>{const _0x3e8a1b=_0x17d9e6;if(!validateTelegram(_0x3e45c6))return;tgBot['removeListener']('callback_query'),tgBot['sendMessage'](_0x3e45c6['chat']['id'],_0x3e8a1b(0x318),{'reply_markup':{'inline_keyboard':[[{'text':_0x3e8a1b(0x279),'callback_data':'orders'},{'text':_0x3e8a1b(0x2d1),'callback_data':'alerts'},{'text':_0x3e8a1b(0x1a8),'callback_data':_0x3e8a1b(0x368)}]]}})[_0x3e8a1b(0x22e)](_0x39104d=>{telegramError(_0x39104d);}),tgBot['on']('callback_query',async _0x2c1db0=>{const _0x49e8a3=_0x3e8a1b,_0x176416=_0x2c1db0[_0x49e8a3(0x37a)],_0x2f1cd8=_0x2c1db0[_0x49e8a3(0x1e7)];tgBot[_0x49e8a3(0x1a5)](_0x2c1db0['id'])[_0x49e8a3(0x1c5)](async()=>{const _0x5bb8a8=_0x49e8a3;_0x176416==_0x5bb8a8(0x35e)&&(updateSetting(_0x5bb8a8(0x299),_0x5bb8a8(0x35e)),updateSetting(_0x5bb8a8(0x204),!![]),await tgBot[_0x5bb8a8(0x1fc)](_0x2f1cd8[_0x5bb8a8(0x35a)]['id'],_0x5bb8a8(0x1d0))['catch'](_0x3c456b=>{telegramError(_0x3c456b);}));_0x176416==_0x5bb8a8(0x1e8)&&(updateSetting(_0x5bb8a8(0x299),_0x5bb8a8(0x1e8)),updateSetting(_0x5bb8a8(0x204),!![]),await tgBot['sendMessage'](_0x2f1cd8[_0x5bb8a8(0x35a)]['id'],_0x5bb8a8(0x342))[_0x5bb8a8(0x22e)](_0x3577aa=>{telegramError(_0x3577aa);}));_0x176416=='all'&&(updateSetting(_0x5bb8a8(0x299),_0x5bb8a8(0x368)),updateSetting(_0x5bb8a8(0x204),!![]),await tgBot['sendMessage'](_0x2f1cd8['chat']['id'],_0x5bb8a8(0x2f5))[_0x5bb8a8(0x22e)](_0x334eab=>{telegramError(_0x334eab);}));if(!settings[_0x5bb8a8(0x1be)])tgBot[_0x5bb8a8(0x1fc)](_0x2f1cd8[_0x5bb8a8(0x35a)]['id'],_0x5bb8a8(0x266))[_0x5bb8a8(0x22e)](_0x76152b=>{telegramError(_0x76152b);});}),tgBot[_0x49e8a3(0x206)]('callback_query');});}),tgBot[_0x17d9e6(0x27f)](/\/status/,_0x2873e7=>{const _0x62d099=_0x17d9e6;if(!validateTelegram(_0x2873e7))return;const _0x1939ab=getBotsWithMode();let _0x337f59=_0x62d099(0x2b2);config[_0x62d099(0x28d)](_0x466a7a=>{const _0x246baa=_0x62d099,_0x572f65=_0x1939ab['find'](_0x49fae6=>_0x49fae6['botID']==_0x466a7a[_0x246baa(0x226)])[_0x246baa(0x2c6)];_0x337f59+='Bot\x20'+_0x466a7a[_0x246baa(0x226)]+':\x20'+_0x466a7a['status']+_0x246baa(0x2ea)+_0x572f65+_0x246baa(0x2ea)+_0x466a7a[_0x246baa(0x283)]+'\x0a';}),_0x337f59+='\x0a',_0x337f59+=_0x62d099(0x225),_0x337f59+=!settings[_0x62d099(0x204)]?_0x62d099(0x357):'Notifications\x20enabled\x0a',_0x337f59+=settings[_0x62d099(0x204)]?settings[_0x62d099(0x299)]==_0x62d099(0x368)?'Notifications\x20types:\x20orders\x20and\x20alerts\x0a':_0x62d099(0x2ca)+settings[_0x62d099(0x299)]+_0x62d099(0x221):'',tgBot[_0x62d099(0x1fc)](_0x2873e7['chat']['id'],_0x337f59,{'parse_mode':_0x62d099(0x1ce)})[_0x62d099(0x22e)](_0xee107d=>{telegramError(_0xee107d);});}),tgBot[_0x17d9e6(0x27f)](/\/restart/,_0x1e39d0=>{const _0x460410=_0x17d9e6;if(!validateTelegram(_0x1e39d0))return;tgBot['removeListener'](_0x460410(0x2f3));const _0x508728=getEnabledBots();if(_0x508728[_0x460410(0x37d)]==0x0)tgBot[_0x460410(0x1fc)](_0x1e39d0[_0x460410(0x35a)]['id'],_0x460410(0x2b5))[_0x460410(0x22e)](_0x16d9a8=>{telegramError(_0x16d9a8);});else{if(_0x508728[_0x460410(0x37d)]>0x1)_0x508728[_0x460410(0x346)]({'botID':'all'});let _0x5b9740=[],_0xa46fbe=[];const _0x591151=_0x508728[_0x460410(0x37d)]%0x4==0x0||_0x508728[_0x460410(0x37d)]%0x4==0x3||_0x508728[_0x460410(0x37d)]%0x3==0x1?0x4:0x3;let _0xf86443=0x0;_0x508728[_0x460410(0x28d)]((_0x5183db,_0x268660)=>{const _0x2a852d=_0x460410;if(_0x268660%_0x591151==0x0)_0xa46fbe=[];_0xa46fbe[_0x2a852d(0x346)]({'text':_0x5183db[_0x2a852d(0x226)]==_0x2a852d(0x368)?_0x2a852d(0x247):_0x2a852d(0x28b)+_0x5183db[_0x2a852d(0x226)],'callback_data':_0x5183db[_0x2a852d(0x226)]}),_0x268660%_0x591151==0x0&&(_0x5b9740[_0xf86443]=_0xa46fbe,_0xf86443++);}),tgBot['sendMessage'](_0x1e39d0[_0x460410(0x35a)]['id'],_0x460410(0x2a4),{'reply_markup':{'inline_keyboard':_0x5b9740}})[_0x460410(0x22e)](_0x493b10=>{telegramError(_0x493b10);}),tgBot['on'](_0x460410(0x2f3),async _0x1c45f3=>{const _0x197003=_0x460410,_0xaf6de9=_0x1c45f3[_0x197003(0x37a)],_0x592162=_0x1c45f3[_0x197003(0x1e7)];tgBot[_0x197003(0x1a5)](_0x1c45f3['id'])[_0x197003(0x1c5)](async()=>{const _0xa89827=_0x197003;_0xaf6de9==_0xa89827(0x368)?config[_0xa89827(0x28d)](_0x209c06=>{const _0x47c8f5=_0xa89827;restartBot(_0x209c06[_0x47c8f5(0x226)]);}):restartBot(_0xaf6de9);}),tgBot[_0x197003(0x206)](_0x197003(0x2f3));});}}),tgBot['onText'](/\/on/,_0x157387=>{const _0x5f4910=_0x17d9e6;if(!validateTelegram(_0x157387))return;tgBot[_0x5f4910(0x206)]('callback_query');const _0x8d3491=getDisabledBots();if(_0x8d3491['length']==0x0)tgBot['sendMessage'](_0x157387[_0x5f4910(0x35a)]['id'],_0x5f4910(0x278))[_0x5f4910(0x22e)](_0x553f8f=>{telegramError(_0x553f8f);});else{if(_0x8d3491[_0x5f4910(0x37d)]>0x1)_0x8d3491[_0x5f4910(0x346)]({'botID':_0x5f4910(0x368)});let _0x3f71f8=[],_0x12a4a7=[];const _0x50c6fe=_0x8d3491[_0x5f4910(0x37d)]%0x4==0x0||_0x8d3491[_0x5f4910(0x37d)]%0x4==0x3||_0x8d3491[_0x5f4910(0x37d)]%0x3==0x1?0x4:0x3;let _0xe61799=0x0;_0x8d3491['forEach']((_0x4f3e1c,_0xcafa77)=>{const _0x554351=_0x5f4910;if(_0xcafa77%_0x50c6fe==0x0)_0x12a4a7=[];_0x12a4a7[_0x554351(0x346)]({'text':_0x4f3e1c[_0x554351(0x226)]==_0x554351(0x368)?_0x554351(0x247):_0x554351(0x28b)+_0x4f3e1c[_0x554351(0x226)],'callback_data':_0x4f3e1c[_0x554351(0x226)]}),_0xcafa77%_0x50c6fe==0x0&&(_0x3f71f8[_0xe61799]=_0x12a4a7,_0xe61799++);}),tgBot[_0x5f4910(0x1fc)](_0x157387[_0x5f4910(0x35a)]['id'],_0x5f4910(0x2ad),{'reply_markup':{'inline_keyboard':_0x3f71f8}})[_0x5f4910(0x22e)](_0x4208ba=>{telegramError(_0x4208ba);}),tgBot['on'](_0x5f4910(0x2f3),async _0x5b80d1=>{const _0xc9a2c3=_0x5f4910,_0xe3e3b4=_0x5b80d1[_0xc9a2c3(0x37a)],_0x2d5f90=_0x5b80d1[_0xc9a2c3(0x1e7)];tgBot['answerCallbackQuery'](_0x5b80d1['id'])[_0xc9a2c3(0x1c5)](async()=>{const _0x4ba8b9=_0xc9a2c3;_0xe3e3b4==_0x4ba8b9(0x368)?(tgBot['sendMessage'](_0x2d5f90[_0x4ba8b9(0x35a)]['id'],_0x4ba8b9(0x1ad))[_0x4ba8b9(0x22e)](_0x6ff645=>{telegramError(_0x6ff645);}),_0x8d3491[_0x4ba8b9(0x28d)](_0x2400f0=>{const _0x129973=_0x4ba8b9;if(_0x2400f0[_0x129973(0x226)]!='all')toggleBot(_0x2400f0[_0x129973(0x226)],toggleStatus(_0x2400f0[_0x129973(0x226)]),'stopped');})):(tgBot[_0x4ba8b9(0x1fc)](_0x2d5f90[_0x4ba8b9(0x35a)]['id'],_0x4ba8b9(0x24c)+_0xe3e3b4)['catch'](_0x3cac92=>{telegramError(_0x3cac92);}),toggleBot(_0xe3e3b4,toggleStatus(_0xe3e3b4),'stopped'));}),tgBot[_0xc9a2c3(0x206)](_0xc9a2c3(0x2f3));});}}),tgBot['onText'](/\/off/,_0x48e151=>{const _0x197f23=_0x17d9e6;if(!validateTelegram(_0x48e151))return;tgBot[_0x197f23(0x206)]('callback_query');const _0x5041ea=getEnabledBots();if(_0x5041ea['length']==0x0)tgBot[_0x197f23(0x1fc)](_0x48e151['chat']['id'],_0x197f23(0x2b5))[_0x197f23(0x22e)](_0x668422=>{telegramError(_0x668422);});else{if(_0x5041ea[_0x197f23(0x37d)]>0x1)_0x5041ea[_0x197f23(0x346)]({'botID':'all'});let _0x3cbb35=[],_0x2afbcc=[];const _0x5c2044=_0x5041ea[_0x197f23(0x37d)]%0x4==0x0||_0x5041ea['length']%0x4==0x3||_0x5041ea['length']%0x3==0x1?0x4:0x3;let _0x480e8b=0x0;_0x5041ea[_0x197f23(0x28d)]((_0x3aaf10,_0xdf0ff8)=>{const _0x1cca1f=_0x197f23;if(_0xdf0ff8%_0x5c2044==0x0)_0x2afbcc=[];_0x2afbcc[_0x1cca1f(0x346)]({'text':_0x3aaf10[_0x1cca1f(0x226)]=='all'?'All\x20bots':'Bot\x20'+_0x3aaf10[_0x1cca1f(0x226)],'callback_data':_0x3aaf10[_0x1cca1f(0x226)]}),_0xdf0ff8%_0x5c2044==0x0&&(_0x3cbb35[_0x480e8b]=_0x2afbcc,_0x480e8b++);}),tgBot[_0x197f23(0x1fc)](_0x48e151['chat']['id'],_0x197f23(0x32a),{'reply_markup':{'inline_keyboard':_0x3cbb35}})[_0x197f23(0x22e)](_0x2a8bd7=>{telegramError(_0x2a8bd7);}),tgBot['on'](_0x197f23(0x2f3),async _0x75c885=>{const _0x5adf4e=_0x197f23,_0x3c4d4a=_0x75c885['data'],_0x4664ad=_0x75c885[_0x5adf4e(0x1e7)];tgBot['answerCallbackQuery'](_0x75c885['id'])[_0x5adf4e(0x1c5)](async()=>{const _0x2f4fba=_0x5adf4e;_0x3c4d4a==_0x2f4fba(0x368)?(tgBot[_0x2f4fba(0x1fc)](_0x4664ad[_0x2f4fba(0x35a)]['id'],_0x2f4fba(0x285))[_0x2f4fba(0x22e)](_0x51a2c1=>{telegramError(_0x51a2c1);}),_0x5041ea['forEach'](_0x1202d9=>{const _0x9147f0=_0x2f4fba;if(_0x1202d9[_0x9147f0(0x226)]!=_0x9147f0(0x368))toggleBot(_0x1202d9['botID'],toggleStatus(_0x1202d9['botID']),_0x9147f0(0x20f));})):(tgBot[_0x2f4fba(0x1fc)](_0x4664ad[_0x2f4fba(0x35a)]['id'],'Bot\x20Mgr\x20>\x20stopping\x20Bot\x20'+_0x3c4d4a)[_0x2f4fba(0x22e)](_0x47be4a=>{telegramError(_0x47be4a);}),toggleBot(_0x3c4d4a,toggleStatus(_0x3c4d4a),_0x2f4fba(0x20f)));}),tgBot['removeListener'](_0x5adf4e(0x2f3));});}}),tgBot[_0x17d9e6(0x27f)](/\/metrics/,_0xd55875=>{const _0x5cf6a9=_0x17d9e6;if(!validateTelegram(_0xd55875))return;tgBot[_0x5cf6a9(0x206)](_0x5cf6a9(0x2f3));const _0x26e743=getEnabledBots();if(_0x26e743[_0x5cf6a9(0x37d)]==0x0)tgBot[_0x5cf6a9(0x1fc)](_0xd55875[_0x5cf6a9(0x35a)]['id'],_0x5cf6a9(0x2b5))[_0x5cf6a9(0x22e)](_0x15e8bf=>{telegramError(_0x15e8bf);});else{if(_0x26e743['length']>0x1){let _0x2e7074=[],_0xef20ac=[];const _0x1cfda4=_0x26e743['length']%0x4==0x0||_0x26e743[_0x5cf6a9(0x37d)]%0x4==0x3||_0x26e743[_0x5cf6a9(0x37d)]%0x3==0x1?0x4:0x3;let _0xb420f7=0x0;_0x26e743['forEach']((_0x3c83fa,_0x13bd52)=>{const _0x3d718a=_0x5cf6a9;if(_0x13bd52%_0x1cfda4==0x0)_0xef20ac=[];_0xef20ac['push']({'text':_0x3d718a(0x28b)+_0x3c83fa[_0x3d718a(0x226)],'callback_data':_0x3c83fa[_0x3d718a(0x226)]}),_0x13bd52%_0x1cfda4==0x0&&(_0x2e7074[_0xb420f7]=_0xef20ac,_0xb420f7++);}),tgBot[_0x5cf6a9(0x1fc)](_0xd55875[_0x5cf6a9(0x35a)]['id'],_0x5cf6a9(0x376),{'reply_markup':{'inline_keyboard':_0x2e7074}})[_0x5cf6a9(0x22e)](_0x21443d=>{telegramError(_0x21443d);}),tgBot['on'](_0x5cf6a9(0x2f3),async _0x216d47=>{const _0x43fd6c=_0x5cf6a9,_0x235a52=_0x216d47[_0x43fd6c(0x37a)],_0x1b4825=_0x216d47[_0x43fd6c(0x1e7)];tgBot[_0x43fd6c(0x1a5)](_0x216d47['id'])[_0x43fd6c(0x1c5)](async()=>{const _0x4b804e=_0x43fd6c;if(pid[_0x235a52])pid[_0x235a52][_0x4b804e(0x23f)]({'function':_0x4b804e(0x2a3),'args':null});}),tgBot[_0x43fd6c(0x206)](_0x43fd6c(0x2f3));});}else{const _0x59fc76=_0x26e743[0x0][_0x5cf6a9(0x226)];if(pid[_0x59fc76])pid[_0x59fc76][_0x5cf6a9(0x23f)]({'function':_0x5cf6a9(0x2a3),'args':null});}}}),tgBot[_0x17d9e6(0x27f)](/\/portfolio/,_0x341355=>{const _0x205453=_0x17d9e6;if(!validateTelegram(_0x341355))return;tgBot[_0x205453(0x206)](_0x205453(0x2f3));const _0x2838d9=getEnabledBots();if(_0x2838d9[_0x205453(0x37d)]==0x0)tgBot[_0x205453(0x1fc)](_0x341355[_0x205453(0x35a)]['id'],_0x205453(0x2b5))[_0x205453(0x22e)](_0x5c80db=>{telegramError(_0x5c80db);});else{if(_0x2838d9['length']>0x1){let _0xd3f98c=[],_0x38074b=[];const _0x135704=_0x2838d9['length']%0x4==0x0||_0x2838d9['length']%0x4==0x3||_0x2838d9[_0x205453(0x37d)]%0x3==0x1?0x4:0x3;let _0x59d8cf=0x0;_0x2838d9[_0x205453(0x28d)]((_0x3dc616,_0x2357d0)=>{const _0x4710c7=_0x205453;if(_0x2357d0%_0x135704==0x0)_0x38074b=[];_0x38074b[_0x4710c7(0x346)]({'text':'Bot\x20'+_0x3dc616[_0x4710c7(0x226)],'callback_data':_0x3dc616[_0x4710c7(0x226)]}),_0x2357d0%_0x135704==0x0&&(_0xd3f98c[_0x59d8cf]=_0x38074b,_0x59d8cf++);}),tgBot['sendMessage'](_0x341355[_0x205453(0x35a)]['id'],_0x205453(0x244),{'reply_markup':{'inline_keyboard':_0xd3f98c}})[_0x205453(0x22e)](_0x3e5992=>{telegramError(_0x3e5992);}),tgBot['on'](_0x205453(0x2f3),async _0x29c600=>{const _0x456957=_0x205453,_0x34019d=_0x29c600['data'],_0x4628ae=_0x29c600[_0x456957(0x1e7)];tgBot['answerCallbackQuery'](_0x29c600['id'])[_0x456957(0x1c5)](async()=>{const _0x44fba1=_0x456957;if(pid[_0x34019d])pid[_0x34019d][_0x44fba1(0x23f)]({'function':_0x44fba1(0x2bb),'args':null});}),tgBot[_0x456957(0x206)](_0x456957(0x2f3));});}else{const _0x32ba40=_0x2838d9[0x0]['botID'];if(pid[_0x32ba40])pid[_0x32ba40][_0x205453(0x23f)]({'function':_0x205453(0x2bb),'args':null});}}}),tgBot['onText'](/\/update/,async _0x1af862=>{const _0x5edef7=_0x17d9e6;if(!validateTelegram(_0x1af862))return;tgBot[_0x5edef7(0x206)](_0x5edef7(0x2f3)),await getMessages();if(!updateAvailable)tgBot[_0x5edef7(0x1fc)](_0x1af862[_0x5edef7(0x35a)]['id'],_0x5edef7(0x251))[_0x5edef7(0x22e)](_0x30e858=>{telegramError(_0x30e858);});else!validInstallation?tgBot[_0x5edef7(0x1fc)](_0x1af862[_0x5edef7(0x35a)]['id'],_0x5edef7(0x344))['catch'](_0x341c5b=>{telegramError(_0x341c5b);}):(tgBot['sendMessage'](_0x1af862[_0x5edef7(0x35a)]['id'],_0x5edef7(0x317),{'reply_markup':{'inline_keyboard':[[{'text':_0x5edef7(0x377),'callback_data':_0x5edef7(0x218)},{'text':'No','callback_data':'no'}]]}})['catch'](_0x46fead=>{telegramError(_0x46fead);}),tgBot['on'](_0x5edef7(0x2f3),async _0x43df8f=>{const _0x567dcb=_0x5edef7,_0x2a3908=_0x43df8f[_0x567dcb(0x37a)],_0x591799=_0x43df8f[_0x567dcb(0x1e7)];tgBot['answerCallbackQuery'](_0x43df8f['id'])[_0x567dcb(0x1c5)](async()=>{const _0x32863f=_0x567dcb;_0x2a3908=='yes'&&(await tgBot['sendMessage'](_0x591799['chat']['id'],_0x32863f(0x23a))[_0x32863f(0x22e)](_0x3eb283=>{telegramError(_0x3eb283);}),updateBB(_0x32863f(0x337))),_0x2a3908=='no'&&await tgBot['sendMessage'](_0x591799[_0x32863f(0x35a)]['id'],_0x32863f(0x1aa))[_0x32863f(0x22e)](_0x172486=>{telegramError(_0x172486);});}),tgBot[_0x567dcb(0x206)](_0x567dcb(0x2f3));}));}),tgBot[_0x17d9e6(0x27f)](/\/reinstall/,async _0x45082d=>{const _0x5970f3=_0x17d9e6;if(!validateTelegram(_0x45082d))return;tgBot[_0x5970f3(0x206)](_0x5970f3(0x2f3)),!validInstallation?tgBot['sendMessage'](_0x45082d[_0x5970f3(0x35a)]['id'],_0x5970f3(0x243))['catch'](_0x521f89=>{telegramError(_0x521f89);}):(tgBot[_0x5970f3(0x1fc)](_0x45082d[_0x5970f3(0x35a)]['id'],_0x5970f3(0x37e),{'reply_markup':{'inline_keyboard':[[{'text':_0x5970f3(0x377),'callback_data':_0x5970f3(0x218)},{'text':'No','callback_data':'no'}]]}})['catch'](_0x374569=>{telegramError(_0x374569);}),tgBot['on'](_0x5970f3(0x2f3),async _0x3be0c3=>{const _0x3365f6=_0x5970f3,_0x3059a5=_0x3be0c3[_0x3365f6(0x37a)],_0x2fd07b=_0x3be0c3[_0x3365f6(0x1e7)];tgBot[_0x3365f6(0x1a5)](_0x3be0c3['id'])['then'](async()=>{const _0x2ab101=_0x3365f6;_0x3059a5=='yes'&&(await tgBot[_0x2ab101(0x1fc)](_0x2fd07b[_0x2ab101(0x35a)]['id'],_0x2ab101(0x2d7))[_0x2ab101(0x22e)](_0x580d95=>{telegramError(_0x580d95);}),updateBB(_0x2ab101(0x303))),_0x3059a5=='no'&&await tgBot[_0x2ab101(0x1fc)](_0x2fd07b[_0x2ab101(0x35a)]['id'],'Ok,\x20reinstalling\x20Balance\x20Bot\x20canceled')[_0x2ab101(0x22e)](_0xb75f1b=>{telegramError(_0xb75f1b);});}),tgBot[_0x3365f6(0x206)](_0x3365f6(0x2f3));}));}),tgBot[_0x17d9e6(0x27f)](/\/toggle/,_0x2f89c3=>{const _0x3eb131=_0x17d9e6;if(!validateTelegram(_0x2f89c3))return;tgBot[_0x3eb131(0x206)](_0x3eb131(0x2f3));const _0x1ba939=getBotsWithMode();if(_0x1ba939[_0x3eb131(0x37d)]==0x0)tgBot['sendMessage'](_0x2f89c3[_0x3eb131(0x35a)]['id'],'No\x20bots\x20running\x20right\x20now')['catch'](_0x5659a3=>{telegramError(_0x5659a3);});else{let _0x173290=[],_0x5faf75=[];const _0x2e7f51=0x2;let _0x2deaa1=0x0;_0x1ba939[_0x3eb131(0x28d)]((_0xb01b97,_0x526af0)=>{const _0x30cea8=_0x3eb131;if(_0x526af0%_0x2e7f51==0x0)_0x5faf75=[];_0x5faf75[_0x30cea8(0x346)]({'text':_0x30cea8(0x28b)+_0xb01b97[_0x30cea8(0x226)]+'\x20('+_0xb01b97['mode']+')','callback_data':_0xb01b97[_0x30cea8(0x226)]}),_0x526af0%_0x2e7f51==0x0&&(_0x173290[_0x2deaa1]=_0x5faf75,_0x2deaa1++);}),tgBot[_0x3eb131(0x1fc)](_0x2f89c3[_0x3eb131(0x35a)]['id'],_0x3eb131(0x1af),{'reply_markup':{'inline_keyboard':_0x173290}})[_0x3eb131(0x22e)](_0x22c970=>{telegramError(_0x22c970);}),tgBot['on'](_0x3eb131(0x2f3),async _0x2a8122=>{const _0xc4147a=_0x3eb131,_0x5a29f3=_0x2a8122[_0xc4147a(0x37a)],_0x1d632a=_0x2a8122[_0xc4147a(0x1e7)];tgBot[_0xc4147a(0x1a5)](_0x2a8122['id'])[_0xc4147a(0x1c5)](async()=>{const _0x25e566=_0xc4147a,_0x3cc15d=_0x1ba939[_0x25e566(0x273)](_0x39a410=>_0x39a410[_0x25e566(0x226)]==_0x5a29f3),_0x24ff02=_0x3cc15d[_0x25e566(0x2c6)]==_0x25e566(0x25c)?'manual':_0x25e566(0x25c);tgBot['sendMessage'](_0x1d632a[_0x25e566(0x35a)]['id'],_0x25e566(0x355)+_0x5a29f3+_0x25e566(0x205)+_0x24ff02+_0x25e566(0x1d5))[_0x25e566(0x22e)](_0x33e45f=>{telegramError(_0x33e45f);}),toggleBotMode(_0x5a29f3);}),tgBot[_0xc4147a(0x206)](_0xc4147a(0x2f3));});}}),tgBot['onText'](/\/names/,_0x55423a=>{const _0x14bcc3=_0x17d9e6;if(!validateTelegram(_0x55423a))return;let _0x18a8a0='';config[_0x14bcc3(0x28d)](_0x57efe2=>{const _0x5e1508=_0x14bcc3;_0x18a8a0+='Bot\x20'+_0x57efe2[_0x5e1508(0x226)]+':\x20'+_0x57efe2[_0x5e1508(0x339)]+'\x0a';}),tgBot[_0x14bcc3(0x1fc)](_0x55423a[_0x14bcc3(0x35a)]['id'],_0x18a8a0,{'parse_mode':_0x14bcc3(0x1ce)})[_0x14bcc3(0x22e)](_0xeebc8b=>{telegramError(_0xeebc8b);});}),tgBot['onText'](/\/disable/,_0x4f1315=>{const _0x287923=_0x17d9e6;if(!validateTelegram(_0x4f1315))return;tgBot[_0x287923(0x1fc)](_0x4f1315['chat']['id'],_0x287923(0x2e9))[_0x287923(0x22e)](_0x465cf6=>{telegramError(_0x465cf6);}),updateSetting(_0x287923(0x204),![]);}),tgBot[_0x17d9e6(0x27f)](/\/help/,_0x3b09d2=>{const _0x544036=_0x17d9e6;if(!validateTelegram(_0x3b09d2))return;tgBot[_0x544036(0x1fc)](_0x3b09d2[_0x544036(0x35a)]['id'],_0x2a77f4)[_0x544036(0x22e)](_0x4e9a21=>{telegramError(_0x4e9a21);});}),tgBot['on']('polling_error',_0x563a7c=>{const _0x490c18=_0x17d9e6;_0x563a7c[_0x490c18(0x2fb)]()[_0x490c18(0x231)](_0x490c18(0x271))&&(logger[_0x490c18(0x365)](_0x490c18(0x2f1)),tgBot[_0x490c18(0x37f)](),tgBot=null,io['to'](_0x490c18(0x236))[_0x490c18(0x237)](_0x490c18(0x20a),_0x490c18(0x2f1)));}),process[_0x17d9e6(0x23d)](_0x17d9e6(0x30a),()=>{const _0x55d7a1=_0x17d9e6;if(tgBot)tgBot['stopPolling']();process[_0x55d7a1(0x2e7)](0x1);}),process[_0x17d9e6(0x23d)](_0x17d9e6(0x36a),()=>{const _0x2373f4=_0x17d9e6;if(tgBot)tgBot[_0x2373f4(0x37f)]();process[_0x2373f4(0x2e7)](0x1);});}}function disableTelegram(){const _0x541612=_0xcb3954;tgBot&&(tgBot[_0x541612(0x37f)](),tgBot=null);}function sendTelegram(_0x12fe73,_0x3fa854){const _0x1d3bdc=_0xcb3954;if(settings[_0x1d3bdc(0x204)]){if(settings[_0x1d3bdc(0x299)]==_0x1d3bdc(0x368)||(_0x3fa854[_0x1d3bdc(0x284)]=='error'||_0x3fa854[_0x1d3bdc(0x284)]==_0x1d3bdc(0x36b)||_0x3fa854[_0x1d3bdc(0x284)]==_0x1d3bdc(0x347))&&settings['telegramEvents']==_0x1d3bdc(0x1e8)||_0x3fa854[_0x1d3bdc(0x284)]==_0x1d3bdc(0x316)&&settings[_0x1d3bdc(0x299)]=='orders'){if(tgBot&&settings[_0x1d3bdc(0x1be)]){if(_0x3fa854['showname'])tgBot['sendMessage'](settings[_0x1d3bdc(0x1be)],_0x3fa854[_0x1d3bdc(0x339)]+_0x1d3bdc(0x2a0)+_0x3fa854['event'])['catch'](_0x2cd99d=>{telegramError(_0x2cd99d);});else tgBot['sendMessage'](settings['telegramChatId'],_0x1d3bdc(0x28b)+_0x12fe73+_0x1d3bdc(0x2a0)+_0x3fa854[_0x1d3bdc(0x1a9)])[_0x1d3bdc(0x22e)](_0x8a0f0b=>{telegramError(_0x8a0f0b);});}}}}async function sendTelegramMsg(_0x7252b,_0x18d3e4=_0xcb3954(0x1ce)){const _0xb57df6=_0xcb3954;return settings[_0xb57df6(0x204)]&&tgBot&&settings[_0xb57df6(0x1be)]?(await tgBot[_0xb57df6(0x1fc)](settings[_0xb57df6(0x1be)],_0x7252b,{'parse_mode':_0x18d3e4})['catch'](_0x2d7614=>{telegramError(_0x2d7614);}),!![]):![];}function getDeviceWithIp(_0x1009a8){const _0x50997f=_0xcb3954;return devices[_0x50997f(0x273)](_0x4e8920=>_0x4e8920['ip']===_0x1009a8);}function temporaryAccess2FA(_0x21f5ff,_0x3148b3){const _0x542e6a=_0xcb3954;let _0x5bd9eb=new Date(),_0x1b6988=![];if(lastIpApproval){if(_0x5bd9eb-lastIpApproval<0x1388)_0x1b6988=!![];}lastIpApproval=new Date();if(_0x1b6988)return;tgBot&&settings[_0x542e6a(0x1be)]&&(tgBot[_0x542e6a(0x206)](_0x542e6a(0x2f3)),tgBot['sendMessage'](settings[_0x542e6a(0x1be)],'Allow\x20temporary\x20access\x20from\x20IP\x20address\x20<b>'+normalizeIP(_0x3148b3)[_0x542e6a(0x23c)]+_0x542e6a(0x1b8),{'parse_mode':_0x542e6a(0x1ce),'reply_markup':{'inline_keyboard':[[{'text':_0x542e6a(0x27d),'callback_data':'5'},{'text':_0x542e6a(0x1e6),'callback_data':'15'},{'text':'30\x20min','callback_data':'30'},{'text':_0x542e6a(0x27b),'callback_data':_0x542e6a(0x27b)}]]}})[_0x542e6a(0x22e)](_0x3ead19=>{telegramError(_0x3ead19);}),tgBot['on'](_0x542e6a(0x2f3),async _0xc2bf78=>{const _0x13d87d=_0x542e6a,_0x415136=_0xc2bf78[_0x13d87d(0x37a)],_0x14f0b2=_0xc2bf78[_0x13d87d(0x1e7)];tgBot[_0x13d87d(0x1a5)](_0xc2bf78['id'])[_0x13d87d(0x1c5)](async()=>{const _0x38a2f0=_0x13d87d;devices[_0x21f5ff][_0x38a2f0(0x281)]={'clientip':_0x3148b3,'timestamp':new Date()[_0x38a2f0(0x256)](),'expiry':_0x415136},_0x415136!=_0x38a2f0(0x27b)?(await tgBot[_0x38a2f0(0x1fc)](_0x14f0b2[_0x38a2f0(0x35a)]['id'],_0x38a2f0(0x295)+_0x415136+_0x38a2f0(0x1f9),{'parse_mode':_0x38a2f0(0x1ce)})[_0x38a2f0(0x22e)](_0x4a3d16=>{telegramError(_0x4a3d16);}),io['to'](_0x21f5ff)['emit'](_0x38a2f0(0x359),{'access':{'allow':![],'reason':_0x38a2f0(0x350),'token':null}})):(await tgBot[_0x38a2f0(0x1fc)](_0x14f0b2['chat']['id'],_0x38a2f0(0x1a2))[_0x38a2f0(0x22e)](_0x2ea5e2=>{telegramError(_0x2ea5e2);}),io['to'](_0x21f5ff)[_0x38a2f0(0x237)](_0x38a2f0(0x359),{'access':{'allow':![],'reason':_0x38a2f0(0x1b2),'token':null}}));}),tgBot['removeListener']('callback_query');}));}function loginAccess2FA(_0x1bc0a0,_0x15d2d5){const _0x4b74a3=_0xcb3954;tgBot&&settings[_0x4b74a3(0x1be)]&&(tgBot[_0x4b74a3(0x206)](_0x4b74a3(0x2f3)),tgBot[_0x4b74a3(0x1fc)](settings['telegramChatId'],'Allow\x20login\x20from\x20IP\x20address\x20<b>'+normalizeIP(_0x15d2d5)[_0x4b74a3(0x23c)]+_0x4b74a3(0x1b8),{'parse_mode':_0x4b74a3(0x1ce),'reply_markup':{'inline_keyboard':[[{'text':_0x4b74a3(0x34a),'callback_data':loginExpiry},{'text':_0x4b74a3(0x27b),'callback_data':_0x4b74a3(0x27b)}]]}})[_0x4b74a3(0x22e)](_0x391baf=>{telegramError(_0x391baf);}),tgBot['on'](_0x4b74a3(0x2f3),async _0x263b50=>{const _0x33cad4=_0x4b74a3,_0xa598db=_0x263b50[_0x33cad4(0x37a)],_0x168dcc=_0x263b50[_0x33cad4(0x1e7)];tgBot['answerCallbackQuery'](_0x263b50['id'])[_0x33cad4(0x1c5)](async()=>{const _0x48a181=_0x33cad4;devices[_0x1bc0a0][_0x48a181(0x371)]={'clientip':_0x15d2d5,'timestamp':new Date()[_0x48a181(0x256)](),'expiry':_0xa598db},_0xa598db!=_0x48a181(0x27b)?(await tgBot[_0x48a181(0x1fc)](_0x168dcc[_0x48a181(0x35a)]['id'],_0x48a181(0x2a6),{'parse_mode':_0x48a181(0x1ce)})[_0x48a181(0x22e)](_0x519b2a=>{telegramError(_0x519b2a);}),io['to'](_0x1bc0a0)[_0x48a181(0x237)]('status',{'access':{'allow':![],'reason':'reload','token':null}})):(await tgBot['sendMessage'](_0x168dcc[_0x48a181(0x35a)]['id'],'Login\x20rejected')['catch'](_0x391a55=>{telegramError(_0x391a55);}),io['to'](_0x1bc0a0)[_0x48a181(0x237)](_0x48a181(0x359),{'access':{'allow':![],'reason':_0x48a181(0x324),'token':null}}));}),tgBot[_0x33cad4(0x206)]('callback_query');}));}function getConfiguration(){return getBotsWithMode();}function getEnabledBots(){const _0x37867b=_0xcb3954;return dbConfig[_0x37867b(0x361)](_0x37867b(0x1bf))[_0x37867b(0x315)](_0x37867b(0x226))[_0x37867b(0x1ae)]({'status':'enabled'})[_0x37867b(0x253)]()||[];}function getDisabledBots(){const _0x33790d=_0xcb3954;return dbConfig['get'](_0x33790d(0x1bf))[_0x33790d(0x315)](_0x33790d(0x226))['filter']({'status':_0x33790d(0x1eb)})[_0x33790d(0x253)]()||[];}function getBotAttributes(_0x4c4997){const _0x1f3a7a=_0xcb3954;let _0x275dc6={};const _0x5795d6=configpath+_0x1f3a7a(0x2c9)+_0x4c4997+'-config.json',_0x3f6eb1=fs[_0x1f3a7a(0x33e)](_0x5795d6);if(_0x3f6eb1){const _0x5f2423=fs[_0x1f3a7a(0x301)](_0x5795d6);try{const _0x3c3e38=JSON[_0x1f3a7a(0x1fa)](_0x5f2423),_0x126693=_0x3c3e38?_0x3c3e38[_0x1f3a7a(0x1d2)][0x0]['headless']:![];_0x275dc6[_0x1f3a7a(0x2c6)]=_0x126693?_0x1f3a7a(0x25c):_0x1f3a7a(0x356),_0x275dc6[_0x1f3a7a(0x339)]=_0x3c3e38?_0x3c3e38[_0x1f3a7a(0x1d2)][0x0][_0x1f3a7a(0x339)]:_0x1f3a7a(0x28b)+_0x4c4997;}catch(_0x3e1f9c){_0x275dc6['mode']=_0x1f3a7a(0x356),_0x275dc6[_0x1f3a7a(0x339)]=_0x1f3a7a(0x28b)+_0x4c4997;}}else _0x275dc6[_0x1f3a7a(0x2c6)]=_0x1f3a7a(0x356),_0x275dc6[_0x1f3a7a(0x339)]=_0x1f3a7a(0x28b)+_0x4c4997;return _0x275dc6;}function getBotsWithMode(){const _0x388af0=_0xcb3954,_0x2b9907=dbConfig[_0x388af0(0x361)]('bots')[_0x388af0(0x315)](_0x388af0(0x226))[_0x388af0(0x253)]()||[];return _0x2b9907[_0x388af0(0x28d)](_0x11bbaf=>{const _0x2992ec=_0x388af0;let _0x439c8a=getBotAttributes(_0x11bbaf[_0x2992ec(0x226)]);_0x11bbaf[_0x2992ec(0x2c6)]=_0x439c8a[_0x2992ec(0x2c6)];}),_0x2b9907;}function getBotExchanges(){const _0x5b8ecb=_0xcb3954;let _0x149d59=[];const _0x2ff47a=dbConfig['get'](_0x5b8ecb(0x1bf))[_0x5b8ecb(0x315)](_0x5b8ecb(0x226))[_0x5b8ecb(0x253)]()||[];_0x2ff47a[_0x5b8ecb(0x28d)](_0x385f00=>{const _0x41ce21=_0x5b8ecb;if(_0x385f00[_0x41ce21(0x359)]==_0x41ce21(0x2af)){const _0x4f2bd3=configpath+'bot-'+_0x385f00['botID']+'-config.json',_0x2a80de=fs['existsSync'](_0x4f2bd3);let _0x3fdc02;if(_0x2a80de){const _0x5f428b=fs[_0x41ce21(0x301)](_0x4f2bd3);try{const _0x17592c=JSON[_0x41ce21(0x1fa)](_0x5f428b);_0x3fdc02=_0x17592c?_0x17592c[_0x41ce21(0x1d2)][0x0][_0x41ce21(0x21f)]:null;}catch(_0x16f42b){}}if(_0x3fdc02)_0x149d59[_0x41ce21(0x346)](_0x3fdc02);}});const _0xa6cfd=[...new Set(_0x149d59)][_0x5b8ecb(0x1ff)]();return _0xa6cfd;}async function initUser(){const _0x5c626e=_0xcb3954;if(!settings[_0x5c626e(0x2bd)]){const _0x20d3e1=uuidRandom();mixpanel[_0x5c626e(0x1a4)](_0x20d3e1),updateSetting(_0x5c626e(0x2bd),_0x20d3e1);}}async function initSecure(){const _0x58bb0f=_0xcb3954;let _0x878be9=getSecure();if(!_0x878be9[_0x58bb0f(0x22d)](_0x58bb0f(0x331))){let _0x1e1115=await generateKeys();_0x878be9[_0x58bb0f(0x309)]=_0x1e1115[_0x58bb0f(0x309)],_0x878be9[_0x58bb0f(0x2bc)]=_0x1e1115[_0x58bb0f(0x2bc)],_0x878be9['secret']=crypto[_0x58bb0f(0x261)](0x20)[_0x58bb0f(0x2fb)](_0x58bb0f(0x351));;storeSecure(_0x878be9);}}function getSettings(){const _0x26f1d3=_0xcb3954;return dbSettings[_0x26f1d3(0x361)](_0x26f1d3(0x212))['value']()||{};}function getSecure(){const _0x16dc04=_0xcb3954;return dbSecure[_0x16dc04(0x361)]('secure')[_0x16dc04(0x253)]()||{};}function getBlacklist(){const _0xb15bcc=_0xcb3954;return dbSecure[_0xb15bcc(0x361)]('blacklist')[_0xb15bcc(0x253)]()||[];}function broadcastToBots(_0x4a35e8,_0x44fb01){const _0x6a5b23=_0xcb3954;config[_0x6a5b23(0x28d)](_0x26b7ec=>{const _0x4a1d58=_0x6a5b23;if(_0x26b7ec[_0x4a1d58(0x359)]==_0x4a1d58(0x2af)&&_0x26b7ec[_0x4a1d58(0x283)]=='running'||_0x26b7ec[_0x4a1d58(0x359)]==_0x4a1d58(0x254)&&_0x26b7ec[_0x4a1d58(0x283)]==_0x4a1d58(0x245)){if(pid[_0x26b7ec[_0x4a1d58(0x226)]])pid[_0x26b7ec['botID']][_0x4a1d58(0x23f)]({[_0x4a35e8]:_0x44fb01});}});}function storeSettings(_0xb97981,_0x5a1aec=![]){const _0x3c1361=_0xcb3954;_0xb97981={...settings,..._0xb97981};if(_0x5a1aec&&_0xb97981['bbPassword']!=_0x3c1361(0x35b)&&_0xb97981['bbPassword']!='***'&&_0xb97981['bbPassword']!=''){const _0x2b0432=crypt[_0x3c1361(0x2f6)](secure[_0x3c1361(0x2bc)],_0xb97981[_0x3c1361(0x277)])[_0x3c1361(0x1e7)][_0x3c1361(0x222)]('@')[0x0],_0x3aab7c=bcrypt[_0x3c1361(0x2f7)](_0x2b0432,saltRounds);_0xb97981={..._0xb97981,'bbPassword':_0x3aab7c};}if(_0x5a1aec&&_0xb97981[_0x3c1361(0x29b)]!=_0x3c1361(0x35b)&&_0xb97981['telegramToken']!=_0x3c1361(0x1cd)&&_0xb97981['telegramToken']!=''){const _0x1b5a9f=crypt[_0x3c1361(0x2f6)](secure[_0x3c1361(0x2bc)],_0xb97981[_0x3c1361(0x29b)])[_0x3c1361(0x1e7)][_0x3c1361(0x222)]('@')[0x0];_0xb97981={..._0xb97981,'telegramToken':_0x1b5a9f};}const _0x4afd1a=_0xb97981[_0x3c1361(0x29b)]!=_0x3c1361(0x35b)&&_0xb97981[_0x3c1361(0x29b)]!=settings[_0x3c1361(0x29b)]||_0xb97981['telegramUsername']!=settings[_0x3c1361(0x2c7)],_0x302077=_0xb97981[_0x3c1361(0x29b)]==''||_0xb97981['telegramUsername']=='';if(_0x4afd1a)_0xb97981[_0x3c1361(0x299)]='all';for(const [_0xf517d6,_0x16da2a]of Object[_0x3c1361(0x2c3)](_0xb97981)){if(_0xf517d6==_0x3c1361(0x29b)&&_0x16da2a=='************'){_0xb97981[_0x3c1361(0x29b)]=settings['telegramToken'];continue;};if(_0xf517d6==_0x3c1361(0x277)&&_0x16da2a==_0x3c1361(0x35b)){_0xb97981[_0x3c1361(0x277)]=settings[_0x3c1361(0x277)];continue;};dbSettings[_0x3c1361(0x36d)](_0x3c1361(0x2c0)+_0xf517d6,_0x16da2a)[_0x3c1361(0x2be)]();}settings=_0xb97981,io['to'](_0x3c1361(0x236))[_0x3c1361(0x237)](_0x3c1361(0x212),cleanSettings()),broadcastToBots(_0x3c1361(0x22b),settings[_0x3c1361(0x22b)]),broadcastToBots('onepagemode',settings['onepagemode']);if(_0x4afd1a&&!_0x302077)initTelegram();if(_0x4afd1a&&_0x302077)disableTelegram();getAllClients()[_0x3c1361(0x28d)](_0x4f5d7f=>{const _0x16432e=_0x3c1361;getSocket(_0x4f5d7f['id'])[_0x16432e(0x237)](_0x16432e(0x359),{'access':{'allow':![],'reason':_0x16432e(0x350),'token':null}});});}function updateSetting(_0xaeeb89,_0x25e2a5){const _0x3dd6f8=_0xcb3954;dbSettings['set'](_0x3dd6f8(0x2c0)+_0xaeeb89,_0x25e2a5)['write'](),settings=getSettings(),io['to']('botmanager')[_0x3dd6f8(0x237)](_0x3dd6f8(0x212),cleanSettings());}function storeSecure(_0x2c1337){const _0x19a584=_0xcb3954;dbSecure[_0x19a584(0x361)](_0x19a584(0x1fb))[_0x19a584(0x346)](_0x2c1337)[_0x19a584(0x2be)](),secure=_0x2c1337;}function addBlacklist(_0x539299){const _0x560a8a=_0xcb3954;cleanBlacklist();let _0xe9dff1;devices[_0x539299][_0x560a8a(0x281)]?_0xe9dff1=Math[_0x560a8a(0x269)](devices[_0x539299][_0x560a8a(0x281)][_0x560a8a(0x258)],loginExpiry):_0xe9dff1=loginExpiry,dbSecure[_0x560a8a(0x361)](_0x560a8a(0x1a0))[_0x560a8a(0x346)]({'expiry':new Date()[_0x560a8a(0x256)]()+_0xe9dff1*0x3c*0x3e8,'token':devices[_0x539299][_0x560a8a(0x2a8)][_0x560a8a(0x305)]})[_0x560a8a(0x2be)](),blacklist=dbSecure[_0x560a8a(0x361)](_0x560a8a(0x1a0))[_0x560a8a(0x253)]();}function cleanBlacklist(){const _0x4f8c86=_0xcb3954;let _0x2a814e=dbSecure['get'](_0x4f8c86(0x1a0))[_0x4f8c86(0x293)]()[_0x4f8c86(0x253)](),_0x4e43c3=new Date()[_0x4f8c86(0x256)]();_0x2a814e['forEach'](_0x5f1104=>{const _0x49a423=_0x4f8c86;_0x5f1104[_0x49a423(0x258)]<_0x4e43c3&&dbSecure['get'](_0x49a423(0x1a0))['remove']({'expiry':_0x5f1104[_0x49a423(0x258)]})[_0x49a423(0x2be)]();});}function initStates(){const _0x811a89=_0xcb3954;let _0x539dde=getConfiguration();_0x539dde[_0x811a89(0x28d)](_0x4983eb=>{const _0x321cfd=_0x811a89;_0x4983eb[_0x321cfd(0x283)]=_0x321cfd(0x20f);}),storeConfiguration(_0x539dde);}function onKeys(){const _0x3a0e91=new RSA();return new Promise(_0x5c24b7=>{_0x3a0e91['generateKeyPairAsync']()['then'](_0x8179b2=>{_0x5c24b7(_0x8179b2);});});}async function generateKeys(){return await onKeys();}async function oneTimeMigration(){const _0x36bae7=_0xcb3954;let _0x5ad047=getSettings(),_0x79ad33=![];!_0x5ad047[_0x36bae7(0x22d)](_0x36bae7(0x333))&&(_0x5ad047[_0x36bae7(0x333)]=0x0,_0x79ad33=!![]);!_0x5ad047[_0x36bae7(0x22d)](_0x36bae7(0x1e5))&&(_0x5ad047['lastmsgemitted']=0x0,_0x79ad33=!![]);!_0x5ad047[_0x36bae7(0x22d)](_0x36bae7(0x372))&&(_0x5ad047[_0x36bae7(0x372)]=_0x36bae7(0x323),_0x79ad33=!![]);!_0x5ad047[_0x36bae7(0x22d)](_0x36bae7(0x24a))&&(_0x5ad047['onepagemode']=![],_0x79ad33=!![]);if(_0x79ad33)storeSettings(_0x5ad047);try{fs[_0x36bae7(0x289)](configbackuppath,{'withFileTypes':!![]})['forEach'](_0x4bba41=>{const _0x4aae15=_0x36bae7;if(!_0x4bba41[_0x4aae15(0x214)]()){if(!_0x4bba41[_0x4aae15(0x1f5)][_0x4aae15(0x257)](_0x4aae15(0x1cc)))fs[_0x4aae15(0x374)](configbackuppath+_0x4bba41[_0x4aae15(0x1f5)]);}else fs[_0x4aae15(0x2ec)](configbackuppath+_0x4bba41[_0x4aae15(0x1f5)],{'recursive':!![]});});}catch(_0x4fb695){logger['debug'](_0x36bae7(0x23e),_0x4fb695);}}function storeConfiguration(_0xddf70e){const _0x2f5ae2=_0xcb3954;dbConfig[_0x2f5ae2(0x361)](_0x2f5ae2(0x1bf))[_0x2f5ae2(0x294)]()[_0x2f5ae2(0x2be)](),_0xddf70e[_0x2f5ae2(0x28d)](_0x1099af=>{const _0x3a611d=_0x2f5ae2;delete _0x1099af[_0x3a611d(0x2c6)];}),dbConfig[_0x2f5ae2(0x361)]('bots')['push'](..._0xddf70e)['write'](),config=_0xddf70e;}function resetPassword(){const _0x5566ff=_0xcb3954;tgBot&&settings[_0x5566ff(0x1be)]&&(tgBot['removeListener']('callback_query'),tgBot['sendMessage'](settings[_0x5566ff(0x1be)],_0x5566ff(0x1b9),{'parse_mode':'HTML','reply_markup':{'inline_keyboard':[[{'text':_0x5566ff(0x218),'callback_data':_0x5566ff(0x218)},{'text':'no','callback_data':'no'}]]}})[_0x5566ff(0x22e)](_0x130f25=>{telegramError(_0x130f25);}),tgBot['on'](_0x5566ff(0x2f3),async _0x275071=>{const _0x5b9681=_0x5566ff,_0x6ad67e=_0x275071[_0x5b9681(0x37a)],_0x123c0b=_0x275071[_0x5b9681(0x1e7)];tgBot[_0x5b9681(0x1a5)](_0x275071['id'])['then'](async()=>{const _0x5694dd=_0x5b9681;if(_0x6ad67e!='no'){const _0x22e82d=0xf,_0x566d10=_0x5694dd(0x379),_0x5b036e=Array[_0x5694dd(0x286)](crypto[_0x5694dd(0x2fd)](new Uint32Array(_0x22e82d)))[_0x5694dd(0x210)](_0x35cc2c=>_0x566d10[_0x35cc2c%_0x566d10[_0x5694dd(0x37d)]])[_0x5694dd(0x1b4)](''),_0x39f9a1=bcrypt['hashSync'](_0x5b036e,saltRounds);storeSettings({'bbPassword':_0x39f9a1}),await tgBot[_0x5694dd(0x1fc)](_0x123c0b[_0x5694dd(0x35a)]['id'],'Password\x20has\x20been\x20reset\x20to:\x20'+_0x5b036e,{'parse_mode':_0x5694dd(0x1ce)})['catch'](_0x19174e=>{telegramError(_0x19174e);});}else await tgBot[_0x5694dd(0x1fc)](_0x123c0b[_0x5694dd(0x35a)]['id'],_0x5694dd(0x219))[_0x5694dd(0x22e)](_0x5dc7cf=>{telegramError(_0x5dc7cf);});}),tgBot[_0x5b9681(0x206)]('callback_query');}));}async function confirmRestore(_0x1fa718,_0x10c4cb){const _0x31e984=_0xcb3954;io['to'](_0x31e984(0x236))['emit'](_0x31e984(0x20a),'Please\x20confirm\x20restoring\x20in\x20your\x20Telegram\x20bot',_0x31e984(0x347)),tgBot&&settings[_0x31e984(0x1be)]&&(tgBot['removeListener']('callback_query'),await tgBot[_0x31e984(0x1fc)](settings[_0x31e984(0x1be)],_0x31e984(0x2b3),{'parse_mode':_0x31e984(0x1ce),'reply_markup':{'inline_keyboard':[[{'text':_0x31e984(0x218),'callback_data':_0x31e984(0x218)},{'text':'no','callback_data':'no'}]]}})[_0x31e984(0x22e)](_0x3aa1e1=>{telegramError(_0x3aa1e1);}),tgBot['on']('callback_query',async _0x80d8c4=>{const _0x5629df=_0x31e984,_0x1e7d05=_0x80d8c4[_0x5629df(0x37a)],_0x24848f=_0x80d8c4['message'];tgBot[_0x5629df(0x1a5)](_0x80d8c4['id'])[_0x5629df(0x1c5)](async()=>{const _0x2fa14b=_0x5629df;_0x1e7d05=='yes'?(await tgBot[_0x2fa14b(0x1fc)](_0x24848f['chat']['id'],_0x2fa14b(0x319),{'parse_mode':'HTML'})[_0x2fa14b(0x22e)](_0x6595ff=>{telegramError(_0x6595ff);}),unzipFile(_0x1fa718,_0x10c4cb)):(logger[_0x2fa14b(0x2cf)](_0x2fa14b(0x2a2)),await tgBot[_0x2fa14b(0x1fc)](_0x24848f[_0x2fa14b(0x35a)]['id'],_0x2fa14b(0x2a2))['catch'](_0x58740f=>{telegramError(_0x58740f);}));}),tgBot[_0x5629df(0x206)]('callback_query');}));}function getServerTime(){const _0xfe8dc5=_0xcb3954,_0x5721e1=new Date();return _0x5721e1[_0xfe8dc5(0x1c0)]()+'/'+(_0x5721e1[_0xfe8dc5(0x328)]()+0x1)['toString']()[_0xfe8dc5(0x2ee)](0x2,'0')+'/'+_0x5721e1[_0xfe8dc5(0x2c4)]()['toString']()[_0xfe8dc5(0x2ee)](0x2,'0')+'\x20'+_0x5721e1[_0xfe8dc5(0x2a7)]()['toString']()[_0xfe8dc5(0x2ee)](0x2,'0')+':'+_0x5721e1['getMinutes']()[_0xfe8dc5(0x2fb)]()['padStart'](0x2,'0')+':'+_0x5721e1[_0xfe8dc5(0x1e2)]()[_0xfe8dc5(0x2fb)]()['padStart'](0x2,'0');}function getTimeStamp(){const _0x562105=_0xcb3954,_0xb99b1f=shiftedTime();return _0xb99b1f['getFullYear']()+'/'+(_0xb99b1f[_0x562105(0x328)]()+0x1)[_0x562105(0x2fb)]()[_0x562105(0x2ee)](0x2,'0')+'/'+_0xb99b1f['getDate']()[_0x562105(0x2fb)]()[_0x562105(0x2ee)](0x2,'0')+'\x20'+_0xb99b1f['getHours']()[_0x562105(0x2fb)]()[_0x562105(0x2ee)](0x2,'0')+':'+_0xb99b1f[_0x562105(0x276)]()['toString']()[_0x562105(0x2ee)](0x2,'0')+':'+_0xb99b1f[_0x562105(0x1e2)]()[_0x562105(0x2fb)]()[_0x562105(0x2ee)](0x2,'0');}function getCleanTimeStamp(){const _0x1326bb=_0xcb3954,_0x3d8a9a=shiftedTime();return _0x3d8a9a['getFullYear']()+(_0x3d8a9a[_0x1326bb(0x328)]()+0x1)[_0x1326bb(0x2fb)]()[_0x1326bb(0x2ee)](0x2,'0')+_0x3d8a9a['getDate']()[_0x1326bb(0x2fb)]()[_0x1326bb(0x2ee)](0x2,'0')+'-'+_0x3d8a9a[_0x1326bb(0x2a7)]()['toString']()[_0x1326bb(0x2ee)](0x2,'0')+_0x3d8a9a['getMinutes']()[_0x1326bb(0x2fb)]()[_0x1326bb(0x2ee)](0x2,'0')+_0x3d8a9a['getSeconds']()['toString']()[_0x1326bb(0x2ee)](0x2,'0');}function shiftedTime(){const _0x389afa=_0xcb3954,_0x2df30a=new Date();let _0x572c08=_0x2df30a;if(settings[_0x389afa(0x22b)]&&settings[_0x389afa(0x22b)]!==0x0)_0x572c08=fns[_0x389afa(0x345)](_0x2df30a,{'hours':settings[_0x389afa(0x22b)]});return _0x572c08;}function startScheduler(){const _0x11567a=_0xcb3954,_0x505cc3=new Date()['getUTCHours'](),_0x412c3c=shiftedTime()[_0x11567a(0x2a7)]();_0x412c3c==0x4&&backupConfigFiles();_0x412c3c==0x0&&rotateLogFiles();_0x505cc3%0x6==0x0&&triggerAnalytics();_0x505cc3%0x6==0x0&&getMessages();if(pidScheduler)clearTimeout(pidScheduler);pidScheduler=setTimeout(()=>{startScheduler();},0x3c*0x3c*0x3e8);}async function restoreBackupFile(_0x406869){const _0x15755d=_0xcb3954;logger[_0x15755d(0x2cf)](_0x15755d(0x288)+_0x406869);const _0x5f5a40=getBotsWithMode();_0x5f5a40[_0x15755d(0x37d)]>0x0?confirmRestore(configbackuppath,_0x406869):unzipFile(configbackuppath,_0x406869);}async function getBackupFiles(_0x5bc119=null){const _0x3f9079=_0xcb3954;let _0x1d76e5=[],_0x3c4709=fs['readdirSync'](configbackuppath,{'withFileTypes':!![]});_0x3c4709[_0x3f9079(0x1ff)]((_0x147ca2,_0x1027ba)=>_0x147ca2['name']<_0x1027ba[_0x3f9079(0x1f5)]?0x1:_0x1027ba[_0x3f9079(0x1f5)]<_0x147ca2['name']?-0x1:0x0),_0x3c4709[_0x3f9079(0x28d)](_0x2dea0b=>{const _0x231ea9=_0x3f9079;if(!_0x2dea0b[_0x231ea9(0x214)]()&&_0x2dea0b[_0x231ea9(0x1f5)][_0x231ea9(0x257)](_0x231ea9(0x1cc))&&_0x2dea0b[_0x231ea9(0x1f5)]['endsWith']('.zip')){const _0x53b0b1=formatDate(fs[_0x231ea9(0x25f)](configbackuppath+_0x2dea0b[_0x231ea9(0x1f5)])['mtime']);_0x1d76e5[_0x231ea9(0x346)]({'name':_0x2dea0b[_0x231ea9(0x1f5)],'mtime':_0x53b0b1});}});if(_0x5bc119)io['to'](_0x5bc119)[_0x3f9079(0x237)]('backup-files',_0x1d76e5);else return _0x1d76e5;}async function backupConfigFiles(){const _0x4553bb=_0xcb3954;await zipFiles(_0x4553bb(0x252));const _0x406233=getCleanTimeStamp();fs[_0x4553bb(0x1f4)](zippath+'backup-full.zip',configbackuppath+(_0x4553bb(0x1cc)+_0x406233+'.zip'));let _0x279e4d=fs['readdirSync'](configbackuppath,{'withFileTypes':!![]});_0x279e4d['sort']((_0x594d8a,_0x123b58)=>_0x594d8a[_0x4553bb(0x1f5)]<_0x123b58[_0x4553bb(0x1f5)]?0x1:_0x123b58[_0x4553bb(0x1f5)]<_0x594d8a['name']?-0x1:0x0),_0x279e4d[_0x4553bb(0x37d)]>maxBackups&&fs['unlinkSync'](configbackuppath+_0x279e4d[_0x279e4d['length']-0x1][_0x4553bb(0x1f5)]);}function rotateLogFiles(){const _0x1c8924=_0xcb3954,_0x505e05=fs[_0x1c8924(0x25f)](logspath+_0x1c8924(0x1e3)),_0x17effe=_0x505e05[_0x1c8924(0x27e)]/0x400;if(_0x17effe>0x64){let _0x4a89a6=fs[_0x1c8924(0x289)](logspath,{'withFileTypes':!![]});_0x4a89a6[_0x1c8924(0x1ff)]((_0x3dd078,_0x28f692)=>_0x3dd078[_0x1c8924(0x1f5)]<_0x28f692['name']?0x1:_0x28f692[_0x1c8924(0x1f5)]<_0x3dd078[_0x1c8924(0x1f5)]?-0x1:0x0),_0x4a89a6['forEach'](_0x24d83d=>{const _0x4d2042=_0x1c8924;if(_0x24d83d[_0x4d2042(0x1f5)]=='output-002.log')fs[_0x4d2042(0x1f4)](logspath+_0x24d83d[_0x4d2042(0x1f5)],logspath+_0x4d2042(0x241));if(_0x24d83d[_0x4d2042(0x1f5)]==_0x4d2042(0x2f9))fs[_0x4d2042(0x1f4)](logspath+_0x24d83d[_0x4d2042(0x1f5)],logspath+_0x4d2042(0x35d));_0x24d83d[_0x4d2042(0x1f5)]==_0x4d2042(0x1e3)&&(fs[_0x4d2042(0x1f4)](logspath+_0x24d83d[_0x4d2042(0x1f5)],logspath+_0x4d2042(0x2f9)),fs['writeFileSync'](logspath+_0x24d83d[_0x4d2042(0x1f5)],''));});}}function _0x31f7(_0x3957c6,_0x2e17af){const _0x50f5dd=_0x3a27();return _0x31f7=function(_0x5d7422,_0x3d067c){_0x5d7422=_0x5d7422-0x19f;let _0x3a27f6=_0x50f5dd[_0x5d7422];return _0x3a27f6;},_0x31f7(_0x3957c6,_0x2e17af);}async function zipFiles(_0x2f20c2){const _0x88167=_0xcb3954;let _0x41eebe;if(_0x2f20c2=='logs')_0x41eebe=logspath;if(_0x2f20c2=='backup')_0x41eebe=configpath;if(_0x2f20c2==_0x88167(0x252))_0x41eebe=configpath;let _0x29cdbd=fs[_0x88167(0x289)](_0x41eebe,{'withFileTypes':!![]});const _0x1e5cff=new require(_0x88167(0x1f1))();_0x29cdbd[_0x88167(0x28d)](_0x52ff06=>{const _0x26066e=_0x88167;if(!_0x52ff06[_0x26066e(0x214)]()){let _0x57512c=fs['readFileSync'](_0x41eebe+_0x52ff06[_0x26066e(0x1f5)]);if(_0x2f20c2==_0x26066e(0x26d)){const _0x5efb4a=/^bot-[0-9]{3}-config.json$/,_0x3971d3=_0x5efb4a[_0x26066e(0x1ed)](_0x52ff06[_0x26066e(0x1f5)]);if(_0x3971d3){const _0x3e1a09=JSON[_0x26066e(0x1fa)](_0x57512c);if(_0x3e1a09[_0x26066e(0x1d2)][0x0]){_0x3e1a09[_0x26066e(0x1d2)][0x0][_0x26066e(0x1fe)]='***',_0x3e1a09[_0x26066e(0x1d2)][0x0][_0x26066e(0x30b)]=_0x26066e(0x1cd);if(_0x3e1a09['bot'][0x0][_0x26066e(0x2fa)])_0x3e1a09['bot'][0x0][_0x26066e(0x2fa)]=_0x26066e(0x1cd);}_0x57512c=JSON[_0x26066e(0x1cb)](_0x3e1a09,null,0x2);}if(_0x52ff06['name']=='bb-settings.json'){const _0x3a6aa7=JSON['parse'](_0x57512c);if(_0x3a6aa7['settings'][_0x26066e(0x33d)])_0x3a6aa7[_0x26066e(0x212)][_0x26066e(0x33d)]=![];if(_0x3a6aa7[_0x26066e(0x212)][_0x26066e(0x277)])_0x3a6aa7['settings'][_0x26066e(0x277)]='***';if(_0x3a6aa7[_0x26066e(0x212)][_0x26066e(0x29b)])_0x3a6aa7[_0x26066e(0x212)][_0x26066e(0x29b)]=_0x26066e(0x1cd);if(_0x3a6aa7[_0x26066e(0x212)][_0x26066e(0x1be)])_0x3a6aa7[_0x26066e(0x212)][_0x26066e(0x1be)]=null;_0x57512c=JSON['stringify'](_0x3a6aa7,null,0x2);}if(_0x52ff06[_0x26066e(0x1f5)]!=_0x26066e(0x262))_0x1e5cff[_0x26066e(0x25b)](_0x52ff06[_0x26066e(0x1f5)],_0x57512c);}else _0x1e5cff[_0x26066e(0x25b)](_0x52ff06['name'],_0x57512c);}});const _0x11cc03=_0x1e5cff['generate']({'base64':![],'compression':_0x88167(0x30c)});fs[_0x88167(0x2e4)](zippath+(_0x2f20c2+_0x88167(0x335)),_0x11cc03,_0x88167(0x366));}async function unzipFile(_0xa1c6eb,_0x5b1de0){const _0x1175f6=_0xcb3954;fs[_0x1175f6(0x289)](configpath,{'withFileTypes':!![]})[_0x1175f6(0x28d)](_0xa8d3e0=>{const _0x46f38b=_0x1175f6;if(!_0xa8d3e0[_0x46f38b(0x214)]())fs['rmSync'](configpath+_0xa8d3e0['name']);});const _0x31c924=fs[_0x1175f6(0x301)](_0xa1c6eb+_0x5b1de0,_0x1175f6(0x366)),_0x16393e=new require('node-zip')(_0x31c924,{'base64':![],'checkCRC32':!![]});Object[_0x1175f6(0x1cf)](_0x16393e[_0x1175f6(0x2b4)])[_0x1175f6(0x28d)](_0x4348f6=>{const _0x4ddfd7=_0x1175f6,_0x44a95=_0x16393e[_0x4ddfd7(0x2b4)][_0x4348f6];fs['writeFileSync'](configpath+_0x44a95[_0x4ddfd7(0x1f5)],_0x44a95[_0x4ddfd7(0x28e)]);}),fs[_0x1175f6(0x289)](temppath,{'withFileTypes':!![]})[_0x1175f6(0x28d)](_0x3fb59c=>{const _0x30372e=_0x1175f6;if(!_0x3fb59c[_0x30372e(0x214)]())fs['rmSync'](temppath+_0x3fb59c[_0x30372e(0x1f5)]);}),logger['debug'](_0x1175f6(0x2fe)),process[_0x1175f6(0x23f)]({'restore':!![]},_0x211d37=>{});}async function getPublicIp(){const _0x34da0c=_0xcb3954;try{const _0x2176a4=await axios[_0x34da0c(0x361)](_0x34da0c(0x329));publicip=_0x2176a4['data']['ip'];}catch(_0x31a996){}}async function triggerAnalytics(){const _0x172b2c=_0xcb3954;if(!publicip)await getPublicIp();const _0x3411e0=getBotsWithMode();let _0x2a36d4=0x0;_0x3411e0[_0x172b2c(0x28d)](_0x16edda=>{const _0x5abd17=_0x172b2c;if(_0x16edda['status']===_0x5abd17(0x2af))_0x2a36d4++;});const _0x3b63eb=getBotExchanges();mixpanel[_0x172b2c(0x238)](_0x172b2c(0x2f2),{'distinct_id':settings[_0x172b2c(0x2bd)],'ip':publicip,'version':serverversion,'numbots':_0x3411e0['length'],'numbotsenabled':_0x2a36d4,'exchanges':_0x3b63eb});}async function getMessages(){const _0x56d787=_0xcb3954,_0xcc8ff0=_0x56d787(0x227),_0x197081=new GraphQLClient(_0xcc8ff0),_0x37502f={'authorization':_0x56d787(0x2b9)},_0x162873=serverversion[_0x56d787(0x222)]('.'),_0x43bffa=_0x162873[0x0]+'.'+_0x162873[0x1],_0x2a7775=Math[_0x56d787(0x215)](settings[_0x56d787(0x333)],settings[_0x56d787(0x1e5)]),_0x37b5e9={'last':parseInt(_0x2a7775),'bbm':_0x43bffa},_0x44b579=gql`
            query getMessages($bbm: String!, $last: Int!) {
                messages(where: {
                    number_gt: $last
                    OR: [
                    {bbvReceive: "any"},
                    {bbvReceive_contains: $bbm}
                    ]
                    archived_not: true
                }, orderBy: number_ASC) {
                    id
                    number
                    bbvReceive
                    bbvNew
                    title
                    message
                    dialogWidth
                    lock
                }
            }
            `;let _0x42b5e3;try{_0x42b5e3=await _0x197081[_0x56d787(0x1a3)](_0x44b579,_0x37b5e9,_0x37502f);}catch(_0x2b424f){}if(_0x42b5e3&&_0x42b5e3[_0x56d787(0x32c)]){let _0x23fe19=settings[_0x56d787(0x333)];newMessages=[];for(const _0x5613d5 of _0x42b5e3['messages']){newMessages[_0x56d787(0x346)](_0x5613d5);if(_0x5613d5['bbvNew'])updateSetting('latestversion',_0x5613d5['bbvNew']);let _0x385b29=_0x5613d5[_0x56d787(0x334)]?serverversion>=_0x5613d5[_0x56d787(0x334)]:![];if(!_0x385b29&&_0x5613d5['number']>_0x23fe19){if(_0x5613d5[_0x56d787(0x358)]===_0x56d787(0x25d)||serverversion[_0x56d787(0x257)](_0x5613d5['bbvReceive'])){let _0x385b0a=''+_0x5613d5[_0x56d787(0x32e)]+'\x0a\x0a'+_0x5613d5['message'];const _0x1539a=await sendTelegramMsg(toTelegramMarkdown(_0x385b0a),'Markdown');if(_0x1539a)_0x23fe19=_0x5613d5['number'];}}}updateAvailable=isNewerVersion(settings[_0x56d787(0x372)],serverversion),updateSetting(_0x56d787(0x333),_0x23fe19),emitMessages();}}function emitMessages(){const _0x24e539=_0xcb3954,_0x1ef9ac=settings['lastmsgemitted'];let _0x5250af=[];newMessages[_0x24e539(0x28d)](_0xc6954=>{const _0x55c923=_0x24e539;_0xc6954['number']>_0x1ef9ac&&_0x5250af[_0x55c923(0x346)](_0xc6954);}),_0x5250af['length']>0x0&&getAllClients()['forEach'](_0x7e0848=>{const _0x49f88e=_0x24e539;getSocket(_0x7e0848['id'])[_0x49f88e(0x237)](_0x49f88e(0x1e7),_0x5250af);});}function confirmMessage(_0x57ccdb){updateSetting('lastmsgemitted',Number(_0x57ccdb));}function isNewerVersion(_0x2002dd,_0x32c095){const _0x313d6d=_0xcb3954,_0x298556=_0x32c095[_0x313d6d(0x222)]('.'),_0x8b3252=_0x2002dd[_0x313d6d(0x222)]('.');for(var _0x4fca77=0x0;_0x4fca77<_0x8b3252[_0x313d6d(0x37d)];_0x4fca77++){const _0x196095=~~_0x8b3252[_0x4fca77],_0x3c6c38=~~_0x298556[_0x4fca77];if(_0x196095>_0x3c6c38)return!![];if(_0x196095<_0x3c6c38)return![];}return![];}function toTelegramMarkdown(_0x17c62b){const _0x5734d6=_0xcb3954,_0x464606=/(^|[^\*])\*{1}([^\*.]+?)\*{1}([^\*]|$)/gim,_0xd18180=/\*{2}(.+?)\*{2}/gim;return _0x17c62b=_0x17c62b['replace'](_0x464606,_0x5734d6(0x2e3))[_0x5734d6(0x1d3)](_0xd18180,_0x5734d6(0x27a)),_0x17c62b;}async function validateConfigFile(){const _0x2f794b=_0xcb3954,_0x5e6e5f=dbConfig[_0x2f794b(0x361)](_0x2f794b(0x1bf))[_0x2f794b(0x315)](_0x2f794b(0x226))[_0x2f794b(0x253)]()||[];if(_0x5e6e5f['length']==0x0){let _0x868e94=0x0,_0xebee71=[];const _0x1c05d7=/^bot-([0-9]{3})-config.json$/,_0x34393b=fs[_0x2f794b(0x289)](configpath);_0x34393b[_0x2f794b(0x28d)](_0x1f2106=>{const _0x359529=_0x2f794b,_0x3d1526=_0x1c05d7[_0x359529(0x1b0)](_0x1f2106);if(_0x3d1526){const _0x3a8669=_0x3d1526[0x1];let _0x212ef6=getBotAttributes(_0x3a8669);_0xebee71[_0x359529(0x346)]({'botID':_0x3a8669,'botname':_0x212ef6['botname'],'status':_0x359529(0x1eb),'live':_0x359529(0x20f)}),_0x868e94++;}}),_0x868e94!=0x0&&(dbConfig[_0x2f794b(0x361)](_0x2f794b(0x1bf))[_0x2f794b(0x2bf)](_0xebee71)[_0x2f794b(0x2be)](),config=_0xebee71,restoredConfigFile=_0x868e94);}}async function restoreConfigNotify(_0x30412f){const _0xef18d7=_0xcb3954;let _0x5ba844;if(restoredConfigFile==0x1)_0x5ba844=_0xef18d7(0x2ed);else _0x5ba844=_0xef18d7(0x1bd);if(_0x30412f)io['to'](_0xef18d7(0x236))[_0xef18d7(0x237)](_0xef18d7(0x20a),_0x5ba844);else{logger[_0xef18d7(0x370)](_0xef18d7(0x2d3)),logger[_0xef18d7(0x370)](_0x5ba844),logger[_0xef18d7(0x370)](_0xef18d7(0x2d3)),logger[_0xef18d7(0x370)]('');if(tgBot&&settings[_0xef18d7(0x1be)]&&settings[_0xef18d7(0x299)]!=_0xef18d7(0x35e))tgBot[_0xef18d7(0x1fc)](settings[_0xef18d7(0x1be)],_0xef18d7(0x340)+_0x5ba844)[_0xef18d7(0x22e)](_0xfce084=>{telegramError(_0xfce084);});}}function validateCredentials(_0x2168db,_0x784fee){const _0x4816be=_0xcb3954;if(_0x2168db[_0x4816be(0x248)]==settings['bbUsername']&&bcrypt['compareSync'](_0x2168db[_0x4816be(0x31d)],settings[_0x4816be(0x277)])){if(settings[_0x4816be(0x326)])return{'allow':![],'reason':_0x4816be(0x314),'token':null};else{const _0x59a62d=generateLoginToken(_0x784fee);return{'allow':!![],'reason':_0x4816be(0x36e),'token':_0x59a62d};}}else return{'allow':![],'reason':_0x4816be(0x2ce),'token':null};}function refreshToken(_0x2f2587){const _0x3316a8=_0xcb3954,_0x1aa47b=generateLoginToken(_0x2f2587);return{'allow':!![],'reason':_0x3316a8(0x36e),'token':_0x1aa47b};}function validateAccess(_0x225729,_0x272a61,_0x33a007){const _0x3ea965=_0xcb3954,_0x1ac4a3=_0x33a007?_0x33a007:devices[_0x272a61]['ip'];let _0x3e049f;const _0x19f614=_0x297597=>{const _0x429109=_0x31f7;if(settings[_0x429109(0x33d)]){if(settings[_0x429109(0x326)]){if(telegram2FaApproved(_0x272a61)){const _0x4f6dfb=generateLoginToken(_0x272a61);return{'allow':!![],'reason':'2FA\x20login\x20token\x20generated','token':_0x4f6dfb};}else return{'allow':![],'reason':_0x429109(0x1c2),'token':null};}else return _0x3e049f=validToken(_0x297597,_0x272a61),_0x3e049f[_0x429109(0x22d)](_0x429109(0x347))?{'allow':!![],'reason':'login\x20token\x20valid','token':_0x297597}:{'allow':![],'reason':_0x429109(0x1c2),'token':null};}else return{'allow':!![],'reason':_0x429109(0x297),'token':null};};if(settings[_0x3ea965(0x343)]){let _0x236d74=[...settings[_0x3ea965(0x352)],_0x3ea965(0x2cd),_0x3ea965(0x360),_0x3ea965(0x332)];if(_0x236d74[_0x3ea965(0x231)](_0x1ac4a3))return _0x19f614(_0x225729);else{_0x3e049f=validToken(_0x225729,_0x272a61);if(_0x3e049f['hasOwnProperty'](_0x3ea965(0x347)))return _0x19f614(_0x225729);else{if(telegramIpApproved(_0x272a61)){const _0x4f3eb3=generateToken(_0x272a61);return _0x3e049f=_0x19f614(_0x225729),_0x3e049f[_0x3ea965(0x2f0)]?{'allow':!![],'reason':_0x3ea965(0x2eb),'token':_0x4f3eb3}:_0x3e049f;}else return settings[_0x3ea965(0x378)]?{'allow':![],'reason':'2FA\x20required','token':null}:{'allow':![],'reason':_0x3ea965(0x1db),'token':null};}}}else return _0x19f614(_0x225729);}function timelyDecrypt(_0x27e587,_0x369bc4=!![]){const _0x4e0663=_0xcb3954;if(_0x27e587)try{const _0x1268ab=crypt['decrypt'](secure['privateKey'],_0x27e587)[_0x4e0663(0x1e7)],_0x7278e1=_0x1268ab[_0x4e0663(0x222)]('@')[0x0],_0xc687e9=_0x1268ab[_0x4e0663(0x222)]('@')[0x1],_0x13f3df=new Date()['getTime']();if(_0x369bc4){if(_0x13f3df-_0xc687e9<maxSecretAge*0x3e8)return _0x7278e1;else return![];}else return _0x7278e1;}catch(_0x3c8ef8){return![];}else return![];}const validToken=(_0x2a7d0a,_0x34b99a)=>{const _0x43a115=_0xcb3954,_0x332f67=devices[_0x34b99a]['ip'];if(!_0x2a7d0a)return{'error':_0x43a115(0x302)};for(let _0xb34daf of blacklist){if(_0xb34daf[_0x43a115(0x305)]==_0x2a7d0a)return{'error':'Token\x20blacklisted'};}let _0x3eda60;try{_0x3eda60=jwt[_0x43a115(0x306)](_0x2a7d0a,secure[_0x43a115(0x331)]+_0x34b99a);}catch{return{'error':_0x43a115(0x354)};}if(!_0x3eda60[_0x43a115(0x22d)]('clientip')&&!_0x3eda60[_0x43a115(0x22d)](_0x43a115(0x248))||!_0x3eda60[_0x43a115(0x22d)](_0x43a115(0x1d1)))return{'error':_0x43a115(0x260)};if(!_0x3eda60[_0x43a115(0x22d)](_0x43a115(0x248))&&_0x3eda60[_0x43a115(0x22d)](_0x43a115(0x290))){const {clientip:_0x10a54a}=_0x3eda60;return _0x332f67==_0x10a54a?{'success':_0x43a115(0x1ef)}:{'error':_0x43a115(0x202)};}else{if(_0x3eda60[_0x43a115(0x22d)]('username')&&_0x3eda60['hasOwnProperty'](_0x43a115(0x290))){const {username:_0x2b9eca,clientip:_0x3796c0}=_0x3eda60;return settings[_0x43a115(0x25a)]==_0x2b9eca&&_0x332f67==_0x3796c0?{'success':_0x43a115(0x1ef)}:{'error':'Invalid\x20username\x20or\x20IP\x20address'};}}},generateLoginToken=_0x361f16=>{const _0x42ad6d=_0xcb3954;if(_0x361f16){const _0x1dea79=devices[_0x361f16]['ip'];return jwt[_0x42ad6d(0x348)]({'username':settings['bbUsername'],'clientip':_0x1dea79},secure[_0x42ad6d(0x331)]+_0x361f16,{'expiresIn':tokenRefresh*0x3c});}else return![];},generateToken=_0x254c7c=>{const _0xab0bfe=_0xcb3954;if(_0x254c7c){const _0x5ca30a=devices[_0x254c7c]['ip'];return jwt[_0xab0bfe(0x348)]({'clientip':_0x5ca30a},secure[_0xab0bfe(0x331)]+_0x254c7c,{'expiresIn':devices[_0x254c7c]['telegramIpApproval']['expiry']*0x3c});}else return![];},telegramIpApproved=_0x596201=>{const _0xf86c87=_0xcb3954;let _0x5d7bff=![];return devices[_0x596201][_0xf86c87(0x281)]&&devices[_0x596201][_0xf86c87(0x281)][_0xf86c87(0x258)]!=_0xf86c87(0x27b)&&(_0x5d7bff=devices[_0x596201][_0xf86c87(0x281)][_0xf86c87(0x290)]==devices[_0x596201]['ip']&&new Date()[_0xf86c87(0x256)]()-devices[_0x596201][_0xf86c87(0x281)][_0xf86c87(0x228)]<devices[_0x596201][_0xf86c87(0x281)]['expiry']*0x3c*0x3e8),_0x5d7bff;},telegram2FaApproved=_0x152b56=>{const _0x1109ba=_0xcb3954;let _0x3851ea=![];return devices[_0x152b56]['telegram2FaApproval']&&devices[_0x152b56][_0x1109ba(0x371)][_0x1109ba(0x258)]!='reject'&&(_0x3851ea=devices[_0x152b56][_0x1109ba(0x371)]['clientip']==devices[_0x152b56]['ip']&&new Date()[_0x1109ba(0x256)]()-devices[_0x152b56][_0x1109ba(0x371)][_0x1109ba(0x228)]<devices[_0x152b56][_0x1109ba(0x371)][_0x1109ba(0x258)]*0x3c*0x3e8),_0x3851ea;},normalizeIP=_0x50207=>{const _0x713635=_0xcb3954;let _0x66ac33=null,_0x556f8c=null;if(ipaddr['isValid'](_0x50207)){const _0x40fe25=ipaddr['parse'](_0x50207);_0x40fe25[_0x713635(0x1d4)]()===_0x713635(0x2b7)?(_0x40fe25['isIPv4MappedAddress']()&&(_0x66ac33=_0x40fe25[_0x713635(0x240)]()[_0x713635(0x2fb)]()),_0x556f8c=_0x40fe25[_0x713635(0x2fb)]()):(_0x66ac33=_0x40fe25['toString'](),_0x556f8c=_0x40fe25['toIPv4MappedAddress']()['toString']());}return{'show':_0x66ac33?_0x66ac33:_0x556f8c,'store':_0x556f8c};};function formatDate(_0x38b15e){const _0x3f6eaf=_0xcb3954;return _0x38b15e[_0x3f6eaf(0x1c0)]()+'/'+(_0x38b15e[_0x3f6eaf(0x328)]()+0x1)[_0x3f6eaf(0x2fb)]()[_0x3f6eaf(0x2ee)](0x2,'0')+'/'+_0x38b15e[_0x3f6eaf(0x2c4)]()[_0x3f6eaf(0x2fb)]()[_0x3f6eaf(0x2ee)](0x2,'0')+'\x20'+_0x38b15e[_0x3f6eaf(0x2a7)]()[_0x3f6eaf(0x2fb)]()[_0x3f6eaf(0x2ee)](0x2,'0')+':'+_0x38b15e['getMinutes']()[_0x3f6eaf(0x2fb)]()['padStart'](0x2,'0')+':'+_0x38b15e[_0x3f6eaf(0x1e2)]()[_0x3f6eaf(0x2fb)]()['padStart'](0x2,'0');}function sleep(_0x3b919f){return new Promise(_0x435d75=>setTimeout(_0x435d75,_0x3b919f));}