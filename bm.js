const _0x136b40=_0x1464;(function(_0x25d6b3,_0x43da3c){const _0x20dcde=_0x1464,_0xca1696=_0x25d6b3();while(!![]){try{const _0x6344fc=-parseInt(_0x20dcde(0x1d4))/0x1+-parseInt(_0x20dcde(0x1e6))/0x2*(parseInt(_0x20dcde(0x21e))/0x3)+parseInt(_0x20dcde(0x1cc))/0x4*(parseInt(_0x20dcde(0x12c))/0x5)+-parseInt(_0x20dcde(0x235))/0x6*(-parseInt(_0x20dcde(0x1ed))/0x7)+-parseInt(_0x20dcde(0x125))/0x8+-parseInt(_0x20dcde(0x26e))/0x9+-parseInt(_0x20dcde(0x1df))/0xa*(-parseInt(_0x20dcde(0x1ec))/0xb);if(_0x6344fc===_0x43da3c)break;else _0xca1696['push'](_0xca1696['shift']());}catch(_0x15adf5){_0xca1696['push'](_0xca1696['shift']());}}}(_0x30c0,0x919e8));const _0x4acb76=function(){let _0x46f6c2=!![];return function(_0xf339d9,_0x246ff7){const _0x1a77f0=_0x46f6c2?function(){const _0x30f1db=_0x1464;if(_0x246ff7){const _0x5d6e7=_0x246ff7[_0x30f1db(0x24d)](_0xf339d9,arguments);return _0x246ff7=null,_0x5d6e7;}}:function(){};return _0x46f6c2=![],_0x1a77f0;};}(),_0x347cb5=_0x4acb76(this,function(){const _0x2acb95=_0x1464;return _0x347cb5[_0x2acb95(0x1b1)]()['search'](_0x2acb95(0x14c))[_0x2acb95(0x1b1)]()[_0x2acb95(0x171)](_0x347cb5)[_0x2acb95(0x20b)]('(((.+)+)+)+$');});_0x347cb5();'use strict';process[_0x136b40(0x160)][_0x136b40(0x21d)]=0x1;const childProcess=require(_0x136b40(0x271)),fs=require('fs'),fns=require('date-fns'),low=require('lowdb'),FileSync=require(_0x136b40(0x183)),path=require(_0x136b40(0x26d)),crypto=require(_0x136b40(0x1f7)),Crypt=require('hybrid-crypto-js')[_0x136b40(0x1b2)],RSA=require(_0x136b40(0xfc))['RSA'],bcrypt=require(_0x136b40(0x118)),jwt=require('jsonwebtoken'),ipaddr=require(_0x136b40(0x10e)),argv=require('yargs/yargs')(process[_0x136b40(0x18a)][_0x136b40(0x1dc)](0x2))[_0x136b40(0x18a)],uuidRandom=require(_0x136b40(0x152)),TelegramBot=require(_0x136b40(0x1ae)),Mixpanel=require(_0x136b40(0x155)),axios=require('axios'),{GraphQLClient,gql}=require(_0x136b40(0xff)),util=require(_0x136b40(0x1ee)),fileUpload=require(_0x136b40(0x269)),PORT=argv[_0x136b40(0x282)]||'3000',pattern=/^[0-9]{2,4}$/;!pattern[_0x136b40(0x1c4)](PORT)&&(console[_0x136b40(0x26a)](_0x136b40(0x22d)+PORT+_0x136b40(0x105)),process[_0x136b40(0x233)](0x1));const HOST=argv[_0x136b40(0x154)]||null,userID=argv[_0x136b40(0x222)]||'';let bbpath=_0x136b40(0x22f),bbpath2='';const botfile=_0x136b40(0x1a4),configfile=_0x136b40(0x10d),settingsfile='bb-settings.json',securefile=_0x136b40(0x20a);let validInstallation=!![];!fs[_0x136b40(0x203)](bbpath+botfile)&&(bbpath='',validInstallation=![]);const {addClient,getAllClients,removeClient,getClient,getClientsWithBotID,getClientsWithUuid}=require('./'+bbpath2+_0x136b40(0x262)),configpath=userID?bbpath+_0x136b40(0x129)+userID+'/':bbpath+_0x136b40(0x129),configbackuppath=configpath+_0x136b40(0x121),logspath=userID?bbpath+'logs/'+userID+'/':bbpath+'logs/',zippath=userID?bbpath+_0x136b40(0x112)+userID+'/':bbpath+_0x136b40(0x112),loggerfile=fs['createWriteStream'](logspath+_0x136b40(0x26f),{'flags':'a'}),temppath=userID?bbpath+_0x136b40(0x264)+userID+'/':bbpath+'temp/';!fs[_0x136b40(0x203)](configpath)&&fs[_0x136b40(0x24a)](configpath);!fs[_0x136b40(0x203)](configbackuppath)&&fs['mkdirSync'](configbackuppath);!fs[_0x136b40(0x203)](logspath)&&fs[_0x136b40(0x24a)](logspath);!fs[_0x136b40(0x203)](zippath)&&fs[_0x136b40(0x24a)](zippath);!fs[_0x136b40(0x203)](temppath)&&fs['mkdirSync'](temppath);const adapter=new FileSync(configpath+configfile),dbConfig=low(adapter);dbConfig[_0x136b40(0x15e)]({'bots':[]})[_0x136b40(0x182)]();const adapter2=new FileSync(configpath+settingsfile),dbSettings=low(adapter2);dbSettings[_0x136b40(0x15e)]({'settings':{'timeshift':0x0,'loginRequired':![],'bbUsername':'','bbPassword':'','f2aRequired':![],'lastmsgtelegram':0x0,'lastmsgemitted':0x0,'latestversion':_0x136b40(0x1e4)}})[_0x136b40(0x182)]();const adapter3=new FileSync(configpath+securefile),dbSecure=low(adapter3);dbSecure[_0x136b40(0x15e)]({'secure':{},'blacklist':[]})['write']();let crypt=new Crypt({'md':_0x136b40(0x131),'rsaStandard':_0x136b40(0x281)});const saltRounds=0xa,mixpanel=Mixpanel[_0x136b40(0x13d)](_0x136b40(0x181),{'host':_0x136b40(0x223)});let config=getConfiguration(),settings=getSettings(),secure=getSecure(),blacklist=getBlacklist(),tgBot;if(settings['telegramToken']&&settings['telegramToken']!=''&&settings[_0x136b40(0x1da)]&&settings[_0x136b40(0x1da)]!='')initTelegram();const logger={'screen':_0x2a2276=>{console['log'](_0x2a2276);},'simple':_0x33cf5b=>{const _0x3e1d78=_0x136b40;console[_0x3e1d78(0x26a)](_0x33cf5b),loggerfile['write'](util['format'](_0x33cf5b)+'\x0a');},'full':async _0x36396d=>{const _0x6b6f4f=_0x136b40,_0xaf02a3=getTimeStamp()+':\x20Bot\x20Mgr\x20>\x20'+_0x36396d;console['log'](_0xaf02a3),loggerfile[_0x6b6f4f(0x182)](util[_0x6b6f4f(0x24c)](_0xaf02a3)+'\x0a');if(tgBot&&settings[_0x6b6f4f(0x185)]&&settings[_0x6b6f4f(0x290)]!=_0x6b6f4f(0x1fc))await tgBot[_0x6b6f4f(0x178)](settings[_0x6b6f4f(0x185)],'Bot\x20Mgr\x20>\x20'+_0x36396d)[_0x6b6f4f(0x1fb)](_0x5ff48c=>{telegramError(_0x5ff48c);});}};process['on']('uncaughtException',function(_0x19f1a0){const _0x1c30e5=_0x136b40;logger[_0x1c30e5(0x14b)](_0x19f1a0);});let restoredConfigFile=0x0,newBot=![],pid=[];const serverversion=require('./'+bbpath2+_0x136b40(0x246))['version'],maxSecretAge=0xa,loginExpiry=0x4*0x3c,tokenRefresh=0x5;let devices=[],lastIpApproval,pidScheduler,installingUpdate=![],publicip,newMessages=[],updateAvailable=![];const express=require(_0x136b40(0xf5)),app=express(),http=require(_0x136b40(0x137))[_0x136b40(0x292)](app);app[_0x136b40(0x166)](fileUpload({'useTempFiles':!![]})),app[_0x136b40(0x1ca)](_0x136b40(0x1d5),async(_0x1af4d8,_0x16e5ec)=>{const _0x7befef=_0x136b40,_0x46af4c=_0x1af4d8[_0x7befef(0x1a7)][_0x7befef(0x241)],_0x2ab605=getClientsWithBotID('botmanager'),_0x281d98=_0x1af4d8[_0x7befef(0x28a)][_0x7befef(0x294)],_0x48d53f=timelyDecrypt(_0x281d98,![]),_0x3a11bb=_0x2ab605['find'](_0x148179=>_0x148179[_0x7befef(0x294)]==_0x48d53f);if(_0x3a11bb){const _0x809518=normalizeIP(_0x1af4d8['socket'][_0x7befef(0x1f1)])[_0x7befef(0x22a)],_0x2863d2=_0x1af4d8[_0x7befef(0x28a)][_0x7befef(0x197)];if(validateAccess(_0x2863d2,_0x48d53f,_0x809518)[_0x7befef(0x13c)])await zipFiles(_0x46af4c),_0x16e5ec[_0x7befef(0x1a2)](zippath+(_0x46af4c+_0x7befef(0x10f)),_0x46a283=>{const _0x37ff6b=_0x7befef;_0x46a283&&(logger['full'](_0x37ff6b(0x188)+_0x46af4c),logger['simple'](_0x46a283));});else logger[_0x7befef(0x259)](_0x7befef(0x164)+_0x46af4c+'\x20(1)');}else logger[_0x7befef(0x259)]('Unauthorized\x20attempt\x20to\x20download\x20'+_0x46af4c+'\x20(2)');}),app[_0x136b40(0x167)](_0x136b40(0x1c8),async(_0x4a8e68,_0x20005a)=>{const _0x226348=_0x136b40,_0x152ce2=getClientsWithBotID('botmanager'),_0x550bc0=_0x4a8e68[_0x226348(0x28a)][_0x226348(0x294)],_0x3028f8=timelyDecrypt(_0x550bc0,![]),_0x4e8026=_0x152ce2['find'](_0x31736e=>_0x31736e['uuid']==_0x3028f8);if(_0x4e8026){const _0x2839dd=normalizeIP(_0x4a8e68[_0x226348(0x250)][_0x226348(0x1f1)])['store'],_0x2d6ca0=_0x4a8e68['headers'][_0x226348(0x197)];if(validateAccess(_0x2d6ca0,_0x3028f8,_0x2839dd)[_0x226348(0x13c)]){if(_0x4a8e68[_0x226348(0x1ef)]){const _0x559308=_0x4a8e68[_0x226348(0x1ef)][_0x226348(0x26b)];await _0x559308['mv'](temppath+_0x559308[_0x226348(0x11a)]),_0x20005a[_0x226348(0x234)]({'status':!![],'message':_0x226348(0x1d0)});const _0x2c08a9=getBotsWithMode();_0x2c08a9['length']>0x0?confirmRestore(temppath,_0x559308[_0x226348(0x11a)]):unzipFile(temppath,_0x559308[_0x226348(0x11a)]);}}else logger[_0x226348(0x259)](_0x226348(0x22e));}else logger['full']('Unauthorized\x20attempt\x20to\x20upload\x20file\x20(2)');}),app[_0x136b40(0x166)](express[_0x136b40(0x1fa)](path[_0x136b40(0x1af)](__dirname,bbpath2,'build2'))),app['use'](express[_0x136b40(0x1fa)](path[_0x136b40(0x1af)](__dirname,bbpath2,_0x136b40(0x23d)))),app[_0x136b40(0x1ca)]('/',function(_0x339a48,_0x4273fb){const _0x23cba5=_0x136b40;_0x4273fb[_0x23cba5(0x18e)](path[_0x23cba5(0x1af)](__dirname,bbpath2,'build2',_0x23cba5(0x130)));}),app[_0x136b40(0x1ca)](_0x136b40(0x27b),function(_0x53f6d1,_0xc18090){const _0xbcb89d=_0x136b40;_0xc18090['sendFile'](path[_0xbcb89d(0x1af)](__dirname,bbpath2,'build',_0xbcb89d(0x130)));}),app[_0x136b40(0x1ca)](_0x136b40(0x159),(_0x25b9b2,_0x7aa3f2)=>{const _0xe4a359=_0x136b40;_0x7aa3f2[_0xe4a359(0x18e)](path['join'](__dirname,bbpath2,'build',_0xe4a359(0x130)));}),app['get'](_0x136b40(0x14a),(_0x13b393,_0x33d002)=>{const _0x414c76=_0x136b40;_0x33d002['sendFile'](path['join'](__dirname,bbpath2,_0x414c76(0x23d),'index.html'));}),app[_0x136b40(0x1ca)](_0x136b40(0x251),(_0x316d8e,_0x1430c5)=>{const _0x436019=_0x136b40;_0x1430c5[_0x436019(0x18e)](path['join'](__dirname,bbpath2,_0x436019(0x23d),_0x436019(0x130)));}),app[_0x136b40(0x1ca)](_0x136b40(0x291),(_0x233cfa,_0x5b9cfc)=>{const _0x387ccd=_0x136b40;_0x5b9cfc[_0x387ccd(0x18e)](path[_0x387ccd(0x1af)](__dirname,bbpath2,_0x387ccd(0x23d),_0x387ccd(0x130)));}),app[_0x136b40(0x1ca)]('/:bot/configuration',(_0x4011c5,_0x486648)=>{const _0x383c39=_0x136b40;_0x486648[_0x383c39(0x18e)](path[_0x383c39(0x1af)](__dirname,bbpath2,_0x383c39(0x23d),_0x383c39(0x130)));}),app[_0x136b40(0x1ca)]('/:bot/support',(_0x287aa6,_0x5af845)=>{const _0x4e25ea=_0x136b40;_0x5af845[_0x4e25ea(0x18e)](path[_0x4e25ea(0x1af)](__dirname,bbpath2,'build',_0x4e25ea(0x130)));});if(HOST)http[_0x136b40(0x157)](PORT,HOST);else http[_0x136b40(0x157)](PORT);const io=require('socket.io')(http,{});init();async function init(){await validateConfigFile(),await initUser(),await initSecure(),oneTimeMigration(),cleanBlacklist(),initStates(),await startServer();if(restoredConfigFile)restoreConfigNotify(![]);startSocket(),startScheduler(),triggerAnalytics(),getMessages(),reloadBotManager();}async function startServer(){const _0xfb55f5=_0x136b40;logger['simple'](''),logger[_0xfb55f5(0x14b)](_0xfb55f5(0x115)),await logger[_0xfb55f5(0x259)]('Bot\x20Manager\x20started\x20|\x20open:\x20http://[ip-address]:'+PORT),logger[_0xfb55f5(0x14b)]('-----------------------------------------------------------------------------------');if(config[_0xfb55f5(0x1f4)]!=0x0)for(const _0x324438 of config){if(_0x324438[_0xfb55f5(0x1cf)]==_0xfb55f5(0x275)||_0x324438[_0xfb55f5(0x1cf)]==_0xfb55f5(0x170))await logger[_0xfb55f5(0x259)](_0xfb55f5(0x1f8)+_0x324438[_0xfb55f5(0x12f)]+_0xfb55f5(0x28b)+_0x324438[_0xfb55f5(0xf3)]),startBot([_0x324438['botID'],userID],{'cwd':bbpath},function(_0x1eb80a){if(_0x1eb80a)logger['full'](_0x1eb80a);});else(_0x324438['status']=='disabled'||_0x324438[_0xfb55f5(0x1cf)]=='new-disabled')&&await logger['full'](_0xfb55f5(0x17f)+_0x324438['botID']+_0xfb55f5(0x28b)+_0x324438[_0xfb55f5(0xf3)]);}else!newBot&&logger[_0xfb55f5(0x14b)](_0xfb55f5(0x227));if(newBot)addBot();logger[_0xfb55f5(0x14b)]('-----------------------------------------------------------------------------------'),logger[_0xfb55f5(0x14b)]('');}function startSocket(){const _0x38d45b=_0x136b40;io['on'](_0x38d45b(0x147),_0x895f72=>{const _0x18fbaf=_0x38d45b;let _0x140b1a,_0x56344a,_0xaa7159,_0x51c1e9,_0x109f8c;const _0x4beb62=_0x895f72[_0x18fbaf(0x293)][_0x18fbaf(0x28a)][_0x18fbaf(0x21b)];_0x56344a=_0x4beb62[_0x18fbaf(0x1fd)](/bot[0-9]{3}/);if(_0x56344a)_0xaa7159=_0x56344a[0x0][_0x18fbaf(0x1fd)](/[0-9]{3}/);if(_0xaa7159)_0x140b1a=_0xaa7159[0x0];else _0x140b1a=_0x18fbaf(0x193);const _0x532f1c=_0x895f72[_0x18fbaf(0x293)][_0x18fbaf(0x1ea)][_0x18fbaf(0x100)];if(!_0x532f1c)_0x895f72[_0x18fbaf(0x249)](_0x18fbaf(0x1cf),{'publicKey':secure['publicKey']});else{_0x51c1e9=timelyDecrypt(_0x532f1c,![]);if(!_0x51c1e9)_0x895f72[_0x18fbaf(0x249)](_0x18fbaf(0x1cf),{'publicKey':secure[_0x18fbaf(0x1f9)]});else{_0x109f8c=normalizeIP(_0x895f72[_0x18fbaf(0x24b)][_0x18fbaf(0x1f1)])[_0x18fbaf(0x22a)];if(!devices[_0x51c1e9])devices[_0x51c1e9]={'uuid':_0x51c1e9,'access':{'token':null}};devices[_0x51c1e9]['ip']=_0x109f8c;const _0x57b806=addClient(_0x895f72['id'],_0x51c1e9,_0x140b1a);setAccess(_0x57b806),emitMessages(),_0x895f72['on'](_0x18fbaf(0x145),_0x41a151=>{const _0x4055e0=_0x18fbaf,_0x5060ee=timelyDecrypt(_0x41a151[_0x4055e0(0x232)]);if(_0x5060ee){_0x41a151={'username':_0x41a151[_0x4055e0(0x19e)],'password':_0x5060ee},devices[_0x51c1e9][_0x4055e0(0x211)]=validateCredentials(_0x41a151,_0x51c1e9);if(devices[_0x51c1e9][_0x4055e0(0x211)]['allow']==![]&&devices[_0x51c1e9][_0x4055e0(0x211)][_0x4055e0(0x1d9)]==_0x4055e0(0x221))_0x895f72[_0x4055e0(0x249)](_0x4055e0(0x1cf),{'access':devices[_0x51c1e9][_0x4055e0(0x211)]}),loginAccess2FA(_0x51c1e9,_0x109f8c);else{if(devices[_0x51c1e9][_0x4055e0(0x211)][_0x4055e0(0x13c)]==![]&&devices[_0x51c1e9][_0x4055e0(0x211)][_0x4055e0(0x1d9)]==_0x4055e0(0x14e))_0x895f72[_0x4055e0(0x249)](_0x4055e0(0x1cf),{'access':devices[_0x51c1e9]['access']});else devices[_0x51c1e9]['access'][_0x4055e0(0x13c)]&&devices[_0x51c1e9][_0x4055e0(0x211)]['reason']=='login\x20token\x20generated'&&(getClientsWithUuid(_0x51c1e9)[_0x4055e0(0x119)](_0x52c7a1=>{setAccess(_0x52c7a1);}),setTokenRefresh(_0x51c1e9),setSessionTimeout(_0x4055e0(0x145),_0x51c1e9));}}else logger[_0x4055e0(0x259)](_0x4055e0(0x239));}),_0x895f72['on'](_0x18fbaf(0x1b4),()=>{resetPassword();}),_0x895f72['on']('disconnect',_0x2acaaf=>{removeClient(_0x895f72['id']);}),_0x140b1a==_0x18fbaf(0x193)&&(restoredConfigFile&&(restoreConfigNotify(!![]),restoredConfigFile=0x0));}}});}function initClient(_0x4debcb){const _0x46ef6b=_0x136b40;if(_0x4debcb!=_0x46ef6b(0x193)&&config[_0x46ef6b(0x228)]!=''){if(pid[_0x4debcb])pid[_0x4debcb][_0x46ef6b(0x234)]({'function':_0x46ef6b(0x231),'args':null});}}function reloadBotManager(){const _0x24b5ed=_0x136b40;getClientsWithBotID(_0x24b5ed(0x193))[_0x24b5ed(0x119)](_0x456ee4=>{const _0x3d1eff=_0x24b5ed;getSocket(_0x456ee4['id'])['emit'](_0x3d1eff(0x1cf),{'access':{'allow':![],'reason':'reload','token':null}});});}function getSocket(_0x1cc66a){const _0x425110=_0x136b40;return io[_0x425110(0x279)][_0x425110(0x279)][_0x425110(0x1ca)](_0x1cc66a);}function setAccess(_0x2f481a){const _0xc923fd=_0x136b40,_0xf3fc60=getSocket(_0x2f481a['id']),_0x39542c=_0x2f481a[_0xc923fd(0x294)],_0x4905b9=_0x2f481a['bot'];devices[_0x39542c][_0xc923fd(0x211)]=validateAccess(devices[_0x39542c][_0xc923fd(0x211)][_0xc923fd(0x172)],_0x39542c),_0xf3fc60[_0xc923fd(0x1af)](_0x39542c);if(devices[_0x39542c][_0xc923fd(0x211)][_0xc923fd(0x13c)]){_0xf3fc60[_0xc923fd(0x1af)](_0x4905b9);if(_0x4905b9==_0xc923fd(0x193))initializeSocketBotManager(_0xf3fc60);else initializeSocketBot(_0xf3fc60);initClient(_0x4905b9);}devices[_0x39542c]['access']['token']&&devices[_0x39542c][_0xc923fd(0x211)][_0xc923fd(0x1d9)]==_0xc923fd(0xf4)&&setSessionTimeout('2FA',_0x39542c),devices[_0x39542c][_0xc923fd(0x211)][_0xc923fd(0x172)]&&devices[_0x39542c][_0xc923fd(0x211)][_0xc923fd(0x1d9)]==_0xc923fd(0x210)&&setSessionTimeout(_0xc923fd(0x145),_0x39542c),_0xf3fc60['emit']('status',{'status':_0x2f481a['server'],'serverversion':serverversion,'servertime':getServerTime(),'access':devices[_0x39542c][_0xc923fd(0x211)],'externalip':devices[_0x39542c]['ip'],'publicKey':secure[_0xc923fd(0x1f9)],'userid':settings['userid'],'validInstallation':validInstallation}),devices[_0x39542c][_0xc923fd(0x211)][_0xc923fd(0x13c)]==![]&&devices[_0x39542c]['access'][_0xc923fd(0x1d9)]=='2FA\x20required'&&temporaryAccess2FA(_0x39542c,devices[_0x39542c]['ip']);}function setSessionTimeout(_0x13dbfa,_0xcfa790){const _0x4cbe85=_0x136b40;let _0x52c26e;if(_0x13dbfa==_0x4cbe85(0x145))_0x52c26e=loginExpiry*0x3c*0x3e8;else _0x52c26e=devices[_0xcfa790][_0x4cbe85(0x278)][_0x4cbe85(0x1db)]*0x3c*0x3e8-(new Date()[_0x4cbe85(0x1a8)]()-devices[_0xcfa790]['telegramIpApproval'][_0x4cbe85(0x1c9)]);if(devices[_0xcfa790]['pidExpireLogin'])clearTimeout(devices[_0xcfa790][_0x4cbe85(0x1b7)]);devices[_0xcfa790][_0x4cbe85(0x1b7)]=setTimeout(()=>{const _0x17d78a=_0x4cbe85;if(devices[_0xcfa790]['pidRefreshToken'])clearTimeout(devices[_0xcfa790][_0x17d78a(0x180)]);removeSocketListeners(_0xcfa790),addBlacklist(_0xcfa790),devices[_0xcfa790][_0x17d78a(0x278)]=null,devices[_0xcfa790][_0x17d78a(0x225)]=null,devices[_0xcfa790][_0x17d78a(0x211)][_0x17d78a(0x172)]=null,devices[_0xcfa790][_0x17d78a(0x211)]=validateAccess(devices[_0xcfa790][_0x17d78a(0x211)]['token'],_0xcfa790),!(devices[_0xcfa790][_0x17d78a(0x211)][_0x17d78a(0x13c)]&&devices[_0xcfa790][_0x17d78a(0x211)][_0x17d78a(0x1d9)]==_0x17d78a(0x19f))&&(_0x13dbfa==_0x17d78a(0x145)?io['to'](_0xcfa790)[_0x17d78a(0x249)](_0x17d78a(0x1cf),{'access':{'allow':![],'reason':'access\x20timeout','token':null}}):io['to'](_0xcfa790)[_0x17d78a(0x249)](_0x17d78a(0x1cf),{'access':{'allow':![],'reason':'temporary\x20access\x20timeout','token':null}})),devices[_0xcfa790]['access'][_0x17d78a(0x172)]=null;},_0x52c26e);}function setTokenRefresh(_0x4b943d){const _0x4e05b6=_0x136b40;if(devices[_0x4b943d][_0x4e05b6(0x180)])clearTimeout(devices[_0x4b943d][_0x4e05b6(0x180)]);devices[_0x4b943d][_0x4e05b6(0x180)]=setTimeout(()=>{const _0x285aac=_0x4e05b6;getClientsWithUuid(_0x4b943d)[_0x285aac(0x1f4)]!=0x0?(devices[_0x4b943d][_0x285aac(0x211)]=refreshToken(_0x4b943d),io['to'](_0x4b943d)[_0x285aac(0x249)](_0x285aac(0x1cf),{'status':_0x285aac(0x126),'serverversion':serverversion,'servertime':getServerTime(),'access':devices[_0x4b943d][_0x285aac(0x211)],'externalip':devices[_0x4b943d]['ip'],'publicKey':secure['publicKey'],'validInstallation':validInstallation}),setTokenRefresh(_0x4b943d)):clearTimeout(devices[_0x4b943d]['pidRefreshToken']);},(tokenRefresh-0x1)*0x3c*0x3e8);}function initializeSocketBotManager(_0x25021e){const _0x2dfc62=_0x136b40,_0xf2a443=getClient(_0x25021e['id'])[_0x2dfc62(0x294)];_0x25021e['emit']('bots',config),_0x25021e[_0x2dfc62(0x249)](_0x2dfc62(0x268),cleanSettings()),_0x25021e['on'](_0x2dfc62(0x21c),_0x33a480=>{const _0x2c6d3b=_0x2dfc62;if(validateAccess(_0x33a480,_0xf2a443)[_0x2c6d3b(0x13c)])addBot();else logger[_0x2c6d3b(0x259)]('Unauthorized\x20attempt\x20to\x20add\x20bot');}),_0x25021e['on'](_0x2dfc62(0x226),(_0x111b52,_0x322f63)=>{const _0x21141a=_0x2dfc62;if(validateAccess(_0x322f63,_0xf2a443)['allow'])toggleBot(_0x111b52['botID'],_0x111b52[_0x21141a(0x1cf)],_0x111b52[_0x21141a(0x219)]);else logger[_0x21141a(0x259)](_0x21141a(0x198));}),_0x25021e['on'](_0x2dfc62(0x191),(_0x56656b,_0x2c055e)=>{const _0x3f7442=_0x2dfc62;if(validateAccess(_0x2c055e,_0xf2a443)[_0x3f7442(0x13c)])toggleBotMode(_0x56656b);else logger[_0x3f7442(0x259)](_0x3f7442(0x198));}),_0x25021e['on'](_0x2dfc62(0x17d),(_0x397e35,_0x355899)=>{const _0x201c59=_0x2dfc62;if(validateAccess(_0x355899,_0xf2a443)[_0x201c59(0x13c)])deleteBot(_0x397e35);else logger[_0x201c59(0x259)](_0x201c59(0x1c2));}),_0x25021e['on'](_0x2dfc62(0x224),(_0xb30ab6,_0x4070b3)=>{const _0x328855=_0x2dfc62;if(validateAccess(_0x4070b3,_0xf2a443)[_0x328855(0x13c)])storeSettings(_0xb30ab6,!![]);else logger['full'](_0x328855(0x285));}),_0x25021e['on']('update-bb',_0x53f225=>{const _0x3473b1=_0x2dfc62;if(validateAccess(_0x53f225,_0xf2a443)['allow'])updateBB();else logger[_0x3473b1(0x259)](_0x3473b1(0x138));}),_0x25021e['on']('get-messages',_0x5eef42=>{const _0x5ca37f=_0x2dfc62;if(validateAccess(_0x5eef42,_0xf2a443)[_0x5ca37f(0x13c)])getMessages();else logger[_0x5ca37f(0x259)](_0x5ca37f(0x1ad));}),_0x25021e['on'](_0x2dfc62(0x141),(_0x144490,_0x542143)=>{const _0x4ead22=_0x2dfc62;if(validateAccess(_0x542143,_0xf2a443)['allow'])confirmMessage(_0x144490);else logger[_0x4ead22(0x259)](_0x4ead22(0x122));}),_0x25021e['on']('logout',_0x2d6d9d=>{const _0x301bbc=_0x2dfc62;if(validateAccess(_0x2d6d9d,_0xf2a443)[_0x301bbc(0x13c)]){if(devices[_0xf2a443][_0x301bbc(0x180)])clearTimeout(devices[_0xf2a443][_0x301bbc(0x180)]);if(devices[_0xf2a443][_0x301bbc(0x1b7)])clearTimeout(devices[_0xf2a443][_0x301bbc(0x1b7)]);removeSocketListeners(getClient(_0x25021e['id'])[_0x301bbc(0x294)]),addBlacklist(_0xf2a443),devices[_0xf2a443]['telegramIpApproval']=null,devices[_0xf2a443][_0x301bbc(0x225)]=null,devices[_0xf2a443][_0x301bbc(0x211)][_0x301bbc(0x172)]=null,io['to'](getClient(_0x25021e['id'])[_0x301bbc(0x294)])[_0x301bbc(0x249)](_0x301bbc(0x1cf),{'access':{'allow':![],'reason':_0x301bbc(0x25d),'token':null}});}else logger[_0x301bbc(0x259)](_0x301bbc(0x215));});}function initializeSocketBot(_0x3021e0){const _0xb3fa06=_0x136b40,_0x5d3fc0=getClient(_0x3021e0['id'])[_0xb3fa06(0x284)],_0x2a7727=getClient(_0x3021e0['id'])[_0xb3fa06(0x294)];_0x3021e0['on'](_0xb3fa06(0x148),(_0x49b001,_0x279942)=>{const _0x22477c=_0xb3fa06;if(validateAccess(_0x279942,_0x2a7727)[_0x22477c(0x13c)]){if(pid[_0x5d3fc0])pid[_0x5d3fc0][_0x22477c(0x234)]({'function':_0x22477c(0x199),'args':_0x49b001});}else logger[_0x22477c(0x259)](_0x22477c(0x1b9));}),_0x3021e0['on']('delete-alerts',(_0x56684c,_0x1a84ad)=>{const _0x7738ca=_0xb3fa06;if(validateAccess(_0x1a84ad,_0x2a7727)['allow']){if(pid[_0x5d3fc0])pid[_0x5d3fc0][_0x7738ca(0x234)]({'function':_0x7738ca(0x139),'args':_0x56684c});}else logger['full']('Unauthorized\x20attempt\x20to\x20delete\x20alerts');}),_0x3021e0['on']('get-portfolio',(_0x168c5e,_0x239f8c)=>{const _0x437176=_0xb3fa06;if(validateAccess(_0x239f8c,_0x2a7727)['allow']){if(pid[_0x5d3fc0])pid[_0x5d3fc0]['send']({'function':_0x437176(0x102),'args':_0x168c5e});}else logger[_0x437176(0x259)]('Unauthorized\x20attempt\x20to\x20get\x20portfolio');}),_0x3021e0['on'](_0xb3fa06(0x1c5),(_0x53f22f,_0x4d3a57)=>{const _0x234cc2=_0xb3fa06;if(validateAccess(_0x4d3a57,_0x2a7727)[_0x234cc2(0x13c)]){if(pid[_0x5d3fc0])pid[_0x5d3fc0][_0x234cc2(0x234)]({'function':_0x234cc2(0x15a),'args':_0x53f22f});}else logger[_0x234cc2(0x259)](_0x234cc2(0x20d));}),_0x3021e0['on'](_0xb3fa06(0x273),(_0xbfd739,_0x120292)=>{const _0x41df9=_0xb3fa06;if(validateAccess(_0x120292,_0x2a7727)[_0x41df9(0x13c)]){if(pid[_0x5d3fc0])pid[_0x5d3fc0][_0x41df9(0x234)]({'function':_0x41df9(0x209),'args':_0xbfd739});}else logger[_0x41df9(0x259)]('Unauthorized\x20attempt\x20to\x20store\x20headless\x20configuration');}),_0x3021e0['on']('get-starting-balances',_0x1b5238=>{const _0x1344f5=_0xb3fa06;if(validateAccess(_0x1b5238,_0x2a7727)[_0x1344f5(0x13c)]){if(pid[_0x5d3fc0])pid[_0x5d3fc0]['send']({'function':'getStartingBalances','args':null});}else logger[_0x1344f5(0x259)]('Unauthorized\x20attempt\x20to\x20get\x20starting\x20balances');}),_0x3021e0['on'](_0xb3fa06(0x256),(_0x3f49f4,_0x3d8738)=>{const _0x8d17ba=_0xb3fa06;if(validateAccess(_0x3d8738,_0x2a7727)[_0x8d17ba(0x13c)]){if(pid[_0x5d3fc0])pid[_0x5d3fc0][_0x8d17ba(0x234)]({'function':_0x8d17ba(0x12e),'args':_0x3f49f4});}else logger[_0x8d17ba(0x259)](_0x8d17ba(0x113));}),_0x3021e0['on'](_0xb3fa06(0x1c3),_0x4d375d=>{const _0x1c77b3=_0xb3fa06;if(validateAccess(_0x4d375d,_0x2a7727)[_0x1c77b3(0x13c)]){if(pid[_0x5d3fc0])pid[_0x5d3fc0][_0x1c77b3(0x234)]({'function':_0x1c77b3(0x18f),'args':null});}else logger[_0x1c77b3(0x259)](_0x1c77b3(0x229));}),_0x3021e0['on'](_0xb3fa06(0x1cb),_0x209c16=>{const _0xc30afd=_0xb3fa06;if(validateAccess(_0x209c16,_0x2a7727)[_0xc30afd(0x13c)]){if(pid[_0x5d3fc0])pid[_0x5d3fc0]['send']({'function':'showConfig','args':null});}else logger['full'](_0xc30afd(0x280));}),_0x3021e0['on'](_0xb3fa06(0x176),_0x4fe3b1=>{const _0x4d7ec7=_0xb3fa06;if(validateAccess(_0x4fe3b1,_0x2a7727)[_0x4d7ec7(0x13c)])updateBB();else logger[_0x4d7ec7(0x259)](_0x4d7ec7(0x138));}),_0x3021e0['on']('get-messages',_0x17af3f=>{const _0x37441d=_0xb3fa06;if(validateAccess(_0x17af3f,_0x2a7727)[_0x37441d(0x13c)])getMessages();else logger['full']('Unauthorized\x20attempt\x20to\x20get\x20messages');}),_0x3021e0['on'](_0xb3fa06(0x141),(_0x33444b,_0x440d69)=>{const _0xde11f8=_0xb3fa06;if(validateAccess(_0x440d69,_0x2a7727)[_0xde11f8(0x13c)])confirmMessage(_0x33444b);else logger['full'](_0xde11f8(0x122));}),_0x3021e0['on'](_0xb3fa06(0x1d2),_0x37bfc8=>{const _0x28e030=_0xb3fa06;if(validateAccess(_0x37bfc8,_0x2a7727)['allow']){if(devices[_0x2a7727][_0x28e030(0x180)])clearTimeout(devices[_0x2a7727][_0x28e030(0x180)]);if(devices[_0x2a7727][_0x28e030(0x1b7)])clearTimeout(devices[_0x2a7727][_0x28e030(0x1b7)]);removeSocketListeners(getClient(_0x3021e0['id'])[_0x28e030(0x294)]),addBlacklist(_0x2a7727),devices[_0x2a7727]['telegramIpApproval']=null,devices[_0x2a7727][_0x28e030(0x225)]=null,devices[_0x2a7727]['access'][_0x28e030(0x172)]=null,io['to'](getClient(_0x3021e0['id'])[_0x28e030(0x294)])[_0x28e030(0x249)](_0x28e030(0x1cf),{'access':{'allow':![],'reason':_0x28e030(0x25d),'token':null}});}else logger[_0x28e030(0x259)](_0x28e030(0x215));});}function removeSocketListeners(_0x5924cd){const _0x4a5951=_0x136b40;getClientsWithUuid(_0x5924cd)[_0x4a5951(0x119)](_0x177159=>{const _0x4041b3=_0x4a5951;getSocket(_0x177159['id'])[_0x4041b3(0x28d)]();});}function cleanSettings(){const _0x501b32=_0x136b40;let _0x35063=settings;return settings[_0x501b32(0x151)]&&settings[_0x501b32(0x151)]!=''&&(_0x35063={..._0x35063,'telegramToken':'************'}),settings[_0x501b32(0x194)]&&settings[_0x501b32(0x194)]!=''&&(_0x35063={..._0x35063,'bbPassword':_0x501b32(0x195)}),(settings[_0x501b32(0x194)]&&settings['bbPassword']==_0x501b32(0x1c0)||settings[_0x501b32(0x151)]&&settings[_0x501b32(0x151)]==_0x501b32(0x1c0))&&(_0x35063={..._0x35063,'restored':{'password':settings['bbPassword']=='***','telegram':settings[_0x501b32(0x151)]==_0x501b32(0x1c0)}}),_0x35063;}function updateBB(){const _0xd49caa=_0x136b40;installingUpdate=!![],config[_0xd49caa(0x119)](_0x1f8aa9=>{restartBot(_0x1f8aa9['botID']);}),process['send']({'update':!![]},_0x121016=>{});}function startBot(_0x368a9d,_0x687f2a,_0x3dee67){const _0x2227df=_0x136b40;let _0x401e4a=![];const _0x435898=_0x368a9d[0x0];_0x687f2a={..._0x687f2a,'stdio':[_0x2227df(0xf7),_0x2227df(0xf7),_0x2227df(0xf7),'ipc']},pid[_0x435898]=childProcess['fork'](botfile,_0x368a9d,_0x687f2a),pid[_0x435898]['on']('message',_0x4d77f6=>{const _0x4276b0=_0x2227df;switch(Object[_0x4276b0(0x26c)](_0x4d77f6)[0x0]){case _0x4276b0(0xf3):updateBotName(_0x435898,_0x4d77f6['botname']);break;case _0x4276b0(0x1bb):updateBotManager();break;case _0x4276b0(0x1cf):updateStatus(_0x435898,_0x4d77f6['status']);break;case _0x4276b0(0x219):updateLive(_0x435898,_0x4d77f6[_0x4276b0(0x219)]);break;case _0x4276b0(0x173):updateLive(_0x435898,_0x4d77f6[_0x4276b0(0x173)]),io['to'](_0x435898)[_0x4276b0(0x249)](_0x4276b0(0x1cf),{'access':{'allow':![],'reason':_0x4276b0(0x1e1),'token':null}});break;case'stop':_0x4d77f6['stop']==_0x4276b0(0x23f)&&restartBot(_0x435898);_0x4d77f6[_0x4276b0(0x15c)]==_0x4276b0(0x236)&&toggleBot(_0x435898,_0x4276b0(0x1ab),'stopped');break;case _0x4276b0(0x13e):sendTelegram(_0x435898,_0x4d77f6[_0x4276b0(0x13e)]);break;case _0x4276b0(0x1f3):sendTelegramMsg(_0x4d77f6[_0x4276b0(0x1f3)]);break;case _0x4276b0(0x123):io['to'](_0x435898)[_0x4276b0(0x249)](_0x4d77f6[_0x4276b0(0x123)],_0x4d77f6[_0x4276b0(0x267)]);break;}}),pid[_0x435898]['on'](_0x2227df(0x27d),function(_0x391c81){if(_0x401e4a)return;_0x401e4a=!![],_0x3dee67(_0x391c81);}),pid[_0x435898]['on'](_0x2227df(0x233),async function(_0xa329d9){const _0x4a91ec=_0x2227df;if(installingUpdate)return;if(_0x401e4a)return;_0x401e4a=!![],_0x3dee67(null);const _0x61efa=dbConfig['get']('bots')['find']({'botID':_0x435898})[_0x4a91ec(0x1c7)]();_0x61efa&&(_0x61efa[_0x4a91ec(0x1cf)]==_0x4a91ec(0x275)||_0x61efa[_0x4a91ec(0x1cf)]==_0x4a91ec(0x170))&&(await sleep(0x3e8),updateLive(_0x435898,_0x4a91ec(0x16f)),logger[_0x4a91ec(0x259)](_0x4a91ec(0x25f)+_0x435898),startBot([_0x435898,userID],{'cwd':bbpath},function(_0x279aa4){const _0x4802db=_0x4a91ec;if(_0x279aa4)logger[_0x4802db(0x259)](_0x279aa4);}));});}function stopBot(_0x259c8f){const _0x12ed06=_0x136b40;getClientsWithBotID(_0x259c8f)[_0x12ed06(0x119)](_0x181f86=>{getSocket(_0x181f86['id'])['disconnect'](!![]),removeClient(_0x181f86['id']);}),pid[_0x259c8f]&&(pid[_0x259c8f][_0x12ed06(0x236)](),pid[_0x259c8f]=null);}function restartBot(_0x15cbf0){if(pid[_0x15cbf0])pid[_0x15cbf0]['kill']();}function addBot(){const _0x43657b=_0x136b40;let _0x5583a9;for(let _0x175be5=0x1;_0x175be5<0x3e9;_0x175be5++){_0x5583a9=_0x175be5[_0x43657b(0x1b1)]()['padStart'](0x3,'0');let _0x2ba3ed=config['find'](_0x1beac7=>_0x1beac7[_0x43657b(0x12f)]==_0x5583a9);if(!_0x2ba3ed)break;}if(_0x5583a9===_0x43657b(0x214)){logger[_0x43657b(0x259)]('the\x20maximum\x20of\x20999\x20bots\x20has\x20been\x20reached');return;}logger[_0x43657b(0x259)]('starting\x20new\x20bot\x20|\x20Bot\x20'+_0x5583a9),dbConfig[_0x43657b(0x1ca)]('bots')[_0x43657b(0x283)]({'botID':_0x5583a9,'botname':_0x43657b(0x23a)+_0x5583a9,'status':'new','live':''})[_0x43657b(0x182)](),startBot([_0x5583a9,userID],{'cwd':bbpath},function(_0x930ffd){const _0x3082d2=_0x43657b;if(_0x930ffd)logger[_0x3082d2(0x259)](_0x930ffd);}),config=getConfiguration(),io['to'](_0x43657b(0x193))[_0x43657b(0x249)](_0x43657b(0x244),config);}function deleteBot(_0x34fa5c){const _0x230599=_0x136b40;getClientsWithBotID(_0x34fa5c)[_0x230599(0x119)](_0x153c6c=>{const _0x242017=_0x230599;getSocket(_0x153c6c['id'])[_0x242017(0x237)](!![]),removeClient(_0x153c6c['id']);}),dbConfig['get'](_0x230599(0x244))['remove']({'botID':_0x34fa5c})[_0x230599(0x182)](),logger['full'](_0x230599(0x11c)+_0x34fa5c),stopBot(_0x34fa5c);try{if(fs[_0x230599(0x203)](path[_0x230599(0x1af)](configpath,_0x230599(0xf6)+_0x34fa5c+_0x230599(0x110))))fs[_0x230599(0x213)](path[_0x230599(0x1af)](configpath,_0x230599(0xf6)+_0x34fa5c+_0x230599(0x110)));if(fs[_0x230599(0x203)](path[_0x230599(0x1af)](configpath,'bot-'+_0x34fa5c+_0x230599(0x16e))))fs['unlinkSync'](path[_0x230599(0x1af)](configpath,_0x230599(0xf6)+_0x34fa5c+'-events.json'));if(fs['existsSync'](path[_0x230599(0x1af)](configpath,_0x230599(0xf6)+_0x34fa5c+_0x230599(0x17c))))fs[_0x230599(0x213)](path['join'](configpath,_0x230599(0xf6)+_0x34fa5c+_0x230599(0x17c)));if(fs[_0x230599(0x203)](path[_0x230599(0x1af)](configpath,_0x230599(0xf6)+_0x34fa5c+_0x230599(0x217))))fs[_0x230599(0x213)](path[_0x230599(0x1af)](configpath,_0x230599(0xf6)+_0x34fa5c+'-results.json'));}catch(_0x122250){if(_0x122250)logger[_0x230599(0x259)](_0x230599(0x28c),_0x122250);}config=getConfiguration(),io['to']('botmanager')['emit'](_0x230599(0x244),config);}function toggleBot(_0x517785,_0x597f70,_0x1e491b){const _0x5d83aa=_0x136b40;dbConfig['get']('bots')[_0x5d83aa(0x184)]({'botID':_0x517785})[_0x5d83aa(0xf2)]({'status':_0x597f70})[_0x5d83aa(0xf2)]({'live':_0x1e491b})[_0x5d83aa(0x182)]();if(_0x597f70=='enabled'||_0x597f70=='new')logger[_0x5d83aa(0x259)](_0x5d83aa(0x16d)+_0x517785),startBot([_0x517785,userID],{'cwd':bbpath},function(_0x72c230){if(_0x72c230)logger['full'](_0x72c230);});else(_0x597f70==_0x5d83aa(0x1ab)||_0x597f70==_0x5d83aa(0x12d))&&(logger[_0x5d83aa(0x259)](_0x5d83aa(0x261)+_0x517785),stopBot(_0x517785));config=getConfiguration(),io['to'](_0x5d83aa(0x193))['emit'](_0x5d83aa(0x244),config);}function toggleStatus(_0x3744b2){const _0x48b7af=_0x136b40;let _0x11c243=dbConfig[_0x48b7af(0x1ca)](_0x48b7af(0x244))[_0x48b7af(0x184)]({'botID':_0x3744b2})[_0x48b7af(0x1c7)](),_0x25ddf5;if(_0x11c243['status']===_0x48b7af(0x275))_0x25ddf5=_0x48b7af(0x1ab);else{if(_0x11c243[_0x48b7af(0x1cf)]==='new')_0x25ddf5=_0x48b7af(0x12d);else{if(_0x11c243[_0x48b7af(0x1cf)]===_0x48b7af(0x12d))_0x25ddf5=_0x48b7af(0x170);else{if(_0x11c243[_0x48b7af(0x1cf)]==='disabled')_0x25ddf5=_0x48b7af(0x275);}}}return _0x25ddf5;}function updateStatus(_0x4b3a0d,_0x4cdc3f){const _0x32621c=_0x136b40;dbConfig['get'](_0x32621c(0x244))['find']({'botID':_0x4b3a0d})[_0x32621c(0xf2)]({'status':_0x4cdc3f})[_0x32621c(0x182)](),config=getConfiguration(),io['to'](_0x32621c(0x193))[_0x32621c(0x249)](_0x32621c(0x244),config);}function updateLive(_0x2acc6d,_0x858598){const _0x3ef9e3=_0x136b40;dbConfig[_0x3ef9e3(0x1ca)](_0x3ef9e3(0x244))[_0x3ef9e3(0x184)]({'botID':_0x2acc6d})[_0x3ef9e3(0xf2)]({'live':_0x858598})[_0x3ef9e3(0x182)](),config=getConfiguration(),io['to'](_0x3ef9e3(0x193))[_0x3ef9e3(0x249)](_0x3ef9e3(0x244),config);}function updateBotName(_0x21b854,_0x1d0cd4){const _0x45f18e=_0x136b40;dbConfig[_0x45f18e(0x1ca)](_0x45f18e(0x244))[_0x45f18e(0x184)]({'botID':_0x21b854})[_0x45f18e(0xf2)]({'botname':_0x1d0cd4})[_0x45f18e(0x182)](),config=getConfiguration(),io['to'](_0x45f18e(0x193))[_0x45f18e(0x249)](_0x45f18e(0x244),config);}function updateBotManager(){const _0x1bcd2d=_0x136b40;config=getConfiguration(),io['to'](_0x1bcd2d(0x193))[_0x1bcd2d(0x249)]('bots',config);}function toggleBotMode(_0x57b2c4){const _0x3f2ba2=_0x136b40;if(pid[_0x57b2c4])pid[_0x57b2c4][_0x3f2ba2(0x234)]({'function':_0x3f2ba2(0x287),'args':null});else{const _0x2f236b=configpath+_0x3f2ba2(0xf6)+_0x57b2c4+_0x3f2ba2(0x110),_0xfccb7c=fs[_0x3f2ba2(0x134)](_0x2f236b),_0x320abc=JSON[_0x3f2ba2(0x13f)](_0xfccb7c),_0x56be17=_0x320abc[_0x3f2ba2(0x284)][0x0][_0x3f2ba2(0x15b)];_0x320abc[_0x3f2ba2(0x284)][0x0][_0x3f2ba2(0x15b)]=!_0x56be17;const _0x322ceb=JSON['stringify'](_0x320abc,null,0x2);fs[_0x3f2ba2(0x230)](_0x2f236b,_0x322ceb),config=getConfiguration(),io['to']('botmanager')[_0x3f2ba2(0x249)](_0x3f2ba2(0x244),config);}}function telegramError(_0x43278c){const _0x75a985=_0x136b40;logger[_0x75a985(0x14b)](getTimeStamp()+_0x75a985(0x286));}function validateTelegram(_0x5a7650){const _0x2e508f=_0x136b40;if(_0x5a7650[_0x2e508f(0x1b8)][_0x2e508f(0x19e)]!=settings[_0x2e508f(0x1da)]&&'@'+_0x5a7650[_0x2e508f(0x1b8)][_0x2e508f(0x19e)]!=settings[_0x2e508f(0x1da)])return tgBot['sendMessage'](_0x5a7650[_0x2e508f(0x242)]['id'],'Unauthorized\x20user\x20-\x20make\x20sure\x20you\x27ve\x20entered\x20your\x20<b>personal</b>\x20Telegram\x20username\x20in\x20the\x20Bot\x20Manager\x27s\x20settings',{'parse_mode':_0x2e508f(0x240)})['catch'](_0x37977b=>{telegramError(_0x37977b);}),![];return!![];}async function initTelegram(){const _0x2f688c=_0x136b40;if(tgBot)tgBot[_0x2f688c(0x1d3)](),tgBot=null,initTelegram();else{tgBot=new TelegramBot(settings[_0x2f688c(0x151)],{'polling':!![]});let _0x3feb76=_0x2f688c(0x22c);_0x3feb76+='\x0a',_0x3feb76+=_0x2f688c(0x212),_0x3feb76+=_0x2f688c(0x107),_0x3feb76+=_0x2f688c(0x179),_0x3feb76+=_0x2f688c(0x1de),_0x3feb76+=_0x2f688c(0x25a),_0x3feb76+=_0x2f688c(0x15d),_0x3feb76+='/toggle\x20-\x20toggle\x20manual\x20vs\x20auto\x20mode\x0a',_0x3feb76+=_0x2f688c(0x13a),_0x3feb76+=_0x2f688c(0x201),_0x3feb76+='/portfolio\x20-\x20show\x20bot\x20portfolio\x0a',_0x3feb76+='/update\x20-\x20update\x20Balance\x20Bot\x0a',_0x3feb76+=_0x2f688c(0x21a);let _0xcd0b1e='Welcome\x20to\x20your\x20personal\x20Balance\x20Bot\x20Telegram\x20bot!\x0a';_0xcd0b1e+='\x0a',_0xcd0b1e+=_0x3feb76,tgBot[_0x2f688c(0x1aa)](/\/start/,_0x2d4c6c=>{const _0xf83a15=_0x2f688c;if(!validateTelegram(_0x2d4c6c))return;if(settings[_0xf83a15(0x185)]!=_0x2d4c6c['chat']['id'])updateSetting('telegramChatId',_0x2d4c6c[_0xf83a15(0x242)]['id']);updateSetting(_0xf83a15(0x10a),!![]),tgBot[_0xf83a15(0x178)](_0x2d4c6c[_0xf83a15(0x242)]['id'],_0xcd0b1e)[_0xf83a15(0x1fb)](_0x4d4118=>{telegramError(_0x4d4118);});}),tgBot['onText'](/\/enable/,_0x539710=>{const _0x33ffe0=_0x2f688c;if(!validateTelegram(_0x539710))return;if(settings['telegramChatId']!=_0x539710[_0x33ffe0(0x242)]['id'])updateSetting('telegramChatId',_0x539710[_0x33ffe0(0x242)]['id']);updateSetting(_0x33ffe0(0x10a),!![]),tgBot[_0x33ffe0(0x178)](_0x539710[_0x33ffe0(0x242)]['id'],_0x33ffe0(0x1bf))['catch'](_0x472317=>{telegramError(_0x472317);});}),tgBot[_0x2f688c(0x1aa)](/\/config/,async _0x4ba638=>{const _0x993d61=_0x2f688c;if(!validateTelegram(_0x4ba638))return;tgBot[_0x993d61(0x161)]('callback_query'),tgBot[_0x993d61(0x178)](_0x4ba638['chat']['id'],'Of\x20which\x20events\x20do\x20you\x20want\x20to\x20be\x20notified?',{'reply_markup':{'inline_keyboard':[[{'text':_0x993d61(0x27e),'callback_data':'orders'},{'text':'Alerts','callback_data':_0x993d61(0xfd)},{'text':_0x993d61(0x1b3),'callback_data':'all'}]]}})[_0x993d61(0x1fb)](_0x388738=>{telegramError(_0x388738);}),tgBot['on'](_0x993d61(0x243),async _0x32f4a9=>{const _0x4ee3ac=_0x993d61,_0xf34715=_0x32f4a9[_0x4ee3ac(0x1b6)],_0x4b1ef9=_0x32f4a9[_0x4ee3ac(0x12a)];tgBot['answerCallbackQuery'](_0x32f4a9['id'])[_0x4ee3ac(0x196)](async()=>{const _0xbcc0e2=_0x4ee3ac;_0xf34715==_0xbcc0e2(0x1fc)&&(updateSetting('telegramEvents',_0xbcc0e2(0x1fc)),updateSetting('telegramEnabled',!![]),await tgBot[_0xbcc0e2(0x178)](_0x4b1ef9['chat']['id'],_0xbcc0e2(0x252))['catch'](_0xb5df52=>{telegramError(_0xb5df52);}));_0xf34715==_0xbcc0e2(0xfd)&&(updateSetting(_0xbcc0e2(0x290),_0xbcc0e2(0xfd)),updateSetting(_0xbcc0e2(0x10a),!![]),await tgBot['sendMessage'](_0x4b1ef9[_0xbcc0e2(0x242)]['id'],_0xbcc0e2(0x104))[_0xbcc0e2(0x1fb)](_0x589217=>{telegramError(_0x589217);}));_0xf34715==_0xbcc0e2(0x11d)&&(updateSetting('telegramEvents',_0xbcc0e2(0x11d)),updateSetting('telegramEnabled',!![]),await tgBot[_0xbcc0e2(0x178)](_0x4b1ef9[_0xbcc0e2(0x242)]['id'],_0xbcc0e2(0x114))['catch'](_0x15dba1=>{telegramError(_0x15dba1);}));if(!settings['telegramChatId'])tgBot['sendMessage'](_0x4b1ef9[_0xbcc0e2(0x242)]['id'],_0xbcc0e2(0x174))['catch'](_0x4659e5=>{telegramError(_0x4659e5);});}),tgBot[_0x4ee3ac(0x161)](_0x4ee3ac(0x243));});}),tgBot[_0x2f688c(0x1aa)](/\/status/,_0x43aa6b=>{const _0x327822=_0x2f688c;if(!validateTelegram(_0x43aa6b))return;const _0x2c6b22=getBotsWithMode();let _0x1e517f=_0x327822(0x109);config['forEach'](_0x4d80c1=>{const _0x5e9f90=_0x327822,_0x1938e7=_0x2c6b22['find'](_0x1f74e2=>_0x1f74e2['botID']==_0x4d80c1[_0x5e9f90(0x12f)])[_0x5e9f90(0x20c)];_0x1e517f+=_0x5e9f90(0x23a)+_0x4d80c1[_0x5e9f90(0x12f)]+':\x20'+_0x4d80c1[_0x5e9f90(0x1cf)]+_0x5e9f90(0x28b)+_0x1938e7+_0x5e9f90(0x28b)+_0x4d80c1[_0x5e9f90(0x219)]+'\x0a';}),_0x1e517f+='\x0a',_0x1e517f+='<b>Telegram\x20Bot\x20Status:</b>\x0a',_0x1e517f+=!settings['telegramEnabled']?_0x327822(0x143):_0x327822(0x1d1),_0x1e517f+=settings[_0x327822(0x10a)]?settings[_0x327822(0x290)]==_0x327822(0x11d)?'Notifications\x20types:\x20orders\x20and\x20alerts\x0a':_0x327822(0x27c)+settings[_0x327822(0x290)]+'\x20only\x0a':'',tgBot[_0x327822(0x178)](_0x43aa6b['chat']['id'],_0x1e517f,{'parse_mode':_0x327822(0x240)})['catch'](_0x37a335=>{telegramError(_0x37a335);});}),tgBot[_0x2f688c(0x1aa)](/\/restart/,_0x816fba=>{const _0xffce70=_0x2f688c;if(!validateTelegram(_0x816fba))return;tgBot[_0xffce70(0x161)](_0xffce70(0x243));const _0x50e72f=getEnabledBots();if(_0x50e72f[_0xffce70(0x1f4)]==0x0)tgBot[_0xffce70(0x178)](_0x816fba[_0xffce70(0x242)]['id'],_0xffce70(0x1f5))[_0xffce70(0x1fb)](_0xb1b51b=>{telegramError(_0xb1b51b);});else{if(_0x50e72f[_0xffce70(0x1f4)]>0x1)_0x50e72f['push']({'botID':_0xffce70(0x11d)});let _0x43d6e6=[],_0xdb192c=[];const _0xba0514=_0x50e72f[_0xffce70(0x1f4)]%0x4==0x0||_0x50e72f[_0xffce70(0x1f4)]%0x4==0x3||_0x50e72f[_0xffce70(0x1f4)]%0x3==0x1?0x4:0x3;let _0x2e54fb=0x0;_0x50e72f[_0xffce70(0x119)]((_0xf5208b,_0x44eea8)=>{const _0xd73661=_0xffce70;if(_0x44eea8%_0xba0514==0x0)_0xdb192c=[];_0xdb192c[_0xd73661(0x283)]({'text':_0xf5208b[_0xd73661(0x12f)]==_0xd73661(0x11d)?'All\x20bots':_0xd73661(0x23a)+_0xf5208b['botID'],'callback_data':_0xf5208b[_0xd73661(0x12f)]}),_0x44eea8%_0xba0514==0x0&&(_0x43d6e6[_0x2e54fb]=_0xdb192c,_0x2e54fb++);}),tgBot['sendMessage'](_0x816fba[_0xffce70(0x242)]['id'],_0xffce70(0x1eb),{'reply_markup':{'inline_keyboard':_0x43d6e6}})[_0xffce70(0x1fb)](_0x237188=>{telegramError(_0x237188);}),tgBot['on'](_0xffce70(0x243),async _0x250f05=>{const _0x29d48c=_0xffce70,_0x4fd004=_0x250f05[_0x29d48c(0x1b6)],_0x2d6b31=_0x250f05[_0x29d48c(0x12a)];tgBot['answerCallbackQuery'](_0x250f05['id'])[_0x29d48c(0x196)](async()=>{const _0x55baea=_0x29d48c;_0x4fd004=='all'?config[_0x55baea(0x119)](_0x48eaf7=>{const _0x32bffe=_0x55baea;restartBot(_0x48eaf7[_0x32bffe(0x12f)]);}):restartBot(_0x4fd004);}),tgBot[_0x29d48c(0x161)](_0x29d48c(0x243));});}}),tgBot[_0x2f688c(0x1aa)](/\/on/,_0x103bfb=>{const _0xa15a9d=_0x2f688c;if(!validateTelegram(_0x103bfb))return;tgBot['removeListener']('callback_query');const _0x3645ce=getDisabledBots();if(_0x3645ce[_0xa15a9d(0x1f4)]==0x0)tgBot[_0xa15a9d(0x178)](_0x103bfb[_0xa15a9d(0x242)]['id'],_0xa15a9d(0x186))[_0xa15a9d(0x1fb)](_0x2dba90=>{telegramError(_0x2dba90);});else{if(_0x3645ce[_0xa15a9d(0x1f4)]>0x1)_0x3645ce[_0xa15a9d(0x283)]({'botID':_0xa15a9d(0x11d)});let _0x32f208=[],_0x4d5473=[];const _0x41e7a0=_0x3645ce[_0xa15a9d(0x1f4)]%0x4==0x0||_0x3645ce[_0xa15a9d(0x1f4)]%0x4==0x3||_0x3645ce['length']%0x3==0x1?0x4:0x3;let _0x2afe43=0x0;_0x3645ce['forEach']((_0x47e8c6,_0x38218b)=>{const _0x180855=_0xa15a9d;if(_0x38218b%_0x41e7a0==0x0)_0x4d5473=[];_0x4d5473[_0x180855(0x283)]({'text':_0x47e8c6[_0x180855(0x12f)]==_0x180855(0x11d)?_0x180855(0x1e3):'Bot\x20'+_0x47e8c6['botID'],'callback_data':_0x47e8c6[_0x180855(0x12f)]}),_0x38218b%_0x41e7a0==0x0&&(_0x32f208[_0x2afe43]=_0x4d5473,_0x2afe43++);}),tgBot[_0xa15a9d(0x178)](_0x103bfb[_0xa15a9d(0x242)]['id'],_0xa15a9d(0x1e9),{'reply_markup':{'inline_keyboard':_0x32f208}})[_0xa15a9d(0x1fb)](_0x4e1e1c=>{telegramError(_0x4e1e1c);}),tgBot['on'](_0xa15a9d(0x243),async _0x455084=>{const _0x55a2af=_0xa15a9d,_0x593dc4=_0x455084[_0x55a2af(0x1b6)],_0x2bdc43=_0x455084[_0x55a2af(0x12a)];tgBot[_0x55a2af(0x289)](_0x455084['id'])[_0x55a2af(0x196)](async()=>{const _0x44f8c5=_0x55a2af;_0x593dc4==_0x44f8c5(0x11d)?(tgBot[_0x44f8c5(0x178)](_0x2bdc43['chat']['id'],'Bot\x20Mgr\x20>\x20starting\x20all\x20bots')[_0x44f8c5(0x1fb)](_0x146981=>{telegramError(_0x146981);}),_0x3645ce[_0x44f8c5(0x119)](_0x3f2c9e=>{const _0x2e227d=_0x44f8c5;if(_0x3f2c9e[_0x2e227d(0x12f)]!=_0x2e227d(0x11d))toggleBot(_0x3f2c9e[_0x2e227d(0x12f)],toggleStatus(_0x3f2c9e['botID']),_0x2e227d(0x16f));})):(tgBot['sendMessage'](_0x2bdc43[_0x44f8c5(0x242)]['id'],_0x44f8c5(0x101)+_0x593dc4)['catch'](_0x18c8d1=>{telegramError(_0x18c8d1);}),toggleBot(_0x593dc4,toggleStatus(_0x593dc4),_0x44f8c5(0x16f)));}),tgBot['removeListener'](_0x55a2af(0x243));});}}),tgBot['onText'](/\/off/,_0xcbc176=>{const _0x226d5a=_0x2f688c;if(!validateTelegram(_0xcbc176))return;tgBot[_0x226d5a(0x161)](_0x226d5a(0x243));const _0x5124e1=getEnabledBots();if(_0x5124e1[_0x226d5a(0x1f4)]==0x0)tgBot['sendMessage'](_0xcbc176[_0x226d5a(0x242)]['id'],_0x226d5a(0x1f5))[_0x226d5a(0x1fb)](_0xc84ef9=>{telegramError(_0xc84ef9);});else{if(_0x5124e1['length']>0x1)_0x5124e1[_0x226d5a(0x283)]({'botID':'all'});let _0x3bcd78=[],_0x29bf00=[];const _0x2d22e7=_0x5124e1[_0x226d5a(0x1f4)]%0x4==0x0||_0x5124e1[_0x226d5a(0x1f4)]%0x4==0x3||_0x5124e1[_0x226d5a(0x1f4)]%0x3==0x1?0x4:0x3;let _0x95f153=0x0;_0x5124e1[_0x226d5a(0x119)]((_0x2357b4,_0x2f5f1f)=>{const _0x2631b3=_0x226d5a;if(_0x2f5f1f%_0x2d22e7==0x0)_0x29bf00=[];_0x29bf00['push']({'text':_0x2357b4[_0x2631b3(0x12f)]==_0x2631b3(0x11d)?_0x2631b3(0x1e3):_0x2631b3(0x23a)+_0x2357b4[_0x2631b3(0x12f)],'callback_data':_0x2357b4['botID']}),_0x2f5f1f%_0x2d22e7==0x0&&(_0x3bcd78[_0x95f153]=_0x29bf00,_0x95f153++);}),tgBot[_0x226d5a(0x178)](_0xcbc176['chat']['id'],'Which\x20bot\x20do\x20you\x20want\x20to\x20stop?',{'reply_markup':{'inline_keyboard':_0x3bcd78}})[_0x226d5a(0x1fb)](_0x185c81=>{telegramError(_0x185c81);}),tgBot['on'](_0x226d5a(0x243),async _0x5adaba=>{const _0x16fdfb=_0x226d5a,_0x42fdba=_0x5adaba[_0x16fdfb(0x1b6)],_0x11fc8f=_0x5adaba[_0x16fdfb(0x12a)];tgBot[_0x16fdfb(0x289)](_0x5adaba['id'])[_0x16fdfb(0x196)](async()=>{const _0x2cbc93=_0x16fdfb;_0x42fdba==_0x2cbc93(0x11d)?(tgBot[_0x2cbc93(0x178)](_0x11fc8f[_0x2cbc93(0x242)]['id'],'Bot\x20Mgr\x20>\x20stopping\x20all\x20bots')[_0x2cbc93(0x1fb)](_0x32639a=>{telegramError(_0x32639a);}),_0x5124e1[_0x2cbc93(0x119)](_0x5b1947=>{const _0x281df0=_0x2cbc93;if(_0x5b1947[_0x281df0(0x12f)]!=_0x281df0(0x11d))toggleBot(_0x5b1947[_0x281df0(0x12f)],toggleStatus(_0x5b1947[_0x281df0(0x12f)]),_0x281df0(0x16f));})):(tgBot[_0x2cbc93(0x178)](_0x11fc8f[_0x2cbc93(0x242)]['id'],'Bot\x20Mgr\x20>\x20stopping\x20Bot\x20'+_0x42fdba)[_0x2cbc93(0x1fb)](_0x42f0fb=>{telegramError(_0x42f0fb);}),toggleBot(_0x42fdba,toggleStatus(_0x42fdba),_0x2cbc93(0x16f)));}),tgBot[_0x16fdfb(0x161)](_0x16fdfb(0x243));});}}),tgBot[_0x2f688c(0x1aa)](/\/portfolio/,_0x376f36=>{const _0x855211=_0x2f688c;if(!validateTelegram(_0x376f36))return;tgBot[_0x855211(0x161)]('callback_query');const _0x51c889=getEnabledBots();if(_0x51c889[_0x855211(0x1f4)]==0x0)tgBot[_0x855211(0x178)](_0x376f36[_0x855211(0x242)]['id'],_0x855211(0x1f5))[_0x855211(0x1fb)](_0x3cda71=>{telegramError(_0x3cda71);});else{if(_0x51c889[_0x855211(0x1f4)]>0x1){let _0x478251=[],_0x140370=[];const _0xb37394=_0x51c889[_0x855211(0x1f4)]%0x4==0x0||_0x51c889[_0x855211(0x1f4)]%0x4==0x3||_0x51c889['length']%0x3==0x1?0x4:0x3;let _0x4416b0=0x0;_0x51c889[_0x855211(0x119)]((_0x2926a8,_0x277ddd)=>{const _0x595782=_0x855211;if(_0x277ddd%_0xb37394==0x0)_0x140370=[];_0x140370[_0x595782(0x283)]({'text':_0x595782(0x23a)+_0x2926a8['botID'],'callback_data':_0x2926a8[_0x595782(0x12f)]}),_0x277ddd%_0xb37394==0x0&&(_0x478251[_0x4416b0]=_0x140370,_0x4416b0++);}),tgBot[_0x855211(0x178)](_0x376f36[_0x855211(0x242)]['id'],'For\x20which\x20bot\x20do\x20you\x20want\x20the\x20portfolio?',{'reply_markup':{'inline_keyboard':_0x478251}})['catch'](_0xd2bc89=>{telegramError(_0xd2bc89);}),tgBot['on'](_0x855211(0x243),async _0x5d4ac2=>{const _0x129c16=_0x855211,_0x4085de=_0x5d4ac2[_0x129c16(0x1b6)],_0x5df876=_0x5d4ac2[_0x129c16(0x12a)];tgBot[_0x129c16(0x289)](_0x5d4ac2['id'])[_0x129c16(0x196)](async()=>{const _0x56db05=_0x129c16;if(pid[_0x4085de])pid[_0x4085de]['send']({'function':_0x56db05(0x13b),'args':null});}),tgBot[_0x129c16(0x161)](_0x129c16(0x243));});}else{const _0x24125a=_0x51c889[0x0][_0x855211(0x12f)];if(pid[_0x24125a])pid[_0x24125a][_0x855211(0x234)]({'function':_0x855211(0x13b),'args':null});}}}),tgBot[_0x2f688c(0x1aa)](/\/update/,async _0x578c8c=>{const _0x2c97d8=_0x2f688c;if(!validateTelegram(_0x578c8c))return;tgBot[_0x2c97d8(0x161)](_0x2c97d8(0x243)),await getMessages();if(!updateAvailable)tgBot[_0x2c97d8(0x178)](_0x578c8c['chat']['id'],_0x2c97d8(0x162))[_0x2c97d8(0x1fb)](_0x3c3faf=>{telegramError(_0x3c3faf);});else!validInstallation?tgBot[_0x2c97d8(0x178)](_0x578c8c[_0x2c97d8(0x242)]['id'],'Your\x20installation\x20does\x20not\x20support\x20updating\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20update')[_0x2c97d8(0x1fb)](_0xa44769=>{telegramError(_0xa44769);}):(tgBot[_0x2c97d8(0x178)](_0x578c8c[_0x2c97d8(0x242)]['id'],_0x2c97d8(0x260),{'reply_markup':{'inline_keyboard':[[{'text':_0x2c97d8(0x116),'callback_data':_0x2c97d8(0x1ac)},{'text':'No','callback_data':'no'}]]}})[_0x2c97d8(0x1fb)](_0x287ff9=>{telegramError(_0x287ff9);}),tgBot['on'](_0x2c97d8(0x243),async _0x2a93ad=>{const _0x5cb322=_0x2c97d8,_0x4144b3=_0x2a93ad['data'],_0x4b24d9=_0x2a93ad[_0x5cb322(0x12a)];tgBot[_0x5cb322(0x289)](_0x2a93ad['id'])['then'](async()=>{const _0x4cb2ca=_0x5cb322;_0x4144b3==_0x4cb2ca(0x1ac)&&(await tgBot[_0x4cb2ca(0x178)](_0x4b24d9[_0x4cb2ca(0x242)]['id'],'Starting\x20Balance\x20Bot\x20update')[_0x4cb2ca(0x1fb)](_0xf92ed0=>{telegramError(_0xf92ed0);}),updateBB());_0x4144b3=='no'&&await tgBot['sendMessage'](_0x4b24d9[_0x4cb2ca(0x242)]['id'],_0x4cb2ca(0x19b))[_0x4cb2ca(0x1fb)](_0x448edc=>{telegramError(_0x448edc);});if(!settings[_0x4cb2ca(0x185)])tgBot[_0x4cb2ca(0x178)](_0x4b24d9['chat']['id'],_0x4cb2ca(0x174))[_0x4cb2ca(0x1fb)](_0x452413=>{telegramError(_0x452413);});}),tgBot[_0x5cb322(0x161)](_0x5cb322(0x243));}));}),tgBot[_0x2f688c(0x1aa)](/\/toggle/,_0x55c3e9=>{const _0x218bba=_0x2f688c;if(!validateTelegram(_0x55c3e9))return;tgBot[_0x218bba(0x161)](_0x218bba(0x243));const _0xc04954=getBotsWithMode();if(_0xc04954['length']==0x0)tgBot[_0x218bba(0x178)](_0x55c3e9[_0x218bba(0x242)]['id'],_0x218bba(0x1f5))[_0x218bba(0x1fb)](_0x8721f7=>{telegramError(_0x8721f7);});else{let _0x10aaf4=[],_0x3827ae=[];const _0xc5d98f=0x2;let _0xe1408b=0x0;_0xc04954['forEach']((_0x188545,_0x1b1421)=>{const _0x5a22d7=_0x218bba;if(_0x1b1421%_0xc5d98f==0x0)_0x3827ae=[];_0x3827ae[_0x5a22d7(0x283)]({'text':'Bot\x20'+_0x188545[_0x5a22d7(0x12f)]+'\x20('+_0x188545[_0x5a22d7(0x20c)]+')','callback_data':_0x188545[_0x5a22d7(0x12f)]}),_0x1b1421%_0xc5d98f==0x0&&(_0x10aaf4[_0xe1408b]=_0x3827ae,_0xe1408b++);}),tgBot[_0x218bba(0x178)](_0x55c3e9[_0x218bba(0x242)]['id'],_0x218bba(0x111),{'reply_markup':{'inline_keyboard':_0x10aaf4}})['catch'](_0x319203=>{telegramError(_0x319203);}),tgBot['on'](_0x218bba(0x243),async _0x2ea0ca=>{const _0x2c1851=_0x218bba,_0x13bef0=_0x2ea0ca[_0x2c1851(0x1b6)],_0x5b58b4=_0x2ea0ca['message'];tgBot[_0x2c1851(0x289)](_0x2ea0ca['id'])[_0x2c1851(0x196)](async()=>{const _0x3e5319=_0x2c1851,_0x39d9e0=_0xc04954['find'](_0x9232e1=>_0x9232e1[_0x3e5319(0x12f)]==_0x13bef0),_0x5a6bc=_0x39d9e0['mode']==_0x3e5319(0x163)?_0x3e5319(0x175):_0x3e5319(0x163);tgBot[_0x3e5319(0x178)](_0x5b58b4[_0x3e5319(0x242)]['id'],_0x3e5319(0x204)+_0x13bef0+_0x3e5319(0x22b)+_0x5a6bc+_0x3e5319(0x28f))['catch'](_0x3eb9fb=>{telegramError(_0x3eb9fb);}),toggleBotMode(_0x13bef0);}),tgBot['removeListener'](_0x2c1851(0x243));});}}),tgBot[_0x2f688c(0x1aa)](/\/names/,_0x2f1321=>{const _0x2f0c68=_0x2f688c;if(!validateTelegram(_0x2f1321))return;let _0x171dff='';config[_0x2f0c68(0x119)](_0x90cb19=>{const _0x20318f=_0x2f0c68;_0x171dff+=_0x20318f(0x23a)+_0x90cb19[_0x20318f(0x12f)]+':\x20'+_0x90cb19['botname']+'\x0a';}),tgBot[_0x2f0c68(0x178)](_0x2f1321[_0x2f0c68(0x242)]['id'],_0x171dff,{'parse_mode':_0x2f0c68(0x240)})[_0x2f0c68(0x1fb)](_0x5908b0=>{telegramError(_0x5908b0);});}),tgBot[_0x2f688c(0x1aa)](/\/disable/,_0x26bf6a=>{const _0x340189=_0x2f688c;if(!validateTelegram(_0x26bf6a))return;tgBot[_0x340189(0x178)](_0x26bf6a[_0x340189(0x242)]['id'],_0x340189(0x18c))[_0x340189(0x1fb)](_0x43bcc8=>{telegramError(_0x43bcc8);}),updateSetting(_0x340189(0x10a),![]);}),tgBot[_0x2f688c(0x1aa)](/\/help/,_0x5dbcac=>{const _0x3f7fbb=_0x2f688c;if(!validateTelegram(_0x5dbcac))return;tgBot[_0x3f7fbb(0x178)](_0x5dbcac[_0x3f7fbb(0x242)]['id'],_0x3feb76)[_0x3f7fbb(0x1fb)](_0x258e9c=>{telegramError(_0x258e9c);});}),tgBot['on'](_0x2f688c(0xf0),_0x3f3e06=>{const _0x5a67b1=_0x2f688c;_0x3f3e06[_0x5a67b1(0x1b1)]()['includes']('404\x20Not\x20Found')&&(logger[_0x5a67b1(0x259)]('Invalid\x20Telegram\x20token'),tgBot[_0x5a67b1(0x1d3)](),tgBot=null,io['to'](_0x5a67b1(0x193))[_0x5a67b1(0x249)](_0x5a67b1(0x16a),_0x5a67b1(0x272)));}),process['once'](_0x2f688c(0x142),()=>{const _0x379ec7=_0x2f688c;if(tgBot)tgBot[_0x379ec7(0x1d3)]();process[_0x379ec7(0x233)](0x1);}),process['once']('SIGTERM',()=>{const _0x505e70=_0x2f688c;if(tgBot)tgBot['stopPolling']();process[_0x505e70(0x233)](0x1);});}}function disableTelegram(){const _0x47987c=_0x136b40;tgBot&&(tgBot[_0x47987c(0x1d3)](),tgBot=null);}function sendTelegram(_0x5ee7bd,_0x3264ad){const _0x54ea83=_0x136b40;if(settings[_0x54ea83(0x10a)]){if(settings[_0x54ea83(0x290)]==_0x54ea83(0x11d)||(_0x3264ad[_0x54ea83(0x241)]==_0x54ea83(0x27d)||_0x3264ad[_0x54ea83(0x241)]==_0x54ea83(0x1c1)||_0x3264ad[_0x54ea83(0x241)]==_0x54ea83(0x258))&&settings[_0x54ea83(0x290)]=='alerts'||_0x3264ad[_0x54ea83(0x241)]==_0x54ea83(0xf8)&&settings[_0x54ea83(0x290)]==_0x54ea83(0x1fc)){if(tgBot&&settings['telegramChatId']){if(_0x3264ad[_0x54ea83(0x20f)])tgBot[_0x54ea83(0x178)](settings[_0x54ea83(0x185)],_0x3264ad[_0x54ea83(0xf3)]+_0x54ea83(0x146)+_0x3264ad[_0x54ea83(0xfe)])['catch'](_0x16d51b=>{telegramError(_0x16d51b);});else tgBot[_0x54ea83(0x178)](settings[_0x54ea83(0x185)],'Bot\x20'+_0x5ee7bd+'\x20>\x20'+_0x3264ad[_0x54ea83(0xfe)])['catch'](_0x3d34c8=>{telegramError(_0x3d34c8);});}}}}async function sendTelegramMsg(_0x2a6869,_0x52ec56=_0x136b40(0x240)){const _0xdd671b=_0x136b40;return settings['telegramEnabled']&&tgBot&&settings[_0xdd671b(0x185)]?(await tgBot[_0xdd671b(0x178)](settings[_0xdd671b(0x185)],_0x2a6869,{'parse_mode':_0x52ec56})[_0xdd671b(0x1fb)](_0x5e0193=>{telegramError(_0x5e0193);}),!![]):![];}function getDeviceWithIp(_0x27b772){const _0x3a0ad2=_0x136b40;return devices[_0x3a0ad2(0x184)](_0x3615d0=>_0x3615d0['ip']===_0x27b772);}function temporaryAccess2FA(_0x12c9f0,_0x2c4175){const _0x417d12=_0x136b40;let _0x3c59da=new Date(),_0x438ce4=![];if(lastIpApproval){if(_0x3c59da-lastIpApproval<0x1388)_0x438ce4=!![];}lastIpApproval=new Date();if(_0x438ce4)return;tgBot&&settings[_0x417d12(0x185)]&&(tgBot['removeListener'](_0x417d12(0x243)),tgBot[_0x417d12(0x178)](settings[_0x417d12(0x185)],_0x417d12(0x1e7)+normalizeIP(_0x2c4175)[_0x417d12(0x136)]+_0x417d12(0x14f),{'parse_mode':_0x417d12(0x240),'reply_markup':{'inline_keyboard':[[{'text':_0x417d12(0x165),'callback_data':'5'},{'text':_0x417d12(0x218),'callback_data':'15'},{'text':_0x417d12(0x1a3),'callback_data':'30'},{'text':'reject','callback_data':_0x417d12(0x19c)}]]}})[_0x417d12(0x1fb)](_0x533087=>{telegramError(_0x533087);}),tgBot['on'](_0x417d12(0x243),async _0x1b1da6=>{const _0x3674a1=_0x417d12,_0x523013=_0x1b1da6[_0x3674a1(0x1b6)],_0x5b0c19=_0x1b1da6[_0x3674a1(0x12a)];tgBot[_0x3674a1(0x289)](_0x1b1da6['id'])[_0x3674a1(0x196)](async()=>{const _0x4d3401=_0x3674a1;devices[_0x12c9f0][_0x4d3401(0x278)]={'clientip':_0x2c4175,'timestamp':new Date()[_0x4d3401(0x1a8)](),'expiry':_0x523013},_0x523013!=_0x4d3401(0x19c)?(await tgBot[_0x4d3401(0x178)](_0x5b0c19[_0x4d3401(0x242)]['id'],_0x4d3401(0x1a6)+_0x523013+_0x4d3401(0x156),{'parse_mode':'HTML'})[_0x4d3401(0x1fb)](_0x3b05ec=>{telegramError(_0x3b05ec);}),io['to'](_0x12c9f0)[_0x4d3401(0x249)](_0x4d3401(0x1cf),{'access':{'allow':![],'reason':_0x4d3401(0x1e1),'token':null}})):(await tgBot[_0x4d3401(0x178)](_0x5b0c19[_0x4d3401(0x242)]['id'],_0x4d3401(0x18b))[_0x4d3401(0x1fb)](_0x4015ce=>{telegramError(_0x4015ce);}),io['to'](_0x12c9f0)[_0x4d3401(0x249)](_0x4d3401(0x1cf),{'access':{'allow':![],'reason':'temporary\x20access\x20rejected','token':null}}));}),tgBot[_0x3674a1(0x161)](_0x3674a1(0x243));}));}function loginAccess2FA(_0x4699d6,_0xec827a){const _0x4b6358=_0x136b40;tgBot&&settings[_0x4b6358(0x185)]&&(tgBot[_0x4b6358(0x161)](_0x4b6358(0x243)),tgBot['sendMessage'](settings[_0x4b6358(0x185)],_0x4b6358(0x1ff)+normalizeIP(_0xec827a)[_0x4b6358(0x136)]+'</b>\x20?',{'parse_mode':_0x4b6358(0x240),'reply_markup':{'inline_keyboard':[[{'text':_0x4b6358(0x24f),'callback_data':loginExpiry},{'text':_0x4b6358(0x19c),'callback_data':_0x4b6358(0x19c)}]]}})['catch'](_0x4a890e=>{telegramError(_0x4a890e);}),tgBot['on']('callback_query',async _0x20818f=>{const _0x1b6f75=_0x4b6358,_0x8539dc=_0x20818f['data'],_0x254f20=_0x20818f[_0x1b6f75(0x12a)];tgBot['answerCallbackQuery'](_0x20818f['id'])[_0x1b6f75(0x196)](async()=>{const _0x15f8a3=_0x1b6f75;devices[_0x4699d6]['telegram2FaApproval']={'clientip':_0xec827a,'timestamp':new Date()[_0x15f8a3(0x1a8)](),'expiry':_0x8539dc},_0x8539dc!=_0x15f8a3(0x19c)?(await tgBot['sendMessage'](_0x254f20[_0x15f8a3(0x242)]['id'],_0x15f8a3(0x1a9),{'parse_mode':_0x15f8a3(0x240)})[_0x15f8a3(0x1fb)](_0x322d4f=>{telegramError(_0x322d4f);}),io['to'](_0x4699d6)[_0x15f8a3(0x249)]('status',{'access':{'allow':![],'reason':_0x15f8a3(0x1e1),'token':null}})):(await tgBot[_0x15f8a3(0x178)](_0x254f20[_0x15f8a3(0x242)]['id'],_0x15f8a3(0x1f2))[_0x15f8a3(0x1fb)](_0x335ee5=>{telegramError(_0x335ee5);}),io['to'](_0x4699d6)[_0x15f8a3(0x249)](_0x15f8a3(0x1cf),{'access':{'allow':![],'reason':_0x15f8a3(0xfb),'token':null}}));}),tgBot[_0x1b6f75(0x161)](_0x1b6f75(0x243));}));}function getConfiguration(){return getBotsWithMode();}function getEnabledBots(){const _0x29bd4d=_0x136b40;return dbConfig[_0x29bd4d(0x1ca)]('bots')[_0x29bd4d(0x17e)](_0x29bd4d(0x12f))[_0x29bd4d(0x270)]({'status':_0x29bd4d(0x275)})[_0x29bd4d(0x1c7)]()||[];}function getDisabledBots(){const _0x26a55c=_0x136b40;return dbConfig[_0x26a55c(0x1ca)](_0x26a55c(0x244))[_0x26a55c(0x17e)]('botID')[_0x26a55c(0x270)]({'status':_0x26a55c(0x1ab)})[_0x26a55c(0x1c7)]()||[];}function getBotAttributes(_0x403097){const _0x3526c8=_0x136b40;let _0xcc4ca6={};const _0x4af5c7=configpath+_0x3526c8(0xf6)+_0x403097+'-config.json',_0x116dcc=fs[_0x3526c8(0x203)](_0x4af5c7);if(_0x116dcc){const _0x47d275=fs['readFileSync'](_0x4af5c7);try{const _0x3edd67=JSON[_0x3526c8(0x13f)](_0x47d275),_0xbfecc8=_0x3edd67?_0x3edd67[_0x3526c8(0x284)][0x0][_0x3526c8(0x15b)]:![];_0xcc4ca6['mode']=_0xbfecc8?_0x3526c8(0x163):_0x3526c8(0x175),_0xcc4ca6[_0x3526c8(0xf3)]=_0x3edd67?_0x3edd67['bot'][0x0][_0x3526c8(0xf3)]:_0x3526c8(0x23a)+_0x403097;}catch(_0x48ee3b){_0xcc4ca6['mode']=_0x3526c8(0x175),_0xcc4ca6[_0x3526c8(0xf3)]=_0x3526c8(0x23a)+_0x403097;}}else _0xcc4ca6['mode']=_0x3526c8(0x175),_0xcc4ca6[_0x3526c8(0xf3)]=_0x3526c8(0x23a)+_0x403097;return _0xcc4ca6;}function getBotsWithMode(){const _0x245a78=_0x136b40,_0x505464=dbConfig[_0x245a78(0x1ca)](_0x245a78(0x244))[_0x245a78(0x17e)](_0x245a78(0x12f))[_0x245a78(0x1c7)]()||[];return _0x505464[_0x245a78(0x119)](_0x1fa457=>{const _0x305763=_0x245a78;let _0x36f3b2=getBotAttributes(_0x1fa457['botID']);_0x1fa457['mode']=_0x36f3b2[_0x305763(0x20c)];}),_0x505464;}function getBotExchanges(){const _0x371309=_0x136b40;let _0x1d168a=[];const _0x46abde=dbConfig[_0x371309(0x1ca)](_0x371309(0x244))[_0x371309(0x17e)]('botID')[_0x371309(0x1c7)]()||[];_0x46abde['forEach'](_0x38b495=>{const _0xb15212=_0x371309;if(_0x38b495[_0xb15212(0x1cf)]=='enabled'){const _0x514aac=configpath+_0xb15212(0xf6)+_0x38b495['botID']+_0xb15212(0x110),_0x464075=fs['existsSync'](_0x514aac);let _0x2e56ce;if(_0x464075){const _0xc0d334=fs['readFileSync'](_0x514aac);try{const _0x515c16=JSON[_0xb15212(0x13f)](_0xc0d334);_0x2e56ce=_0x515c16?_0x515c16[_0xb15212(0x284)][0x0][_0xb15212(0x1cd)]:null;}catch(_0x300291){}}if(_0x2e56ce)_0x1d168a['push'](_0x2e56ce);}});const _0x3d7ddf=[...new Set(_0x1d168a)][_0x371309(0x189)]();return _0x3d7ddf;}async function initUser(){const _0x44b342=_0x136b40;if(!settings[_0x44b342(0x11e)]){const _0x1bc7ce=uuidRandom();mixpanel[_0x44b342(0x263)](_0x1bc7ce),updateSetting(_0x44b342(0x11e),_0x1bc7ce);}}async function initSecure(){const _0x30d698=_0x136b40;let _0x4b1d35=getSecure();if(!_0x4b1d35[_0x30d698(0x27f)](_0x30d698(0x1b5))){let _0x391c3b=await generateKeys();_0x4b1d35['publicKey']=_0x391c3b[_0x30d698(0x1f9)],_0x4b1d35['privateKey']=_0x391c3b['privateKey'],_0x4b1d35['secret']=crypto['randomBytes'](0x20)['toString'](_0x30d698(0x1be));;storeSecure(_0x4b1d35);}}function getSettings(){const _0x285696=_0x136b40;return dbSettings[_0x285696(0x1ca)](_0x285696(0x268))[_0x285696(0x1c7)]()||{};}function getSecure(){const _0x4b27e9=_0x136b40;return dbSecure['get'](_0x4b27e9(0x187))[_0x4b27e9(0x1c7)]()||{};}function getBlacklist(){const _0x3bda0f=_0x136b40;return dbSecure['get'](_0x3bda0f(0x247))[_0x3bda0f(0x1c7)]()||[];}function broadcastToBots(_0x569d1c,_0x39f353){const _0x1c3545=_0x136b40;config[_0x1c3545(0x119)](_0x5ccea1=>{const _0x8b8539=_0x1c3545;if(_0x5ccea1['status']==_0x8b8539(0x275)&&_0x5ccea1['live']=='running'){if(pid[_0x5ccea1[_0x8b8539(0x12f)]])pid[_0x5ccea1['botID']][_0x8b8539(0x234)]({[_0x569d1c]:_0x39f353});}});}function storeSettings(_0xb4ccd8,_0xc8ffc8=![]){const _0x441845=_0x136b40;_0xb4ccd8={...settings,..._0xb4ccd8};if(_0xc8ffc8&&_0xb4ccd8[_0x441845(0x194)]!=_0x441845(0x195)&&_0xb4ccd8[_0x441845(0x194)]!=_0x441845(0x1c0)&&_0xb4ccd8[_0x441845(0x194)]!=''){const _0x545f7a=crypt[_0x441845(0x266)](secure[_0x441845(0x158)],_0xb4ccd8[_0x441845(0x194)])[_0x441845(0x12a)][_0x441845(0x1e0)]('@')[0x0],_0x49cc70=bcrypt[_0x441845(0x20e)](_0x545f7a,saltRounds);_0xb4ccd8={..._0xb4ccd8,'bbPassword':_0x49cc70};}if(_0xc8ffc8&&_0xb4ccd8[_0x441845(0x151)]!=_0x441845(0x195)&&_0xb4ccd8[_0x441845(0x151)]!='***'&&_0xb4ccd8['telegramToken']!=''){const _0x4716a8=crypt[_0x441845(0x266)](secure[_0x441845(0x158)],_0xb4ccd8[_0x441845(0x151)])[_0x441845(0x12a)]['split']('@')[0x0];_0xb4ccd8={..._0xb4ccd8,'telegramToken':_0x4716a8};}const _0x5da258=_0xb4ccd8[_0x441845(0x151)]!=_0x441845(0x195)&&_0xb4ccd8['telegramToken']!=settings[_0x441845(0x151)]||_0xb4ccd8['telegramUsername']!=settings[_0x441845(0x1da)],_0x408057=_0xb4ccd8['telegramToken']==''||_0xb4ccd8[_0x441845(0x1da)]=='';if(_0x5da258)_0xb4ccd8[_0x441845(0x290)]=_0x441845(0x11d);for(const [_0x113b48,_0x3f9a5d]of Object[_0x441845(0x117)](_0xb4ccd8)){if(_0x113b48==_0x441845(0x151)&&_0x3f9a5d==_0x441845(0x195)){_0xb4ccd8[_0x441845(0x151)]=settings[_0x441845(0x151)];continue;};if(_0x113b48==_0x441845(0x194)&&_0x3f9a5d==_0x441845(0x195)){_0xb4ccd8[_0x441845(0x194)]=settings[_0x441845(0x194)];continue;};dbSettings['set']('settings.'+_0x113b48,_0x3f9a5d)[_0x441845(0x182)]();}settings=_0xb4ccd8,io['to'](_0x441845(0x193))[_0x441845(0x249)](_0x441845(0x268),cleanSettings()),broadcastToBots('timeshift',settings[_0x441845(0x168)]);if(_0x5da258&&!_0x408057)initTelegram();if(_0x5da258&&_0x408057)disableTelegram();getAllClients()[_0x441845(0x119)](_0x2f8003=>{const _0x506f7c=_0x441845;getSocket(_0x2f8003['id'])['emit'](_0x506f7c(0x1cf),{'access':{'allow':![],'reason':_0x506f7c(0x1e1),'token':null}});});}function updateSetting(_0x1b7517,_0x2d50b7){const _0x17a0b4=_0x136b40;dbSettings['set'](_0x17a0b4(0x24e)+_0x1b7517,_0x2d50b7)[_0x17a0b4(0x182)](),settings=getSettings(),io['to'](_0x17a0b4(0x193))[_0x17a0b4(0x249)](_0x17a0b4(0x268),cleanSettings());}function storeSecure(_0x1611c2){const _0x453bb9=_0x136b40;dbSecure[_0x453bb9(0x1ca)]('secure')['push'](_0x1611c2)['write'](),secure=_0x1611c2;}function addBlacklist(_0x2c65fb){const _0x14e14b=_0x136b40;cleanBlacklist();let _0x518aa5;devices[_0x2c65fb][_0x14e14b(0x278)]?_0x518aa5=Math[_0x14e14b(0x124)](devices[_0x2c65fb][_0x14e14b(0x278)][_0x14e14b(0x1db)],loginExpiry):_0x518aa5=loginExpiry,dbSecure[_0x14e14b(0x1ca)](_0x14e14b(0x247))[_0x14e14b(0x283)]({'expiry':new Date()['getTime']()+_0x518aa5*0x3c*0x3e8,'token':devices[_0x2c65fb][_0x14e14b(0x211)]['token']})[_0x14e14b(0x182)](),blacklist=dbSecure['get'](_0x14e14b(0x247))[_0x14e14b(0x1c7)]();}function cleanBlacklist(){const _0x30c00d=_0x136b40;let _0x52a830=dbSecure[_0x30c00d(0x1ca)]('blacklist')[_0x30c00d(0x253)]()[_0x30c00d(0x1c7)](),_0x46e944=new Date()[_0x30c00d(0x1a8)]();_0x52a830[_0x30c00d(0x119)](_0x40841e=>{const _0x529994=_0x30c00d;_0x40841e['expiry']<_0x46e944&&dbSecure[_0x529994(0x1ca)]('blacklist')[_0x529994(0x1f0)]({'expiry':_0x40841e[_0x529994(0x1db)]})[_0x529994(0x182)]();});}function initStates(){const _0x40ece8=_0x136b40;let _0xb479da=getConfiguration();_0xb479da[_0x40ece8(0x119)](_0x31be4c=>{const _0x507ecf=_0x40ece8;_0x31be4c['live']=_0x507ecf(0x16f);}),storeConfiguration(_0xb479da);}function onKeys(){const _0x136796=new RSA();return new Promise(_0x593bc2=>{const _0x377013=_0x1464;_0x136796[_0x377013(0x220)]()[_0x377013(0x196)](_0x2bcc38=>{_0x593bc2(_0x2bcc38);});});}async function generateKeys(){return await onKeys();}async function oneTimeMigration(){const _0x59b948=_0x136b40;let _0x1dc290=getSettings(),_0x5a2a13=![];!_0x1dc290[_0x59b948(0x27f)](_0x59b948(0x205))&&(_0x1dc290[_0x59b948(0x205)]=0x0,_0x5a2a13=!![]);!_0x1dc290[_0x59b948(0x27f)](_0x59b948(0x19a))&&(_0x1dc290['lastmsgemitted']=0x0,_0x5a2a13=!![]);!_0x1dc290['hasOwnProperty'](_0x59b948(0x1f6))&&(_0x1dc290['latestversion']=_0x59b948(0x1e4),_0x5a2a13=!![]);if(_0x5a2a13)storeSettings(_0x1dc290);}function storeConfiguration(_0x49c3f5){const _0x39d020=_0x136b40;dbConfig[_0x39d020(0x1ca)](_0x39d020(0x244))[_0x39d020(0x1f0)]()[_0x39d020(0x182)](),_0x49c3f5['forEach'](_0x44644f=>{const _0x232ea1=_0x39d020;delete _0x44644f[_0x232ea1(0x20c)];}),dbConfig[_0x39d020(0x1ca)]('bots')[_0x39d020(0x283)](..._0x49c3f5)['write'](),config=_0x49c3f5;}function resetPassword(){const _0x3a25a8=_0x136b40;tgBot&&settings[_0x3a25a8(0x185)]&&(tgBot[_0x3a25a8(0x161)]('callback_query'),tgBot['sendMessage'](settings[_0x3a25a8(0x185)],_0x3a25a8(0x23b),{'parse_mode':_0x3a25a8(0x240),'reply_markup':{'inline_keyboard':[[{'text':_0x3a25a8(0x1ac),'callback_data':_0x3a25a8(0x1ac)},{'text':'no','callback_data':'no'}]]}})[_0x3a25a8(0x1fb)](_0x51a2b1=>{telegramError(_0x51a2b1);}),tgBot['on'](_0x3a25a8(0x243),async _0xcf2942=>{const _0xa54075=_0x3a25a8,_0x4ffb87=_0xcf2942[_0xa54075(0x1b6)],_0x478f0f=_0xcf2942[_0xa54075(0x12a)];tgBot[_0xa54075(0x289)](_0xcf2942['id'])[_0xa54075(0x196)](async()=>{const _0xdf357c=_0xa54075;if(_0x4ffb87!='no'){const _0x527fac=0xf,_0x1ca6b2=_0xdf357c(0x200),_0x4ee452=Array[_0xdf357c(0x1b8)](crypto[_0xdf357c(0x1ba)](new Uint32Array(_0x527fac)))['map'](_0x5e3da1=>_0x1ca6b2[_0x5e3da1%_0x1ca6b2[_0xdf357c(0x1f4)]])[_0xdf357c(0x1af)](''),_0x59f36b=bcrypt[_0xdf357c(0x20e)](_0x4ee452,saltRounds);storeSettings({'bbPassword':_0x59f36b}),await tgBot['sendMessage'](_0x478f0f[_0xdf357c(0x242)]['id'],_0xdf357c(0x23c)+_0x4ee452,{'parse_mode':_0xdf357c(0x240)})[_0xdf357c(0x1fb)](_0x46472b=>{telegramError(_0x46472b);});}else await tgBot['sendMessage'](_0x478f0f['chat']['id'],_0xdf357c(0x16c))[_0xdf357c(0x1fb)](_0xce57b8=>{telegramError(_0xce57b8);});}),tgBot['removeListener'](_0xa54075(0x243));}));}async function confirmRestore(_0x36657b,_0x16f208){const _0x595ff1=_0x136b40;tgBot&&settings['telegramChatId']&&(tgBot['removeListener'](_0x595ff1(0x243)),await tgBot[_0x595ff1(0x178)](settings['telegramChatId'],'Do\x20you\x20want\x20to\x20restore\x20your\x20installation?\x20NOTE:\x20this\x20will\x20replace\x20your\x20current\x20settings\x20and\x20bot(s)',{'parse_mode':_0x595ff1(0x240),'reply_markup':{'inline_keyboard':[[{'text':'yes','callback_data':_0x595ff1(0x1ac)},{'text':'no','callback_data':'no'}]]}})[_0x595ff1(0x1fb)](_0x1de113=>{telegramError(_0x1de113);}),tgBot['on'](_0x595ff1(0x243),async _0x18b5c0=>{const _0x129e48=_0x595ff1,_0xcea60d=_0x18b5c0['data'],_0x1a9060=_0x18b5c0[_0x129e48(0x12a)];tgBot[_0x129e48(0x289)](_0x18b5c0['id'])[_0x129e48(0x196)](async()=>{const _0x1a9436=_0x129e48;_0xcea60d==_0x1a9436(0x1ac)?(await tgBot[_0x1a9436(0x178)](_0x1a9060['chat']['id'],_0x1a9436(0x150),{'parse_mode':_0x1a9436(0x240)})[_0x1a9436(0x1fb)](_0x2d8752=>{telegramError(_0x2d8752);}),unzipFile(_0x36657b,_0x16f208)):await tgBot[_0x1a9436(0x178)](_0x1a9060[_0x1a9436(0x242)]['id'],_0x1a9436(0x206))[_0x1a9436(0x1fb)](_0x5dcf52=>{telegramError(_0x5dcf52);});}),tgBot[_0x129e48(0x161)](_0x129e48(0x243));}));}function getServerTime(){const _0x39fbe1=_0x136b40,_0x129451=new Date();return _0x129451['getFullYear']()+'/'+(_0x129451[_0x39fbe1(0x1d8)]()+0x1)[_0x39fbe1(0x1b1)]()[_0x39fbe1(0x25e)](0x2,'0')+'/'+_0x129451['getDate']()['toString']()['padStart'](0x2,'0')+'\x20'+_0x129451['getHours']()[_0x39fbe1(0x1b1)]()['padStart'](0x2,'0')+':'+_0x129451[_0x39fbe1(0x190)]()[_0x39fbe1(0x1b1)]()[_0x39fbe1(0x25e)](0x2,'0')+':'+_0x129451[_0x39fbe1(0x133)]()['toString']()[_0x39fbe1(0x25e)](0x2,'0');}function getTimeStamp(){const _0x53a04d=_0x136b40,_0xf93533=shiftedTime();return _0xf93533[_0x53a04d(0x106)]()+'/'+(_0xf93533['getMonth']()+0x1)[_0x53a04d(0x1b1)]()['padStart'](0x2,'0')+'/'+_0xf93533[_0x53a04d(0x1b0)]()[_0x53a04d(0x1b1)]()[_0x53a04d(0x25e)](0x2,'0')+'\x20'+_0xf93533[_0x53a04d(0xee)]()[_0x53a04d(0x1b1)]()['padStart'](0x2,'0')+':'+_0xf93533[_0x53a04d(0x190)]()['toString']()['padStart'](0x2,'0')+':'+_0xf93533[_0x53a04d(0x133)]()['toString']()[_0x53a04d(0x25e)](0x2,'0');}function shiftedTime(){const _0x22282f=_0x136b40,_0x3cae3d=new Date();let _0x16d3be=_0x3cae3d;if(settings[_0x22282f(0x168)]&&settings[_0x22282f(0x168)]!==0x0)_0x16d3be=fns['add'](_0x3cae3d,{'hours':settings[_0x22282f(0x168)]});return _0x16d3be;}function startScheduler(){const _0x9c2ff6=_0x136b40,_0x17b9f3=new Date()[_0x9c2ff6(0x108)](),_0x12372f=shiftedTime()['getHours']();_0x12372f==0x4&&backupConfigFiles();_0x12372f==0x0&&rotateLogFiles();_0x17b9f3%0x6==0x0&&triggerAnalytics();_0x17b9f3%0x6==0x0&&getMessages();if(pidScheduler)clearTimeout(pidScheduler);pidScheduler=setTimeout(()=>{startScheduler();},0x3c*0x3c*0x3e8);}function _0x30c0(){const _0x7e0161=['restarting\x20Bot\x20','Are\x20you\x20sure\x20you\x20want\x20to\x20update\x20Balance\x20Bot\x20now?','disabled\x20Bot\x20','clients','alias','temp/','ipv6','decrypt','args','settings','express-fileupload','log','backupfile','keys','path','3534291DEaMsv','/output-000.log','filter','child_process','Invalid\x20Telegram\x20token','store-headless','readdirSync','enabled','$1_$2_$3','temporary\x20access\x20not\x20allowed','telegramIpApproval','sockets','sign','/:bot','Notifications\x20types:\x20','error','Orders','hasOwnProperty','Unauthorized\x20attempt\x20to\x20show\x20configuration','RSA-OAEP','port','push','bot','Unauthorized\x20attempt\x20to\x20update\x20settings',':\x20Bot\x20Mgr\x20>\x20Sending\x20Telegram\x20message\x20failed','toggleBotMode','isDirectory','answerCallbackQuery','headers','\x20|\x20','error\x20while\x20deleting\x20config\x20files:\x20','removeAllListeners','2FA\x20required','\x20mode','telegramEvents','/:bot/history','createServer','handshake','uuid','getHours','any','polling_error','No\x20authentication\x20token','assign','botname','temporary\x20token\x20generated','express','bot-','inherit','order','apiSecret','NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bots\x20are\x20disabled\x20by\x20default\x20-\x20enable\x20those\x20you\x20want\x20to\x20run','2FA\x20login\x20rejected','hybrid-crypto-js','alerts','event','graphql-request','encryptedUuid','Bot\x20Mgr\x20>\x20starting\x20Bot\x20','getPortfolio','*$1*','Ok,\x20will\x20send\x20alert\x20notifications\x20only',',\x20must\x20be\x20a\x204\x20digit\x20number','getFullYear','/disable\x20-\x20disable\x20notifications\x0a','getUTCHours','<b>Balance\x20Bot\x20Status:</b>\x0a','telegramEnabled','min','Token\x20blacklisted','bb-config.json','ipaddr.js','.zip','-config.json','Which\x20bot\x20do\x20you\x20want\x20to\x20toggle?','zip/','Unauthorized\x20attempt\x20to\x20place\x20market\x20order','Ok,\x20will\x20send\x20both\x20order\x20and\x20alert\x20notifications','-----------------------------------------------------------------------------------','Yes','entries','bcryptjs','forEach','name','toIPv4MappedAddress','deleted\x20Bot\x20','all','userid','::1','rmSync','backup/','Unauthorized\x20attempt\x20to\x20confirm\x20message','function','max','8990072HxXqhe','connected','statSync','login\x20token\x20generated','config/','message','login\x20token\x20valid','65380NrOCei','new-disabled','placeOrder','botID','index.html','sha256','DEFLATE','getSeconds','readFileSync','loginRequired','show','http','Unauthorized\x20attempt\x20to\x20update\x20Balance\x20Bot','deleteHistoryAlerts','/names\x20-\x20show\x20bot\x20names\x0a','sendPortfolioTelegram','allow','init','telegram','parse','includes','confirm-message','SIGINT','Notifications\x20disabled\x0a','https://api.ipify.org?format=json','login','\x20>\x20','connection','get-logs','User\x20has\x20been\x20validated','/:bot/performance','simple','(((.+)+)+)+$','f2aRequired','invalid\x20credentials','</b>\x20?','Restoring\x20bot(s)\x20from\x20backup','telegramToken','uuid-random','startsWith','host','mixpanel','\x20minutes','listen','privateKey','/:bot/portfolio','storeConfiguration','headless','stop','/off\x20-\x20stop\x20bot(s)\x0a','defaults','whitelist','env','removeListener','Your\x20installation\x20is\x20already\x20up\x20to\x20date','auto','Unauthorized\x20attempt\x20to\x20download\x20','5\x20min','use','post','timeshift','clientip','notification','bbvNew','Password\x20reset\x20rejected','enabled\x20Bot\x20','-events.json','stopped','new','constructor','token','started','Note:\x20notifications\x20are\x20currently\x20disabled\x20-\x20to\x20enable\x20notifications,\x20type\x20/enable','manual','update-bb','verify','sendMessage','/config\x20-\x20notification\x20types\x20to\x20receive\x0a','Invalid\x20authentication\x20token\x20(2)','compareSync','-performance.json','delete-bot','sortBy','idling\x20bot\x20\x20\x20|\x20Bot\x20','pidRefreshToken','6b67f3d61ee94b8f5c80b4affef4c4d9','write','lowdb/adapters/FileSync','find','telegramChatId','All\x20bots\x20running\x20right\x20now','secure','Failed\x20to\x20download\x20','sort','argv','Temporary\x20access\x20rejected','Notifications\x20disabled','node-zip','sendFile','cancelLoading','getMinutes','toggle-bot-mode','isIPv4MappedAddress','botmanager','bbPassword','************','then','tkn','Unauthorized\x20attempt\x20to\x20update\x20bot','emitHistory','lastmsgemitted','Ok,\x20consider\x20updating\x20Balance\x20Bot\x20later','reject','127.0.0.1','username','login\x20not\x20required','copyFileSync','number','download','30\x20min','bot.js','stringify','Access\x20enabled\x20for\x20','params','getTime','Login\x20accepted','onText','disabled','yes','Unauthorized\x20attempt\x20to\x20get\x20messages','node-telegram-bot-api','join','getDate','toString','Crypt','All','reset-password','secret','data','pidExpireLogin','from','Unauthorized\x20attempt\x20to\x20get\x20logs','randomFillSync','updatebotmanager','bbUsername','exp','hex','Notifications\x20enabled','***','warning','Unauthorized\x20attempt\x20to\x20delete\x20bot','cancel-loading','test','store-configuration','replace','value','/upload-backup','timestamp','get','show-config','276imTFHn','exchange','Server','status','File\x20uploaded','Notifications\x20enabled\x0a','logout','stopPolling','683783oanLZK','/download/:type','whitelistEnabled','binary','getMonth','reason','telegramUsername','expiry','slice','size','/restart\x20-\x20restart\x20bot(s)\x0a','4846730jOMZMn','split','reload','messages','All\x20bots','0.0.0','Markdown','2RJzEWi','Allow\x20temporary\x20access\x20from\x20IP\x20address\x20<b>','generate','Which\x20bot\x20do\x20you\x20want\x20to\x20start?','auth','Which\x20bot\x20do\x20you\x20want\x20to\x20restart?','55KiYhmi','510839rqLTfB','util','files','remove','remoteAddress','Login\x20rejected','telegrammsg','length','No\x20bots\x20running\x20right\x20now','latestversion','crypto','starting\x20bot\x20|\x20Bot\x20','publicKey','static','catch','orders','match','temporaryAccessAllowed','Allow\x20login\x20from\x20IP\x20address\x20<b>','0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@-#$','/status\x20-\x20show\x20bot(s)\x20status\x0a','bb-settings.json','existsSync','Bot\x20Mgr\x20>\x20toggling\x20Bot\x20','lastmsgtelegram','Restore\x20process\x20aborted','Bot\x20Mgr\x20>\x20','_data','storeHeadless','bb-secure.json','search','mode','Unauthorized\x20attempt\x20to\x20store\x20configuration','hashSync','showname','2FA\x20login\x20token\x20generated','access','/enable\x20-\x20enable\x20notifications\x0a','unlinkSync','1000','Unauthorized\x20attempt\x20to\x20log\x20out','::ffff:127.0.0.1','-results.json','15\x20min','live','/help\x20-\x20show\x20available\x20commands\x0a','referer','add-bot','NTBA_FIX_319','3557115cgOnZE','login\x20required','generateKeyPairAsync','2FA\x20login\x20required','user','api-eu.mixpanel.com','store-settings','telegram2FaApproval','update-bot','>\x20Set\x20up\x20your\x20first\x20bot\x20in\x20the\x20Bot\x20Manager!','apiKey','Unauthorized\x20attempt\x20to\x20cancel\x20loading\x20coins','store','\x20to\x20','You\x20can\x20use\x20the\x20following\x20commands:\x0a','Error:\x20Invalid\x20argument\x20','Unauthorized\x20attempt\x20to\x20upload\x20file\x20(1)','bb/','writeFileSync','initclient','password','exit','send','54FfwTYB','kill','disconnect','title','Unauthorized\x20login\x20attempt\x20(timeout)','Bot\x20','Do\x20you\x20want\x20to\x20reset\x20your\x20password?','Password\x20has\x20been\x20reset\x20to:\x20','build','file','restart','HTML','type','chat','callback_query','bots','kind','version.json','blacklist','Invalid\x20authentication\x20token\x20(1)','emit','mkdirSync','conn','format','apply','settings.','accept','socket','/:bot/coins','Ok,\x20will\x20send\x20order\x20notifications\x20only','cloneDeep','https://api-eu-central-1.graphcms.com/v2/ckoytzv3lotky01w59glace7y/master','output-003.log','place-order','Bearer\x20eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImdjbXMtbWFpbi1wcm9kdWN0aW9uIn0.eyJ2ZXJzaW9uIjozLCJpYXQiOjE2MjE2NjgzMzgsImF1ZCI6WyJodHRwczovL2FwaS1ldS1jZW50cmFsLTEuZ3JhcGhjbXMuY29tL3YyL2Nrb3l0enYzbG90a3kwMXc1OWdsYWNlN3kvbWFzdGVyIiwiaHR0cHM6Ly9tYW5hZ2VtZW50LW5leHQuZ3JhcGhjbXMuY29tIl0sImlzcyI6Imh0dHBzOi8vbWFuYWdlbWVudC5ncmFwaGNtcy5jb20vIiwic3ViIjoiYjZlOTBmODAtZmEzYS00ODJmLWE0NTAtMTY3YTFmZTliNzIzIiwianRpIjoiY2tvemZnaWE0Mno4bTAxdzU5bHU5ZTA3NSJ9.cEJ5isSubzX1ymlpkfyvfgZ6zyUMFiFOVaD4N84NoEOxwGZ8DtYM1k4DlCjoeCcTR8Ftr43bIGDxR4apANAG_-wf9Nge9T2MAuKa9z2sCWA5jnYtTHYU-x1Hx_ShpHAl1wPjrSpTMquV3bRlKQBm6EQTreoaQZgBXY25ClLbVzXFcohcDn3RGi3hHVRvxNLr0F7ETwFJnbowm9UX66vz2SP-5-u-CBKUxSipKMO5za0MZiIWoprSdE0f22xVXp8up3k_6-5x22mS88P2OFgMXoA-UBFS8nz6jRE_fRULzCouKYyJG3oQ10ovuZ1M729GQ0rMv9fkJroVKyS4i8KgglwPPBwQbaD2LCJXINKXYC65DmKyJ9UjWxQ9Lv6akcnkT7CkeqEqzwLnCEQgZEmJS_PBFDu40LMS8UbnwDcntJznA8rH_jsD7IkMdyRyXmns6fbLOc91Q1idBCk-VqUzkL0FzfscCVpkg1J7kGtGeW4YEWhWyPze4ZO4IxM9WRoSsCDUOx3EXklA0WSdR2M6IRnoFL-qoawOLQaaPACy8-QGmaAL6N6fuMIHUWavOTYnyLip0oyy74sUHz4S4sx4mAf5pexlvDcxM_6RIRnCQ84THsM2KwpoWkpR-F2s4pIyfYYn-4R7MNENfPGxNm4INjBYrCOWyZN_vXHGBa4uw2U','success','full','/on\x20-\x20start\x20bot(s)\x0a','output-001.log','logs','logged\x20out','padStart'];_0x30c0=function(){return _0x7e0161;};return _0x30c0();}async function backupConfigFiles(){const _0x9049a2=_0x136b40;fs[_0x9049a2(0x274)](configpath,{'withFileTypes':!![]})[_0x9049a2(0x119)](_0x442e85=>{const _0x157ff9=_0x9049a2;if(!_0x442e85[_0x157ff9(0x288)]())fs[_0x157ff9(0x1a0)](configpath+_0x442e85[_0x157ff9(0x11a)],configbackuppath+_0x442e85[_0x157ff9(0x11a)]);});}function rotateLogFiles(){const _0x221bf8=_0x136b40,_0x50daa4=fs[_0x221bf8(0x127)](logspath+'output-000.log'),_0x16a4bc=_0x50daa4[_0x221bf8(0x1dd)]/0x400;if(_0x16a4bc>0x32){let _0xecc025=fs[_0x221bf8(0x274)](logspath,{'withFileTypes':!![]});_0xecc025[_0x221bf8(0x189)]((_0x3dd870,_0x1715aa)=>_0x3dd870[_0x221bf8(0x11a)]<_0x1715aa[_0x221bf8(0x11a)]?0x1:_0x1715aa[_0x221bf8(0x11a)]<_0x3dd870[_0x221bf8(0x11a)]?-0x1:0x0),_0xecc025['forEach'](_0x1afd35=>{const _0x169a6d=_0x221bf8;if(_0x1afd35[_0x169a6d(0x11a)]=='output-002.log')fs['copyFileSync'](logspath+_0x1afd35['name'],logspath+_0x169a6d(0x255));if(_0x1afd35[_0x169a6d(0x11a)]==_0x169a6d(0x25b))fs[_0x169a6d(0x1a0)](logspath+_0x1afd35['name'],logspath+'output-002.log');_0x1afd35[_0x169a6d(0x11a)]=='output-000.log'&&(fs[_0x169a6d(0x1a0)](logspath+_0x1afd35[_0x169a6d(0x11a)],logspath+_0x169a6d(0x25b)),fs[_0x169a6d(0x230)](logspath+_0x1afd35['name'],''));});}}async function zipFiles(_0x16b82f){const _0x7efcf9=_0x136b40;let _0x54f089;if(_0x16b82f==_0x7efcf9(0x25c))_0x54f089=logspath;if(_0x16b82f=='backup')_0x54f089=configpath;let _0x47d396=fs[_0x7efcf9(0x274)](_0x54f089,{'withFileTypes':!![]});const _0x32b2f3=new require(_0x7efcf9(0x18d))();_0x47d396[_0x7efcf9(0x119)](_0x4baa04=>{const _0x1e849=_0x7efcf9;if(!_0x4baa04['isDirectory']()){let _0x475e5a=fs[_0x1e849(0x134)](_0x54f089+_0x4baa04[_0x1e849(0x11a)]);const _0x47eeb2=/^bot-[0-9]{3}-config.json$/,_0x42ad70=_0x47eeb2[_0x1e849(0x1c4)](_0x4baa04['name']);if(_0x42ad70){const _0x1de12a=JSON[_0x1e849(0x13f)](_0x475e5a);_0x1de12a[_0x1e849(0x284)][0x0][_0x1e849(0x228)]=_0x1e849(0x1c0),_0x1de12a['bot'][0x0][_0x1e849(0xf9)]='***',_0x475e5a=JSON[_0x1e849(0x1a5)](_0x1de12a,null,0x2);}if(_0x4baa04['name']==_0x1e849(0x202)){const _0x1ce7be=JSON['parse'](_0x475e5a);if(_0x1ce7be['settings'][_0x1e849(0x135)])_0x1ce7be[_0x1e849(0x268)][_0x1e849(0x135)]=![];if(_0x1ce7be[_0x1e849(0x268)][_0x1e849(0x194)])_0x1ce7be[_0x1e849(0x268)][_0x1e849(0x194)]=_0x1e849(0x1c0);if(_0x1ce7be['settings']['telegramToken'])_0x1ce7be[_0x1e849(0x268)]['telegramToken']=_0x1e849(0x1c0);if(_0x1ce7be['settings'][_0x1e849(0x185)])_0x1ce7be['settings'][_0x1e849(0x185)]=null;_0x475e5a=JSON['stringify'](_0x1ce7be,null,0x2);}if(_0x4baa04[_0x1e849(0x11a)]!='bb-secure.json')_0x32b2f3[_0x1e849(0x23e)](_0x4baa04[_0x1e849(0x11a)],_0x475e5a);}});const _0x1a3459=_0x32b2f3[_0x7efcf9(0x1e8)]({'base64':![],'compression':_0x7efcf9(0x132)});fs[_0x7efcf9(0x230)](zippath+(_0x16b82f+_0x7efcf9(0x10f)),_0x1a3459,_0x7efcf9(0x1d7));}async function unzipFile(_0xe19121,_0x5d06bb){const _0xef082f=_0x136b40;await backupConfigFiles(),fs[_0xef082f(0x274)](configpath,{'withFileTypes':!![]})[_0xef082f(0x119)](_0x180978=>{const _0x1a0aa2=_0xef082f;if(!_0x180978['isDirectory']())fs[_0x1a0aa2(0x120)](configpath+_0x180978[_0x1a0aa2(0x11a)]);});const _0x58488f=fs[_0xef082f(0x134)](_0xe19121+_0x5d06bb,'binary'),_0x307b7f=new require(_0xef082f(0x18d))(_0x58488f,{'base64':![],'checkCRC32':!![]});Object['keys'](_0x307b7f[_0xef082f(0x1ef)])[_0xef082f(0x119)](_0x312a25=>{const _0x5bc0fa=_0xef082f,_0x18c3f2=_0x307b7f[_0x5bc0fa(0x1ef)][_0x312a25];fs[_0x5bc0fa(0x230)](configpath+_0x18c3f2[_0x5bc0fa(0x11a)],_0x18c3f2[_0x5bc0fa(0x208)]);}),fs[_0xef082f(0x274)](temppath,{'withFileTypes':!![]})['forEach'](_0x5311a1=>{const _0x4e0a84=_0xef082f;if(!_0x5311a1[_0x4e0a84(0x288)]())fs['rmSync'](temppath+_0x5311a1[_0x4e0a84(0x11a)]);}),process[_0xef082f(0x234)]({'restore':!![]},_0x3bb9f5=>{});}async function getPublicIp(){const _0x68a5fe=_0x136b40;try{const _0x314f18=await axios[_0x68a5fe(0x1ca)](_0x68a5fe(0x144));publicip=_0x314f18[_0x68a5fe(0x1b6)]['ip'];}catch(_0x38488b){}}async function triggerAnalytics(){const _0x56f264=_0x136b40;if(!publicip)await getPublicIp();const _0x5588e5=getBotsWithMode();let _0x2b8a3a=0x0;_0x5588e5[_0x56f264(0x119)](_0x444952=>{if(_0x444952['status']==='enabled')_0x2b8a3a++;});const _0x1c24bf=getBotExchanges();mixpanel['track'](_0x56f264(0x1ce),{'distinct_id':settings[_0x56f264(0x11e)],'ip':publicip,'version':serverversion,'numbots':_0x5588e5[_0x56f264(0x1f4)],'numbotsenabled':_0x2b8a3a,'exchanges':_0x1c24bf});}function _0x1464(_0x500029,_0x3837b){const _0x31c026=_0x30c0();return _0x1464=function(_0x347cb5,_0x4acb76){_0x347cb5=_0x347cb5-0xee;let _0x30c006=_0x31c026[_0x347cb5];return _0x30c006;},_0x1464(_0x500029,_0x3837b);}async function getMessages(){const _0x4968a0=_0x136b40,_0x3c03e5=_0x4968a0(0x254),_0x2cc304=new GraphQLClient(_0x3c03e5),_0x2d33b4={'authorization':_0x4968a0(0x257)},_0x30ae11=serverversion[_0x4968a0(0x1e0)]('.'),_0x4a0975=_0x30ae11[0x0]+'.'+_0x30ae11[0x1],_0x253b6e=Math[_0x4968a0(0x10b)](settings['lastmsgtelegram'],settings[_0x4968a0(0x19a)]),_0x34531f={'last':parseInt(_0x253b6e),'bbm':_0x4a0975},_0x3f4e66=gql`
            query getMessages($bbm: String!, $last: Int!) {
                messages(where: {
                    number_gt: $last
                    OR: [
                    {bbvReceive: "any"},
                    {bbvReceive_contains: $bbm}
                    ]
                    archived_not: true
                }, orderBy: number_ASC) {
                    id
                    number
                    bbvReceive
                    bbvNew
                    title
                    message
                    dialogWidth
                    lock
                }
            }
            `;let _0x5480be;try{_0x5480be=await _0x2cc304['request'](_0x3f4e66,_0x34531f,_0x2d33b4);}catch(_0x30bde2){}if(_0x5480be&&_0x5480be['messages']){let _0x29b5f2=settings[_0x4968a0(0x205)];newMessages=[];for(const _0x5e025e of _0x5480be[_0x4968a0(0x1e2)]){newMessages[_0x4968a0(0x283)](_0x5e025e);if(_0x5e025e[_0x4968a0(0x16b)])updateSetting(_0x4968a0(0x1f6),_0x5e025e[_0x4968a0(0x16b)]);let _0xdc2d40=_0x5e025e[_0x4968a0(0x16b)]?serverversion>=_0x5e025e[_0x4968a0(0x16b)]:![];if(!_0xdc2d40&&_0x5e025e[_0x4968a0(0x1a1)]>_0x29b5f2){if(_0x5e025e['bbvReceive']===_0x4968a0(0xef)||serverversion[_0x4968a0(0x153)](_0x5e025e['bbvReceive'])){let _0x44d824=''+_0x5e025e[_0x4968a0(0x238)]+'\x0a\x0a'+_0x5e025e[_0x4968a0(0x12a)];const _0x416ffb=await sendTelegramMsg(toTelegramMarkdown(_0x44d824),_0x4968a0(0x1e5));if(_0x416ffb)_0x29b5f2=_0x5e025e[_0x4968a0(0x1a1)];}}}updateAvailable=isNewerVersion(settings[_0x4968a0(0x1f6)],serverversion),updateSetting(_0x4968a0(0x205),_0x29b5f2),emitMessages();}}function emitMessages(){const _0x64d76f=_0x136b40,_0x5e5a86=settings[_0x64d76f(0x19a)];let _0xa0eccd=[];newMessages['forEach'](_0x2f2f0a=>{const _0x57a1c2=_0x64d76f;_0x2f2f0a[_0x57a1c2(0x1a1)]>_0x5e5a86&&_0xa0eccd[_0x57a1c2(0x283)](_0x2f2f0a);}),_0xa0eccd[_0x64d76f(0x1f4)]>0x0&&getAllClients()[_0x64d76f(0x119)](_0x2d15af=>{const _0x4a6b8a=_0x64d76f;getSocket(_0x2d15af['id'])[_0x4a6b8a(0x249)](_0x4a6b8a(0x12a),_0xa0eccd);});}function confirmMessage(_0x14cbf0){const _0x514ae2=_0x136b40;updateSetting(_0x514ae2(0x19a),Number(_0x14cbf0));}function isNewerVersion(_0xa62abf,_0x50d039){const _0x33ae4c=_0x136b40,_0x325e41=_0x50d039[_0x33ae4c(0x1e0)]('.'),_0x776f85=_0xa62abf['split']('.');for(var _0x254f30=0x0;_0x254f30<_0x776f85[_0x33ae4c(0x1f4)];_0x254f30++){const _0x51705e=~~_0x776f85[_0x254f30],_0x49830a=~~_0x325e41[_0x254f30];if(_0x51705e>_0x49830a)return!![];if(_0x51705e<_0x49830a)return![];}return![];}function toTelegramMarkdown(_0x295bf8){const _0xd33027=_0x136b40,_0x57e93a=/(^|[^\*])\*{1}([^\*.]+?)\*{1}([^\*]|$)/gim,_0x1c31cf=/\*{2}(.+?)\*{2}/gim;return _0x295bf8=_0x295bf8[_0xd33027(0x1c6)](_0x57e93a,_0xd33027(0x276))[_0xd33027(0x1c6)](_0x1c31cf,_0xd33027(0x103)),_0x295bf8;}async function validateConfigFile(){const _0x15fd6d=_0x136b40,_0x38613f=dbConfig[_0x15fd6d(0x1ca)]('bots')[_0x15fd6d(0x17e)](_0x15fd6d(0x12f))[_0x15fd6d(0x1c7)]()||[];if(_0x38613f[_0x15fd6d(0x1f4)]==0x0){let _0x4a7ab1=0x0,_0x4b4cc5=[];const _0x431b5f=/^bot-([0-9]{3})-config.json$/,_0x651eaa=fs['readdirSync'](configpath);_0x651eaa['forEach'](_0x1de6f8=>{const _0x424daa=_0x15fd6d,_0x3b8cdd=_0x431b5f['exec'](_0x1de6f8);if(_0x3b8cdd){const _0x365d08=_0x3b8cdd[0x1];let _0x52e341=getBotAttributes(_0x365d08);_0x4b4cc5[_0x424daa(0x283)]({'botID':_0x365d08,'botname':_0x52e341[_0x424daa(0xf3)],'status':_0x424daa(0x1ab),'live':_0x424daa(0x16f)}),_0x4a7ab1++;}}),_0x4a7ab1!=0x0&&(dbConfig[_0x15fd6d(0x1ca)]('bots')[_0x15fd6d(0xf2)](_0x4b4cc5)[_0x15fd6d(0x182)](),config=_0x4b4cc5,restoredConfigFile=_0x4a7ab1);}}async function restoreConfigNotify(_0x663f4f){const _0x1b7d67=_0x136b40;let _0x32011c;if(restoredConfigFile==0x1)_0x32011c='NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bot\x20is\x20disabled\x20by\x20default\x20-\x20enable\x20if\x20you\x20want\x20it\x20to\x20run';else _0x32011c=_0x1b7d67(0xfa);if(_0x663f4f)io['to'](_0x1b7d67(0x193))[_0x1b7d67(0x249)](_0x1b7d67(0x16a),_0x32011c);else{logger[_0x1b7d67(0x14b)](_0x1b7d67(0x115)),logger[_0x1b7d67(0x14b)](_0x32011c),logger[_0x1b7d67(0x14b)](_0x1b7d67(0x115)),logger[_0x1b7d67(0x14b)]('');if(tgBot&&settings['telegramChatId']&&settings['telegramEvents']!='orders')tgBot[_0x1b7d67(0x178)](settings['telegramChatId'],_0x1b7d67(0x207)+_0x32011c)[_0x1b7d67(0x1fb)](_0x360618=>{telegramError(_0x360618);});}}function validateCredentials(_0x38429f,_0x3d1eed){const _0x5360d1=_0x136b40;if(_0x38429f[_0x5360d1(0x19e)]==settings[_0x5360d1(0x1bc)]&&bcrypt[_0x5360d1(0x17b)](_0x38429f[_0x5360d1(0x232)],settings['bbPassword'])){if(settings[_0x5360d1(0x14d)])return{'allow':![],'reason':_0x5360d1(0x221),'token':null};else{const _0x1c2bec=generateLoginToken(_0x3d1eed);return{'allow':!![],'reason':_0x5360d1(0x128),'token':_0x1c2bec};}}else return{'allow':![],'reason':_0x5360d1(0x14e),'token':null};}function refreshToken(_0x197903){const _0x5a0543=_0x136b40,_0x3bb3d1=generateLoginToken(_0x197903);return{'allow':!![],'reason':_0x5a0543(0x128),'token':_0x3bb3d1};}function validateAccess(_0x20093b,_0x255cda,_0x147267){const _0x516a99=_0x136b40,_0x3edc09=_0x147267?_0x147267:devices[_0x255cda]['ip'];let _0x4a7332;const _0xde28ab=_0x31ee73=>{const _0x25c814=_0x1464;if(settings[_0x25c814(0x135)]){if(settings[_0x25c814(0x14d)]){if(telegram2FaApproved(_0x255cda)){const _0x400503=generateLoginToken(_0x255cda);return{'allow':!![],'reason':'2FA\x20login\x20token\x20generated','token':_0x400503};}else return{'allow':![],'reason':_0x25c814(0x21f),'token':null};}else return _0x4a7332=validToken(_0x31ee73,_0x255cda),_0x4a7332['hasOwnProperty'](_0x25c814(0x258))?{'allow':!![],'reason':_0x25c814(0x12b),'token':_0x31ee73}:{'allow':![],'reason':_0x25c814(0x21f),'token':null};}else return{'allow':!![],'reason':'login\x20not\x20required','token':null};};if(settings[_0x516a99(0x1d6)]){let _0x43a235=[...settings[_0x516a99(0x15f)],_0x516a99(0x11f),_0x516a99(0x216),_0x516a99(0x19d)];if(_0x43a235[_0x516a99(0x140)](_0x3edc09))return _0xde28ab(_0x20093b);else{_0x4a7332=validToken(_0x20093b,_0x255cda);if(_0x4a7332[_0x516a99(0x27f)]('success'))return _0xde28ab(_0x20093b);else{if(telegramIpApproved(_0x255cda)){const _0x3f0149=generateToken(_0x255cda);return _0x4a7332=_0xde28ab(_0x20093b),_0x4a7332['allow']?{'allow':!![],'reason':_0x516a99(0xf4),'token':_0x3f0149}:_0x4a7332;}else return settings[_0x516a99(0x1fe)]?{'allow':![],'reason':_0x516a99(0x28e),'token':null}:{'allow':![],'reason':_0x516a99(0x277),'token':null};}}}else return _0xde28ab(_0x20093b);}function timelyDecrypt(_0x12364f,_0x50841e=!![]){const _0x5974de=_0x136b40;if(_0x12364f)try{const _0x5f4fdf=crypt[_0x5974de(0x266)](secure[_0x5974de(0x158)],_0x12364f)[_0x5974de(0x12a)],_0x34eaf5=_0x5f4fdf['split']('@')[0x0],_0x540e69=_0x5f4fdf[_0x5974de(0x1e0)]('@')[0x1],_0x5b1e0e=new Date()['getTime']();if(_0x50841e){if(_0x5b1e0e-_0x540e69<maxSecretAge*0x3e8)return _0x34eaf5;else return![];}else return _0x34eaf5;}catch(_0x32fee2){return![];}else return![];}const validToken=(_0x2366dc,_0x44f6cd)=>{const _0xa4660f=_0x136b40,_0x295479=devices[_0x44f6cd]['ip'];if(!_0x2366dc)return{'error':_0xa4660f(0xf1)};for(let _0x179ea1 of blacklist){if(_0x179ea1[_0xa4660f(0x172)]==_0x2366dc)return{'error':_0xa4660f(0x10c)};}let _0x14be64;try{_0x14be64=jwt[_0xa4660f(0x177)](_0x2366dc,secure[_0xa4660f(0x1b5)]+_0x44f6cd);}catch{return{'error':_0xa4660f(0x248)};}if(!_0x14be64[_0xa4660f(0x27f)](_0xa4660f(0x169))&&!_0x14be64[_0xa4660f(0x27f)](_0xa4660f(0x19e))||!_0x14be64[_0xa4660f(0x27f)](_0xa4660f(0x1bd)))return{'error':_0xa4660f(0x17a)};if(!_0x14be64[_0xa4660f(0x27f)]('username')&&_0x14be64[_0xa4660f(0x27f)](_0xa4660f(0x169))){const {clientip:_0x37ddc6}=_0x14be64;return _0x295479==_0x37ddc6?{'success':_0xa4660f(0x149)}:{'error':'Invalid\x20IP\x20address'};}else{if(_0x14be64[_0xa4660f(0x27f)]('username')&&_0x14be64[_0xa4660f(0x27f)](_0xa4660f(0x169))){const {username:_0xda045f,clientip:_0x4263b4}=_0x14be64;return settings['bbUsername']==_0xda045f&&_0x295479==_0x4263b4?{'success':_0xa4660f(0x149)}:{'error':'Invalid\x20username\x20or\x20IP\x20address'};}}},generateLoginToken=_0x157459=>{const _0x50e610=_0x136b40;if(_0x157459){const _0x1ffb55=devices[_0x157459]['ip'];return jwt[_0x50e610(0x27a)]({'username':settings[_0x50e610(0x1bc)],'clientip':_0x1ffb55},secure[_0x50e610(0x1b5)]+_0x157459,{'expiresIn':tokenRefresh*0x3c});}else return![];},generateToken=_0x2b4566=>{const _0x1ce830=_0x136b40;if(_0x2b4566){const _0x305c24=devices[_0x2b4566]['ip'];return jwt['sign']({'clientip':_0x305c24},secure[_0x1ce830(0x1b5)]+_0x2b4566,{'expiresIn':devices[_0x2b4566]['telegramIpApproval'][_0x1ce830(0x1db)]*0x3c});}else return![];},telegramIpApproved=_0x2afa3c=>{const _0x25ed8d=_0x136b40;let _0x12786b=![];return devices[_0x2afa3c][_0x25ed8d(0x278)]&&devices[_0x2afa3c][_0x25ed8d(0x278)][_0x25ed8d(0x1db)]!=_0x25ed8d(0x19c)&&(_0x12786b=devices[_0x2afa3c][_0x25ed8d(0x278)][_0x25ed8d(0x169)]==devices[_0x2afa3c]['ip']&&new Date()[_0x25ed8d(0x1a8)]()-devices[_0x2afa3c][_0x25ed8d(0x278)][_0x25ed8d(0x1c9)]<devices[_0x2afa3c][_0x25ed8d(0x278)]['expiry']*0x3c*0x3e8),_0x12786b;},telegram2FaApproved=_0x44b782=>{const _0x57dac7=_0x136b40;let _0xb767c3=![];return devices[_0x44b782][_0x57dac7(0x225)]&&devices[_0x44b782]['telegram2FaApproval']['expiry']!='reject'&&(_0xb767c3=devices[_0x44b782][_0x57dac7(0x225)][_0x57dac7(0x169)]==devices[_0x44b782]['ip']&&new Date()[_0x57dac7(0x1a8)]()-devices[_0x44b782][_0x57dac7(0x225)][_0x57dac7(0x1c9)]<devices[_0x44b782][_0x57dac7(0x225)][_0x57dac7(0x1db)]*0x3c*0x3e8),_0xb767c3;},normalizeIP=_0xee1dc4=>{const _0x125c03=_0x136b40;let _0x1d0f4a=null,_0x15c788=null;if(ipaddr['isValid'](_0xee1dc4)){const _0x3fb95d=ipaddr[_0x125c03(0x13f)](_0xee1dc4);_0x3fb95d[_0x125c03(0x245)]()===_0x125c03(0x265)?(_0x3fb95d[_0x125c03(0x192)]()&&(_0x1d0f4a=_0x3fb95d['toIPv4Address']()['toString']()),_0x15c788=_0x3fb95d[_0x125c03(0x1b1)]()):(_0x1d0f4a=_0x3fb95d[_0x125c03(0x1b1)](),_0x15c788=_0x3fb95d[_0x125c03(0x11b)]()[_0x125c03(0x1b1)]());}return{'show':_0x1d0f4a?_0x1d0f4a:_0x15c788,'store':_0x15c788};};function sleep(_0x5e7cfc){return new Promise(_0x360544=>setTimeout(_0x360544,_0x5e7cfc));}