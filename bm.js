const _0x3a7aa2=_0x3c16;(function(_0x3ddda3,_0x54d236){const _0x6fdd53=_0x3c16,_0x3d8bad=_0x3ddda3();while(!![]){try{const _0x521bfc=-parseInt(_0x6fdd53(0x1fd))/0x1+parseInt(_0x6fdd53(0x282))/0x2+parseInt(_0x6fdd53(0x141))/0x3*(parseInt(_0x6fdd53(0x163))/0x4)+parseInt(_0x6fdd53(0xec))/0x5+parseInt(_0x6fdd53(0x235))/0x6*(-parseInt(_0x6fdd53(0x182))/0x7)+parseInt(_0x6fdd53(0x28b))/0x8*(parseInt(_0x6fdd53(0x169))/0x9)+-parseInt(_0x6fdd53(0x238))/0xa*(parseInt(_0x6fdd53(0x171))/0xb);if(_0x521bfc===_0x54d236)break;else _0x3d8bad['push'](_0x3d8bad['shift']());}catch(_0x1622cc){_0x3d8bad['push'](_0x3d8bad['shift']());}}}(_0x3f8b,0x85d15));const _0x4ddd94=function(){let _0x12e6ac=!![];return function(_0x2fbe72,_0x104602){const _0x9fc5fe=_0x12e6ac?function(){if(_0x104602){const _0x274b18=_0x104602['apply'](_0x2fbe72,arguments);return _0x104602=null,_0x274b18;}}:function(){};return _0x12e6ac=![],_0x9fc5fe;};}(),_0x6a128b=_0x4ddd94(this,function(){const _0x563f93=_0x3c16;return _0x6a128b[_0x563f93(0x233)]()[_0x563f93(0xbb)]('(((.+)+)+)+$')[_0x563f93(0x233)]()[_0x563f93(0x1e2)](_0x6a128b)['search'](_0x563f93(0x14d));});_0x6a128b();'use strict';process[_0x3a7aa2(0x275)][_0x3a7aa2(0x1de)]=0x1;const childProcess=require(_0x3a7aa2(0x10a)),fs=require('fs'),fns=require(_0x3a7aa2(0x1f2)),low=require(_0x3a7aa2(0x103)),FileSync=require(_0x3a7aa2(0x231)),path=require(_0x3a7aa2(0x20d)),crypto=require('crypto'),Crypt=require(_0x3a7aa2(0xe4))[_0x3a7aa2(0x210)],RSA=require(_0x3a7aa2(0xe4))[_0x3a7aa2(0x23f)],bcrypt=require('bcryptjs'),jwt=require(_0x3a7aa2(0xd5)),ipaddr=require(_0x3a7aa2(0xb0)),argv=require(_0x3a7aa2(0x248))(process['argv'][_0x3a7aa2(0xa0)](0x2))[_0x3a7aa2(0x218)],uuidRandom=require('uuid-random'),{Telegraf,Markup}=require(_0x3a7aa2(0xc0)),Mixpanel=require(_0x3a7aa2(0x179)),axios=require(_0x3a7aa2(0x178)),{GraphQLClient,gql}=require(_0x3a7aa2(0xd6)),util=require('util'),fileUpload=require(_0x3a7aa2(0xd9)),{networkInterfaces}=require('os'),PORT=argv[_0x3a7aa2(0x117)]||_0x3a7aa2(0x290),pattern=/^[0-9]{2,4}$/;!pattern['test'](PORT)&&(console[_0x3a7aa2(0x22f)](_0x3a7aa2(0x16a)+PORT+_0x3a7aa2(0xc1)),process[_0x3a7aa2(0xfe)](0x1));const HOST=argv[_0x3a7aa2(0x1fb)]||null,userID=argv[_0x3a7aa2(0x151)]||'',debugging=argv['d']||![],nodeversion=process[_0x3a7aa2(0x1e9)][_0x3a7aa2(0xa6)];let bbpath=_0x3a7aa2(0x1e8),bbpath2='';const botfile=_0x3a7aa2(0x259),configfile=_0x3a7aa2(0x21d),settingsfile='bb-settings.json',securefile=_0x3a7aa2(0xd0),environment=require('./'+bbpath2+'version.json')[_0x3a7aa2(0xe9)]||_0x3a7aa2(0x202),maxBackups=0xa;let validInstallation=!![];!fs['existsSync'](bbpath+botfile)&&(bbpath='',validInstallation=![]);const {addClient,getAllClients,removeClient,getClient,getClientsWithBotID,getClientsWithUuid}=require('./'+bbpath2+'clients'),configpath=userID?bbpath+'config/'+userID+'/':bbpath+_0x3a7aa2(0xed),configbackuppath=configpath+_0x3a7aa2(0x260),logspath=userID?bbpath+_0x3a7aa2(0x124)+userID+'/':bbpath+'logs/',zippath=userID?bbpath+_0x3a7aa2(0x24d)+userID+'/':bbpath+'zip/',loggerfile=fs[_0x3a7aa2(0xc4)](logspath+_0x3a7aa2(0xde),{'flags':'a'}),temppath=userID?bbpath+'temp/'+userID+'/':bbpath+_0x3a7aa2(0x1dc);!fs[_0x3a7aa2(0x1ba)](configpath)&&fs['mkdirSync'](configpath);!fs[_0x3a7aa2(0x1ba)](configbackuppath)&&fs[_0x3a7aa2(0x26b)](configbackuppath);!fs['existsSync'](logspath)&&fs[_0x3a7aa2(0x26b)](logspath);!fs['existsSync'](zippath)&&fs[_0x3a7aa2(0x26b)](zippath);!fs[_0x3a7aa2(0x1ba)](temppath)&&fs[_0x3a7aa2(0x26b)](temppath);const adapter=new FileSync(configpath+configfile),dbConfig=low(adapter);dbConfig['defaults']({'bots':[]})[_0x3a7aa2(0x287)]();const adapter2=new FileSync(configpath+settingsfile),dbSettings=low(adapter2);dbSettings[_0x3a7aa2(0x14e)]({'settings':{'timeshift':0x0,'loginRequired':![],'bbUsername':'','bbPassword':'','f2aRequired':![],'lastmsgtelegram':0x0,'lastmsgemitted':0x0,'latestversion':_0x3a7aa2(0x153),'onepagemode':![]}})[_0x3a7aa2(0x287)]();const adapter3=new FileSync(configpath+securefile),dbSecure=low(adapter3);dbSecure['defaults']({'secure':{},'blacklist':[]})['write']();let crypt=new Crypt({'md':_0x3a7aa2(0x293),'rsaStandard':'RSA-OAEP'});const saltRounds=0xa,mixpanel=Mixpanel[_0x3a7aa2(0x1fe)](_0x3a7aa2(0x205),{'host':_0x3a7aa2(0x116)});let config=getConfiguration(),settings=getSettings(),secure=getSecure(),blacklist=getBlacklist(),tgBot;if(settings[_0x3a7aa2(0x9c)]&&(settings[_0x3a7aa2(0x9c)]!=''&&settings[_0x3a7aa2(0x9c)]!=_0x3a7aa2(0x244))&&settings[_0x3a7aa2(0x21b)]&&settings['telegramUsername']!='')initTelegram();const parseColor=(_0xd823dc,_0x5decdd)=>{const _0x18f010=_0x3a7aa2,_0x56bed4=/#[A-Z]{3}#/g;if(typeof _0xd823dc=='string'){!_0x5decdd?_0xd823dc=_0xd823dc[_0x18f010(0x118)](_0x56bed4,''):(_0xd823dc=_0xd823dc['replace'](/#BLU#/g,'\x1b[34m'),_0xd823dc=_0xd823dc[_0x18f010(0x118)](/#RED#/g,'\x1b[31m'),_0xd823dc=_0xd823dc[_0x18f010(0x118)](/#YEL#/g,_0x18f010(0xd2)),_0xd823dc=_0xd823dc[_0x18f010(0x118)](/#MAG#/g,_0x18f010(0x126)),_0xd823dc=_0xd823dc[_0x18f010(0x118)](/#CYA#/g,_0x18f010(0xfa)),_0xd823dc=_0xd823dc[_0x18f010(0x118)](/#RES#/g,'\x1b[0m'));;}return _0xd823dc;},logger={'screen':_0xc51ab3=>{console['log'](parseColor(_0xc51ab3,!![]));},'simple':_0xa3390f=>{const _0x9a53a3=_0x3a7aa2;console[_0x9a53a3(0x22f)](parseColor(_0xa3390f,!![])),loggerfile[_0x9a53a3(0x287)](util[_0x9a53a3(0x292)](parseColor(_0xa3390f,![]))+'\x0a');},'full':async _0x1d6b71=>{const _0x1f9f31=_0x3a7aa2,_0x39be0e=getTimeStamp()+':\x20Bot\x20Mgr\x20>\x20'+_0x1d6b71;console[_0x1f9f31(0x22f)](parseColor(_0x39be0e,!![])),loggerfile[_0x1f9f31(0x287)](util[_0x1f9f31(0x292)](parseColor(_0x39be0e,![]))+'\x0a');if(tgBot&&settings[_0x1f9f31(0xe8)]&&settings['telegramEvents']!=_0x1f9f31(0x1c5))await sendTelegram(settings[_0x1f9f31(0xe8)],_0x1f9f31(0xc6)+parseColor(_0x1d6b71,![]));},'debug':async(_0x56d759,_0x553550='')=>{const _0x3df78b=_0x3a7aa2,_0x50b307=getTimeStamp()+_0x3df78b(0xb8)+_0x56d759;if(debugging)console[_0x3df78b(0x22f)](parseColor(_0x50b307,!![]));loggerfile[_0x3df78b(0x287)](util[_0x3df78b(0x292)](parseColor(_0x50b307,![]))+'\x0a');if(_0x553550){if(debugging)console[_0x3df78b(0x22f)](_0x553550);loggerfile[_0x3df78b(0x287)](util[_0x3df78b(0x292)](_0x553550)+'\x0a');}}};let terminating=![];process['on'](_0x3a7aa2(0x173),function(_0x4825d2){const _0x1790b0=_0x3a7aa2;logger[_0x1790b0(0x166)](_0x4825d2);}),process['on']('exit',()=>{const _0x1fc58b=_0x3a7aa2;stopAllBots(),process[_0x1fc58b(0xfe)](0x0);}),process['on'](_0x3a7aa2(0xc7),()=>{const _0x2e0152=_0x3a7aa2;stopAllBots(),process[_0x2e0152(0xfe)](0x0);}),process['on'](_0x3a7aa2(0x195),()=>{const _0x324c96=_0x3a7aa2;stopAllBots(),process[_0x324c96(0xfe)](0x0);});let restoredConfigFile=0x0,newBot=![],pid=[];function _0x3f8b(){const _0x2eea97=['Unauthorized\x20login\x20attempt\x20(timeout)','once','bb-secure.json','logged\x20out','\x1b[33m','Stopping\x20Bot\x20Manager\x20and\x20starting\x20update\x20process','latestversion','jsonwebtoken','graphql-request','/disable\x20-\x20disable\x20notifications\x0a','unlinkSync','express-fileupload','Ok,\x20consider\x20updating\x20Balance\x20Bot\x20later','All\x20bots\x20running\x20right\x20now','readdirSync','mode','/output-000.log','output-002.log','deleteHistoryAlerts',')\x20\x20\x20|\x20Bot\x20','store-headless','config_alerts','hybrid-crypto-js','lastmsgtelegram','notification','\x20>\x20','telegramChatId','environment','createServer','reload','693960EkVwFB','config/','use','text','All\x20bots','access','Which\x20bot\x20do\x20you\x20want\x20to\x20stop?','map','match','error','node-zip','temporary\x20access\x20not\x20allowed','timeshift','referer','\x1b[36m','kill','Error\x20removing\x20old\x20backup\x20files:','showname','exit','messages','yes','Unauthorized\x20attempt\x20to\x20log\x20out','debug','lowdb','Unauthorized\x20attempt\x20to\x20cancel\x20loading\x20coins','[ip-address]','reinstall-bb','show','login\x20token\x20valid','temporary\x20access\x20rejected','child_process','delete-alerts','encryptedUuid','get-logs','userid','\x20to\x20','cloneDeep','ipc','decrypt','bot-','server','type','api-eu.mixpanel.com','port','replace','manual','Logged\x20in\x20user\x20...','0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@-#$','Unauthorized\x20attempt\x20to\x20store\x20fiat\x20configuration','Unauthorized\x20attempt\x20to\x20show\x20configuration','args','forEach','Bot\x20Mgr\x20>\x20toggling\x20Bot\x20','close','Unauthorized\x20attempt\x20to\x20reset\x20bot\x20history','password','logs/','\x20mode','\x1b[35m','names','reinstall_yes','size','timestamp','settings.','filter','toggle','split','getFullYear','reason','login','update-bot','Telegram\x20error:','Unauthorized\x20attempt\x20to\x20store\x20configuration','Notifications\x20disabled','file','/start','Notifications\x20disabled\x0a','socket.io','family','telegram2FaApproval','Unauthorized\x20attempt\x20to\x20update\x20bot','restore_yes_','For\x20which\x20bot\x20do\x20you\x20want\x20the\x20metrics?','add','::ffff:127.0.0.1','17865LuzSFT','callback','tkn','status','Which\x20bot\x20do\x20you\x20want\x20to\x20restart?','stringify','>\x20Set\x20up\x20your\x20first\x20bot\x20in\x20the\x20Bot\x20Manager!','Invalid\x20authentication\x20token\x20(1)','store','alerts','all','success','(((.+)+)+)+$','defaults','min','-performance.json','user','Unauthorized\x20attempt\x20to\x20reinstall\x20Balance\x20Bot','0.0.0','toggleBotMode','No\x20authentication\x20token','enabled','lastmsgemitted','Unauthorized\x20attempt\x20to\x20get\x20messages','getSeconds','config_all','Notifications\x20types:\x20orders\x20and\x20alerts\x0a','generate','find','inherit','bb-settings.json','join','temporary\x20token\x20generated','private','652CekTAT','backup-full','2FA\x20login\x20token\x20generated','simple','Your\x20installation\x20is\x20already\x20up\x20to\x20date','Failed\x20to\x20download\x20','9PMVIRT','Error:\x20Invalid\x20argument\x20','new-disabled','login2fa_','Node.js\x20v','post','botID','mtime','143naorDG','Your\x20installation\x20does\x20not\x20support\x20reinstalling\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20reinstallation','uncaughtException','No\x20bots\x20running\x20right\x20now','endsWith','Ok,\x20will\x20send\x20alert\x20notifications\x20only','new','axios','mixpanel','catch','rmSync','resetpw_yes','bot','Which\x20bot\x20do\x20you\x20want\x20to\x20toggle?','Welcome\x20to\x20your\x20personal\x20Balance\x20Bot\x20Telegram\x20bot!\x0a',')\x20|\x20Bot\x20','Error\x20while\x20deleting\x20config\x20files:\x20','58828XWazVZ','-config.json','send','inlineKeyboard','User\x20has\x20been\x20validated','whitelistEnabled','command','listen','version','Unauthorized\x20attempt\x20to\x20get\x20events','token','storeHeadless','\x20|\x20','output-001.log','loginRequired','Starting\x20Balance\x20Bot\x20update','settings','stopped','privateKey','SIGINT','logout','pidRefreshToken','5\x20min','assign','.zip','get-messages','Unauthorized\x20attempt\x20to\x20store\x20headless\x20configuration','telegramEvents','started','store-settings','conn','#RES#\x20if\x20running\x20locally\x0a','/toggle\x20-\x20toggle\x20manual\x20vs\x20auto\x20mode\x0a','expiry','Unauthorized\x20attempt\x20to\x20place\x20market\x20order','Network\x20Interfaces:','address','isDirectory','auto','express','reinstall','************','writeFileSync','isIPv4MappedAddress','storeConfiguration','backup','/on\x20-\x20start\x20bot(s)\x0a','access\x20timeout','getTime','emitHistory','keys','binary','telegram','Unauthorized\x20attempt\x20to\x20delete\x20bot','secret','Starting\x20Balance\x20Bot\x20reinstallation','existsSync','Unknown\x20client\x20attempting\x20to\x20retrieve\x20list\x20of\x20backup\x20files','You\x20can\x20use\x20the\x20following\x20commands:\x0a','getUTCHours','/:bot','message','-results.json','username','logs','::1','Server','orders','max','remove','any','portfolio_','telegramIpApproval','headless','sendFile','Bearer\x20eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImdjbXMtbWFpbi1wcm9kdWN0aW9uIn0.eyJ2ZXJzaW9uIjozLCJpYXQiOjE2MjE2NjgzMzgsImF1ZCI6WyJodHRwczovL2FwaS1ldS1jZW50cmFsLTEuZ3JhcGhjbXMuY29tL3YyL2Nrb3l0enYzbG90a3kwMXc1OWdsYWNlN3kvbWFzdGVyIiwiaHR0cHM6Ly9tYW5hZ2VtZW50LW5leHQuZ3JhcGhjbXMuY29tIl0sImlzcyI6Imh0dHBzOi8vbWFuYWdlbWVudC5ncmFwaGNtcy5jb20vIiwic3ViIjoiYjZlOTBmODAtZmEzYS00ODJmLWE0NTAtMTY3YTFmZTliNzIzIiwianRpIjoiY2tvemZnaWE0Mno4bTAxdzU5bHU5ZTA3NSJ9.cEJ5isSubzX1ymlpkfyvfgZ6zyUMFiFOVaD4N84NoEOxwGZ8DtYM1k4DlCjoeCcTR8Ftr43bIGDxR4apANAG_-wf9Nge9T2MAuKa9z2sCWA5jnYtTHYU-x1Hx_ShpHAl1wPjrSpTMquV3bRlKQBm6EQTreoaQZgBXY25ClLbVzXFcohcDn3RGi3hHVRvxNLr0F7ETwFJnbowm9UX66vz2SP-5-u-CBKUxSipKMO5za0MZiIWoprSdE0f22xVXp8up3k_6-5x22mS88P2OFgMXoA-UBFS8nz6jRE_fRULzCouKYyJG3oQ10ovuZ1M729GQ0rMv9fkJroVKyS4i8KgglwPPBwQbaD2LCJXINKXYC65DmKyJ9UjWxQ9Lv6akcnkT7CkeqEqzwLnCEQgZEmJS_PBFDu40LMS8UbnwDcntJznA8rH_jsD7IkMdyRyXmns6fbLOc91Q1idBCk-VqUzkL0FzfscCVpkg1J7kGtGeW4YEWhWyPze4ZO4IxM9WRoSsCDUOx3EXklA0WSdR2M6IRnoFL-qoawOLQaaPACy8-QGmaAL6N6fuMIHUWavOTYnyLip0oyy74sUHz4S4sx4mAf5pexlvDcxM_6RIRnCQ84THsM2KwpoWkpR-F2s4pIyfYYn-4R7MNENfPGxNm4INjBYrCOWyZN_vXHGBa4uw2U','build','/portfolio\x20-\x20show\x20bot\x20portfolio\x0a','Telegraf\x20error:','emit','2FA\x20required','files','remoteAddress','static','version.json','HTML','login\x20not\x20required','-----------------------------------------------------------------------------------','Please\x20confirm\x20restoring\x20in\x20your\x20Telegram\x20bot','Password\x20has\x20been\x20reset\x20to:\x20','temp/','/:bot/coins','NTBA_FIX_319',':\x20Bot\x20Mgr\x20>\x20Telegram\x20error\x20occured','handshake','Restoring\x20bot(s)\x20from\x20backup','constructor','Idling\x20(','/download/:type','connection','Bot\x20','event','bb/','versions','build2','getDate','apiPassword','help','Yes','bbPassword','temporaryAccessAllowed','*$1*','date-fns','2FA\x20login\x20rejected','randomBytes','off','get-starting-balances','Do\x20you\x20want\x20to\x20reset\x20your\x20password?','get-portfolio','Invalid\x20IP\x20address','data','host','File\x20uploaded','1007972sPwAMU','init','login2fa_reject_','Of\x20which\x20events\x20do\x20you\x20want\x20to\x20be\x20notified?','length','production','update_yes','Unauthorized\x20attempt\x20to\x20delete\x20alerts','6b67f3d61ee94b8f5c80b4affef4c4d9','Unauthorized\x20attempt\x20to\x20restore\x20backup\x20file','alias','socket','Allow\x20temporary\x20access\x20from\x20IP\x20address\x20','fork','reset-password','reject','path','randomFillSync','onepagemode','Crypt','Restore\x20backup\x20file\x20','Session\x20expired\x20for\x20user\x20...','params','readFileSync','clientip','portfolio','#RES#\x20','argv','button','Which\x20bot\x20do\x20you\x20want\x20to\x20start?','telegramUsername','backup-full@','bb-config.json','telegramEnabled','publicKey','sendMessage','copyFileSync','editMessageReplyMarkup','getMonth','Are\x20you\x20sure\x20you\x20want\x20to\x20reinstall\x20Balance\x20Bot\x20now?','2FA','Restore\x20process\x20confirmed','tempaccess_reject_','index.html','function','Starting\x20new\x20bot\x20|\x20Bot\x20','track','Disabled\x20Bot\x20','internal','Bot\x20Mgr\x20>\x20starting\x20Bot\x20','log','startsWith','lowdb/adapters/FileSync','padStart','toString','showConfig','528cPypjb','Backup\x20file\x20unzipped\x20and\x20stored','Allow\x20login\x20from\x20IP\x20address\x20','408670BnhJzT','apiSecret','sendPortfolioTelegram','2FA\x20login\x20required','Unauthorized\x20attempt\x20to\x20upload\x20file\x20(2)','output-003.log','sendMetricsTelegram','RSA','sign','live','sortBy','name','***','confirm-message','show-config','cancelLoading','yargs/yargs','NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bot\x20is\x20disabled\x20by\x20default\x20-\x20enable\x20if\x20you\x20want\x20it\x20to\x20run','value','Unauthorized\x20attempt\x20to\x20update\x20settings','place-order','zip/','exec','staging','blacklist','https://api-eu-central-1.graphcms.com/v2/ckoytzv3lotky01w59glace7y/master','reply','Bot\x20Mgr\x20>\x20stopping\x20all\x20bots','stop','Bot\x20Mgr\x20>\x20starting\x20all\x20bots','/names\x20-\x20show\x20bot\x20names\x0a','botname','set','bot.js','Orders','store-fiat','Unauthorized\x20attempt\x20to\x20upload\x20file\x20(1)','config_orders','parse','-events.json','backup/','start','chat','metrics_','running','15\x20min','bbvNew','getMinutes','request','telegrammsg','warning','mkdirSync','connected','DEFLATE','sort','number','Unauthorized\x20user\x20-\x20make\x20sure\x20you\x27ve\x20entered\x20your\x20<b>personal</b>\x20Telegram\x20username\x20in\x20the\x20Bot\x20Manager\x27s\x20settings','update-bb','All','invalid\x20credentials','hashSync','env','Ok,\x20will\x20send\x20order\x20notifications\x20only','login\x20required','update','=>\x20Go\x20to\x20#CYA#http://127.0.0.1:','Unauthorized\x20attempt\x20to\x20download\x20','\x20|\x20client:\x20...','includes','Setting\x20access:\x20','<b>Balance\x20Bot\x20Status:</b>\x0a','disable','compareSync','Starting\x20(','1863524EPWjLH','/help\x20-\x20show\x20available\x20commands\x0a','(staging)','sockets','generateKeyPairAsync','write','Your\x20installation\x20does\x20not\x20support\x20updating\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20update','removeAllListeners','allow','6285544QrQcRK','from','restore_no_','/:bot/history','127.0.0.1','3000','/metrics\x20-\x20show\x20bot\x20performance\x0a','format','sha256','secure','/:bot/configuration','bbUsername','Bot\x20Mgr\x20>\x20stopping\x20Bot\x20','toIPv4MappedAddress','action','/off\x20-\x20stop\x20bot(s)\x0a','verify','resetHistory','/:bot/portfolio','get','whitelist','telegramToken','#RES#\x20if\x20running\x20on\x20server','statSync','range','slice','Enabled\x20Bot\x20','/:bot/performance','metrics','disabled','f2aRequired','node','For\x20which\x20bot\x20do\x20you\x20want\x20the\x20portfolio?','getStartingBalances','Do\x20you\x20want\x20to\x20restore\x20your\x20installation?\x20NOTE:\x20this\x20will\x20replace\x20your\x20current\x20settings\x20and\x20bot(s)','getHours','push','full','uuid','tempaccess_15_','Logged\x20out\x20user\x20...','ipaddr.js','/status\x20-\x20show\x20bot(s)\x20status\x0a','bots','/enable\x20-\x20enable\x20notifications\x0a','hasOwnProperty','botmanager','Restore\x20process\x20aborted','Notifications\x20enabled',':\x20Bot\x20Mgr\x20>\x20[DEBUG]\x20','tempaccess_5_','Alerts','search','login\x20token\x20generated','\x20only\x0a','apiKey','pidExpireLogin','telegraf',',\x20must\x20be\x20a\x204\x20digit\x20number','initclient','https://api.ipify.org?format=json','createWriteStream','headers','Bot\x20Mgr\x20>\x20','SIGTERM','update_no','output-000.log','Unauthorized\x20attempt\x20to\x20confirm\x20message','Deleted\x20Bot\x20','hex','getPortfolio'];_0x3f8b=function(){return _0x2eea97;};return _0x3f8b();}const serverversion=require('./'+bbpath2+_0x3a7aa2(0x1d6))[_0x3a7aa2(0x18a)],maxSecretAge=0xa,loginExpiry=0x4*0x3c,tokenRefresh=0x5;let tmpStorage={},devices=[],lastIpApproval,pidScheduler,installingUpdate=![],publicip,newMessages=[],updateAvailable=![];const express=require(_0x3a7aa2(0x1a9)),app=express(),http=require('http')[_0x3a7aa2(0xea)](app);app['use'](fileUpload({'useTempFiles':!![]})),app['get'](_0x3a7aa2(0x1e4),async(_0x3a15ae,_0x5b32a6)=>{const _0x3eb082=_0x3a7aa2,_0x3cefe0=_0x3a15ae[_0x3eb082(0x213)][_0x3eb082(0x115)],_0x47ec35=getClientsWithBotID(_0x3eb082(0xb5)),_0x11c685=_0x3a15ae[_0x3eb082(0xc5)][_0x3eb082(0xad)],_0x511bc0=timelyDecrypt(_0x11c685,![]),_0x4caf80=_0x47ec35[_0x3eb082(0x15d)](_0x3964e9=>_0x3964e9[_0x3eb082(0xad)]==_0x511bc0);if(_0x4caf80){const _0x1dd326=normalizeIP(_0x3a15ae[_0x3eb082(0x208)][_0x3eb082(0x1d4)])[_0x3eb082(0x149)],_0x5c6f7b=_0x3a15ae['headers'][_0x3eb082(0x143)];if(validateAccess(_0x5c6f7b,_0x511bc0,_0x1dd326)['allow'])_0x3cefe0==_0x3eb082(0x1af)&&await backupConfigFiles(),await zipFiles(_0x3cefe0),_0x5b32a6['download'](zippath+(_0x3cefe0+_0x3eb082(0x19a)),_0x51f85c=>{const _0x40a865=_0x3eb082;_0x51f85c&&(logger[_0x40a865(0xac)](_0x40a865(0x168)+_0x3cefe0),logger[_0x40a865(0x166)](_0x51f85c));});else logger['full'](_0x3eb082(0x27a)+_0x3cefe0+'\x20(1)');}else logger[_0x3eb082(0xac)]('Unauthorized\x20attempt\x20to\x20download\x20'+_0x3cefe0+'\x20(2)');}),app[_0x3a7aa2(0x16e)]('/upload-backup',async(_0x23a5e3,_0x58ac41)=>{const _0x38c59f=_0x3a7aa2,_0x25a342=getClientsWithBotID(_0x38c59f(0xb5)),_0x3033d8=_0x23a5e3[_0x38c59f(0xc5)][_0x38c59f(0xad)],_0x288fa9=timelyDecrypt(_0x3033d8,![]),_0x37db44=_0x25a342['find'](_0x319abd=>_0x319abd[_0x38c59f(0xad)]==_0x288fa9);logger[_0x38c59f(0x102)]('Backup\x20file\x20uploaded');if(_0x37db44){const _0x49c097=normalizeIP(_0x23a5e3[_0x38c59f(0x208)][_0x38c59f(0x1d4)])['store'],_0x4371f0=_0x23a5e3[_0x38c59f(0xc5)]['tkn'];if(validateAccess(_0x4371f0,_0x288fa9,_0x49c097)['allow']){if(_0x23a5e3['files']){const _0x3b4145=_0x23a5e3[_0x38c59f(0x1d3)]['backupfile'];await _0x3b4145['mv'](temppath+_0x3b4145[_0x38c59f(0x243)]),_0x58ac41[_0x38c59f(0x184)]({'status':!![],'message':_0x38c59f(0x1fc)});const _0x7647f1=getBotsWithMode();_0x7647f1['length']>0x0?confirmRestore(temppath,_0x3b4145[_0x38c59f(0x243)]):unzipFile(temppath,_0x3b4145[_0x38c59f(0x243)]);}}else logger[_0x38c59f(0xac)](_0x38c59f(0x25c));}else logger[_0x38c59f(0xac)](_0x38c59f(0x23c));}),app['use'](express[_0x3a7aa2(0x1d5)](path[_0x3a7aa2(0x160)](__dirname,bbpath2,_0x3a7aa2(0x1ea)))),app[_0x3a7aa2(0xee)](express['static'](path[_0x3a7aa2(0x160)](__dirname,bbpath2,_0x3a7aa2(0x1ce)))),app[_0x3a7aa2(0x29e)]('/',function(_0x205efc,_0x345f28){const _0x27bee4=_0x3a7aa2;_0x345f28[_0x27bee4(0x1cc)](path[_0x27bee4(0x160)](__dirname,bbpath2,_0x27bee4(0x1ea),'index.html'));}),app[_0x3a7aa2(0x29e)](_0x3a7aa2(0x1be),function(_0x4a7217,_0x3bac89){const _0x2cde03=_0x3a7aa2;_0x3bac89[_0x2cde03(0x1cc)](path[_0x2cde03(0x160)](__dirname,bbpath2,_0x2cde03(0x1ce),'index.html'));}),app[_0x3a7aa2(0x29e)](_0x3a7aa2(0x29d),(_0x45d6b8,_0x24a8de)=>{const _0x414717=_0x3a7aa2;_0x24a8de['sendFile'](path['join'](__dirname,bbpath2,_0x414717(0x1ce),'index.html'));}),app[_0x3a7aa2(0x29e)](_0x3a7aa2(0xa2),(_0x164b67,_0x3717c8)=>{const _0x4dd035=_0x3a7aa2;_0x3717c8[_0x4dd035(0x1cc)](path['join'](__dirname,bbpath2,'build',_0x4dd035(0x228)));}),app[_0x3a7aa2(0x29e)](_0x3a7aa2(0x1dd),(_0x25aafa,_0x4ba185)=>{const _0x5521e7=_0x3a7aa2;_0x4ba185[_0x5521e7(0x1cc)](path[_0x5521e7(0x160)](__dirname,bbpath2,_0x5521e7(0x1ce),'index.html'));}),app[_0x3a7aa2(0x29e)](_0x3a7aa2(0x28e),(_0x4acb31,_0x5a1e82)=>{const _0xaf2d98=_0x3a7aa2;_0x5a1e82[_0xaf2d98(0x1cc)](path[_0xaf2d98(0x160)](__dirname,bbpath2,_0xaf2d98(0x1ce),_0xaf2d98(0x228)));}),app[_0x3a7aa2(0x29e)](_0x3a7aa2(0x295),(_0x49db43,_0x219479)=>{const _0xc7104e=_0x3a7aa2;_0x219479[_0xc7104e(0x1cc)](path[_0xc7104e(0x160)](__dirname,bbpath2,_0xc7104e(0x1ce),_0xc7104e(0x228)));}),app['get']('/:bot/support',(_0x22f7cd,_0x40f70f)=>{const _0x3bb019=_0x3a7aa2;_0x40f70f['sendFile'](path[_0x3bb019(0x160)](__dirname,bbpath2,_0x3bb019(0x1ce),_0x3bb019(0x228)));});if(HOST)http[_0x3a7aa2(0x189)](PORT,HOST);else http['listen'](PORT);const io=require(_0x3a7aa2(0x139))(http,{});init();async function init(){await validateConfigFile(),await initUser(),await initSecure(),oneTimeMigration(),cleanBlacklist(),initStates(),await startServer();if(restoredConfigFile)restoreConfigNotify(![]);startSocket(),startScheduler(),triggerAnalytics(),getMessages(),reloadBotManager();}function getServerIP(){const _0x3a3532=_0x3a7aa2;let _0x7e40b8=_0x3a3532(0x105);const _0x2aad85=networkInterfaces(),_0x156a9d={};for(const _0x229f1d of Object[_0x3a3532(0x1b4)](_0x2aad85)){for(const _0x1581ad of _0x2aad85[_0x229f1d]){if((_0x1581ad[_0x3a3532(0x13a)]=='IPv4'||_0x1581ad[_0x3a3532(0x13a)]==0x4)&&!_0x1581ad[_0x3a3532(0x22d)]){const _0x53d59d=ipaddr[_0x3a3532(0x25e)](_0x1581ad[_0x3a3532(0x1a6)])[_0x3a3532(0x9f)]();_0x53d59d!=_0x3a3532(0x162)&&(!_0x156a9d[_0x229f1d]&&(_0x156a9d[_0x229f1d]=[]),_0x156a9d[_0x229f1d]['push'](_0x1581ad[_0x3a3532(0x1a6)]),_0x7e40b8=_0x1581ad[_0x3a3532(0x1a6)]);}}}return{'serverip':_0x7e40b8,'netinterfaces':_0x156a9d};}async function startServer(){const _0x40fd85=_0x3a7aa2,{serverip:_0x1da4d1,netinterfaces:_0x3e6f74}=getServerIP();logger[_0x40fd85(0x166)](''),logger[_0x40fd85(0x166)](_0x40fd85(0x1d9)),await logger[_0x40fd85(0xac)]('Starting\x20#RED#Balance\x20Bot\x20v'+serverversion+_0x40fd85(0x217)+(environment==_0x40fd85(0x24f)?_0x40fd85(0x284):'')+'\x0a'+(_0x40fd85(0x279)+PORT+_0x40fd85(0x1a1))+('=>\x20Go\x20to\x20#CYA#http://'+_0x1da4d1+':'+PORT+_0x40fd85(0x9d))),logger[_0x40fd85(0x166)](_0x40fd85(0x1d9));if(config['length']!=0x0)for(const _0x50ea7a of config){const _0x268a81=_0x50ea7a[_0x40fd85(0xdd)]=='auto'?'a':'m';if(_0x50ea7a['status']==_0x40fd85(0x156)||_0x50ea7a[_0x40fd85(0x144)]==_0x40fd85(0x177))await logger[_0x40fd85(0xac)](_0x40fd85(0x281)+_0x268a81+_0x40fd85(0x180)+_0x50ea7a[_0x40fd85(0x16f)]+_0x40fd85(0x18e)+_0x50ea7a[_0x40fd85(0x257)]),startBot([_0x50ea7a[_0x40fd85(0x16f)],userID],{'cwd':bbpath},function(_0x202a6d){const _0x168043=_0x40fd85;if(_0x202a6d)logger[_0x168043(0xac)](_0x202a6d);});else(_0x50ea7a[_0x40fd85(0x144)]==_0x40fd85(0xa4)||_0x50ea7a['status']=='new-disabled')&&await logger[_0x40fd85(0xac)](_0x40fd85(0x1e3)+_0x268a81+_0x40fd85(0xe1)+_0x50ea7a[_0x40fd85(0x16f)]+'\x20|\x20'+_0x50ea7a[_0x40fd85(0x257)]);}else!newBot&&logger[_0x40fd85(0x166)](_0x40fd85(0x147));if(newBot)addBot();logger[_0x40fd85(0x166)](_0x40fd85(0x1d9)),logger[_0x40fd85(0x166)](''),await logger[_0x40fd85(0x102)](_0x40fd85(0x16d)+nodeversion),await logger[_0x40fd85(0x102)](_0x40fd85(0x1a5),_0x3e6f74);}function startSocket(){const _0x17aaf6=_0x3a7aa2;io['on'](_0x17aaf6(0x1e5),_0x4b3bbe=>{const _0x1de964=_0x17aaf6;let _0x53fd83,_0xaab27a,_0x6e257f,_0x39926d,_0x344d8c;const _0xeee68f=_0x4b3bbe[_0x1de964(0x1e0)][_0x1de964(0xc5)][_0x1de964(0xf9)];_0xaab27a=_0xeee68f['match'](/bot[0-9]{3}/);if(_0xaab27a)_0x6e257f=_0xaab27a[0x0][_0x1de964(0xf4)](/[0-9]{3}/);if(_0x6e257f)_0x53fd83=_0x6e257f[0x0];else _0x53fd83='botmanager';const _0x52d044=_0x4b3bbe[_0x1de964(0x1e0)]['auth'][_0x1de964(0x10c)];if(!_0x52d044)_0x4b3bbe[_0x1de964(0x1d1)](_0x1de964(0x144),{'publicKey':secure[_0x1de964(0x21f)]});else{_0x39926d=timelyDecrypt(_0x52d044,![]);if(!_0x39926d)_0x4b3bbe['emit'](_0x1de964(0x144),{'publicKey':secure['publicKey']});else{_0x344d8c=normalizeIP(_0x4b3bbe[_0x1de964(0x1a0)][_0x1de964(0x1d4)])[_0x1de964(0x149)];if(!devices[_0x39926d])devices[_0x39926d]={'uuid':_0x39926d,'access':{'token':null}};devices[_0x39926d]['ip']=_0x344d8c;const _0x454246=addClient(_0x4b3bbe['id'],_0x39926d,_0x53fd83);setAccess(_0x454246),emitMessages(),_0x4b3bbe['on'](_0x1de964(0x131),_0x204c55=>{const _0x4aedb9=_0x1de964,_0x46b1cb=timelyDecrypt(_0x204c55[_0x4aedb9(0x123)]);if(_0x46b1cb){_0x204c55={'username':_0x204c55['username'],'password':_0x46b1cb},devices[_0x39926d]['access']=validateCredentials(_0x204c55,_0x39926d);if(devices[_0x39926d][_0x4aedb9(0xf1)][_0x4aedb9(0x28a)]==![]&&devices[_0x39926d][_0x4aedb9(0xf1)]['reason']==_0x4aedb9(0x23b))_0x4b3bbe[_0x4aedb9(0x1d1)](_0x4aedb9(0x144),{'access':devices[_0x39926d][_0x4aedb9(0xf1)]}),loginAccess2FA(_0x39926d,_0x344d8c);else{if(devices[_0x39926d][_0x4aedb9(0xf1)]['allow']==![]&&devices[_0x39926d][_0x4aedb9(0xf1)][_0x4aedb9(0x130)]==_0x4aedb9(0x273))_0x4b3bbe[_0x4aedb9(0x1d1)](_0x4aedb9(0x144),{'access':devices[_0x39926d][_0x4aedb9(0xf1)]});else devices[_0x39926d][_0x4aedb9(0xf1)]['allow']&&devices[_0x39926d]['access']['reason']==_0x4aedb9(0xbc)&&(getClientsWithUuid(_0x39926d)[_0x4aedb9(0x11f)](_0x3722d2=>{setAccess(_0x3722d2);}),logger['debug'](_0x4aedb9(0x11a)+_0x39926d[_0x4aedb9(0xa0)](-0x8)),setTokenRefresh(_0x39926d),setSessionTimeout(_0x4aedb9(0x131),_0x39926d));}}else logger['full'](_0x4aedb9(0xce));}),_0x4b3bbe['on'](_0x1de964(0x20b),()=>{resetPassword();}),_0x4b3bbe['on']('disconnect',_0x434ff4=>{removeClient(_0x4b3bbe['id']);}),_0x53fd83=='botmanager'&&(restoredConfigFile&&(restoreConfigNotify(!![]),restoredConfigFile=0x0));}}});}function initClient(_0x20cefb){const _0x57f19f=_0x3a7aa2;if(_0x20cefb!=_0x57f19f(0xb5)&&config[_0x57f19f(0xbe)]!=''){if(pid[_0x20cefb])pid[_0x20cefb][_0x57f19f(0x184)]({'function':_0x57f19f(0xc2),'args':null});}_0x20cefb!='botmanager'&&broadcastToBots('bots',JSON[_0x57f19f(0x146)](config));}function reloadBotManager(){const _0x58ebc5=_0x3a7aa2;getClientsWithBotID(_0x58ebc5(0xb5))[_0x58ebc5(0x11f)](_0x109c56=>{const _0x3d4c41=_0x58ebc5;getSocket(_0x109c56['id'])[_0x3d4c41(0x1d1)](_0x3d4c41(0x144),{'access':{'allow':![],'reason':_0x3d4c41(0xeb),'token':null}});});}function getSocket(_0x2f5636){const _0x1ed508=_0x3a7aa2;return io[_0x1ed508(0x285)][_0x1ed508(0x285)][_0x1ed508(0x29e)](_0x2f5636);}function setAccess(_0x57cdd7){const _0x36a2aa=_0x3a7aa2,_0x57c0f8=getSocket(_0x57cdd7['id']),_0x4cfff7=_0x57cdd7['uuid'],_0x2cb650=_0x57cdd7[_0x36a2aa(0x17d)];devices[_0x4cfff7][_0x36a2aa(0xf1)]=validateAccess(devices[_0x4cfff7][_0x36a2aa(0xf1)][_0x36a2aa(0x18c)],_0x4cfff7),logger['debug'](_0x36a2aa(0x27d)+devices[_0x4cfff7]['access'][_0x36a2aa(0x130)]+_0x36a2aa(0x27b)+_0x57cdd7['id'][_0x36a2aa(0xa0)](-0x8)+'\x20|\x20user:\x20...'+_0x4cfff7[_0x36a2aa(0xa0)](-0x8)),_0x57c0f8[_0x36a2aa(0x160)](_0x4cfff7);if(devices[_0x4cfff7][_0x36a2aa(0xf1)][_0x36a2aa(0x28a)]){_0x57c0f8[_0x36a2aa(0x160)](_0x2cb650);if(_0x2cb650==_0x36a2aa(0xb5))initializeSocketBotManager(_0x57c0f8);else initializeSocketBot(_0x57c0f8);initClient(_0x2cb650);}devices[_0x4cfff7]['access'][_0x36a2aa(0x18c)]&&devices[_0x4cfff7][_0x36a2aa(0xf1)]['reason']=='temporary\x20token\x20generated'&&setSessionTimeout(_0x36a2aa(0x225),_0x4cfff7),devices[_0x4cfff7][_0x36a2aa(0xf1)]['token']&&devices[_0x4cfff7][_0x36a2aa(0xf1)][_0x36a2aa(0x130)]==_0x36a2aa(0x165)&&setSessionTimeout(_0x36a2aa(0x131),_0x4cfff7),_0x57c0f8[_0x36a2aa(0x1d1)](_0x36a2aa(0x144),{'status':_0x57cdd7[_0x36a2aa(0x114)],'serverversion':serverversion,'environment':environment,'servertime':getServerTime(),'access':devices[_0x4cfff7][_0x36a2aa(0xf1)],'externalip':devices[_0x4cfff7]['ip'],'publicKey':secure[_0x36a2aa(0x21f)],'userid':settings['userid'],'validInstallation':validInstallation}),devices[_0x4cfff7][_0x36a2aa(0xf1)][_0x36a2aa(0x28a)]==![]&&devices[_0x4cfff7][_0x36a2aa(0xf1)][_0x36a2aa(0x130)]==_0x36a2aa(0x1d2)&&temporaryAccess2FA(_0x4cfff7,devices[_0x4cfff7]['ip']);}function setSessionTimeout(_0x17c8d3,_0x164b09){const _0x5681c2=_0x3a7aa2;let _0x2747e4;if(_0x17c8d3==_0x5681c2(0x131))_0x2747e4=loginExpiry*0x3c*0x3e8;else _0x2747e4=devices[_0x164b09][_0x5681c2(0x1ca)][_0x5681c2(0x1a3)]*0x3c*0x3e8-(new Date()[_0x5681c2(0x1b2)]()-devices[_0x164b09]['telegramIpApproval'][_0x5681c2(0x12a)]);if(devices[_0x164b09][_0x5681c2(0xbf)])clearTimeout(devices[_0x164b09][_0x5681c2(0xbf)]);devices[_0x164b09]['pidExpireLogin']=setTimeout(()=>{const _0x3d6d93=_0x5681c2;if(devices[_0x164b09][_0x3d6d93(0x197)])clearTimeout(devices[_0x164b09][_0x3d6d93(0x197)]);removeSocketListeners(_0x164b09),addBlacklist(_0x164b09),devices[_0x164b09]['telegramIpApproval']=null,devices[_0x164b09][_0x3d6d93(0x13b)]=null,devices[_0x164b09]['access'][_0x3d6d93(0x18c)]=null,logger[_0x3d6d93(0x102)](_0x3d6d93(0x212)+_0x164b09['slice'](-0x8)),devices[_0x164b09]['access']=validateAccess(devices[_0x164b09][_0x3d6d93(0xf1)][_0x3d6d93(0x18c)],_0x164b09),!(devices[_0x164b09][_0x3d6d93(0xf1)][_0x3d6d93(0x28a)]&&devices[_0x164b09]['access'][_0x3d6d93(0x130)]==_0x3d6d93(0x1d8))&&(_0x17c8d3=='login'?io['to'](_0x164b09)[_0x3d6d93(0x1d1)](_0x3d6d93(0x144),{'access':{'allow':![],'reason':_0x3d6d93(0x1b1),'token':null}}):io['to'](_0x164b09)[_0x3d6d93(0x1d1)]('status',{'access':{'allow':![],'reason':'temporary\x20access\x20timeout','token':null}})),devices[_0x164b09]['access'][_0x3d6d93(0x18c)]=null;},_0x2747e4);}function setTokenRefresh(_0x367d42){const _0x3d9cce=_0x3a7aa2;if(devices[_0x367d42]['pidRefreshToken'])clearTimeout(devices[_0x367d42][_0x3d9cce(0x197)]);devices[_0x367d42][_0x3d9cce(0x197)]=setTimeout(()=>{const _0x1113cf=_0x3d9cce;getClientsWithUuid(_0x367d42)[_0x1113cf(0x201)]!=0x0?(devices[_0x367d42]['access']=refreshToken(_0x367d42),io['to'](_0x367d42)[_0x1113cf(0x1d1)](_0x1113cf(0x144),{'status':_0x1113cf(0x26c),'serverversion':serverversion,'environment':environment,'servertime':getServerTime(),'access':devices[_0x367d42][_0x1113cf(0xf1)],'externalip':devices[_0x367d42]['ip'],'publicKey':secure['publicKey'],'validInstallation':validInstallation}),setTokenRefresh(_0x367d42)):clearTimeout(devices[_0x367d42][_0x1113cf(0x197)]);},(tokenRefresh-0x1)*0x3c*0x3e8);}function initializeSocketBotManager(_0x41231e){const _0x55be7f=_0x3a7aa2,_0x5b4696=getClient(_0x41231e['id'])[_0x55be7f(0xad)];_0x41231e['emit']('bots',config),_0x41231e[_0x55be7f(0x1d1)](_0x55be7f(0x192),cleanSettings()),_0x41231e['on']('add-bot',_0x2239d7=>{const _0x56159a=_0x55be7f;if(validateAccess(_0x2239d7,_0x5b4696)[_0x56159a(0x28a)])addBot();else logger[_0x56159a(0xac)]('Unauthorized\x20attempt\x20to\x20add\x20bot');}),_0x41231e['on'](_0x55be7f(0x132),(_0x176035,_0x33ccf4)=>{const _0x6181d5=_0x55be7f;if(validateAccess(_0x33ccf4,_0x5b4696)[_0x6181d5(0x28a)])toggleBot(_0x176035[_0x6181d5(0x16f)],_0x176035[_0x6181d5(0x144)],_0x176035[_0x6181d5(0x241)]);else logger[_0x6181d5(0xac)](_0x6181d5(0x13c));}),_0x41231e['on']('toggle-bot-mode',(_0x43b8ce,_0x483f69)=>{const _0x545696=_0x55be7f;if(validateAccess(_0x483f69,_0x5b4696)['allow'])toggleBotMode(_0x43b8ce);else logger[_0x545696(0xac)](_0x545696(0x13c));}),_0x41231e['on']('delete-bot',(_0x6bb7c4,_0x3284d3)=>{const _0x1888eb=_0x55be7f;if(validateAccess(_0x3284d3,_0x5b4696)[_0x1888eb(0x28a)])deleteBot(_0x6bb7c4);else logger[_0x1888eb(0xac)](_0x1888eb(0x1b7));}),_0x41231e['on'](_0x55be7f(0x19f),(_0x565e6c,_0x3fe629)=>{const _0x2f5593=_0x55be7f;if(validateAccess(_0x3fe629,_0x5b4696)[_0x2f5593(0x28a)])storeSettings(_0x565e6c,!![]);else logger['full'](_0x2f5593(0x24b));}),_0x41231e['on'](_0x55be7f(0x271),_0x4e9bda=>{const _0x136d0f=_0x55be7f;if(validateAccess(_0x4e9bda,_0x5b4696)[_0x136d0f(0x28a)])updateBB(_0x136d0f(0x278));else logger['full']('Unauthorized\x20attempt\x20to\x20update\x20Balance\x20Bot');}),_0x41231e['on'](_0x55be7f(0x106),_0xacb3ab=>{const _0x581b92=_0x55be7f;if(validateAccess(_0xacb3ab,_0x5b4696)[_0x581b92(0x28a)])updateBB(_0x581b92(0x1aa));else logger[_0x581b92(0xac)](_0x581b92(0x152));}),_0x41231e['on']('get-backup-files',_0x2fd61a=>{const _0x3834a2=_0x55be7f;if(validateAccess(_0x2fd61a,_0x5b4696)[_0x3834a2(0x28a)]){const _0x4f956e=getClient(_0x41231e['id']);if(_0x4f956e)getBackupFiles(_0x4f956e[_0x3834a2(0xad)]);else logger[_0x3834a2(0xac)](_0x3834a2(0x1bb));}else logger['full']('Unauthorized\x20attempt\x20to\x20retrieve\x20list\x20of\x20backup\x20files');}),_0x41231e['on']('restore-backup-file',(_0x1ebf73,_0x49dd0e)=>{const _0x3485ec=_0x55be7f;if(validateAccess(_0x49dd0e,_0x5b4696)[_0x3485ec(0x28a)])restoreBackupFile(_0x1ebf73);else logger['full'](_0x3485ec(0x206));}),_0x41231e['on']('get-messages',_0x3d6e23=>{const _0x13b936=_0x55be7f;if(validateAccess(_0x3d6e23,_0x5b4696)[_0x13b936(0x28a)])getMessages();else logger[_0x13b936(0xac)](_0x13b936(0x158));}),_0x41231e['on']('confirm-message',(_0x43a1d2,_0x4d276d)=>{const _0x4ac46=_0x55be7f;if(validateAccess(_0x4d276d,_0x5b4696)[_0x4ac46(0x28a)])confirmMessage(_0x43a1d2);else logger[_0x4ac46(0xac)](_0x4ac46(0xca));}),_0x41231e['on']('logout',_0xdbd1b1=>{const _0x70412e=_0x55be7f;if(validateAccess(_0xdbd1b1,_0x5b4696)['allow']){if(devices[_0x5b4696][_0x70412e(0x197)])clearTimeout(devices[_0x5b4696][_0x70412e(0x197)]);if(devices[_0x5b4696][_0x70412e(0xbf)])clearTimeout(devices[_0x5b4696]['pidExpireLogin']);removeSocketListeners(getClient(_0x41231e['id'])[_0x70412e(0xad)]),addBlacklist(_0x5b4696),devices[_0x5b4696]['telegramIpApproval']=null,devices[_0x5b4696][_0x70412e(0x13b)]=null,devices[_0x5b4696][_0x70412e(0xf1)][_0x70412e(0x18c)]=null,logger['debug'](_0x70412e(0xaf)+_0x5b4696[_0x70412e(0xa0)](-0x8)),io['to'](getClient(_0x41231e['id'])[_0x70412e(0xad)])[_0x70412e(0x1d1)](_0x70412e(0x144),{'access':{'allow':![],'reason':_0x70412e(0xd1),'token':null}});}else logger[_0x70412e(0xac)](_0x70412e(0x101));});}function initializeSocketBot(_0x5796f6){const _0x32d825=_0x3a7aa2,_0x1e5bf6=getClient(_0x5796f6['id'])[_0x32d825(0x17d)],_0x28a8c9=getClient(_0x5796f6['id'])[_0x32d825(0xad)];_0x5796f6['on'](_0x32d825(0x10d),(_0x5edfdc,_0x279ed5)=>{const _0x5a17ac=_0x32d825;if(validateAccess(_0x279ed5,_0x28a8c9)[_0x5a17ac(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6][_0x5a17ac(0x184)]({'function':_0x5a17ac(0x1b3),'args':_0x5edfdc});}else logger[_0x5a17ac(0xac)](_0x5a17ac(0x18b));}),_0x5796f6['on'](_0x32d825(0x10b),(_0x2fd6b8,_0x32a8a6)=>{const _0x20e013=_0x32d825;if(validateAccess(_0x32a8a6,_0x28a8c9)[_0x20e013(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6]['send']({'function':_0x20e013(0xe0),'args':_0x2fd6b8});}else logger[_0x20e013(0xac)](_0x20e013(0x204));}),_0x5796f6['on'](_0x32d825(0x1f8),(_0x4c13a4,_0x538462)=>{const _0x1de78a=_0x32d825;if(validateAccess(_0x538462,_0x28a8c9)['allow']){if(pid[_0x1e5bf6])pid[_0x1e5bf6]['send']({'function':_0x1de78a(0xcd),'args':_0x4c13a4});}else logger[_0x1de78a(0xac)]('Unauthorized\x20attempt\x20to\x20get\x20portfolio');}),_0x5796f6['on']('store-configuration',(_0x5c7fe5,_0x581d1f)=>{const _0x31f569=_0x32d825;if(validateAccess(_0x581d1f,_0x28a8c9)[_0x31f569(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6][_0x31f569(0x184)]({'function':_0x31f569(0x1ae),'args':_0x5c7fe5});}else logger[_0x31f569(0xac)](_0x31f569(0x134));}),_0x5796f6['on'](_0x32d825(0xe2),(_0x445ab4,_0x3e22f3)=>{const _0x1f2ca7=_0x32d825;if(validateAccess(_0x3e22f3,_0x28a8c9)[_0x1f2ca7(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6]['send']({'function':_0x1f2ca7(0x18d),'args':_0x445ab4});}else logger[_0x1f2ca7(0xac)](_0x1f2ca7(0x19c));}),_0x5796f6['on'](_0x32d825(0x25b),(_0x21cf35,_0x1b045a)=>{const _0x2339c1=_0x32d825;if(validateAccess(_0x1b045a,_0x28a8c9)[_0x2339c1(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6]['send']({'function':'storeFiat','args':_0x21cf35});}else logger[_0x2339c1(0xac)](_0x2339c1(0x11c));}),_0x5796f6['on']('reset-history',_0x2f642f=>{const _0x3fad3c=_0x32d825;if(validateAccess(_0x2f642f,_0x28a8c9)[_0x3fad3c(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6][_0x3fad3c(0x184)]({'function':_0x3fad3c(0x29c),'args':null});}else logger[_0x3fad3c(0xac)](_0x3fad3c(0x122));}),_0x5796f6['on'](_0x32d825(0x1f6),_0x277dfe=>{const _0x10e170=_0x32d825;if(validateAccess(_0x277dfe,_0x28a8c9)[_0x10e170(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6][_0x10e170(0x184)]({'function':_0x10e170(0xa8),'args':null});}else logger[_0x10e170(0xac)]('Unauthorized\x20attempt\x20to\x20get\x20starting\x20balances');}),_0x5796f6['on'](_0x32d825(0x24c),(_0x68cc00,_0xc21c34)=>{const _0x3368f9=_0x32d825;if(validateAccess(_0xc21c34,_0x28a8c9)['allow']){if(pid[_0x1e5bf6])pid[_0x1e5bf6][_0x3368f9(0x184)]({'function':'placeOrder','args':_0x68cc00});}else logger['full'](_0x3368f9(0x1a4));}),_0x5796f6['on']('cancel-loading',_0x2e6bf2=>{const _0x35c8c1=_0x32d825;if(validateAccess(_0x2e6bf2,_0x28a8c9)[_0x35c8c1(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6][_0x35c8c1(0x184)]({'function':_0x35c8c1(0x247),'args':null});}else logger[_0x35c8c1(0xac)](_0x35c8c1(0x104));}),_0x5796f6['on'](_0x32d825(0x246),_0xdd2988=>{const _0x5c64e1=_0x32d825;if(validateAccess(_0xdd2988,_0x28a8c9)[_0x5c64e1(0x28a)]){if(pid[_0x1e5bf6])pid[_0x1e5bf6][_0x5c64e1(0x184)]({'function':_0x5c64e1(0x234),'args':null});}else logger[_0x5c64e1(0xac)](_0x5c64e1(0x11d));}),_0x5796f6['on'](_0x32d825(0x271),_0x107955=>{const _0x35ab92=_0x32d825;if(validateAccess(_0x107955,_0x28a8c9)[_0x35ab92(0x28a)])updateBB(_0x35ab92(0x278));else logger['full']('Unauthorized\x20attempt\x20to\x20update\x20Balance\x20Bot');}),_0x5796f6['on'](_0x32d825(0x19b),_0xb31420=>{const _0x39a362=_0x32d825;if(validateAccess(_0xb31420,_0x28a8c9)[_0x39a362(0x28a)])getMessages();else logger[_0x39a362(0xac)](_0x39a362(0x158));}),_0x5796f6['on'](_0x32d825(0x245),(_0x27887d,_0x1951bf)=>{const _0x191b5d=_0x32d825;if(validateAccess(_0x1951bf,_0x28a8c9)[_0x191b5d(0x28a)])confirmMessage(_0x27887d);else logger[_0x191b5d(0xac)](_0x191b5d(0xca));}),_0x5796f6['on'](_0x32d825(0x196),_0x54eee4=>{const _0x127397=_0x32d825;if(validateAccess(_0x54eee4,_0x28a8c9)['allow']){if(devices[_0x28a8c9][_0x127397(0x197)])clearTimeout(devices[_0x28a8c9][_0x127397(0x197)]);if(devices[_0x28a8c9]['pidExpireLogin'])clearTimeout(devices[_0x28a8c9]['pidExpireLogin']);removeSocketListeners(getClient(_0x5796f6['id'])[_0x127397(0xad)]),addBlacklist(_0x28a8c9),devices[_0x28a8c9][_0x127397(0x1ca)]=null,devices[_0x28a8c9][_0x127397(0x13b)]=null,devices[_0x28a8c9]['access'][_0x127397(0x18c)]=null,logger[_0x127397(0x102)](_0x127397(0xaf)+_0x28a8c9[_0x127397(0xa0)](-0x8)),io['to'](getClient(_0x5796f6['id'])[_0x127397(0xad)])['emit'](_0x127397(0x144),{'access':{'allow':![],'reason':_0x127397(0xd1),'token':null}});}else logger['full'](_0x127397(0x101));});}function removeSocketListeners(_0x5631f2){const _0x3a0349=_0x3a7aa2;getClientsWithUuid(_0x5631f2)[_0x3a0349(0x11f)](_0x3644cd=>{const _0x33d11e=_0x3a0349;getSocket(_0x3644cd['id'])[_0x33d11e(0x289)]();});}function cleanSettings(){const _0x4f1fbf=_0x3a7aa2;let _0x5d1fcd=settings;return settings[_0x4f1fbf(0x9c)]&&settings['telegramToken']!=''&&(_0x5d1fcd={..._0x5d1fcd,'telegramToken':_0x4f1fbf(0x1ab)}),settings[_0x4f1fbf(0x1ef)]&&settings[_0x4f1fbf(0x1ef)]!=''&&(_0x5d1fcd={..._0x5d1fcd,'bbPassword':_0x4f1fbf(0x1ab)}),(settings[_0x4f1fbf(0x1ef)]&&settings[_0x4f1fbf(0x1ef)]=='***'||settings[_0x4f1fbf(0x9c)]&&settings[_0x4f1fbf(0x9c)]==_0x4f1fbf(0x244))&&(_0x5d1fcd={..._0x5d1fcd,'restored':{'password':settings[_0x4f1fbf(0x1ef)]==_0x4f1fbf(0x244),'telegram':settings['telegramToken']=='***'}}),_0x5d1fcd;}async function updateBB(_0x9324d9){const _0x4238df=_0x3a7aa2;await backupConfigFiles(),installingUpdate=!![],config[_0x4238df(0x11f)](_0x20ad37=>{const _0x15f55a=_0x4238df;restartBot(_0x20ad37[_0x15f55a(0x16f)]);});if(_0x9324d9==_0x4238df(0x278))process[_0x4238df(0x184)]({'update':!![],'environment':environment},_0x55d27d=>{});else _0x9324d9==_0x4238df(0x1aa)&&process[_0x4238df(0x184)]({'reinstall':!![],'environment':environment},_0x4e89e3=>{});}function startBot(_0x48ee3e,_0x1ee116,_0x310c41){const _0x778539=_0x3a7aa2;if(debugging)_0x48ee3e[_0x778539(0xab)]('-d');let _0x3ceac9=![];const _0x2cb3da=_0x48ee3e[0x0];_0x1ee116={..._0x1ee116,'stdio':[_0x778539(0x15e),_0x778539(0x15e),_0x778539(0x15e),_0x778539(0x111)]},pid[_0x2cb3da]=childProcess[_0x778539(0x20a)](botfile,_0x48ee3e,_0x1ee116),pid[_0x2cb3da]['on'](_0x778539(0x1bf),_0x366468=>{const _0x4bd759=_0x778539;switch(Object['keys'](_0x366468)[0x0]){case _0x4bd759(0x257):updateBotName(_0x2cb3da,_0x366468[_0x4bd759(0x257)]);break;case'updatebotmanager':updateBotManager();break;case _0x4bd759(0x144):updateStatus(_0x2cb3da,_0x366468[_0x4bd759(0x144)]);break;case _0x4bd759(0x241):updateLive(_0x2cb3da,_0x366468[_0x4bd759(0x241)]);break;case _0x4bd759(0x19e):updateLive(_0x2cb3da,_0x366468['started']),io['to'](_0x2cb3da)['emit'](_0x4bd759(0x144),{'access':{'allow':![],'reason':_0x4bd759(0xeb),'token':null}});break;case _0x4bd759(0x254):_0x366468[_0x4bd759(0x254)]=='restart'&&restartBot(_0x2cb3da);_0x366468[_0x4bd759(0x254)]==_0x4bd759(0xfb)&&toggleBot(_0x2cb3da,'disabled',_0x4bd759(0x193));break;case _0x4bd759(0x1b6):sendTelegramBot(_0x2cb3da,_0x366468['telegram']);break;case _0x4bd759(0x269):sendTelegramMsg(_0x366468[_0x4bd759(0x269)]);break;case'function':io['to'](_0x2cb3da)[_0x4bd759(0x1d1)](_0x366468[_0x4bd759(0x229)],_0x366468[_0x4bd759(0x11e)]);break;}}),pid[_0x2cb3da]['on'](_0x778539(0xf5),function(_0x42a7cf){if(_0x3ceac9)return;_0x3ceac9=!![],_0x310c41(_0x42a7cf);}),pid[_0x2cb3da]['on'](_0x778539(0xfe),async function(_0xbec4c){const _0x310b35=_0x778539;if(terminating)return;if(installingUpdate){logger[_0x310b35(0x102)](_0x310b35(0xd3)),io[_0x310b35(0x121)]();return;}if(_0x3ceac9)return;_0x3ceac9=!![],_0x310c41(null);const _0x2d3815=dbConfig[_0x310b35(0x29e)](_0x310b35(0xb2))['find']({'botID':_0x2cb3da})[_0x310b35(0x24a)]();_0x2d3815&&(_0x2d3815[_0x310b35(0x144)]==_0x310b35(0x156)||_0x2d3815['status']==_0x310b35(0x177))&&(await sleep(0x3e8),updateLive(_0x2cb3da,_0x310b35(0x193)),logger[_0x310b35(0xac)]('Restarting\x20Bot\x20'+_0x2cb3da),startBot([_0x2cb3da,userID],{'cwd':bbpath},function(_0xe42804){const _0x1b2c6f=_0x310b35;if(_0xe42804)logger[_0x1b2c6f(0xac)](_0xe42804);}));});}function stopBot(_0x3e778f){const _0x3506ad=_0x3a7aa2;getClientsWithBotID(_0x3e778f)[_0x3506ad(0x11f)](_0x4f2ddf=>{getSocket(_0x4f2ddf['id'])['disconnect'](!![]),removeClient(_0x4f2ddf['id']);}),pid[_0x3e778f]&&(pid[_0x3e778f][_0x3506ad(0xfb)](),pid[_0x3e778f]=null);}function stopAllBots(){terminating=!![];const _0x2390fe=getEnabledBots();_0x2390fe['forEach'](_0x16a096=>{const _0x3242db=_0x3c16;stopBot(_0x16a096[_0x3242db(0x16f)]);});}function restartBot(_0x57d79c){if(pid[_0x57d79c])pid[_0x57d79c]['kill']();}function addBot(){const _0x4bd064=_0x3a7aa2;let _0x2fb757;for(let _0x497c2b=0x1;_0x497c2b<0x3e9;_0x497c2b++){_0x2fb757=_0x497c2b[_0x4bd064(0x233)]()[_0x4bd064(0x232)](0x3,'0');let _0x2974cd=config[_0x4bd064(0x15d)](_0x217699=>_0x217699[_0x4bd064(0x16f)]==_0x2fb757);if(!_0x2974cd)break;}if(_0x2fb757==='1000'){logger[_0x4bd064(0xac)]('The\x20maximum\x20of\x20999\x20bots\x20has\x20been\x20reached');return;}logger['full'](_0x4bd064(0x22a)+_0x2fb757),dbConfig[_0x4bd064(0x29e)](_0x4bd064(0xb2))['push']({'botID':_0x2fb757,'botname':_0x4bd064(0x1e6)+_0x2fb757,'status':_0x4bd064(0x177),'live':''})['write'](),startBot([_0x2fb757,userID],{'cwd':bbpath},function(_0x2c5d90){if(_0x2c5d90)logger['full'](_0x2c5d90);}),config=getConfiguration(),io['to'](_0x4bd064(0xb5))[_0x4bd064(0x1d1)](_0x4bd064(0xb2),config),broadcastToBots(_0x4bd064(0xb2),JSON[_0x4bd064(0x146)](config));}function deleteBot(_0x2ac60c){const _0x5c45b2=_0x3a7aa2;getClientsWithBotID(_0x2ac60c)[_0x5c45b2(0x11f)](_0x29f80c=>{getSocket(_0x29f80c['id'])['disconnect'](!![]),removeClient(_0x29f80c['id']);}),dbConfig['get'](_0x5c45b2(0xb2))[_0x5c45b2(0x1c7)]({'botID':_0x2ac60c})[_0x5c45b2(0x287)](),logger[_0x5c45b2(0xac)](_0x5c45b2(0xcb)+_0x2ac60c),stopBot(_0x2ac60c);try{if(fs[_0x5c45b2(0x1ba)](path[_0x5c45b2(0x160)](configpath,_0x5c45b2(0x113)+_0x2ac60c+_0x5c45b2(0x183))))fs['unlinkSync'](path['join'](configpath,_0x5c45b2(0x113)+_0x2ac60c+'-config.json'));if(fs[_0x5c45b2(0x1ba)](path[_0x5c45b2(0x160)](configpath,'bot-'+_0x2ac60c+_0x5c45b2(0x25f))))fs['unlinkSync'](path[_0x5c45b2(0x160)](configpath,_0x5c45b2(0x113)+_0x2ac60c+_0x5c45b2(0x25f)));if(fs['existsSync'](path[_0x5c45b2(0x160)](configpath,_0x5c45b2(0x113)+_0x2ac60c+_0x5c45b2(0x150))))fs['unlinkSync'](path['join'](configpath,_0x5c45b2(0x113)+_0x2ac60c+'-performance.json'));if(fs[_0x5c45b2(0x1ba)](path[_0x5c45b2(0x160)](configpath,'bot-'+_0x2ac60c+'-results.json')))fs[_0x5c45b2(0xd8)](path['join'](configpath,_0x5c45b2(0x113)+_0x2ac60c+_0x5c45b2(0x1c0)));}catch(_0x5b8df5){if(_0x5b8df5)logger[_0x5c45b2(0xac)](_0x5c45b2(0x181),_0x5b8df5);}config=getConfiguration(),io['to']('botmanager')['emit']('bots',config),broadcastToBots('bots',JSON[_0x5c45b2(0x146)](config));}function toggleBot(_0x40db62,_0x1be9e2,_0x588507){const _0xd6780b=_0x3a7aa2;dbConfig[_0xd6780b(0x29e)]('bots')[_0xd6780b(0x15d)]({'botID':_0x40db62})['assign']({'status':_0x1be9e2})[_0xd6780b(0x199)]({'live':_0x588507})[_0xd6780b(0x287)]();if(_0x1be9e2=='enabled'||_0x1be9e2==_0xd6780b(0x177))logger['full'](_0xd6780b(0xa1)+_0x40db62),startBot([_0x40db62,userID],{'cwd':bbpath},function(_0x307eba){if(_0x307eba)logger['full'](_0x307eba);});else(_0x1be9e2=='disabled'||_0x1be9e2==_0xd6780b(0x16b))&&(logger[_0xd6780b(0xac)](_0xd6780b(0x22c)+_0x40db62),stopBot(_0x40db62));config=getConfiguration(),io['to'](_0xd6780b(0xb5))[_0xd6780b(0x1d1)](_0xd6780b(0xb2),config),broadcastToBots(_0xd6780b(0xb2),JSON['stringify'](config));}function toggleStatus(_0x2ae8bd){const _0x189d23=_0x3a7aa2;let _0x387c2d=dbConfig[_0x189d23(0x29e)]('bots')[_0x189d23(0x15d)]({'botID':_0x2ae8bd})['value'](),_0x1977a1;if(_0x387c2d['status']===_0x189d23(0x156))_0x1977a1=_0x189d23(0xa4);else{if(_0x387c2d[_0x189d23(0x144)]===_0x189d23(0x177))_0x1977a1=_0x189d23(0x16b);else{if(_0x387c2d[_0x189d23(0x144)]===_0x189d23(0x16b))_0x1977a1=_0x189d23(0x177);else{if(_0x387c2d['status']===_0x189d23(0xa4))_0x1977a1='enabled';}}}return _0x1977a1;}function updateStatus(_0x6c3e6b,_0x596ac){const _0x50fdb9=_0x3a7aa2;dbConfig[_0x50fdb9(0x29e)](_0x50fdb9(0xb2))[_0x50fdb9(0x15d)]({'botID':_0x6c3e6b})[_0x50fdb9(0x199)]({'status':_0x596ac})['write'](),config=getConfiguration(),io['to']('botmanager')[_0x50fdb9(0x1d1)]('bots',config),broadcastToBots(_0x50fdb9(0xb2),JSON[_0x50fdb9(0x146)](config));}function updateLive(_0x30a320,_0x577909){const _0x5c28d6=_0x3a7aa2;dbConfig[_0x5c28d6(0x29e)](_0x5c28d6(0xb2))['find']({'botID':_0x30a320})[_0x5c28d6(0x199)]({'live':_0x577909})['write'](),config=getConfiguration(),io['to'](_0x5c28d6(0xb5))[_0x5c28d6(0x1d1)]('bots',config),broadcastToBots(_0x5c28d6(0xb2),JSON['stringify'](config));}function updateBotName(_0x454b86,_0x3e9819){const _0x5e75db=_0x3a7aa2;dbConfig[_0x5e75db(0x29e)](_0x5e75db(0xb2))[_0x5e75db(0x15d)]({'botID':_0x454b86})[_0x5e75db(0x199)]({'botname':_0x3e9819})[_0x5e75db(0x287)](),config=getConfiguration(),io['to']('botmanager')[_0x5e75db(0x1d1)](_0x5e75db(0xb2),config),broadcastToBots('bots',JSON[_0x5e75db(0x146)](config));}function updateBotManager(){const _0x5b39c3=_0x3a7aa2;config=getConfiguration(),io['to'](_0x5b39c3(0xb5))[_0x5b39c3(0x1d1)]('bots',config),broadcastToBots(_0x5b39c3(0xb2),JSON['stringify'](config));}function toggleBotMode(_0x1f4980){const _0x194a5a=_0x3a7aa2;if(pid[_0x1f4980])pid[_0x1f4980]['send']({'function':_0x194a5a(0x154),'args':null});else{const _0x2c2484=configpath+'bot-'+_0x1f4980+'-config.json',_0x1a893f=fs[_0x194a5a(0x214)](_0x2c2484),_0x3b1520=JSON['parse'](_0x1a893f),_0x529a75=_0x3b1520['bot'][0x0]['headless'];_0x3b1520[_0x194a5a(0x17d)][0x0][_0x194a5a(0x1cb)]=!_0x529a75;const _0x1beb95=JSON[_0x194a5a(0x146)](_0x3b1520,null,0x2);fs['writeFileSync'](_0x2c2484,_0x1beb95),config=getConfiguration(),io['to'](_0x194a5a(0xb5))[_0x194a5a(0x1d1)](_0x194a5a(0xb2),config),broadcastToBots(_0x194a5a(0xb2),JSON[_0x194a5a(0x146)](config));}}function validateTelegram(_0x506390){const _0x139460=_0x3a7aa2;if(_0x506390['from']['username']!=settings[_0x139460(0x21b)]&&'@'+_0x506390[_0x139460(0x28c)][_0x139460(0x1c1)]!=settings[_0x139460(0x21b)]||_0x506390[_0x139460(0x262)]['id']!=settings[_0x139460(0xe8)])return sendTelegram(_0x506390[_0x139460(0x262)]['id'],_0x139460(0x270),{'parse_mode':'HTML'}),![];return!![];}async function initTelegram(){const _0x4bfd99=_0x3a7aa2;if(tgBot)tgBot[_0x4bfd99(0x254)](),tgBot=null,initTelegram();else{tgBot=new Telegraf(settings[_0x4bfd99(0x9c)]);let _0xa34580=_0x4bfd99(0x1bc);_0xa34580+='\x0a',_0xa34580+=_0x4bfd99(0xb3),_0xa34580+=_0x4bfd99(0xd7),_0xa34580+='/config\x20-\x20notification\x20types\x20to\x20receive\x0a',_0xa34580+='/restart\x20-\x20restart\x20bot(s)\x0a',_0xa34580+=_0x4bfd99(0x1b0),_0xa34580+=_0x4bfd99(0x29a),_0xa34580+=_0x4bfd99(0x1a2),_0xa34580+=_0x4bfd99(0x256),_0xa34580+=_0x4bfd99(0xb1),_0xa34580+=_0x4bfd99(0x291),_0xa34580+=_0x4bfd99(0x1cf),_0xa34580+='/update\x20-\x20update\x20Balance\x20Bot\x0a',_0xa34580+='/reinstall\x20-\x20reinstall\x20Balance\x20Bot\x0a',_0xa34580+=_0x4bfd99(0x283);let _0x2bbd53=_0x4bfd99(0x17f);_0x2bbd53+='\x0a',_0x2bbd53+=_0xa34580,tgBot[_0x4bfd99(0x17a)]((_0x643bae,_0x3448f9)=>{const _0x5f051b=_0x4bfd99;logger[_0x5f051b(0x166)](getTimeStamp()+_0x5f051b(0x1df)),logger[_0x5f051b(0x102)](_0x5f051b(0x1d0),_0x643bae);}),tgBot[_0x4bfd99(0xee)](async(_0xe1f151,_0x2fff10)=>{const _0xf4e32b=_0x4bfd99;if(!(!settings[_0xf4e32b(0xe8)]&&_0xe1f151[_0xf4e32b(0x278)][_0xf4e32b(0x1bf)][_0xf4e32b(0xef)]==_0xf4e32b(0x137))){if(!validateTelegram(_0xe1f151))return;}_0x2fff10();}),tgBot[_0x4bfd99(0x188)](_0x4bfd99(0x261),async _0x2cc9b7=>{const _0x29bfb9=_0x4bfd99;if(!settings['telegramChatId'])updateSetting(_0x29bfb9(0xe8),_0x2cc9b7[_0x29bfb9(0x262)]['id']);updateSetting(_0x29bfb9(0x21e),!![]);if(!validateTelegram(_0x2cc9b7))return;await sendTelegram(_0x2cc9b7[_0x29bfb9(0x262)]['id'],_0x2bbd53);}),tgBot[_0x4bfd99(0x188)]('enable',async _0x427a4a=>{const _0xbd9b57=_0x4bfd99;updateSetting(_0xbd9b57(0x21e),!![]),await sendTelegram(_0x427a4a[_0xbd9b57(0x262)]['id'],_0xbd9b57(0xb7));}),tgBot[_0x4bfd99(0x188)](_0x4bfd99(0x27f),async _0x4f6244=>{const _0x14caf2=_0x4bfd99;await sendTelegram(_0x4f6244[_0x14caf2(0x262)]['id'],_0x14caf2(0x135)),updateSetting(_0x14caf2(0x21e),![]);}),tgBot[_0x4bfd99(0x188)]('config',async _0x526cbe=>{const _0x3c73d1=_0x4bfd99,_0x56e2e7=Markup['inlineKeyboard']([Markup[_0x3c73d1(0x219)]['callback'](_0x3c73d1(0x25a),_0x3c73d1(0x25d)),Markup[_0x3c73d1(0x219)]['callback'](_0x3c73d1(0xba),_0x3c73d1(0xe3)),Markup[_0x3c73d1(0x219)][_0x3c73d1(0x142)](_0x3c73d1(0x272),_0x3c73d1(0x15a))]);_0x526cbe[_0x3c73d1(0x252)](_0x3c73d1(0x200),_0x56e2e7);}),tgBot['action'](_0x4bfd99(0x25d),async _0xefd95d=>{const _0x3f7f00=_0x4bfd99;_0xefd95d[_0x3f7f00(0x222)](),updateSetting(_0x3f7f00(0x19d),'orders'),updateSetting('telegramEnabled',!![]),await sendTelegram(_0xefd95d[_0x3f7f00(0x262)]['id'],_0x3f7f00(0x276));}),tgBot[_0x4bfd99(0x299)](_0x4bfd99(0xe3),async _0x1adfc9=>{const _0x2ad8f6=_0x4bfd99;_0x1adfc9[_0x2ad8f6(0x222)](),updateSetting(_0x2ad8f6(0x19d),_0x2ad8f6(0x14a)),updateSetting(_0x2ad8f6(0x21e),!![]),await sendTelegram(_0x1adfc9[_0x2ad8f6(0x262)]['id'],_0x2ad8f6(0x176));}),tgBot[_0x4bfd99(0x299)](_0x4bfd99(0x15a),async _0x4666b8=>{const _0x1fc85a=_0x4bfd99;_0x4666b8['editMessageReplyMarkup'](),updateSetting(_0x1fc85a(0x19d),_0x1fc85a(0x14b)),updateSetting(_0x1fc85a(0x21e),!![]),await sendTelegram(_0x4666b8['chat']['id'],'Ok,\x20will\x20send\x20both\x20order\x20and\x20alert\x20notifications');}),tgBot[_0x4bfd99(0x188)](_0x4bfd99(0x144),async _0xd1c917=>{const _0xe88084=_0x4bfd99,_0x1f24a4=getBotsWithMode();let _0x21f4a1=_0xe88084(0x27e);config['forEach'](_0x1cad3c=>{const _0x5a8b9c=_0xe88084,_0x59abf6=_0x1f24a4['find'](_0x5057c2=>_0x5057c2[_0x5a8b9c(0x16f)]==_0x1cad3c[_0x5a8b9c(0x16f)])[_0x5a8b9c(0xdd)];_0x21f4a1+=_0x5a8b9c(0x1e6)+_0x1cad3c[_0x5a8b9c(0x16f)]+':\x20'+_0x1cad3c[_0x5a8b9c(0x144)]+_0x5a8b9c(0x18e)+_0x59abf6+_0x5a8b9c(0x18e)+_0x1cad3c[_0x5a8b9c(0x241)]+'\x0a';}),_0x21f4a1+='\x0a',_0x21f4a1+='<b>Telegram\x20Bot\x20Status:</b>\x0a',_0x21f4a1+=!settings['telegramEnabled']?_0xe88084(0x138):'Notifications\x20enabled\x0a',_0x21f4a1+=settings[_0xe88084(0x21e)]?settings[_0xe88084(0x19d)]==_0xe88084(0x14b)?_0xe88084(0x15b):'Notifications\x20types:\x20'+settings['telegramEvents']+_0xe88084(0xbd):'',await sendTelegram(_0xd1c917['chat']['id'],_0x21f4a1,{'parse_mode':_0xe88084(0x1d7)});}),tgBot[_0x4bfd99(0x188)]('restart',async _0x364cf3=>{const _0xf14567=_0x4bfd99,_0x2b9d5c=getEnabledBots();if(_0x2b9d5c[_0xf14567(0x201)]==0x0)await sendTelegram(_0x364cf3[_0xf14567(0x262)]['id'],_0xf14567(0x174));else{if(_0x2b9d5c[_0xf14567(0x201)]>0x1)_0x2b9d5c[_0xf14567(0xab)]({'botID':_0xf14567(0x14b)});let _0x22d490=[],_0x404d79=[];const _0x4386f9=_0x2b9d5c[_0xf14567(0x201)]%0x4==0x0||_0x2b9d5c['length']%0x4==0x3||_0x2b9d5c[_0xf14567(0x201)]%0x3==0x1?0x4:0x3;let _0xd0f249=0x0;_0x2b9d5c[_0xf14567(0x11f)]((_0x5c04fd,_0x1d320e)=>{const _0x15c480=_0xf14567;if(_0x1d320e%_0x4386f9==0x0)_0x404d79=[];_0x404d79[_0x15c480(0xab)](Markup[_0x15c480(0x219)][_0x15c480(0x142)](_0x5c04fd[_0x15c480(0x16f)]==_0x15c480(0x14b)?_0x15c480(0xf0):'Bot\x20'+_0x5c04fd['botID'],'restart_'+_0x5c04fd[_0x15c480(0x16f)])),_0x1d320e%_0x4386f9==0x0&&(_0x22d490[_0xd0f249]=_0x404d79,_0xd0f249++);});const _0x412637=Markup[_0xf14567(0x185)](_0x22d490);_0x364cf3[_0xf14567(0x252)](_0xf14567(0x145),_0x412637);}}),tgBot[_0x4bfd99(0x299)](/restart_(.+)/,async _0x50409a=>{const _0x2c0507=_0x4bfd99,_0x31f127=_0x50409a[_0x2c0507(0xf4)][0x1];_0x50409a['editMessageReplyMarkup'](),_0x31f127==_0x2c0507(0x14b)?config[_0x2c0507(0x11f)](_0x38c4f1=>{restartBot(_0x38c4f1['botID']);}):restartBot(_0x31f127);}),tgBot[_0x4bfd99(0x188)]('on',async _0x1c91df=>{const _0x4a42d6=_0x4bfd99,_0x537085=getDisabledBots();if(_0x537085[_0x4a42d6(0x201)]==0x0)await sendTelegram(_0x1c91df[_0x4a42d6(0x262)]['id'],_0x4a42d6(0xdb));else{if(_0x537085[_0x4a42d6(0x201)]>0x1)_0x537085['push']({'botID':'all'});let _0x4efeb0=[],_0x54a67c=[];const _0x31910a=_0x537085[_0x4a42d6(0x201)]%0x4==0x0||_0x537085[_0x4a42d6(0x201)]%0x4==0x3||_0x537085[_0x4a42d6(0x201)]%0x3==0x1?0x4:0x3;let _0x3df3d0=0x0;_0x537085['forEach']((_0x4c62da,_0x285457)=>{const _0x2909e3=_0x4a42d6;if(_0x285457%_0x31910a==0x0)_0x54a67c=[];_0x54a67c['push'](Markup[_0x2909e3(0x219)]['callback'](_0x4c62da[_0x2909e3(0x16f)]==_0x2909e3(0x14b)?'All\x20bots':_0x2909e3(0x1e6)+_0x4c62da[_0x2909e3(0x16f)],'on_'+_0x4c62da[_0x2909e3(0x16f)])),_0x285457%_0x31910a==0x0&&(_0x4efeb0[_0x3df3d0]=_0x54a67c,_0x3df3d0++);});const _0x399bc0=Markup[_0x4a42d6(0x185)](_0x4efeb0);_0x1c91df[_0x4a42d6(0x252)](_0x4a42d6(0x21a),_0x399bc0);}}),tgBot[_0x4bfd99(0x299)](/on_(.+)/,async _0x122a13=>{const _0x36e851=_0x4bfd99,_0x1c907f=_0x122a13[_0x36e851(0xf4)][0x1];_0x122a13[_0x36e851(0x222)]();if(_0x1c907f=='all'){const _0x3894e4=getDisabledBots();await sendTelegram(_0x122a13['chat']['id'],_0x36e851(0x255)),_0x3894e4[_0x36e851(0x11f)](_0x10523a=>{const _0x212c65=_0x36e851;if(_0x10523a[_0x212c65(0x16f)]!=_0x212c65(0x14b))toggleBot(_0x10523a['botID'],toggleStatus(_0x10523a[_0x212c65(0x16f)]),_0x212c65(0x193));});}else await sendTelegram(_0x122a13[_0x36e851(0x262)]['id'],_0x36e851(0x22e)+_0x1c907f),toggleBot(_0x1c907f,toggleStatus(_0x1c907f),_0x36e851(0x193));}),tgBot['command'](_0x4bfd99(0x1f5),async _0x54328e=>{const _0x2941dc=_0x4bfd99,_0x1fd7a6=getEnabledBots();if(_0x1fd7a6[_0x2941dc(0x201)]==0x0)await sendTelegram(_0x54328e[_0x2941dc(0x262)]['id'],_0x2941dc(0x174));else{if(_0x1fd7a6[_0x2941dc(0x201)]>0x1)_0x1fd7a6[_0x2941dc(0xab)]({'botID':_0x2941dc(0x14b)});let _0x21c40f=[],_0x21a7b5=[];const _0x3c1d0b=_0x1fd7a6[_0x2941dc(0x201)]%0x4==0x0||_0x1fd7a6[_0x2941dc(0x201)]%0x4==0x3||_0x1fd7a6[_0x2941dc(0x201)]%0x3==0x1?0x4:0x3;let _0x434ba9=0x0;_0x1fd7a6[_0x2941dc(0x11f)]((_0x2ccde3,_0x139108)=>{const _0x57de8a=_0x2941dc;if(_0x139108%_0x3c1d0b==0x0)_0x21a7b5=[];_0x21a7b5[_0x57de8a(0xab)](Markup['button'][_0x57de8a(0x142)](_0x2ccde3[_0x57de8a(0x16f)]==_0x57de8a(0x14b)?_0x57de8a(0xf0):_0x57de8a(0x1e6)+_0x2ccde3['botID'],'off_'+_0x2ccde3[_0x57de8a(0x16f)])),_0x139108%_0x3c1d0b==0x0&&(_0x21c40f[_0x434ba9]=_0x21a7b5,_0x434ba9++);});const _0xcc4aec=Markup['inlineKeyboard'](_0x21c40f);_0x54328e[_0x2941dc(0x252)](_0x2941dc(0xf2),_0xcc4aec);}}),tgBot[_0x4bfd99(0x299)](/off_(.+)/,async _0x3209f5=>{const _0x5aeeed=_0x4bfd99,_0x14bbab=_0x3209f5['match'][0x1];_0x3209f5[_0x5aeeed(0x222)]();if(_0x14bbab==_0x5aeeed(0x14b)){const _0x1292ca=getEnabledBots();await sendTelegram(_0x3209f5[_0x5aeeed(0x262)]['id'],_0x5aeeed(0x253)),_0x1292ca[_0x5aeeed(0x11f)](_0xedee18=>{const _0xf3cea6=_0x5aeeed;if(_0xedee18[_0xf3cea6(0x16f)]!='all')toggleBot(_0xedee18['botID'],toggleStatus(_0xedee18[_0xf3cea6(0x16f)]),_0xf3cea6(0x193));});}else await sendTelegram(_0x3209f5[_0x5aeeed(0x262)]['id'],_0x5aeeed(0x297)+_0x14bbab),toggleBot(_0x14bbab,toggleStatus(_0x14bbab),_0x5aeeed(0x193));}),tgBot[_0x4bfd99(0x188)](_0x4bfd99(0xa3),async _0x2eee00=>{const _0x23bf70=_0x4bfd99,_0x4e3d64=getEnabledBots();if(_0x4e3d64[_0x23bf70(0x201)]==0x0)await sendTelegram(_0x2eee00['chat']['id'],_0x23bf70(0x174));else{if(_0x4e3d64[_0x23bf70(0x201)]>0x1){let _0x2a33fa=[],_0x406aa8=[];const _0x4cc071=_0x4e3d64['length']%0x4==0x0||_0x4e3d64['length']%0x4==0x3||_0x4e3d64['length']%0x3==0x1?0x4:0x3;let _0x2bdfc2=0x0;_0x4e3d64['forEach']((_0xd0eea6,_0x4ea95f)=>{const _0x1e5bc5=_0x23bf70;if(_0x4ea95f%_0x4cc071==0x0)_0x406aa8=[];_0x406aa8[_0x1e5bc5(0xab)](Markup['button'][_0x1e5bc5(0x142)](_0x1e5bc5(0x1e6)+_0xd0eea6[_0x1e5bc5(0x16f)],_0x1e5bc5(0x263)+_0xd0eea6[_0x1e5bc5(0x16f)])),_0x4ea95f%_0x4cc071==0x0&&(_0x2a33fa[_0x2bdfc2]=_0x406aa8,_0x2bdfc2++);});const _0x2d2462=Markup[_0x23bf70(0x185)](_0x2a33fa);_0x2eee00[_0x23bf70(0x252)](_0x23bf70(0x13e),_0x2d2462);}else{const _0x2a9d58=_0x4e3d64[0x0][_0x23bf70(0x16f)];if(pid[_0x2a9d58])pid[_0x2a9d58]['send']({'function':_0x23bf70(0x23e),'args':null});}}}),tgBot['action'](/metrics_(.+)/,async _0x43b5e6=>{const _0x3fcdc6=_0x4bfd99,_0x53e3b1=_0x43b5e6[_0x3fcdc6(0xf4)][0x1];_0x43b5e6['editMessageReplyMarkup']();if(pid[_0x53e3b1])pid[_0x53e3b1][_0x3fcdc6(0x184)]({'function':_0x3fcdc6(0x23e),'args':null});}),tgBot['command'](_0x4bfd99(0x216),async _0x1605ec=>{const _0x3a1c39=_0x4bfd99,_0x201b8d=getEnabledBots();if(_0x201b8d[_0x3a1c39(0x201)]==0x0)await sendTelegram(_0x1605ec[_0x3a1c39(0x262)]['id'],_0x3a1c39(0x174));else{if(_0x201b8d[_0x3a1c39(0x201)]>0x1){let _0x2307df=[],_0x218d70=[];const _0x402393=_0x201b8d[_0x3a1c39(0x201)]%0x4==0x0||_0x201b8d[_0x3a1c39(0x201)]%0x4==0x3||_0x201b8d['length']%0x3==0x1?0x4:0x3;let _0x1b77d6=0x0;_0x201b8d[_0x3a1c39(0x11f)]((_0x2d24d5,_0x369731)=>{const _0x51011a=_0x3a1c39;if(_0x369731%_0x402393==0x0)_0x218d70=[];_0x218d70[_0x51011a(0xab)](Markup['button'][_0x51011a(0x142)]('Bot\x20'+_0x2d24d5[_0x51011a(0x16f)],_0x51011a(0x1c9)+_0x2d24d5['botID'])),_0x369731%_0x402393==0x0&&(_0x2307df[_0x1b77d6]=_0x218d70,_0x1b77d6++);});const _0x1afd5d=Markup[_0x3a1c39(0x185)](_0x2307df);_0x1605ec[_0x3a1c39(0x252)](_0x3a1c39(0xa7),_0x1afd5d);}else{const _0x21f990=_0x201b8d[0x0][_0x3a1c39(0x16f)];if(pid[_0x21f990])pid[_0x21f990]['send']({'function':_0x3a1c39(0x23a),'args':null});}}}),tgBot[_0x4bfd99(0x299)](/portfolio_(.+)/,async _0x28b5ad=>{const _0x2ac41d=_0x4bfd99,_0x3d8aff=_0x28b5ad[_0x2ac41d(0xf4)][0x1];_0x28b5ad[_0x2ac41d(0x222)]();if(pid[_0x3d8aff])pid[_0x3d8aff][_0x2ac41d(0x184)]({'function':_0x2ac41d(0x23a),'args':null});}),tgBot[_0x4bfd99(0x188)](_0x4bfd99(0x278),async _0x295525=>{const _0x406f9e=_0x4bfd99;await getMessages();if(!updateAvailable)await sendTelegram(_0x295525['chat']['id'],_0x406f9e(0x167));else{if(!validInstallation)await sendTelegram(_0x295525['chat']['id'],_0x406f9e(0x288));else{const _0x1639a2=Markup[_0x406f9e(0x185)]([Markup[_0x406f9e(0x219)]['callback'](_0x406f9e(0x1ee),_0x406f9e(0x203)),Markup[_0x406f9e(0x219)]['callback']('No',_0x406f9e(0xc8))]);_0x295525[_0x406f9e(0x252)]('Are\x20you\x20sure\x20you\x20want\x20to\x20update\x20Balance\x20Bot\x20now?',_0x1639a2);}}}),tgBot['action'](/update_(.+)/,async _0x1d60cd=>{const _0x40dc6d=_0x4bfd99,_0x386526=_0x1d60cd[_0x40dc6d(0xf4)][0x1];_0x1d60cd[_0x40dc6d(0x222)](),_0x386526==_0x40dc6d(0x100)&&(await sendTelegram(_0x1d60cd['chat']['id'],_0x40dc6d(0x191)),updateBB(_0x40dc6d(0x278))),_0x386526=='no'&&await sendTelegram(_0x1d60cd[_0x40dc6d(0x262)]['id'],_0x40dc6d(0xda));}),tgBot[_0x4bfd99(0x188)](_0x4bfd99(0x1aa),async _0xf6a0bc=>{const _0xc52e6=_0x4bfd99;if(!validInstallation)await sendTelegram(_0xf6a0bc[_0xc52e6(0x262)]['id'],_0xc52e6(0x172));else{const _0x41752e=Markup[_0xc52e6(0x185)]([Markup[_0xc52e6(0x219)][_0xc52e6(0x142)]('Yes',_0xc52e6(0x128)),Markup[_0xc52e6(0x219)][_0xc52e6(0x142)]('No','reinstall_no')]);_0xf6a0bc[_0xc52e6(0x252)](_0xc52e6(0x224),_0x41752e);}}),tgBot[_0x4bfd99(0x299)](/reinstall_(.+)/,async _0x19c817=>{const _0x46d2b9=_0x4bfd99,_0x1a11dd=_0x19c817[_0x46d2b9(0xf4)][0x1];_0x19c817['editMessageReplyMarkup'](),_0x1a11dd=='yes'&&(await sendTelegram(_0x19c817[_0x46d2b9(0x262)]['id'],_0x46d2b9(0x1b9)),updateBB('reinstall')),_0x1a11dd=='no'&&await sendTelegram(_0x19c817[_0x46d2b9(0x262)]['id'],'Ok,\x20reinstalling\x20Balance\x20Bot\x20canceled');}),tgBot['command'](_0x4bfd99(0x12d),async _0x4c8f32=>{const _0x92c95=_0x4bfd99,_0x1b6db9=getBotsWithMode();if(_0x1b6db9[_0x92c95(0x201)]==0x0)await sendTelegram(_0x4c8f32[_0x92c95(0x262)]['id'],_0x92c95(0x174));else{let _0x2189d8=[],_0x4235c7=[];const _0x38757f=0x2;let _0x4be0ac=0x0;_0x1b6db9['forEach']((_0x4b116b,_0x1efe11)=>{const _0x3dbb7a=_0x92c95;if(_0x1efe11%_0x38757f==0x0)_0x4235c7=[];_0x4235c7['push'](Markup[_0x3dbb7a(0x219)][_0x3dbb7a(0x142)](_0x3dbb7a(0x1e6)+_0x4b116b[_0x3dbb7a(0x16f)]+'\x20('+_0x4b116b['mode']+')','toggle_'+_0x4b116b[_0x3dbb7a(0x16f)])),_0x1efe11%_0x38757f==0x0&&(_0x2189d8[_0x4be0ac]=_0x4235c7,_0x4be0ac++);});const _0xd863d1=Markup[_0x92c95(0x185)](_0x2189d8);_0x4c8f32[_0x92c95(0x252)](_0x92c95(0x17e),_0xd863d1);}}),tgBot['action'](/toggle_(.+)/,async _0x10f23e=>{const _0x5c39c1=_0x4bfd99,_0x31abe3=_0x10f23e[_0x5c39c1(0xf4)][0x1];_0x10f23e['editMessageReplyMarkup']();const _0xae5aab=getBotsWithMode(),_0x485e1b=_0xae5aab[_0x5c39c1(0x15d)](_0x484d2e=>_0x484d2e[_0x5c39c1(0x16f)]==_0x31abe3),_0x2d1045=_0x485e1b['mode']==_0x5c39c1(0x1a8)?_0x5c39c1(0x119):_0x5c39c1(0x1a8);await sendTelegram(_0x10f23e[_0x5c39c1(0x262)]['id'],_0x5c39c1(0x120)+_0x31abe3+_0x5c39c1(0x10f)+_0x2d1045+_0x5c39c1(0x125)),toggleBotMode(_0x31abe3);}),tgBot[_0x4bfd99(0x188)](_0x4bfd99(0x127),async _0x1406be=>{const _0x28eea9=_0x4bfd99;let _0x499fe6='';config[_0x28eea9(0x11f)](_0x2572c8=>{const _0x115310=_0x28eea9;_0x499fe6+=_0x115310(0x1e6)+_0x2572c8[_0x115310(0x16f)]+':\x20'+_0x2572c8[_0x115310(0x257)]+'\x0a';}),await sendTelegram(_0x1406be[_0x28eea9(0x262)]['id'],_0x499fe6,{'parse_mode':_0x28eea9(0x1d7)});}),tgBot[_0x4bfd99(0x188)](_0x4bfd99(0x1ed),async _0x3e78c2=>{await sendTelegram(_0x3e78c2['chat']['id'],_0xa34580);}),process[_0x4bfd99(0xcf)](_0x4bfd99(0x195),()=>tgBot[_0x4bfd99(0x254)](_0x4bfd99(0x195))),process[_0x4bfd99(0xcf)]('SIGTERM',()=>tgBot['stop'](_0x4bfd99(0xc7))),tgBot['launch']();}}function disableTelegram(){const _0x191ab2=_0x3a7aa2;tgBot&&tgBot[_0x191ab2(0x254)]();}async function sendTelegram(_0xc2074e,_0x3ba4f1,_0x52235a){const _0x1ac2f4=_0x3a7aa2;try{await tgBot[_0x1ac2f4(0x1b6)][_0x1ac2f4(0x220)](_0xc2074e,_0x3ba4f1,_0x52235a);}catch(_0x129918){console[_0x1ac2f4(0x22f)](_0x1ac2f4(0x133),_0x129918);}}async function sendTelegramBot(_0x89f2ca,_0x528144){const _0x56c386=_0x3a7aa2;if(settings[_0x56c386(0x21e)]){if(settings[_0x56c386(0x19d)]==_0x56c386(0x14b)||(_0x528144[_0x56c386(0x115)]=='error'||_0x528144[_0x56c386(0x115)]==_0x56c386(0x26a)||_0x528144[_0x56c386(0x115)]==_0x56c386(0x14c))&&settings[_0x56c386(0x19d)]==_0x56c386(0x14a)||_0x528144[_0x56c386(0x115)]=='order'&&settings[_0x56c386(0x19d)]==_0x56c386(0x1c5)){if(tgBot&&settings[_0x56c386(0xe8)]){if(_0x528144[_0x56c386(0xfd)])await sendTelegram(settings['telegramChatId'],_0x528144[_0x56c386(0x257)]+'\x20>\x20'+_0x528144[_0x56c386(0x1e7)]);else await sendTelegram(settings[_0x56c386(0xe8)],_0x56c386(0x1e6)+_0x89f2ca+_0x56c386(0xe7)+_0x528144[_0x56c386(0x1e7)]);}}}}async function sendTelegramMsg(_0x293fa7,_0x12a5cf='HTML'){const _0xce5e67=_0x3a7aa2;return settings[_0xce5e67(0x21e)]&&tgBot&&settings[_0xce5e67(0xe8)]?(await sendTelegram(settings[_0xce5e67(0xe8)],_0x293fa7,{'parse_mode':_0x12a5cf}),!![]):![];}function getDeviceWithIp(_0x4c7b6b){const _0x581a03=_0x3a7aa2;return devices[_0x581a03(0x15d)](_0x534d22=>_0x534d22['ip']===_0x4c7b6b);}async function temporaryAccess2FA(_0x3a3d53,_0x38a84a){const _0x295c7e=_0x3a7aa2;let _0x2aec1d=new Date(),_0x1b0966=![];if(lastIpApproval){if(_0x2aec1d-lastIpApproval<0x1388)_0x1b0966=!![];}lastIpApproval=new Date();if(_0x1b0966)return;if(tgBot&&settings[_0x295c7e(0xe8)]){const _0x3cd17c=uuidRandom();tmpStorage[_0x3cd17c]={'uuid':_0x3a3d53,'externalip':_0x38a84a};const _0x5ab05a=Markup[_0x295c7e(0x185)]([Markup[_0x295c7e(0x219)]['callback'](_0x295c7e(0x198),_0x295c7e(0xb9)+_0x3cd17c),Markup[_0x295c7e(0x219)]['callback'](_0x295c7e(0x265),_0x295c7e(0xae)+_0x3cd17c),Markup[_0x295c7e(0x219)][_0x295c7e(0x142)]('30\x20min','tempaccess_30_'+_0x3cd17c),Markup[_0x295c7e(0x219)]['callback'](_0x295c7e(0x20c),_0x295c7e(0x227)+_0x3cd17c)]);await sendTelegram(settings[_0x295c7e(0xe8)],_0x295c7e(0x209)+normalizeIP(_0x38a84a)[_0x295c7e(0x107)]+'\x20?',_0x5ab05a),tgBot['action'](/tempaccess_(.+)_(.+)/,async _0x2f13f2=>{const _0x5a3f18=_0x295c7e,_0x3f72c1=_0x2f13f2[_0x5a3f18(0xf4)][0x1],_0x8c4447=_0x2f13f2[_0x5a3f18(0xf4)][0x2],{uuid:_0x40c8ba,externalip:_0x542fdd}=tmpStorage[_0x8c4447];delete tmpStorage[_0x8c4447],_0x2f13f2[_0x5a3f18(0x222)](),devices[_0x40c8ba][_0x5a3f18(0x1ca)]={'clientip':_0x542fdd,'timestamp':new Date()['getTime'](),'expiry':_0x3f72c1},_0x3f72c1!='reject'?(await sendTelegram(_0x2f13f2[_0x5a3f18(0x262)]['id'],'Access\x20enabled\x20for\x20'+_0x3f72c1+'\x20minutes',{'parse_mode':_0x5a3f18(0x1d7)}),io['to'](_0x40c8ba)[_0x5a3f18(0x1d1)](_0x5a3f18(0x144),{'access':{'allow':![],'reason':_0x5a3f18(0xeb),'token':null}})):(await sendTelegram(_0x2f13f2['chat']['id'],'Temporary\x20access\x20rejected'),io['to'](_0x40c8ba)[_0x5a3f18(0x1d1)](_0x5a3f18(0x144),{'access':{'allow':![],'reason':_0x5a3f18(0x109),'token':null}}));});}}async function loginAccess2FA(_0x54d0fd,_0x165d8b){const _0x203463=_0x3a7aa2;if(tgBot&&settings[_0x203463(0xe8)]){const _0x19f01c=uuidRandom();tmpStorage[_0x19f01c]={'uuid':_0x54d0fd,'externalip':_0x165d8b};const _0x25fcf1=Markup[_0x203463(0x185)]([Markup[_0x203463(0x219)]['callback']('accept',_0x203463(0x16c)+loginExpiry+'_'+_0x19f01c),Markup[_0x203463(0x219)][_0x203463(0x142)](_0x203463(0x20c),_0x203463(0x1ff)+_0x19f01c)]);await sendTelegram(settings[_0x203463(0xe8)],_0x203463(0x237)+normalizeIP(_0x165d8b)[_0x203463(0x107)]+'\x20?',_0x25fcf1),tgBot[_0x203463(0x299)](/login2fa_(.+)_(.+)/,async _0x910194=>{const _0x12bf5c=_0x203463,_0x343b12=_0x910194[_0x12bf5c(0xf4)][0x1],_0x22e95a=_0x910194[_0x12bf5c(0xf4)][0x2],{uuid:_0x40f1ae,externalip:_0x6e2f82}=tmpStorage[_0x22e95a];delete tmpStorage[_0x22e95a],_0x910194['editMessageReplyMarkup'](),devices[_0x40f1ae][_0x12bf5c(0x13b)]={'clientip':_0x6e2f82,'timestamp':new Date()[_0x12bf5c(0x1b2)](),'expiry':_0x343b12},_0x343b12!=_0x12bf5c(0x20c)?(await sendTelegram(_0x910194[_0x12bf5c(0x262)]['id'],'Login\x20accepted',{'parse_mode':'HTML'}),io['to'](_0x40f1ae)['emit']('status',{'access':{'allow':![],'reason':_0x12bf5c(0xeb),'token':null}})):(await sendTelegram(_0x910194['chat']['id'],'Login\x20rejected'),io['to'](_0x40f1ae)['emit'](_0x12bf5c(0x144),{'access':{'allow':![],'reason':_0x12bf5c(0x1f3),'token':null}}));});}}function getConfiguration(){return getBotsWithMode();}function getEnabledBots(){const _0xbe3e3c=_0x3a7aa2;return dbConfig[_0xbe3e3c(0x29e)](_0xbe3e3c(0xb2))[_0xbe3e3c(0x242)](_0xbe3e3c(0x16f))[_0xbe3e3c(0x12c)]({'status':'enabled'})['value']()||[];}function getDisabledBots(){const _0x35d3d3=_0x3a7aa2;return dbConfig[_0x35d3d3(0x29e)](_0x35d3d3(0xb2))['sortBy']('botID')['filter']({'status':_0x35d3d3(0xa4)})[_0x35d3d3(0x24a)]()||[];}function getBotAttributes(_0xc44f45){const _0x21689d=_0x3a7aa2;let _0x56bff2={};const _0x2fe0bc=configpath+'bot-'+_0xc44f45+'-config.json',_0x50b699=fs['existsSync'](_0x2fe0bc);if(_0x50b699){const _0x487ac8=fs[_0x21689d(0x214)](_0x2fe0bc);try{const _0x45626f=JSON[_0x21689d(0x25e)](_0x487ac8),_0x5bbce5=_0x45626f?_0x45626f['bot'][0x0][_0x21689d(0x1cb)]:![];_0x56bff2['mode']=_0x5bbce5?_0x21689d(0x1a8):_0x21689d(0x119),_0x56bff2[_0x21689d(0x257)]=_0x45626f?_0x45626f['bot'][0x0][_0x21689d(0x257)]:'Bot\x20'+_0xc44f45;}catch(_0x54f88a){_0x56bff2['mode']='manual',_0x56bff2[_0x21689d(0x257)]='Bot\x20'+_0xc44f45;}}else _0x56bff2['mode']='manual',_0x56bff2[_0x21689d(0x257)]='Bot\x20'+_0xc44f45;return _0x56bff2;}function getBotsWithMode(){const _0x35bba=_0x3a7aa2,_0x1cbec4=dbConfig[_0x35bba(0x29e)](_0x35bba(0xb2))['sortBy']('botID')['value']()||[];return _0x1cbec4[_0x35bba(0x11f)](_0x51533b=>{const _0x48ea4a=_0x35bba;let _0x448fad=getBotAttributes(_0x51533b[_0x48ea4a(0x16f)]);_0x51533b['mode']=_0x448fad[_0x48ea4a(0xdd)];}),_0x1cbec4;}function getBotExchanges(){const _0xa013d2=_0x3a7aa2;let _0x24b340=[];const _0x30a0bc=dbConfig[_0xa013d2(0x29e)](_0xa013d2(0xb2))[_0xa013d2(0x242)](_0xa013d2(0x16f))['value']()||[];_0x30a0bc[_0xa013d2(0x11f)](_0x33ee43=>{const _0x24ad91=_0xa013d2;if(_0x33ee43[_0x24ad91(0x144)]==_0x24ad91(0x156)){const _0xaaf3da=configpath+_0x24ad91(0x113)+_0x33ee43[_0x24ad91(0x16f)]+_0x24ad91(0x183),_0x328519=fs[_0x24ad91(0x1ba)](_0xaaf3da);let _0x57f0f5;if(_0x328519){const _0x424513=fs[_0x24ad91(0x214)](_0xaaf3da);try{const _0x35e5d2=JSON[_0x24ad91(0x25e)](_0x424513);_0x57f0f5=_0x35e5d2?_0x35e5d2[_0x24ad91(0x17d)][0x0]['exchange']:null;}catch(_0x1fe83d){}}if(_0x57f0f5)_0x24b340['push'](_0x57f0f5);}});const _0x3ed817=[...new Set(_0x24b340)][_0xa013d2(0x26e)]();return _0x3ed817;}async function initUser(){const _0x1a4c49=_0x3a7aa2;if(!settings['userid']){const _0xc8619c=uuidRandom();mixpanel[_0x1a4c49(0x207)](_0xc8619c),updateSetting(_0x1a4c49(0x10e),_0xc8619c);}}async function initSecure(){const _0x5ca647=_0x3a7aa2;let _0x11b93b=getSecure();if(!_0x11b93b[_0x5ca647(0xb4)]('secret')){let _0x5ec9ca=await generateKeys();_0x11b93b[_0x5ca647(0x21f)]=_0x5ec9ca[_0x5ca647(0x21f)],_0x11b93b[_0x5ca647(0x194)]=_0x5ec9ca[_0x5ca647(0x194)],_0x11b93b[_0x5ca647(0x1b8)]=crypto[_0x5ca647(0x1f4)](0x20)[_0x5ca647(0x233)](_0x5ca647(0xcc));;storeSecure(_0x11b93b);}}function getSettings(){const _0x5aa406=_0x3a7aa2;return dbSettings[_0x5aa406(0x29e)]('settings')[_0x5aa406(0x24a)]()||{};}function getSecure(){const _0x26d036=_0x3a7aa2;return dbSecure[_0x26d036(0x29e)](_0x26d036(0x294))[_0x26d036(0x24a)]()||{};}function getBlacklist(){const _0x119f39=_0x3a7aa2;return dbSecure[_0x119f39(0x29e)](_0x119f39(0x250))[_0x119f39(0x24a)]()||[];}function broadcastToBots(_0x236b07,_0x1f847f){const _0x52a5af=_0x3a7aa2;config[_0x52a5af(0x11f)](_0x1d7f38=>{const _0x5ead91=_0x52a5af;if(_0x1d7f38[_0x5ead91(0x144)]==_0x5ead91(0x156)&&_0x1d7f38[_0x5ead91(0x241)]=='running'||_0x1d7f38[_0x5ead91(0x144)]==_0x5ead91(0x177)&&_0x1d7f38[_0x5ead91(0x241)]==_0x5ead91(0x264)){if(pid[_0x1d7f38['botID']])pid[_0x1d7f38[_0x5ead91(0x16f)]][_0x5ead91(0x184)]({[_0x236b07]:_0x1f847f});}});}function storeSettings(_0x2afca1,_0x21775e=![]){const _0x5675a1=_0x3a7aa2;_0x2afca1={...settings,..._0x2afca1};if(_0x21775e&&_0x2afca1[_0x5675a1(0x1ef)]!=_0x5675a1(0x1ab)&&_0x2afca1[_0x5675a1(0x1ef)]!=_0x5675a1(0x244)&&_0x2afca1[_0x5675a1(0x1ef)]!=''){const _0x231dc3=crypt['decrypt'](secure['privateKey'],_0x2afca1[_0x5675a1(0x1ef)])[_0x5675a1(0x1bf)]['split']('@')[0x0],_0x159e89=bcrypt[_0x5675a1(0x274)](_0x231dc3,saltRounds);_0x2afca1={..._0x2afca1,'bbPassword':_0x159e89};}if(_0x21775e&&_0x2afca1['telegramToken']!='************'&&_0x2afca1[_0x5675a1(0x9c)]!='***'&&_0x2afca1[_0x5675a1(0x9c)]!=''){const _0x2fb44e=crypt[_0x5675a1(0x112)](secure[_0x5675a1(0x194)],_0x2afca1[_0x5675a1(0x9c)])[_0x5675a1(0x1bf)]['split']('@')[0x0];_0x2afca1={..._0x2afca1,'telegramToken':_0x2fb44e};}const _0x2ff3bb=_0x2afca1[_0x5675a1(0x9c)]!=_0x5675a1(0x1ab)&&_0x2afca1[_0x5675a1(0x9c)]!=settings[_0x5675a1(0x9c)]||_0x2afca1[_0x5675a1(0x21b)]!=settings[_0x5675a1(0x21b)],_0x48bb3c=_0x2afca1[_0x5675a1(0x9c)]==''||_0x2afca1[_0x5675a1(0x21b)]=='';_0x2ff3bb&&(_0x2afca1[_0x5675a1(0xe8)]=null,_0x2afca1[_0x5675a1(0x19d)]=_0x5675a1(0x14b));for(const [_0x439b0d,_0x553c7c]of Object['entries'](_0x2afca1)){if(_0x439b0d==_0x5675a1(0x9c)&&_0x553c7c==_0x5675a1(0x1ab)){_0x2afca1[_0x5675a1(0x9c)]=settings[_0x5675a1(0x9c)];continue;};if(_0x439b0d=='bbPassword'&&_0x553c7c==_0x5675a1(0x1ab)){_0x2afca1['bbPassword']=settings[_0x5675a1(0x1ef)];continue;};dbSettings[_0x5675a1(0x258)](_0x5675a1(0x12b)+_0x439b0d,_0x553c7c)[_0x5675a1(0x287)]();}settings=_0x2afca1,io['to'](_0x5675a1(0xb5))['emit'](_0x5675a1(0x192),cleanSettings()),broadcastToBots('timeshift',settings[_0x5675a1(0xf8)]),broadcastToBots(_0x5675a1(0x20f),settings[_0x5675a1(0x20f)]);if(_0x2ff3bb&&!_0x48bb3c)initTelegram();if(_0x2ff3bb&&_0x48bb3c)disableTelegram();getAllClients()[_0x5675a1(0x11f)](_0x32a207=>{const _0xa34410=_0x5675a1;getSocket(_0x32a207['id'])[_0xa34410(0x1d1)]('status',{'access':{'allow':![],'reason':_0xa34410(0xeb),'token':null}});});}function updateSetting(_0x3a19d9,_0x4c26b6){const _0x5b12f0=_0x3a7aa2;dbSettings[_0x5b12f0(0x258)]('settings.'+_0x3a19d9,_0x4c26b6)[_0x5b12f0(0x287)](),settings=getSettings(),io['to']('botmanager')[_0x5b12f0(0x1d1)](_0x5b12f0(0x192),cleanSettings());}function storeSecure(_0x3a78f5){const _0x2bc20d=_0x3a7aa2;dbSecure[_0x2bc20d(0x29e)]('secure')[_0x2bc20d(0xab)](_0x3a78f5)[_0x2bc20d(0x287)](),secure=_0x3a78f5;}function addBlacklist(_0x384532){const _0x1c7245=_0x3a7aa2;cleanBlacklist();let _0x384500;devices[_0x384532]['telegramIpApproval']?_0x384500=Math[_0x1c7245(0x1c6)](devices[_0x384532][_0x1c7245(0x1ca)][_0x1c7245(0x1a3)],loginExpiry):_0x384500=loginExpiry,dbSecure[_0x1c7245(0x29e)](_0x1c7245(0x250))[_0x1c7245(0xab)]({'expiry':new Date()[_0x1c7245(0x1b2)]()+_0x384500*0x3c*0x3e8,'token':devices[_0x384532][_0x1c7245(0xf1)][_0x1c7245(0x18c)]})[_0x1c7245(0x287)](),blacklist=dbSecure[_0x1c7245(0x29e)]('blacklist')[_0x1c7245(0x24a)]();}function cleanBlacklist(){const _0x534203=_0x3a7aa2;let _0x1afa24=dbSecure[_0x534203(0x29e)](_0x534203(0x250))[_0x534203(0x110)]()[_0x534203(0x24a)](),_0x76bdf1=new Date()[_0x534203(0x1b2)]();_0x1afa24[_0x534203(0x11f)](_0x4ee9fc=>{const _0x3390ea=_0x534203;_0x4ee9fc[_0x3390ea(0x1a3)]<_0x76bdf1&&dbSecure[_0x3390ea(0x29e)]('blacklist')['remove']({'expiry':_0x4ee9fc[_0x3390ea(0x1a3)]})['write']();});}function initStates(){const _0xcaf7ec=_0x3a7aa2;let _0x1a4d3e=getConfiguration();_0x1a4d3e[_0xcaf7ec(0x11f)](_0x566d4b=>{const _0x156df1=_0xcaf7ec;_0x566d4b[_0x156df1(0x241)]='stopped';}),storeConfiguration(_0x1a4d3e);}function onKeys(){const _0x4656e0=new RSA();return new Promise(_0x9d2ee2=>{const _0x2a488d=_0x3c16;_0x4656e0[_0x2a488d(0x286)]()['then'](_0x83fe44=>{_0x9d2ee2(_0x83fe44);});});}async function generateKeys(){return await onKeys();}async function oneTimeMigration(){const _0x5e761a=_0x3a7aa2;let _0x5d7c6c=getSettings(),_0x2f7813=![];!_0x5d7c6c['hasOwnProperty'](_0x5e761a(0xe5))&&(_0x5d7c6c[_0x5e761a(0xe5)]=0x0,_0x2f7813=!![]);!_0x5d7c6c[_0x5e761a(0xb4)](_0x5e761a(0x157))&&(_0x5d7c6c[_0x5e761a(0x157)]=0x0,_0x2f7813=!![]);!_0x5d7c6c[_0x5e761a(0xb4)]('latestversion')&&(_0x5d7c6c[_0x5e761a(0xd4)]=_0x5e761a(0x153),_0x2f7813=!![]);!_0x5d7c6c[_0x5e761a(0xb4)](_0x5e761a(0x20f))&&(_0x5d7c6c[_0x5e761a(0x20f)]=![],_0x2f7813=!![]);if(_0x2f7813)storeSettings(_0x5d7c6c);try{fs[_0x5e761a(0xdc)](configbackuppath,{'withFileTypes':!![]})[_0x5e761a(0x11f)](_0x5c97dc=>{const _0x34f56a=_0x5e761a;if(!_0x5c97dc[_0x34f56a(0x1a7)]()){if(!_0x5c97dc[_0x34f56a(0x243)][_0x34f56a(0x230)](_0x34f56a(0x21c)))fs[_0x34f56a(0xd8)](configbackuppath+_0x5c97dc[_0x34f56a(0x243)]);}else fs[_0x34f56a(0x17b)](configbackuppath+_0x5c97dc['name'],{'recursive':!![]});});}catch(_0x1c39b2){logger[_0x5e761a(0x102)](_0x5e761a(0xfc),_0x1c39b2);}}function storeConfiguration(_0x55dacf){const _0xc5860f=_0x3a7aa2;dbConfig[_0xc5860f(0x29e)](_0xc5860f(0xb2))[_0xc5860f(0x1c7)]()[_0xc5860f(0x287)](),dbConfig['get']('bots')[_0xc5860f(0xab)](..._0x55dacf)[_0xc5860f(0x287)](),config=_0x55dacf;}async function resetPassword(){const _0x2cb91d=_0x3a7aa2;if(tgBot&&settings[_0x2cb91d(0xe8)]){const _0x21a212=Markup[_0x2cb91d(0x185)]([Markup['button'][_0x2cb91d(0x142)](_0x2cb91d(0x100),_0x2cb91d(0x17c)),Markup[_0x2cb91d(0x219)][_0x2cb91d(0x142)]('no','resetpw_no')]);await sendTelegram(settings[_0x2cb91d(0xe8)],_0x2cb91d(0x1f7),_0x21a212),tgBot[_0x2cb91d(0x299)](/resetpw_(.+)/,async _0x1cd7b1=>{const _0x150a71=_0x2cb91d,_0x53ac98=_0x1cd7b1['match'][0x1];_0x1cd7b1[_0x150a71(0x222)]();if(_0x53ac98!='no'){const _0x41ba0e=0xf,_0x28b983=_0x150a71(0x11b),_0xf99499=Array[_0x150a71(0x28c)](crypto[_0x150a71(0x20e)](new Uint32Array(_0x41ba0e)))[_0x150a71(0xf3)](_0x326094=>_0x28b983[_0x326094%_0x28b983['length']])['join'](''),_0x5024f5=bcrypt[_0x150a71(0x274)](_0xf99499,saltRounds);storeSettings({'bbPassword':_0x5024f5}),await sendTelegram(_0x1cd7b1['chat']['id'],_0x150a71(0x1db)+_0xf99499,{'parse_mode':_0x150a71(0x1d7)});}else await sendTelegram(_0x1cd7b1[_0x150a71(0x262)]['id'],'Password\x20reset\x20rejected');});}}async function confirmRestore(_0x39f1d9,_0x2f15cb){const _0x260e99=_0x3a7aa2;io['to'](_0x260e99(0xb5))[_0x260e99(0x1d1)](_0x260e99(0xe6),_0x260e99(0x1da),_0x260e99(0x14c));if(tgBot&&settings[_0x260e99(0xe8)]){const _0x1d7038=uuidRandom();tmpStorage[_0x1d7038]={'path':_0x39f1d9,'filename':_0x2f15cb};const _0x25cc1f=Markup[_0x260e99(0x185)]([Markup['button']['callback'](_0x260e99(0x100),_0x260e99(0x13d)+_0x1d7038),Markup['button']['callback']('no',_0x260e99(0x28d)+_0x1d7038)]);await sendTelegram(settings[_0x260e99(0xe8)],_0x260e99(0xa9),_0x25cc1f),tgBot['action'](/restore_(.+)_(.+)/,async _0x2f51d8=>{const _0x4ef1e3=_0x260e99,_0x803d39=_0x2f51d8['match'][0x1],_0x5a9ebd=_0x2f51d8[_0x4ef1e3(0xf4)][0x2],{path:_0x27d609,filename:_0x519d9b}=tmpStorage[_0x5a9ebd];delete tmpStorage[_0x5a9ebd],_0x2f51d8[_0x4ef1e3(0x222)](),_0x803d39==_0x4ef1e3(0x100)?(logger[_0x4ef1e3(0x102)](_0x4ef1e3(0x226)),await sendTelegram(_0x2f51d8[_0x4ef1e3(0x262)]['id'],_0x4ef1e3(0x1e1),{'parse_mode':_0x4ef1e3(0x1d7)}),unzipFile(_0x27d609,_0x519d9b)):(logger[_0x4ef1e3(0x102)](_0x4ef1e3(0xb6)),await sendTelegram(_0x2f51d8['chat']['id'],_0x4ef1e3(0xb6)));});}}function getServerTime(){const _0x52e17b=_0x3a7aa2,_0x5982e5=new Date();return _0x5982e5[_0x52e17b(0x12f)]()+'/'+(_0x5982e5['getMonth']()+0x1)[_0x52e17b(0x233)]()[_0x52e17b(0x232)](0x2,'0')+'/'+_0x5982e5[_0x52e17b(0x1eb)]()[_0x52e17b(0x233)]()['padStart'](0x2,'0')+'\x20'+_0x5982e5[_0x52e17b(0xaa)]()[_0x52e17b(0x233)]()[_0x52e17b(0x232)](0x2,'0')+':'+_0x5982e5[_0x52e17b(0x267)]()['toString']()[_0x52e17b(0x232)](0x2,'0')+':'+_0x5982e5[_0x52e17b(0x159)]()[_0x52e17b(0x233)]()[_0x52e17b(0x232)](0x2,'0');}function getTimeStamp(){const _0xe5ff9=_0x3a7aa2,_0x1ea733=shiftedTime();return _0x1ea733[_0xe5ff9(0x12f)]()+'/'+(_0x1ea733[_0xe5ff9(0x223)]()+0x1)[_0xe5ff9(0x233)]()[_0xe5ff9(0x232)](0x2,'0')+'/'+_0x1ea733[_0xe5ff9(0x1eb)]()['toString']()[_0xe5ff9(0x232)](0x2,'0')+'\x20'+_0x1ea733[_0xe5ff9(0xaa)]()[_0xe5ff9(0x233)]()['padStart'](0x2,'0')+':'+_0x1ea733[_0xe5ff9(0x267)]()[_0xe5ff9(0x233)]()[_0xe5ff9(0x232)](0x2,'0')+':'+_0x1ea733[_0xe5ff9(0x159)]()['toString']()[_0xe5ff9(0x232)](0x2,'0');}function getCleanTimeStamp(){const _0x42fc56=_0x3a7aa2,_0x476983=shiftedTime();return _0x476983['getFullYear']()+(_0x476983[_0x42fc56(0x223)]()+0x1)['toString']()[_0x42fc56(0x232)](0x2,'0')+_0x476983[_0x42fc56(0x1eb)]()[_0x42fc56(0x233)]()[_0x42fc56(0x232)](0x2,'0')+'-'+_0x476983['getHours']()['toString']()[_0x42fc56(0x232)](0x2,'0')+_0x476983['getMinutes']()[_0x42fc56(0x233)]()[_0x42fc56(0x232)](0x2,'0')+_0x476983[_0x42fc56(0x159)]()[_0x42fc56(0x233)]()['padStart'](0x2,'0');}function shiftedTime(){const _0x232633=_0x3a7aa2,_0x2d7dbc=new Date();let _0x1fa7fd=_0x2d7dbc;if(settings[_0x232633(0xf8)]&&settings[_0x232633(0xf8)]!==0x0)_0x1fa7fd=fns[_0x232633(0x13f)](_0x2d7dbc,{'hours':settings[_0x232633(0xf8)]});return _0x1fa7fd;}function startScheduler(){const _0x53b212=_0x3a7aa2,_0x20acbc=new Date()[_0x53b212(0x1bd)](),_0x56d665=shiftedTime()[_0x53b212(0xaa)]();_0x56d665==0x4&&backupConfigFiles();_0x56d665==0x0&&rotateLogFiles();_0x20acbc%0x6==0x0&&triggerAnalytics();_0x20acbc%0x6==0x0&&getMessages();if(pidScheduler)clearTimeout(pidScheduler);pidScheduler=setTimeout(()=>{startScheduler();},0x3c*0x3c*0x3e8);}async function restoreBackupFile(_0x96fd4e){const _0x4c34d3=_0x3a7aa2;logger[_0x4c34d3(0x102)](_0x4c34d3(0x211)+_0x96fd4e);const _0x4f6ef9=getBotsWithMode();_0x4f6ef9[_0x4c34d3(0x201)]>0x0?confirmRestore(configbackuppath,_0x96fd4e):unzipFile(configbackuppath,_0x96fd4e);}async function getBackupFiles(_0x39d984=null){const _0x21d2b5=_0x3a7aa2;let _0x3943a1=[],_0xe2c027=fs[_0x21d2b5(0xdc)](configbackuppath,{'withFileTypes':!![]});_0xe2c027['sort']((_0x9592c3,_0x29b7b5)=>_0x9592c3[_0x21d2b5(0x243)]<_0x29b7b5[_0x21d2b5(0x243)]?0x1:_0x29b7b5[_0x21d2b5(0x243)]<_0x9592c3[_0x21d2b5(0x243)]?-0x1:0x0),_0xe2c027[_0x21d2b5(0x11f)](_0x546f8a=>{const _0x144a74=_0x21d2b5;if(!_0x546f8a['isDirectory']()&&_0x546f8a[_0x144a74(0x243)][_0x144a74(0x230)](_0x144a74(0x21c))&&_0x546f8a[_0x144a74(0x243)][_0x144a74(0x175)]('.zip')){const _0x3b733a=formatDate(fs['statSync'](configbackuppath+_0x546f8a[_0x144a74(0x243)])[_0x144a74(0x170)]);_0x3943a1[_0x144a74(0xab)]({'name':_0x546f8a['name'],'mtime':_0x3b733a});}});if(_0x39d984)io['to'](_0x39d984)[_0x21d2b5(0x1d1)]('backup-files',_0x3943a1);else return _0x3943a1;}async function backupConfigFiles(){const _0x1264a4=_0x3a7aa2;await zipFiles(_0x1264a4(0x164));const _0x29d69d=getCleanTimeStamp();fs[_0x1264a4(0x221)](zippath+'backup-full.zip',configbackuppath+(_0x1264a4(0x21c)+_0x29d69d+'.zip'));let _0x5daec2=fs['readdirSync'](configbackuppath,{'withFileTypes':!![]});_0x5daec2[_0x1264a4(0x26e)]((_0x12e725,_0x529d42)=>_0x12e725[_0x1264a4(0x243)]<_0x529d42[_0x1264a4(0x243)]?0x1:_0x529d42['name']<_0x12e725[_0x1264a4(0x243)]?-0x1:0x0),_0x5daec2[_0x1264a4(0x201)]>maxBackups&&fs[_0x1264a4(0xd8)](configbackuppath+_0x5daec2[_0x5daec2[_0x1264a4(0x201)]-0x1][_0x1264a4(0x243)]);}function rotateLogFiles(){const _0xa6978e=_0x3a7aa2,_0x26cccf=fs[_0xa6978e(0x9e)](logspath+_0xa6978e(0xc9)),_0x24aa72=_0x26cccf[_0xa6978e(0x129)]/0x400;if(_0x24aa72>0x64){let _0x4cde97=fs[_0xa6978e(0xdc)](logspath,{'withFileTypes':!![]});_0x4cde97[_0xa6978e(0x26e)]((_0x5d413f,_0x56aa0f)=>_0x5d413f[_0xa6978e(0x243)]<_0x56aa0f['name']?0x1:_0x56aa0f[_0xa6978e(0x243)]<_0x5d413f[_0xa6978e(0x243)]?-0x1:0x0),_0x4cde97['forEach'](_0x2f41e8=>{const _0x308274=_0xa6978e;if(_0x2f41e8[_0x308274(0x243)]==_0x308274(0xdf))fs[_0x308274(0x221)](logspath+_0x2f41e8[_0x308274(0x243)],logspath+_0x308274(0x23d));if(_0x2f41e8[_0x308274(0x243)]==_0x308274(0x18f))fs['copyFileSync'](logspath+_0x2f41e8[_0x308274(0x243)],logspath+_0x308274(0xdf));_0x2f41e8[_0x308274(0x243)]==_0x308274(0xc9)&&(fs[_0x308274(0x221)](logspath+_0x2f41e8[_0x308274(0x243)],logspath+_0x308274(0x18f)),fs[_0x308274(0x1ac)](logspath+_0x2f41e8[_0x308274(0x243)],''));});}}async function zipFiles(_0x4908c1){const _0x2045fb=_0x3a7aa2;let _0x16cc15;if(_0x4908c1==_0x2045fb(0x1c2))_0x16cc15=logspath;if(_0x4908c1==_0x2045fb(0x1af))_0x16cc15=configpath;if(_0x4908c1=='backup-full')_0x16cc15=configpath;let _0x1ed53c=fs['readdirSync'](_0x16cc15,{'withFileTypes':!![]});const _0x12bec6=new require(_0x2045fb(0xf6))();_0x1ed53c['forEach'](_0x570138=>{const _0x674e97=_0x2045fb;if(!_0x570138[_0x674e97(0x1a7)]()){let _0x379308=fs[_0x674e97(0x214)](_0x16cc15+_0x570138[_0x674e97(0x243)]);if(_0x4908c1==_0x674e97(0x1af)){const _0x54e8f7=/^bot-[0-9]{3}-config.json$/,_0xfd4ca=_0x54e8f7['test'](_0x570138[_0x674e97(0x243)]);if(_0xfd4ca){const _0x3109cc=JSON[_0x674e97(0x25e)](_0x379308);if(_0x3109cc[_0x674e97(0x17d)][0x0]){_0x3109cc['bot'][0x0][_0x674e97(0xbe)]=_0x674e97(0x244),_0x3109cc[_0x674e97(0x17d)][0x0][_0x674e97(0x239)]=_0x674e97(0x244);if(_0x3109cc['bot'][0x0][_0x674e97(0x1ec)])_0x3109cc[_0x674e97(0x17d)][0x0][_0x674e97(0x1ec)]=_0x674e97(0x244);}_0x379308=JSON[_0x674e97(0x146)](_0x3109cc,null,0x2);}if(_0x570138['name']==_0x674e97(0x15f)){const _0x4557c9=JSON[_0x674e97(0x25e)](_0x379308);if(_0x4557c9[_0x674e97(0x192)][_0x674e97(0x190)])_0x4557c9[_0x674e97(0x192)][_0x674e97(0x190)]=![];if(_0x4557c9[_0x674e97(0x192)][_0x674e97(0x1ef)])_0x4557c9[_0x674e97(0x192)][_0x674e97(0x1ef)]=_0x674e97(0x244);if(_0x4557c9[_0x674e97(0x192)][_0x674e97(0x9c)])_0x4557c9[_0x674e97(0x192)][_0x674e97(0x9c)]=_0x674e97(0x244);if(_0x4557c9[_0x674e97(0x192)][_0x674e97(0xe8)])_0x4557c9[_0x674e97(0x192)][_0x674e97(0xe8)]=null;_0x379308=JSON[_0x674e97(0x146)](_0x4557c9,null,0x2);}if(_0x570138[_0x674e97(0x243)]!='bb-secure.json')_0x12bec6['file'](_0x570138[_0x674e97(0x243)],_0x379308);}else _0x12bec6[_0x674e97(0x136)](_0x570138[_0x674e97(0x243)],_0x379308);}});const _0x251ff6=_0x12bec6[_0x2045fb(0x15c)]({'base64':![],'compression':_0x2045fb(0x26d)});fs[_0x2045fb(0x1ac)](zippath+(_0x4908c1+_0x2045fb(0x19a)),_0x251ff6,_0x2045fb(0x1b5));}async function unzipFile(_0x41bec1,_0x3b4a78){const _0x427a61=_0x3a7aa2;fs[_0x427a61(0xdc)](configpath,{'withFileTypes':!![]})[_0x427a61(0x11f)](_0x445df3=>{const _0x2ce273=_0x427a61;if(!_0x445df3[_0x2ce273(0x1a7)]())fs[_0x2ce273(0x17b)](configpath+_0x445df3[_0x2ce273(0x243)]);});const _0x48f86b=fs[_0x427a61(0x214)](_0x41bec1+_0x3b4a78,'binary'),_0x1eac24=new require(_0x427a61(0xf6))(_0x48f86b,{'base64':![],'checkCRC32':!![]});Object['keys'](_0x1eac24[_0x427a61(0x1d3)])[_0x427a61(0x11f)](_0x1b59cb=>{const _0x45eb7f=_0x427a61,_0x19a919=_0x1eac24[_0x45eb7f(0x1d3)][_0x1b59cb];fs[_0x45eb7f(0x1ac)](configpath+_0x19a919[_0x45eb7f(0x243)],_0x19a919['_data']);}),fs[_0x427a61(0xdc)](temppath,{'withFileTypes':!![]})[_0x427a61(0x11f)](_0x3055eb=>{const _0x4e26c8=_0x427a61;if(!_0x3055eb[_0x4e26c8(0x1a7)]())fs[_0x4e26c8(0x17b)](temppath+_0x3055eb[_0x4e26c8(0x243)]);}),logger[_0x427a61(0x102)](_0x427a61(0x236)),process[_0x427a61(0x184)]({'restore':!![]},_0x40e938=>{});}async function getPublicIp(){const _0x2bf3b6=_0x3a7aa2;try{const _0x639b41=await axios[_0x2bf3b6(0x29e)](_0x2bf3b6(0xc3));publicip=_0x639b41[_0x2bf3b6(0x1fa)]['ip'];}catch(_0x23a945){}}async function triggerAnalytics(){const _0x85c625=_0x3a7aa2;if(!publicip)await getPublicIp();const _0x4745e7=getBotsWithMode();let _0x389d2b=0x0;_0x4745e7[_0x85c625(0x11f)](_0x353821=>{const _0x971fc0=_0x85c625;if(_0x353821[_0x971fc0(0x144)]===_0x971fc0(0x156))_0x389d2b++;});const _0x5b556c=getBotExchanges();mixpanel[_0x85c625(0x22b)](_0x85c625(0x1c4),{'distinct_id':settings[_0x85c625(0x10e)],'ip':publicip,'version':serverversion,'numbots':_0x4745e7['length'],'numbotsenabled':_0x389d2b,'exchanges':_0x5b556c,'environment':environment});}async function getMessages(){const _0x304e5f=_0x3a7aa2,_0x1664a5=_0x304e5f(0x251),_0x552a45=new GraphQLClient(_0x1664a5),_0x424b52={'authorization':_0x304e5f(0x1cd)},_0x3c4d77=serverversion[_0x304e5f(0x12e)]('.'),_0x29570a=_0x3c4d77[0x0]+'.'+_0x3c4d77[0x1],_0x3a2457=Math[_0x304e5f(0x14f)](settings[_0x304e5f(0xe5)],settings[_0x304e5f(0x157)]),_0x20ed1e={'last':parseInt(_0x3a2457),'bbm':_0x29570a},_0x530fc9=gql`
            query getMessages($bbm: String!, $last: Int!) {
                messages(where: {
                    number_gt: $last
                    OR: [
                    {bbvReceive: "any"},
                    {bbvReceive_contains: $bbm}
                    ]
                    archived_not: true
                }, orderBy: number_ASC) {
                    id
                    number
                    bbvReceive
                    bbvNew
                    title
                    message
                    dialogWidth
                    lock
                }
            }
            `;let _0x3e3e80;try{_0x3e3e80=await _0x552a45[_0x304e5f(0x268)](_0x530fc9,_0x20ed1e,_0x424b52);}catch(_0x8dd744){}if(_0x3e3e80&&_0x3e3e80['messages']){let _0x2db153=settings[_0x304e5f(0xe5)];newMessages=[];for(const _0x2d6159 of _0x3e3e80[_0x304e5f(0xff)]){newMessages[_0x304e5f(0xab)](_0x2d6159);let _0x359371=![];_0x2d6159['bbvNew']&&(updateSetting(_0x304e5f(0xd4),_0x2d6159['bbvNew']),_0x359371=isNewerVersion(serverversion,_0x2d6159['bbvNew'])||serverversion==_0x2d6159[_0x304e5f(0x266)]);if(!_0x359371&&_0x2d6159[_0x304e5f(0x26f)]>_0x2db153){if(_0x2d6159['bbvReceive']===_0x304e5f(0x1c8)||serverversion[_0x304e5f(0x230)](_0x2d6159['bbvReceive'])){let _0x1a899e=''+_0x2d6159['title']+'\x0a\x0a'+_0x2d6159[_0x304e5f(0x1bf)];const _0xab3c53=await sendTelegramMsg(toTelegramMarkdown(_0x1a899e),'Markdown');if(_0xab3c53)_0x2db153=_0x2d6159[_0x304e5f(0x26f)];}}}updateAvailable=isNewerVersion(settings['latestversion'],serverversion),updateSetting('lastmsgtelegram',_0x2db153),emitMessages();}}function emitMessages(){const _0x14adc5=_0x3a7aa2,_0x5222a6=settings['lastmsgemitted'];let _0x549665=[];newMessages[_0x14adc5(0x11f)](_0x293720=>{const _0x18a8b5=_0x14adc5;_0x293720[_0x18a8b5(0x26f)]>_0x5222a6&&_0x549665[_0x18a8b5(0xab)](_0x293720);}),_0x549665[_0x14adc5(0x201)]>0x0&&getAllClients()[_0x14adc5(0x11f)](_0x13451d=>{const _0x3735dc=_0x14adc5;getSocket(_0x13451d['id'])[_0x3735dc(0x1d1)](_0x3735dc(0x1bf),_0x549665);});}function confirmMessage(_0x4d050f){const _0x3207af=_0x3a7aa2;updateSetting(_0x3207af(0x157),Number(_0x4d050f));}function isNewerVersion(_0x2f9f8b,_0x2ea51d){const _0x5ba1d3=_0x3a7aa2,_0x2c947a=_0x2ea51d[_0x5ba1d3(0x12e)]('.'),_0x12539d=_0x2f9f8b['split']('.');for(var _0x5c6e1a=0x0;_0x5c6e1a<_0x12539d[_0x5ba1d3(0x201)];_0x5c6e1a++){const _0x30f934=~~_0x12539d[_0x5c6e1a],_0x38e8a4=~~_0x2c947a[_0x5c6e1a];if(_0x30f934>_0x38e8a4)return!![];if(_0x30f934<_0x38e8a4)return![];}return![];}function toTelegramMarkdown(_0x2815fb){const _0xa0dbab=_0x3a7aa2,_0x57fcd3=/(^|[^\*])\*{1}([^\*.]+?)\*{1}([^\*]|$)/gim,_0x1e2689=/\*{2}(.+?)\*{2}/gim;return _0x2815fb=_0x2815fb['replace'](_0x57fcd3,'$1_$2_$3')[_0xa0dbab(0x118)](_0x1e2689,_0xa0dbab(0x1f1)),_0x2815fb;}async function validateConfigFile(){const _0x3c8768=_0x3a7aa2,_0x2329e0=dbConfig[_0x3c8768(0x29e)](_0x3c8768(0xb2))[_0x3c8768(0x242)](_0x3c8768(0x16f))[_0x3c8768(0x24a)]()||[];if(_0x2329e0['length']==0x0){let _0x26c858=0x0,_0x3ae831=[];const _0x44f983=/^bot-([0-9]{3})-config.json$/,_0x29514c=fs[_0x3c8768(0xdc)](configpath);_0x29514c[_0x3c8768(0x11f)](_0x970f56=>{const _0x85f3c2=_0x3c8768,_0x224ea7=_0x44f983[_0x85f3c2(0x24e)](_0x970f56);if(_0x224ea7){const _0x135ad9=_0x224ea7[0x1];let _0x4d2c0f=getBotAttributes(_0x135ad9);_0x3ae831[_0x85f3c2(0xab)]({'botID':_0x135ad9,'botname':_0x4d2c0f[_0x85f3c2(0x257)],'status':'disabled','live':'stopped'}),_0x26c858++;}}),_0x26c858!=0x0&&(dbConfig[_0x3c8768(0x29e)]('bots')[_0x3c8768(0x199)](_0x3ae831)['write'](),config=_0x3ae831,restoredConfigFile=_0x26c858);}}async function restoreConfigNotify(_0xc88a97){const _0x4df565=_0x3a7aa2;let _0x17e200;if(restoredConfigFile==0x1)_0x17e200=_0x4df565(0x249);else _0x17e200='NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bots\x20are\x20disabled\x20by\x20default\x20-\x20enable\x20those\x20you\x20want\x20to\x20run';if(_0xc88a97)io['to']('botmanager')['emit'](_0x4df565(0xe6),_0x17e200);else{logger[_0x4df565(0x166)](_0x4df565(0x1d9)),logger[_0x4df565(0x166)](_0x17e200),logger[_0x4df565(0x166)](_0x4df565(0x1d9)),logger[_0x4df565(0x166)]('');if(tgBot&&settings['telegramChatId']&&settings['telegramEvents']!=_0x4df565(0x1c5))await sendTelegram(settings['telegramChatId'],_0x4df565(0xc6)+_0x17e200);}}function validateCredentials(_0x50027f,_0x2b0ff3){const _0x1e2b68=_0x3a7aa2;if(_0x50027f[_0x1e2b68(0x1c1)]==settings[_0x1e2b68(0x296)]&&bcrypt[_0x1e2b68(0x280)](_0x50027f[_0x1e2b68(0x123)],settings[_0x1e2b68(0x1ef)])){if(settings[_0x1e2b68(0xa5)])return{'allow':![],'reason':_0x1e2b68(0x23b),'token':null};else{const _0x3c7c82=generateLoginToken(_0x2b0ff3);return{'allow':!![],'reason':_0x1e2b68(0xbc),'token':_0x3c7c82};}}else return{'allow':![],'reason':_0x1e2b68(0x273),'token':null};}function refreshToken(_0x41f5fe){const _0x5dfa9c=_0x3a7aa2,_0x792101=generateLoginToken(_0x41f5fe);return{'allow':!![],'reason':_0x5dfa9c(0xbc),'token':_0x792101};}function validateAccess(_0x5f4bc1,_0x630260,_0x52640c){const _0xe70b55=_0x3a7aa2,_0x368b31=_0x52640c?_0x52640c:devices[_0x630260]['ip'];let _0x3368e8;const _0x23e80c=_0x4efcd8=>{const _0x2b4a3f=_0x3c16;if(settings[_0x2b4a3f(0x190)]){if(settings[_0x2b4a3f(0xa5)]){if(telegram2FaApproved(_0x630260)){const _0x5a41df=generateLoginToken(_0x630260);return{'allow':!![],'reason':_0x2b4a3f(0x165),'token':_0x5a41df};}else return{'allow':![],'reason':'login\x20required','token':null};}else return _0x3368e8=validToken(_0x4efcd8,_0x630260),_0x3368e8[_0x2b4a3f(0xb4)](_0x2b4a3f(0x14c))?{'allow':!![],'reason':_0x2b4a3f(0x108),'token':_0x4efcd8}:{'allow':![],'reason':_0x2b4a3f(0x277),'token':null};}else return{'allow':!![],'reason':'login\x20not\x20required','token':null};};if(settings[_0xe70b55(0x187)]){let _0x13acbe=[...settings[_0xe70b55(0x9b)],_0xe70b55(0x1c3),_0xe70b55(0x140),_0xe70b55(0x28f)];if(_0x13acbe[_0xe70b55(0x27c)](_0x368b31))return _0x23e80c(_0x5f4bc1);else{_0x3368e8=validToken(_0x5f4bc1,_0x630260);if(_0x3368e8[_0xe70b55(0xb4)](_0xe70b55(0x14c)))return _0x23e80c(_0x5f4bc1);else{if(telegramIpApproved(_0x630260)){const _0x2ae9ab=generateToken(_0x630260);return _0x3368e8=_0x23e80c(_0x5f4bc1),_0x3368e8[_0xe70b55(0x28a)]?{'allow':!![],'reason':_0xe70b55(0x161),'token':_0x2ae9ab}:_0x3368e8;}else return settings[_0xe70b55(0x1f0)]?{'allow':![],'reason':_0xe70b55(0x1d2),'token':null}:{'allow':![],'reason':_0xe70b55(0xf7),'token':null};}}}else return _0x23e80c(_0x5f4bc1);}function _0x3c16(_0x5893dc,_0x19198a){const _0x534368=_0x3f8b();return _0x3c16=function(_0x6a128b,_0x4ddd94){_0x6a128b=_0x6a128b-0x9b;let _0x3f8bf3=_0x534368[_0x6a128b];return _0x3f8bf3;},_0x3c16(_0x5893dc,_0x19198a);}function timelyDecrypt(_0x507dc0,_0x1c13e1=!![]){const _0x5eda80=_0x3a7aa2;if(_0x507dc0)try{const _0x41562c=crypt[_0x5eda80(0x112)](secure[_0x5eda80(0x194)],_0x507dc0)[_0x5eda80(0x1bf)],_0x4e2754=_0x41562c[_0x5eda80(0x12e)]('@')[0x0],_0x59a40c=_0x41562c[_0x5eda80(0x12e)]('@')[0x1],_0x101a9c=new Date()[_0x5eda80(0x1b2)]();if(_0x1c13e1){if(_0x101a9c-_0x59a40c<maxSecretAge*0x3e8)return _0x4e2754;else return![];}else return _0x4e2754;}catch(_0x2882ea){return![];}else return![];}const validToken=(_0x2e0775,_0x30dfd4)=>{const _0x404291=_0x3a7aa2,_0x4120d2=devices[_0x30dfd4]['ip'];if(!_0x2e0775)return{'error':_0x404291(0x155)};for(let _0x59c383 of blacklist){if(_0x59c383[_0x404291(0x18c)]==_0x2e0775)return{'error':'Token\x20blacklisted'};}let _0x3b8f1a;try{_0x3b8f1a=jwt[_0x404291(0x29b)](_0x2e0775,secure[_0x404291(0x1b8)]+_0x30dfd4);}catch{return{'error':_0x404291(0x148)};}if(!_0x3b8f1a[_0x404291(0xb4)](_0x404291(0x215))&&!_0x3b8f1a[_0x404291(0xb4)]('username')||!_0x3b8f1a[_0x404291(0xb4)]('exp'))return{'error':'Invalid\x20authentication\x20token\x20(2)'};if(!_0x3b8f1a['hasOwnProperty'](_0x404291(0x1c1))&&_0x3b8f1a[_0x404291(0xb4)](_0x404291(0x215))){const {clientip:_0x6f0e79}=_0x3b8f1a;return _0x4120d2==_0x6f0e79?{'success':_0x404291(0x186)}:{'error':_0x404291(0x1f9)};}else{if(_0x3b8f1a[_0x404291(0xb4)]('username')&&_0x3b8f1a[_0x404291(0xb4)](_0x404291(0x215))){const {username:_0x58d64f,clientip:_0x56b9ca}=_0x3b8f1a;return settings[_0x404291(0x296)]==_0x58d64f&&_0x4120d2==_0x56b9ca?{'success':_0x404291(0x186)}:{'error':'Invalid\x20username\x20or\x20IP\x20address'};}}},generateLoginToken=_0x2f48b8=>{const _0x5a0751=_0x3a7aa2;if(_0x2f48b8){const _0x550e11=devices[_0x2f48b8]['ip'];return jwt[_0x5a0751(0x240)]({'username':settings[_0x5a0751(0x296)],'clientip':_0x550e11},secure['secret']+_0x2f48b8,{'expiresIn':tokenRefresh*0x3c,'allowInsecureKeySizes':!![]});}else return![];},generateToken=_0x38acd6=>{const _0x3f9949=_0x3a7aa2;if(_0x38acd6){const _0x435d0d=devices[_0x38acd6]['ip'];return jwt[_0x3f9949(0x240)]({'clientip':_0x435d0d},secure['secret']+_0x38acd6,{'expiresIn':devices[_0x38acd6][_0x3f9949(0x1ca)]['expiry']*0x3c,'allowInsecureKeySizes':!![]});}else return![];},telegramIpApproved=_0x359881=>{const _0x55efef=_0x3a7aa2;let _0x376e6b=![];return devices[_0x359881][_0x55efef(0x1ca)]&&devices[_0x359881][_0x55efef(0x1ca)][_0x55efef(0x1a3)]!='reject'&&(_0x376e6b=devices[_0x359881][_0x55efef(0x1ca)]['clientip']==devices[_0x359881]['ip']&&new Date()[_0x55efef(0x1b2)]()-devices[_0x359881][_0x55efef(0x1ca)][_0x55efef(0x12a)]<devices[_0x359881][_0x55efef(0x1ca)][_0x55efef(0x1a3)]*0x3c*0x3e8),_0x376e6b;},telegram2FaApproved=_0x4823f7=>{const _0x360626=_0x3a7aa2;let _0x23ace0=![];return devices[_0x4823f7]['telegram2FaApproval']&&devices[_0x4823f7][_0x360626(0x13b)]['expiry']!=_0x360626(0x20c)&&(_0x23ace0=devices[_0x4823f7][_0x360626(0x13b)]['clientip']==devices[_0x4823f7]['ip']&&new Date()[_0x360626(0x1b2)]()-devices[_0x4823f7][_0x360626(0x13b)][_0x360626(0x12a)]<devices[_0x4823f7]['telegram2FaApproval'][_0x360626(0x1a3)]*0x3c*0x3e8),_0x23ace0;},normalizeIP=_0x44fc05=>{const _0x1cc202=_0x3a7aa2;let _0x1ef21f=null,_0x71ffef=null;if(ipaddr['isValid'](_0x44fc05)){const _0x56f7aa=ipaddr[_0x1cc202(0x25e)](_0x44fc05);_0x56f7aa['kind']()==='ipv6'?(_0x56f7aa[_0x1cc202(0x1ad)]()&&(_0x1ef21f=_0x56f7aa['toIPv4Address']()[_0x1cc202(0x233)]()),_0x71ffef=_0x56f7aa[_0x1cc202(0x233)]()):(_0x1ef21f=_0x56f7aa['toString'](),_0x71ffef=_0x56f7aa[_0x1cc202(0x298)]()[_0x1cc202(0x233)]());}return{'show':_0x1ef21f?_0x1ef21f:_0x71ffef,'store':_0x71ffef};};function formatDate(_0x3fad0a){const _0x6acec3=_0x3a7aa2;return _0x3fad0a[_0x6acec3(0x12f)]()+'/'+(_0x3fad0a[_0x6acec3(0x223)]()+0x1)[_0x6acec3(0x233)]()[_0x6acec3(0x232)](0x2,'0')+'/'+_0x3fad0a[_0x6acec3(0x1eb)]()[_0x6acec3(0x233)]()[_0x6acec3(0x232)](0x2,'0')+'\x20'+_0x3fad0a[_0x6acec3(0xaa)]()['toString']()[_0x6acec3(0x232)](0x2,'0')+':'+_0x3fad0a['getMinutes']()['toString']()[_0x6acec3(0x232)](0x2,'0')+':'+_0x3fad0a[_0x6acec3(0x159)]()['toString']()[_0x6acec3(0x232)](0x2,'0');}function sleep(_0x212ec9){return new Promise(_0x1e9021=>setTimeout(_0x1e9021,_0x212ec9));}