const _0x21fe16=_0x10d2;(function(_0x7dac3a,_0x1c6581){const _0x5cccd4=_0x10d2,_0x3a27a9=_0x7dac3a();while(!![]){try{const _0x15e986=parseInt(_0x5cccd4(0x1fe))/0x1+parseInt(_0x5cccd4(0x24b))/0x2*(parseInt(_0x5cccd4(0x2c7))/0x3)+-parseInt(_0x5cccd4(0x2cd))/0x4*(parseInt(_0x5cccd4(0x291))/0x5)+parseInt(_0x5cccd4(0x2e0))/0x6+-parseInt(_0x5cccd4(0x2f0))/0x7*(-parseInt(_0x5cccd4(0x212))/0x8)+parseInt(_0x5cccd4(0x26e))/0x9*(-parseInt(_0x5cccd4(0x171))/0xa)+-parseInt(_0x5cccd4(0x2d9))/0xb*(parseInt(_0x5cccd4(0x286))/0xc);if(_0x15e986===_0x1c6581)break;else _0x3a27a9['push'](_0x3a27a9['shift']());}catch(_0x245787){_0x3a27a9['push'](_0x3a27a9['shift']());}}}(_0x4615,0xb1b90));const _0x3608ed=function(){let _0xe6f773=!![];return function(_0xaacdad,_0x58ad68){const _0x524c35=_0xe6f773?function(){const _0x1ac78b=_0x10d2;if(_0x58ad68){const _0x74da3a=_0x58ad68[_0x1ac78b(0x257)](_0xaacdad,arguments);return _0x58ad68=null,_0x74da3a;}}:function(){};return _0xe6f773=![],_0x524c35;};}(),_0x4e1c19=_0x3608ed(this,function(){const _0x4abb9c=_0x10d2;return _0x4e1c19[_0x4abb9c(0x198)]()[_0x4abb9c(0x2f6)](_0x4abb9c(0x1ca))[_0x4abb9c(0x198)]()[_0x4abb9c(0x13d)](_0x4e1c19)[_0x4abb9c(0x2f6)](_0x4abb9c(0x1ca));});_0x4e1c19();'use strict';process[_0x21fe16(0x1e3)][_0x21fe16(0x302)]=0x1;const childProcess=require(_0x21fe16(0x2d5)),fs=require('fs'),fns=require(_0x21fe16(0x218)),low=require('lowdb'),FileSync=require(_0x21fe16(0x1d3)),path=require(_0x21fe16(0x20b)),crypto=require(_0x21fe16(0x230)),Crypt=require(_0x21fe16(0x1dc))[_0x21fe16(0x1b8)],RSA=require('hybrid-crypto-js')[_0x21fe16(0x12e)],bcrypt=require(_0x21fe16(0x262)),jwt=require('jsonwebtoken'),ipaddr=require(_0x21fe16(0x273)),argv=require('yargs/yargs')(process[_0x21fe16(0x2b9)][_0x21fe16(0x2a9)](0x2))[_0x21fe16(0x2b9)],uuidRandom=require(_0x21fe16(0x2f2)),{Telegraf,Markup}=require('telegraf'),Mixpanel=require('mixpanel'),axios=require(_0x21fe16(0x305)),{GraphQLClient,gql}=require(_0x21fe16(0x1d7)),util=require(_0x21fe16(0x2b7)),fileUpload=require(_0x21fe16(0x29b)),{networkInterfaces}=require('os'),PORT=argv[_0x21fe16(0x20d)]||'3000',pattern=/^[0-9]{2,4}$/;!pattern[_0x21fe16(0x122)](PORT)&&(console['log'](_0x21fe16(0x15f)+PORT+_0x21fe16(0x18e)),process['exit'](0x1));const HOST=argv['host']||null,userID=argv[_0x21fe16(0x2f8)]||'',debugging=argv['d']||![],nodeversion=process['versions']['node'];let bbpath=_0x21fe16(0x1e6),bbpath2='';const botfile=_0x21fe16(0x254),configfile=_0x21fe16(0x1b6),settingsfile='bb-settings.json',securefile=_0x21fe16(0x2ec),environment=require('./'+bbpath2+'version.json')[_0x21fe16(0x13c)]||_0x21fe16(0x134),maxBackups=0xa;let validInstallation=!![];const schedulerInterval=0x3c*0x3c*0x3e8;!fs[_0x21fe16(0x2fd)](bbpath+botfile)&&(bbpath='',validInstallation=![]);const {addClient,getAllClients,removeClient,getClient,getClientsWithBotID,getClientsWithUuid}=require('./'+bbpath2+_0x21fe16(0x2e1)),configpath=userID?bbpath+_0x21fe16(0x203)+userID+'/':bbpath+'config/',configbackuppath=configpath+_0x21fe16(0x304),logspath=userID?bbpath+'logs/'+userID+'/':bbpath+_0x21fe16(0x2ce),zippath=userID?bbpath+_0x21fe16(0x23b)+userID+'/':bbpath+_0x21fe16(0x23b),loggerfile=fs['createWriteStream'](logspath+'/output-000.log',{'flags':'a'}),temppath=userID?bbpath+_0x21fe16(0x315)+userID+'/':bbpath+'temp/';!fs[_0x21fe16(0x2fd)](configpath)&&fs[_0x21fe16(0x2f1)](configpath);!fs['existsSync'](configbackuppath)&&fs[_0x21fe16(0x2f1)](configbackuppath);!fs['existsSync'](logspath)&&fs[_0x21fe16(0x2f1)](logspath);!fs['existsSync'](zippath)&&fs['mkdirSync'](zippath);!fs[_0x21fe16(0x2fd)](temppath)&&fs[_0x21fe16(0x2f1)](temppath);const adapter=new FileSync(configpath+configfile),dbConfig=low(adapter);dbConfig[_0x21fe16(0x131)]({'bots':[]})[_0x21fe16(0x19a)]();const adapter2=new FileSync(configpath+settingsfile),dbSettings=low(adapter2);dbSettings[_0x21fe16(0x131)]({'settings':{'timeshift':0x0,'loginRequired':![],'bbUsername':'','bbPassword':'','f2aRequired':![],'lastmsgtelegram':0x0,'lastmsgemitted':0x0,'latestversion':_0x21fe16(0x2c8),'onepagemode':![],'marketcapApi':''}})['write']();const adapter3=new FileSync(configpath+securefile),dbSecure=low(adapter3);dbSecure['defaults']({'secure':{},'blacklist':[]})[_0x21fe16(0x19a)]();function _0x4615(){const _0x4b1280=['(((.+)+)+)+$','store','sockets','verify','<b>Telegram\x20Bot\x20Status:</b>\x0a','Bot\x20Mgr\x20>\x20','emit','.zip','kind','lowdb/adapters/FileSync','parse','Unauthorized\x20attempt\x20to\x20store\x20headless\x20configuration','telegramToken','graphql-request','/:bot/performance','name','Ok,\x20will\x20send\x20alert\x20notifications\x20only','/help\x20-\x20show\x20available\x20commands\x0a','hybrid-crypto-js','showConfig','$1_$2_$3','Starting\x20(','For\x20which\x20bot\x20do\x20you\x20want\x20the\x20metrics?','Unauthorized\x20user\x20-\x20make\x20sure\x20you\x27ve\x20entered\x20your\x20<b>personal</b>\x20Telegram\x20username\x20in\x20the\x20Bot\x20Manager\x27s\x20settings','listen','env','toIPv4MappedAddress','build2','bb/','isIPv4MappedAddress','sign','headless','/update\x20-\x20update\x20Balance\x20Bot\x0a','apiKey','/config\x20-\x20notification\x20types\x20to\x20receive\x0a','socket.io','notification','live','forEach','ipc','Allow\x20login\x20from\x20IP\x20address\x20','telegrammsg','sendPortfolioTelegram','0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@-#$','bot-','enabled','config_alerts','updatebotmanager','telegramUsername','bbPassword','toIPv4Address','getDate','646585RzYrrQ','value','invalid\x20credentials','uuid','restart_','config/','/:bot/configuration','update-bot','getTime','Temporary\x20access\x20rejected','-results.json','Invalid\x20IP\x20address','editMessageReplyMarkup','path','Login\x20accepted','port','find','debug','entries','getSeconds','16XqDUuF','rmSync','\x20(2)','update-bb','-----------------------------------------------------------------------------------','telegramIpApproval','date-fns','placeOrder','Login\x20rejected','botID','off_','get-backup-files','filter','family','api-eu.mixpanel.com','logged\x20out','https://pro-api.coinmarketcap.com/v2/cryptocurrency/quotes/latest','start','callback','2FA\x20login\x20required','User\x20has\x20been\x20validated','SIGTERM','Telegraf\x20error:','success','temporary\x20access\x20not\x20allowed','code','exchange','2FA\x20login\x20token\x20generated','telegramChatId','login\x20token\x20valid','crypto','Please\x20confirm\x20restoring\x20in\x20your\x20Telegram\x20bot','Restore\x20backup\x20file\x20','store-configuration','text','output-001.log','Restoring\x20bot(s)\x20from\x20backup','IPv4','bb-settings.json','-performance.json','loginRequired','zip/','Logged\x20out\x20user\x20...','Which\x20bot\x20do\x20you\x20want\x20to\x20restart?','Unauthorized\x20attempt\x20to\x20delete\x20bot','getMonth','startsWith','inherit','disconnect','new-disabled','/:bot/coins','_data','randomBytes','output-000.log','bots','track','backup-files','694282Jctspq','2FA','send','update_yes','running','tkn','secure','close','hasOwnProperty','bot.js','/enable\x20-\x20enable\x20notifications\x0a','params','apply','publicKey','botname','/start','keys','show','\x20mode','6b67f3d61ee94b8f5c80b4affef4c4d9','Notifications\x20enabled','build','Bot\x20','bcryptjs','15\x20min','-config.json','getUTCHours','replace','launch','/disable\x20-\x20disable\x20notifications\x0a','Bot\x20Mgr\x20>\x20toggling\x20Bot\x20','started','files','Allow\x20temporary\x20access\x20from\x20IP\x20address\x20','orders','27YFMtfr','*$1*','login\x20required','::ffff:127.0.0.1','timestamp','ipaddr.js','Access\x20enabled\x20for\x20','kill','portfolio_','any','yes','NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bots\x20are\x20disabled\x20by\x20default\x20-\x20enable\x20those\x20you\x20want\x20to\x20run','manual','Unauthorized\x20attempt\x20to\x20get\x20starting\x20balances','function','access','Unauthorized\x20attempt\x20to\x20update\x20bot','temporaryAccessAllowed','lastmsgtelegram','Orders','toggle_','command','download','Failed\x20to\x20download\x20','628128nxvSzW','reset-history','Unauthorized\x20attempt\x20to\x20log\x20out','Unauthorized\x20attempt\x20to\x20download\x20','mtime','referer','backup','Unauthorized\x20attempt\x20to\x20get\x20events','\x20-\x20','node-zip','temporary\x20access\x20timeout','11600PMOYuB','reinstall','Restore\x20process\x20confirmed','\x1b[0m','showname','telegramEvents','/on\x20-\x20start\x20bot(s)\x0a','Which\x20bot\x20do\x20you\x20want\x20to\x20start?','Unauthorized\x20attempt\x20to\x20update\x20settings','address\x20already\x20in\x20use','express-fileupload','deleteHistoryAlerts','endsWith','file','Unauthorized\x20attempt\x20to\x20store\x20fiat\x20configuration','HTML',':\x20Bot\x20Mgr\x20>\x20[DEBUG]\x20','chat','socket','get-portfolio','/reinstall\x20-\x20reinstall\x20Balance\x20Bot\x0a','password','backup-full','log','slice','Error\x20while\x20deleting\x20config\x20files:\x20','action','Unauthorized\x20attempt\x20to\x20place\x20market\x20order','get-logs','[ip-address]','Welcome\x20to\x20your\x20personal\x20Balance\x20Bot\x20Telegram\x20bot!\x0a','staging','\x1b[34m','args','match','Restore\x20process\x20aborted','marketcapApi','status\x20code\x20401','util','|@|','argv','hashSync','/upload-backup','-events.json','split','exec','temporary\x20access\x20rejected','Do\x20you\x20want\x20to\x20restore\x20your\x20installation?\x20NOTE:\x20this\x20will\x20replace\x20your\x20current\x20settings\x20and\x20bot(s)','button','push','remoteAddress','Notifications\x20disabled','DEFLATE','update_no','3sHKamQ','0.0.0','sendFile','timeshift','add-bot','lastmsgemitted','1180vGaKrW','logs/','clientip','isDirectory','then','update','toggle-bot-mode','resetpw_no','child_process','Notifications\x20enabled\x0a','/restart\x20-\x20restart\x20bot(s)\x0a','store-fiat','143BErDxA','=>\x20Go\x20to\x20#CYA#http://','getFullYear','storeFiat','https://api-eu-central-1.graphcms.com/v2/ckoytzv3lotky01w59glace7y/master','All\x20bots','login\x20not\x20required','880746saBUmk','clients','toggleBotMode','max','cancelLoading','Yes','Setting\x20access:\x20','Error\x20details:','config_all','/download/:type','onepagemode','Bearer\x20eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImdjbXMtbWFpbi1wcm9kdWN0aW9uIn0.eyJ2ZXJzaW9uIjozLCJpYXQiOjE2MjE2NjgzMzgsImF1ZCI6WyJodHRwczovL2FwaS1ldS1jZW50cmFsLTEuZ3JhcGhjbXMuY29tL3YyL2Nrb3l0enYzbG90a3kwMXc1OWdsYWNlN3kvbWFzdGVyIiwiaHR0cHM6Ly9tYW5hZ2VtZW50LW5leHQuZ3JhcGhjbXMuY29tIl0sImlzcyI6Imh0dHBzOi8vbWFuYWdlbWVudC5ncmFwaGNtcy5jb20vIiwic3ViIjoiYjZlOTBmODAtZmEzYS00ODJmLWE0NTAtMTY3YTFmZTliNzIzIiwianRpIjoiY2tvemZnaWE0Mno4bTAxdzU5bHU5ZTA3NSJ9.cEJ5isSubzX1ymlpkfyvfgZ6zyUMFiFOVaD4N84NoEOxwGZ8DtYM1k4DlCjoeCcTR8Ftr43bIGDxR4apANAG_-wf9Nge9T2MAuKa9z2sCWA5jnYtTHYU-x1Hx_ShpHAl1wPjrSpTMquV3bRlKQBm6EQTreoaQZgBXY25ClLbVzXFcohcDn3RGi3hHVRvxNLr0F7ETwFJnbowm9UX66vz2SP-5-u-CBKUxSipKMO5za0MZiIWoprSdE0f22xVXp8up3k_6-5x22mS88P2OFgMXoA-UBFS8nz6jRE_fRULzCouKYyJG3oQ10ovuZ1M729GQ0rMv9fkJroVKyS4i8KgglwPPBwQbaD2LCJXINKXYC65DmKyJ9UjWxQ9Lv6akcnkT7CkeqEqzwLnCEQgZEmJS_PBFDu40LMS8UbnwDcntJznA8rH_jsD7IkMdyRyXmns6fbLOc91Q1idBCk-VqUzkL0FzfscCVpkg1J7kGtGeW4YEWhWyPze4ZO4IxM9WRoSsCDUOx3EXklA0WSdR2M6IRnoFL-qoawOLQaaPACy8-QGmaAL6N6fuMIHUWavOTYnyLip0oyy74sUHz4S4sx4mAf5pexlvDcxM_6RIRnCQ84THsM2KwpoWkpR-F2s4pIyfYYn-4R7MNENfPGxNm4INjBYrCOWyZN_vXHGBa4uw2U','bb-secure.json','new','place-order','botmanager','4300639QsHKCW','mkdirSync','uuid-random','>\x20Set\x20up\x20your\x20first\x20bot\x20in\x20the\x20Bot\x20Manager!','Notifications\x20types:\x20','config_orders','search','Logged\x20in\x20user\x20...','user','use','f2aRequired','backup-full.zip','help','existsSync','File\x20uploaded','Stopping\x20Bot\x20Manager\x20and\x20starting\x20update\x20process','stopped','SIGINT','NTBA_FIX_319','full','backup/','axios','Bot\x20Mgr\x20>\x20stopping\x20Bot\x20','reason','No\x20authentication\x20token','Node.js\x20v','address','accept','whitelistEnabled','all','add','\x20minutes','stringify','decrypt','privateKey','/portfolio\x20-\x20show\x20bot\x20portfolio\x0a','error','temp/','reinstall-bb','reinstall_no','telegramEnabled','includes','sort','Invalid\x20authentication\x20token\x20(1)','private','ipv6','simple','Unauthorized\x20attempt\x20to\x20restore\x20backup\x20file','userid','telegram2FaApproval','Which\x20bot\x20do\x20you\x20want\x20to\x20toggle?','\x20only\x0a','Unauthorized\x20attempt\x20to\x20get\x20messages','tempaccess_30_','express','tempaccess_15_','************','Server','bbvReceive','\x1b[35m','remove','set','static','#RED#Balance\x20Bot\x20is\x20already\x20running\x20on\x20port\x20','copyFileSync','Starting\x20#RED#Balance\x20Bot\x20v','Starting\x20Balance\x20Bot\x20reinstallation','#RES#','test','post','2FA\x20required','off','allow','For\x20which\x20bot\x20do\x20you\x20want\x20the\x20portfolio?','join','login2fa_','get-starting-balances','/names\x20-\x20show\x20bot\x20names\x0a','https://api.ipify.org?format=json','bot','RSA','inlineKeyboard','catch','defaults','reload','\x1b[33m','production','Notifications\x20types:\x20orders\x20and\x20alerts\x0a','storeHeadless','Unauthorized\x20attempt\x20to\x20update\x20Balance\x20Bot','/:bot/portfolio','restart','Unauthorized\x20attempt\x20to\x20reinstall\x20Balance\x20Bot','mode','environment','constructor','#RES#\x20if\x20running\x20on\x20server','Unauthorized\x20attempt\x20to\x20delete\x20alerts','ETH','get','http','sendMessage','reply','binary','username','number','sendMetricsTelegram','once','Starting\x20Balance\x20Bot\x20update','config','blacklist','Are\x20you\x20sure\x20you\x20want\x20to\x20update\x20Balance\x20Bot\x20now?','createServer','Do\x20you\x20want\x20to\x20reset\x20your\x20password?','reject','auto','compareSync','event','\x20|\x20','restore-backup-file','Are\x20you\x20sure\x20you\x20want\x20to\x20reinstall\x20Balance\x20Bot\x20now?','readdirSync','exp','metrics','expiry','type','message','format','No\x20bots\x20running\x20right\x20now','Error:\x20Invalid\x20argument\x20','secret','title','encryptedUuid','\x20to\x20','backup-full@',':\x20Bot\x20Mgr\x20>\x20','cloneDeep','data','1000','Backup\x20file\x20uploaded','uncaughtException','latestversion','warning','server','settings','(staging)','token','921490Ndpwmp','/off\x20-\x20stop\x20bot(s)\x0a','Unauthorized\x20attempt\x20to\x20add\x20bot','Password\x20reset\x20rejected','get-messages','toggle','sortBy','<b>Balance\x20Bot\x20Status:</b>\x0a','map','apiPassword','getStartingBalances','restore_yes_','bbvNew','writeFileSync','Unauthorized\x20attempt\x20to\x20reset\x20bot\x20history','tempaccess_5_','whitelist','getHours','Restarting\x20Bot\x20','alias','CoinMarketCap\x20API\x20key\x20is\x20invalid\x20-\x20enter\x20your\x20API\x20key\x20in\x20the\x20Bot\x20Manager','from','messages','Idling\x20(','pidRefreshToken','Ok,\x20reinstalling\x20Balance\x20Bot\x20canceled','order','Enabled\x20Bot\x20','padStart',',\x20must\x20be\x20a\x204\x20digit\x20number','range','store-settings','length','output-002.log','index.html','RSA-OAEP','::1','Unauthorized\x20attempt\x20to\x20confirm\x20message','Ok,\x20will\x20send\x20order\x20notifications\x20only','toString','Which\x20bot\x20do\x20you\x20want\x20to\x20stop?','write','logout','access\x20timeout','unlinkSync','/status\x20-\x20show\x20bot(s)\x20status\x0a','stop','Unauthorized\x20attempt\x20to\x20upload\x20file\x20(1)','login','Disabled\x20Bot\x20','bbUsername','emitHistory','string','#RES#\x20','exit','temporary\x20token\x20generated','\x1b[36m','confirm-message','getMinutes','CoinMarketCap\x20API\x20key\x20validated','headers','Invalid\x20authentication\x20token\x20(2)','CoinMarketCap\x20data\x20could\x20not\x20be\x20retrieved\x20-\x20see\x20logs\x20for\x20details','status','readFileSync','disabled','conn','Alerts','/:bot/support','bb-config.json',')\x20\x20\x20|\x20Bot\x20','Crypt','\x20>\x20','Unauthorized\x20attempt\x20to\x20show\x20configuration','=>\x20Go\x20to\x20#CYA#http://127.0.0.1:','\x1b[31m','removeAllListeners','initclient','handshake','All\x20bots\x20running\x20right\x20now','***','statSync','Telegram\x20error:','Network\x20Interfaces:','5\x20min','pidExpireLogin','#RES#\x20if\x20running\x20locally\x0a','Ok,\x20will\x20send\x20both\x20order\x20and\x20alert\x20notifications','assign'];_0x4615=function(){return _0x4b1280;};return _0x4615();}let crypt=new Crypt({'md':'sha256','rsaStandard':_0x21fe16(0x194)});const saltRounds=0xa,mixpanel=Mixpanel['init'](_0x21fe16(0x25e),{'host':_0x21fe16(0x220)});let config=getConfiguration(),settings=getSettings(),secure=getSecure(),blacklist=getBlacklist(),tgBot;if(settings[_0x21fe16(0x1d6)]&&(settings[_0x21fe16(0x1d6)]!=''&&settings[_0x21fe16(0x1d6)]!=_0x21fe16(0x1c1))&&settings[_0x21fe16(0x1fa)]&&settings['telegramUsername']!='')initTelegram();const parseColor=(_0x512b93,_0x8b001b)=>{const _0x137702=_0x21fe16,_0x515c52=/#[A-Z]{3}#/g;if(typeof _0x512b93==_0x137702(0x1a5)){!_0x8b001b?_0x512b93=_0x512b93['replace'](_0x515c52,''):(_0x512b93=_0x512b93[_0x137702(0x266)](/#BLU#/g,_0x137702(0x2b1)),_0x512b93=_0x512b93[_0x137702(0x266)](/#RED#/g,_0x137702(0x1bc)),_0x512b93=_0x512b93['replace'](/#YEL#/g,_0x137702(0x133)),_0x512b93=_0x512b93[_0x137702(0x266)](/#MAG#/g,_0x137702(0x119)),_0x512b93=_0x512b93['replace'](/#CYA#/g,_0x137702(0x1a9)),_0x512b93=_0x512b93[_0x137702(0x266)](/#RES#/g,_0x137702(0x294)));;}return _0x512b93;},logger={'screen':_0x32ac55=>{const _0x3ec1cb=_0x21fe16;console[_0x3ec1cb(0x2a8)](parseColor(_0x32ac55,!![]));},'simple':_0x475804=>{const _0x52a9cd=_0x21fe16;console['log'](parseColor(_0x475804,!![])),loggerfile[_0x52a9cd(0x19a)](util[_0x52a9cd(0x15d)](parseColor(_0x475804,![]))+'\x0a');},'full':async _0x35ade9=>{const _0x4c7523=_0x21fe16,_0x4bc0d1=getTimeStamp()+_0x4c7523(0x165)+_0x35ade9;console[_0x4c7523(0x2a8)](parseColor(_0x4bc0d1,!![])),loggerfile['write'](util[_0x4c7523(0x15d)](parseColor(_0x4bc0d1,![]))+'\x0a');if(tgBot&&settings[_0x4c7523(0x22e)]&&settings['telegramEvents']!=_0x4c7523(0x26d))await sendTelegram(settings['telegramChatId'],_0x4c7523(0x1cf)+parseColor(_0x35ade9,![]));},'debug':async(_0x30229a,_0x94e13f='')=>{const _0x167297=_0x21fe16,_0xb19c1c=getTimeStamp()+_0x167297(0x2a1)+_0x30229a;if(debugging)console['log'](parseColor(_0xb19c1c,!![]));loggerfile[_0x167297(0x19a)](util[_0x167297(0x15d)](parseColor(_0xb19c1c,![]))+'\x0a');if(_0x94e13f){if(debugging)console[_0x167297(0x2a8)](_0x94e13f);loggerfile['write'](util['format'](_0x94e13f)+'\x0a');}}};let terminating=![];process['on'](_0x21fe16(0x16a),function(_0x50f29a){const _0x230b6a=_0x21fe16;_0x50f29a[_0x230b6a(0x198)]()[_0x230b6a(0x319)](_0x230b6a(0x29a))?(logger[_0x230b6a(0x10c)](_0x230b6a(0x11d)+_0x50f29a[_0x230b6a(0x20d)]+_0x230b6a(0x121)),process[_0x230b6a(0x24d)]({'terminate':!![]},_0x6f4cc3=>{})):logger[_0x230b6a(0x10c)](_0x50f29a);}),process['on'](_0x21fe16(0x1a7),()=>{const _0x13af5d=_0x21fe16;stopAllBots(),process[_0x13af5d(0x1a7)](0x0);}),process['on'](_0x21fe16(0x227),()=>{stopAllBots(),process['exit'](0x0);}),process['on'](_0x21fe16(0x301),()=>{const _0x13d331=_0x21fe16;stopAllBots(),process[_0x13d331(0x1a7)](0x0);});let restoredConfigFile=0x0,newBot=![],pid=[];const serverversion=require('./'+bbpath2+'version.json')['version'],maxSecretAge=0xa,loginExpiry=0x4*0x3c,tokenRefresh=0x5;let tmpStorage={},devices=[],lastIpApproval,pidScheduler,installingUpdate=![],publicip,newMessages=[],updateAvailable=![];const express=require(_0x21fe16(0x114)),app=express(),http=require(_0x21fe16(0x142))[_0x21fe16(0x14e)](app);app[_0x21fe16(0x2f9)](fileUpload({'useTempFiles':!![]})),app['get'](_0x21fe16(0x2e9),async(_0x5e1e75,_0x13ad5f)=>{const _0x3dbc03=_0x21fe16,_0x48ab68=_0x5e1e75[_0x3dbc03(0x256)]['type'],_0x32b83b=getClientsWithBotID(_0x3dbc03(0x2ef)),_0x1e4a91=_0x5e1e75[_0x3dbc03(0x1ad)][_0x3dbc03(0x201)],_0x7d1645=timelyDecrypt(_0x1e4a91,![]),_0x43260d=_0x32b83b[_0x3dbc03(0x20e)](_0x15c892=>_0x15c892[_0x3dbc03(0x201)]==_0x7d1645);if(_0x43260d){const _0x4f4c28=normalizeIP(_0x5e1e75['socket'][_0x3dbc03(0x2c3)])[_0x3dbc03(0x1cb)],_0x549176=_0x5e1e75[_0x3dbc03(0x1ad)]['tkn'];if(validateAccess(_0x549176,_0x7d1645,_0x4f4c28)[_0x3dbc03(0x126)])_0x48ab68==_0x3dbc03(0x28c)&&await backupConfigFiles(),await zipFiles(_0x48ab68),_0x13ad5f[_0x3dbc03(0x284)](zippath+(_0x48ab68+'.zip'),_0x1d57e2=>{const _0x119e71=_0x3dbc03;_0x1d57e2&&(logger['full'](_0x119e71(0x285)+_0x48ab68),logger[_0x119e71(0x10c)](_0x1d57e2));});else logger[_0x3dbc03(0x303)](_0x3dbc03(0x289)+_0x48ab68+'\x20(1)');}else logger[_0x3dbc03(0x303)](_0x3dbc03(0x289)+_0x48ab68+_0x3dbc03(0x214));}),app[_0x21fe16(0x123)](_0x21fe16(0x2bb),async(_0x55d042,_0x4d1c92)=>{const _0x15cdd1=_0x21fe16,_0x855408=getClientsWithBotID(_0x15cdd1(0x2ef)),_0x2da617=_0x55d042[_0x15cdd1(0x1ad)][_0x15cdd1(0x201)],_0x31874c=timelyDecrypt(_0x2da617,![]),_0x4d1b1f=_0x855408['find'](_0x390317=>_0x390317[_0x15cdd1(0x201)]==_0x31874c);logger[_0x15cdd1(0x20f)](_0x15cdd1(0x169));if(_0x4d1b1f){const _0x462d1e=normalizeIP(_0x55d042[_0x15cdd1(0x2a3)][_0x15cdd1(0x2c3)])[_0x15cdd1(0x1cb)],_0x26dcce=_0x55d042['headers'][_0x15cdd1(0x250)];if(validateAccess(_0x26dcce,_0x31874c,_0x462d1e)[_0x15cdd1(0x126)]){if(_0x55d042[_0x15cdd1(0x26b)]){const _0x177858=_0x55d042[_0x15cdd1(0x26b)]['backupfile'];await _0x177858['mv'](temppath+_0x177858[_0x15cdd1(0x1d9)]),_0x4d1c92['send']({'status':!![],'message':_0x15cdd1(0x2fe)});const _0x1c6bb9=getBotsWithMode();_0x1c6bb9['length']>0x0?confirmRestore(temppath,_0x177858['name']):unzipFile(temppath,_0x177858[_0x15cdd1(0x1d9)]);}}else logger[_0x15cdd1(0x303)](_0x15cdd1(0x1a0));}else logger[_0x15cdd1(0x303)]('Unauthorized\x20attempt\x20to\x20upload\x20file\x20(2)');}),app[_0x21fe16(0x2f9)](express['static'](path['join'](__dirname,bbpath2,_0x21fe16(0x1e5)))),app[_0x21fe16(0x2f9)](express[_0x21fe16(0x11c)](path[_0x21fe16(0x128)](__dirname,bbpath2,_0x21fe16(0x260)))),app['get']('/',function(_0x2483ff,_0x591101){const _0x5446e1=_0x21fe16;_0x591101[_0x5446e1(0x2c9)](path[_0x5446e1(0x128)](__dirname,bbpath2,'build2',_0x5446e1(0x193)));}),app[_0x21fe16(0x141)]('/:bot',function(_0x5982d9,_0x3b4513){const _0x3ef0b8=_0x21fe16;_0x3b4513['sendFile'](path[_0x3ef0b8(0x128)](__dirname,bbpath2,_0x3ef0b8(0x260),_0x3ef0b8(0x193)));}),app[_0x21fe16(0x141)](_0x21fe16(0x138),(_0x45cd43,_0x3b76e9)=>{const _0x457706=_0x21fe16;_0x3b76e9[_0x457706(0x2c9)](path[_0x457706(0x128)](__dirname,bbpath2,_0x457706(0x260),_0x457706(0x193)));}),app[_0x21fe16(0x141)](_0x21fe16(0x1d8),(_0x502517,_0x388167)=>{const _0x161299=_0x21fe16;_0x388167[_0x161299(0x2c9)](path['join'](__dirname,bbpath2,_0x161299(0x260),'index.html'));}),app['get'](_0x21fe16(0x244),(_0x46bffe,_0x4203e7)=>{const _0x332445=_0x21fe16;_0x4203e7[_0x332445(0x2c9)](path['join'](__dirname,bbpath2,'build',_0x332445(0x193)));}),app[_0x21fe16(0x141)]('/:bot/history',(_0x404de5,_0x16ddab)=>{const _0x25deb6=_0x21fe16;_0x16ddab[_0x25deb6(0x2c9)](path[_0x25deb6(0x128)](__dirname,bbpath2,_0x25deb6(0x260),'index.html'));}),app[_0x21fe16(0x141)](_0x21fe16(0x204),(_0x16926a,_0x50b248)=>{const _0x42d029=_0x21fe16;_0x50b248[_0x42d029(0x2c9)](path['join'](__dirname,bbpath2,_0x42d029(0x260),'index.html'));}),app[_0x21fe16(0x141)](_0x21fe16(0x1b5),(_0x81e0b,_0x51b034)=>{const _0x5a9c05=_0x21fe16;_0x51b034[_0x5a9c05(0x2c9)](path[_0x5a9c05(0x128)](__dirname,bbpath2,_0x5a9c05(0x260),_0x5a9c05(0x193)));});if(HOST)http['listen'](PORT,HOST);else http[_0x21fe16(0x1e2)](PORT);const io=require(_0x21fe16(0x1ed))(http,{});init();async function init(){await validateConfigFile(),await initUser(),await initSecure(),oneTimeMigration(),cleanBlacklist(),initStates(),await startServer();if(restoredConfigFile)restoreConfigNotify(![]);startSocket(),startScheduler(),triggerAnalytics(),getMessages(),reloadBotManager();}function getServerIP(){const _0x40d955=_0x21fe16;let _0x5a42bb=_0x40d955(0x2ae);const _0x27b04c=networkInterfaces(),_0x3b136b={};for(const _0x158f16 of Object['keys'](_0x27b04c)){for(const _0x694f27 of _0x27b04c[_0x158f16]){if((_0x694f27['family']==_0x40d955(0x237)||_0x694f27[_0x40d955(0x21f)]==0x4)&&!_0x694f27['internal']){const _0x7e3eb8=ipaddr[_0x40d955(0x1d4)](_0x694f27[_0x40d955(0x30a)])[_0x40d955(0x18f)]();_0x7e3eb8!=_0x40d955(0x10a)&&(!_0x3b136b[_0x158f16]&&(_0x3b136b[_0x158f16]=[]),_0x3b136b[_0x158f16][_0x40d955(0x2c2)](_0x694f27[_0x40d955(0x30a)]),_0x5a42bb=_0x694f27[_0x40d955(0x30a)]);}}}return{'serverip':_0x5a42bb,'netinterfaces':_0x3b136b};}async function startServer(){const _0x380403=_0x21fe16,{serverip:_0x3e5bfc,netinterfaces:_0x593fc0}=getServerIP();logger[_0x380403(0x10c)](''),logger[_0x380403(0x10c)](_0x380403(0x216)),await logger[_0x380403(0x303)](_0x380403(0x11f)+serverversion+_0x380403(0x1a6)+(environment==_0x380403(0x2b0)?_0x380403(0x16f):'')+'\x0a'+(_0x380403(0x1bb)+PORT+_0x380403(0x1c7))+(_0x380403(0x2da)+_0x3e5bfc+':'+PORT+_0x380403(0x13e))),logger['simple'](_0x380403(0x216));if(config['length']!=0x0)for(const _0x25fd90 of config){const _0x5dfb10=_0x25fd90['mode']==_0x380403(0x151)?'a':'m';if(_0x25fd90['status']=='enabled'||_0x25fd90['status']==_0x380403(0x2ed))await logger['full'](_0x380403(0x1df)+_0x5dfb10+')\x20|\x20Bot\x20'+_0x25fd90[_0x380403(0x21b)]+_0x380403(0x154)+_0x25fd90[_0x380403(0x259)]),startBot([_0x25fd90[_0x380403(0x21b)],userID],{'cwd':bbpath},function(_0x5f1fc6){const _0x693842=_0x380403;if(_0x5f1fc6)logger[_0x693842(0x303)](_0x5f1fc6);});else(_0x25fd90[_0x380403(0x1b0)]==_0x380403(0x1b2)||_0x25fd90['status']==_0x380403(0x243))&&await logger[_0x380403(0x303)](_0x380403(0x188)+_0x5dfb10+_0x380403(0x1b7)+_0x25fd90[_0x380403(0x21b)]+_0x380403(0x154)+_0x25fd90[_0x380403(0x259)]);}else!newBot&&logger[_0x380403(0x10c)](_0x380403(0x2f3));if(newBot)addBot();logger['simple'](_0x380403(0x216)),logger[_0x380403(0x10c)](''),await logger[_0x380403(0x20f)](_0x380403(0x309)+nodeversion),await logger[_0x380403(0x20f)](_0x380403(0x1c4),_0x593fc0);}function startSocket(){io['on']('connection',_0x10413c=>{const _0x3f1047=_0x10d2;let _0x35c23d,_0x197ffe,_0x18c18d,_0x5d9a3c,_0x4fccce;const _0x45acd3=_0x10413c['handshake'][_0x3f1047(0x1ad)][_0x3f1047(0x28b)];_0x197ffe=_0x45acd3['match'](/bot[0-9]{3}/);if(_0x197ffe)_0x18c18d=_0x197ffe[0x0][_0x3f1047(0x2b3)](/[0-9]{3}/);if(_0x18c18d)_0x35c23d=_0x18c18d[0x0];else _0x35c23d='botmanager';const _0xb93e8f=_0x10413c[_0x3f1047(0x1bf)]['auth'][_0x3f1047(0x162)];if(!_0xb93e8f)_0x10413c[_0x3f1047(0x1d0)]('status',{'publicKey':secure[_0x3f1047(0x258)]});else{_0x5d9a3c=timelyDecrypt(_0xb93e8f,![]);if(!_0x5d9a3c)_0x10413c[_0x3f1047(0x1d0)](_0x3f1047(0x1b0),{'publicKey':secure['publicKey']});else{_0x4fccce=normalizeIP(_0x10413c[_0x3f1047(0x1b3)]['remoteAddress'])[_0x3f1047(0x1cb)];if(!devices[_0x5d9a3c])devices[_0x5d9a3c]={'uuid':_0x5d9a3c,'access':{'token':null}};devices[_0x5d9a3c]['ip']=_0x4fccce;const _0x16b7ba=addClient(_0x10413c['id'],_0x5d9a3c,_0x35c23d);setAccess(_0x16b7ba),emitMessages(),_0x10413c['on'](_0x3f1047(0x1a1),_0x5ef354=>{const _0x5bd5eb=_0x3f1047,_0xd755c8=timelyDecrypt(_0x5ef354[_0x5bd5eb(0x2a6)],!![],_0x5bd5eb(0x2b8));if(_0xd755c8){_0x5ef354={'username':_0x5ef354[_0x5bd5eb(0x146)],'password':_0xd755c8},devices[_0x5d9a3c][_0x5bd5eb(0x27d)]=validateCredentials(_0x5ef354,_0x5d9a3c);if(devices[_0x5d9a3c][_0x5bd5eb(0x27d)][_0x5bd5eb(0x126)]==![]&&devices[_0x5d9a3c][_0x5bd5eb(0x27d)][_0x5bd5eb(0x307)]=='2FA\x20login\x20required')_0x10413c[_0x5bd5eb(0x1d0)](_0x5bd5eb(0x1b0),{'access':devices[_0x5d9a3c]['access']}),loginAccess2FA(_0x5d9a3c,_0x4fccce);else{if(devices[_0x5d9a3c][_0x5bd5eb(0x27d)][_0x5bd5eb(0x126)]==![]&&devices[_0x5d9a3c][_0x5bd5eb(0x27d)][_0x5bd5eb(0x307)]==_0x5bd5eb(0x200))_0x10413c[_0x5bd5eb(0x1d0)](_0x5bd5eb(0x1b0),{'access':devices[_0x5d9a3c]['access']});else devices[_0x5d9a3c][_0x5bd5eb(0x27d)]['allow']&&devices[_0x5d9a3c][_0x5bd5eb(0x27d)]['reason']=='login\x20token\x20generated'&&(getClientsWithUuid(_0x5d9a3c)[_0x5bd5eb(0x1f0)](_0x4d3ed9=>{setAccess(_0x4d3ed9);}),logger[_0x5bd5eb(0x20f)](_0x5bd5eb(0x2f7)+_0x5d9a3c[_0x5bd5eb(0x2a9)](-0x8)),setTokenRefresh(_0x5d9a3c),setSessionTimeout(_0x5bd5eb(0x1a1),_0x5d9a3c));}}else logger[_0x5bd5eb(0x303)]('Unauthorized\x20login\x20attempt\x20(timeout)');}),_0x10413c['on']('reset-password',()=>{resetPassword();}),_0x10413c['on'](_0x3f1047(0x242),_0x4d7142=>{removeClient(_0x10413c['id']);}),_0x35c23d=='botmanager'&&(restoredConfigFile&&(restoreConfigNotify(!![]),restoredConfigFile=0x0));}}});}function initClient(_0x5b6428){const _0x32624c=_0x21fe16;if(_0x5b6428!=_0x32624c(0x2ef)&&config['apiKey']!=''){if(pid[_0x5b6428])pid[_0x5b6428][_0x32624c(0x24d)]({'function':_0x32624c(0x1be),'args':null});}_0x5b6428!=_0x32624c(0x2ef)&&broadcastToBots('bots',JSON[_0x32624c(0x310)](config));}function reloadBotManager(){const _0x146a47=_0x21fe16;getClientsWithBotID('botmanager')[_0x146a47(0x1f0)](_0x4aaae6=>{const _0x57f251=_0x146a47;getSocket(_0x4aaae6['id'])[_0x57f251(0x1d0)](_0x57f251(0x1b0),{'access':{'allow':![],'reason':_0x57f251(0x132),'token':null}});});}function getSocket(_0x9f688d){const _0x30b74b=_0x21fe16;return io[_0x30b74b(0x1cc)][_0x30b74b(0x1cc)][_0x30b74b(0x141)](_0x9f688d);}function setAccess(_0x1b2a08){const _0x5dcaa9=_0x21fe16,_0x24d27b=getSocket(_0x1b2a08['id']),_0x28f3ed=_0x1b2a08[_0x5dcaa9(0x201)],_0x3a2485=_0x1b2a08[_0x5dcaa9(0x12d)];devices[_0x28f3ed][_0x5dcaa9(0x27d)]=validateAccess(devices[_0x28f3ed][_0x5dcaa9(0x27d)][_0x5dcaa9(0x170)],_0x28f3ed),logger[_0x5dcaa9(0x20f)](_0x5dcaa9(0x2e6)+devices[_0x28f3ed]['access']['reason']+'\x20|\x20client:\x20...'+_0x1b2a08['id'][_0x5dcaa9(0x2a9)](-0x8)+'\x20|\x20user:\x20...'+_0x28f3ed[_0x5dcaa9(0x2a9)](-0x8)),_0x24d27b['join'](_0x28f3ed);if(devices[_0x28f3ed][_0x5dcaa9(0x27d)][_0x5dcaa9(0x126)]){_0x24d27b[_0x5dcaa9(0x128)](_0x3a2485);if(_0x3a2485==_0x5dcaa9(0x2ef))initializeSocketBotManager(_0x24d27b);else initializeSocketBot(_0x24d27b);initClient(_0x3a2485);}devices[_0x28f3ed][_0x5dcaa9(0x27d)]['token']&&devices[_0x28f3ed][_0x5dcaa9(0x27d)][_0x5dcaa9(0x307)]==_0x5dcaa9(0x1a8)&&setSessionTimeout(_0x5dcaa9(0x24c),_0x28f3ed),devices[_0x28f3ed][_0x5dcaa9(0x27d)][_0x5dcaa9(0x170)]&&devices[_0x28f3ed][_0x5dcaa9(0x27d)][_0x5dcaa9(0x307)]==_0x5dcaa9(0x22d)&&setSessionTimeout(_0x5dcaa9(0x1a1),_0x28f3ed),_0x24d27b[_0x5dcaa9(0x1d0)](_0x5dcaa9(0x1b0),{'status':_0x1b2a08[_0x5dcaa9(0x16d)],'serverversion':serverversion,'environment':environment,'servertime':getServerTime(),'access':devices[_0x28f3ed][_0x5dcaa9(0x27d)],'externalip':devices[_0x28f3ed]['ip'],'publicKey':secure[_0x5dcaa9(0x258)],'userid':settings[_0x5dcaa9(0x10e)],'validInstallation':validInstallation}),devices[_0x28f3ed]['access'][_0x5dcaa9(0x126)]==![]&&devices[_0x28f3ed][_0x5dcaa9(0x27d)][_0x5dcaa9(0x307)]=='2FA\x20required'&&temporaryAccess2FA(_0x28f3ed,devices[_0x28f3ed]['ip']);}function setSessionTimeout(_0x23da40,_0x4cfec0){const _0x348402=_0x21fe16;let _0x143b13;if(_0x23da40==_0x348402(0x1a1))_0x143b13=loginExpiry*0x3c*0x3e8;else _0x143b13=devices[_0x4cfec0][_0x348402(0x217)][_0x348402(0x15a)]*0x3c*0x3e8-(new Date()[_0x348402(0x206)]()-devices[_0x4cfec0][_0x348402(0x217)][_0x348402(0x272)]);if(devices[_0x4cfec0]['pidExpireLogin'])clearTimeout(devices[_0x4cfec0]['pidExpireLogin']);devices[_0x4cfec0][_0x348402(0x1c6)]=setTimeout(()=>{const _0x5e6fc4=_0x348402;if(devices[_0x4cfec0][_0x5e6fc4(0x189)])clearTimeout(devices[_0x4cfec0][_0x5e6fc4(0x189)]);removeSocketListeners(_0x4cfec0),addBlacklist(_0x4cfec0),devices[_0x4cfec0][_0x5e6fc4(0x217)]=null,devices[_0x4cfec0][_0x5e6fc4(0x10f)]=null,devices[_0x4cfec0]['access'][_0x5e6fc4(0x170)]=null,logger['debug']('Session\x20expired\x20for\x20user\x20...'+_0x4cfec0[_0x5e6fc4(0x2a9)](-0x8)),devices[_0x4cfec0][_0x5e6fc4(0x27d)]=validateAccess(devices[_0x4cfec0][_0x5e6fc4(0x27d)][_0x5e6fc4(0x170)],_0x4cfec0),!(devices[_0x4cfec0][_0x5e6fc4(0x27d)][_0x5e6fc4(0x126)]&&devices[_0x4cfec0][_0x5e6fc4(0x27d)][_0x5e6fc4(0x307)]==_0x5e6fc4(0x2df))&&(_0x23da40=='login'?io['to'](_0x4cfec0)[_0x5e6fc4(0x1d0)](_0x5e6fc4(0x1b0),{'access':{'allow':![],'reason':_0x5e6fc4(0x19c),'token':null}}):io['to'](_0x4cfec0)[_0x5e6fc4(0x1d0)]('status',{'access':{'allow':![],'reason':_0x5e6fc4(0x290),'token':null}})),devices[_0x4cfec0][_0x5e6fc4(0x27d)][_0x5e6fc4(0x170)]=null;},_0x143b13);}function setTokenRefresh(_0x11046b){const _0x376a7a=_0x21fe16;if(devices[_0x11046b][_0x376a7a(0x189)])clearTimeout(devices[_0x11046b][_0x376a7a(0x189)]);devices[_0x11046b][_0x376a7a(0x189)]=setTimeout(()=>{const _0x23c69f=_0x376a7a;getClientsWithUuid(_0x11046b)[_0x23c69f(0x191)]!=0x0?(devices[_0x11046b][_0x23c69f(0x27d)]=refreshToken(_0x11046b),io['to'](_0x11046b)[_0x23c69f(0x1d0)](_0x23c69f(0x1b0),{'status':'connected','serverversion':serverversion,'environment':environment,'servertime':getServerTime(),'access':devices[_0x11046b][_0x23c69f(0x27d)],'externalip':devices[_0x11046b]['ip'],'publicKey':secure[_0x23c69f(0x258)],'validInstallation':validInstallation}),setTokenRefresh(_0x11046b)):clearTimeout(devices[_0x11046b][_0x23c69f(0x189)]);},(tokenRefresh-0x1)*0x3c*0x3e8);}function initializeSocketBotManager(_0x205d78){const _0x4f7e6d=_0x21fe16,_0x7fb8c8=getClient(_0x205d78['id'])[_0x4f7e6d(0x201)];_0x205d78[_0x4f7e6d(0x1d0)](_0x4f7e6d(0x248),config),_0x205d78[_0x4f7e6d(0x1d0)]('settings',cleanSettings()),_0x205d78['on'](_0x4f7e6d(0x2cb),_0x55fcae=>{const _0x2c8524=_0x4f7e6d;if(validateAccess(_0x55fcae,_0x7fb8c8)['allow'])addBot();else logger[_0x2c8524(0x303)](_0x2c8524(0x173));}),_0x205d78['on'](_0x4f7e6d(0x205),(_0x533655,_0x27d2f6)=>{const _0x51e705=_0x4f7e6d;if(validateAccess(_0x27d2f6,_0x7fb8c8)[_0x51e705(0x126)])toggleBot(_0x533655['botID'],_0x533655[_0x51e705(0x1b0)],_0x533655[_0x51e705(0x1ef)]);else logger[_0x51e705(0x303)]('Unauthorized\x20attempt\x20to\x20update\x20bot');}),_0x205d78['on'](_0x4f7e6d(0x2d3),(_0x1f9de4,_0xd18e93)=>{const _0x123426=_0x4f7e6d;if(validateAccess(_0xd18e93,_0x7fb8c8)[_0x123426(0x126)])toggleBotMode(_0x1f9de4);else logger[_0x123426(0x303)](_0x123426(0x27e));}),_0x205d78['on']('delete-bot',(_0x5bc013,_0x9fee96)=>{const _0x36d7a1=_0x4f7e6d;if(validateAccess(_0x9fee96,_0x7fb8c8)['allow'])deleteBot(_0x5bc013);else logger[_0x36d7a1(0x303)](_0x36d7a1(0x23e));}),_0x205d78['on'](_0x4f7e6d(0x190),(_0x212305,_0x5ecedd)=>{const _0x57390b=_0x4f7e6d;if(validateAccess(_0x5ecedd,_0x7fb8c8)[_0x57390b(0x126)])storeSettings(_0x212305,!![]);else logger[_0x57390b(0x303)](_0x57390b(0x299));}),_0x205d78['on'](_0x4f7e6d(0x215),_0x2dba6d=>{const _0x1d4dfa=_0x4f7e6d;if(validateAccess(_0x2dba6d,_0x7fb8c8)[_0x1d4dfa(0x126)])updateBB(_0x1d4dfa(0x2d2));else logger[_0x1d4dfa(0x303)](_0x1d4dfa(0x137));}),_0x205d78['on'](_0x4f7e6d(0x316),_0x17f4bf=>{const _0x157cbd=_0x4f7e6d;if(validateAccess(_0x17f4bf,_0x7fb8c8)[_0x157cbd(0x126)])updateBB(_0x157cbd(0x292));else logger[_0x157cbd(0x303)](_0x157cbd(0x13a));}),_0x205d78['on'](_0x4f7e6d(0x21d),_0x41adff=>{const _0x13aea7=_0x4f7e6d;if(validateAccess(_0x41adff,_0x7fb8c8)['allow']){const _0x282c24=getClient(_0x205d78['id']);if(_0x282c24)getBackupFiles(_0x282c24['uuid']);else logger[_0x13aea7(0x303)]('Unknown\x20client\x20attempting\x20to\x20retrieve\x20list\x20of\x20backup\x20files');}else logger[_0x13aea7(0x303)]('Unauthorized\x20attempt\x20to\x20retrieve\x20list\x20of\x20backup\x20files');}),_0x205d78['on'](_0x4f7e6d(0x155),(_0x219cea,_0x40b96d)=>{const _0x399c0f=_0x4f7e6d;if(validateAccess(_0x40b96d,_0x7fb8c8)[_0x399c0f(0x126)])restoreBackupFile(_0x219cea);else logger[_0x399c0f(0x303)](_0x399c0f(0x10d));}),_0x205d78['on'](_0x4f7e6d(0x175),_0x449d08=>{const _0x1a9b96=_0x4f7e6d;if(validateAccess(_0x449d08,_0x7fb8c8)[_0x1a9b96(0x126)])getMessages();else logger[_0x1a9b96(0x303)](_0x1a9b96(0x112));}),_0x205d78['on'](_0x4f7e6d(0x1aa),(_0x7ce8e5,_0x49dcc0)=>{const _0xc07a13=_0x4f7e6d;if(validateAccess(_0x49dcc0,_0x7fb8c8)[_0xc07a13(0x126)])confirmMessage(_0x7ce8e5);else logger[_0xc07a13(0x303)](_0xc07a13(0x196));}),_0x205d78['on'](_0x4f7e6d(0x19b),_0x84a928=>{const _0x5c5e7f=_0x4f7e6d;if(validateAccess(_0x84a928,_0x7fb8c8)[_0x5c5e7f(0x126)]){if(devices[_0x7fb8c8]['pidRefreshToken'])clearTimeout(devices[_0x7fb8c8][_0x5c5e7f(0x189)]);if(devices[_0x7fb8c8][_0x5c5e7f(0x1c6)])clearTimeout(devices[_0x7fb8c8][_0x5c5e7f(0x1c6)]);removeSocketListeners(getClient(_0x205d78['id'])['uuid']),addBlacklist(_0x7fb8c8),devices[_0x7fb8c8]['telegramIpApproval']=null,devices[_0x7fb8c8][_0x5c5e7f(0x10f)]=null,devices[_0x7fb8c8][_0x5c5e7f(0x27d)][_0x5c5e7f(0x170)]=null,logger[_0x5c5e7f(0x20f)](_0x5c5e7f(0x23c)+_0x7fb8c8[_0x5c5e7f(0x2a9)](-0x8)),io['to'](getClient(_0x205d78['id'])[_0x5c5e7f(0x201)])['emit'](_0x5c5e7f(0x1b0),{'access':{'allow':![],'reason':_0x5c5e7f(0x221),'token':null}});}else logger[_0x5c5e7f(0x303)]('Unauthorized\x20attempt\x20to\x20log\x20out');});}function initializeSocketBot(_0xf389ca){const _0x458d8e=_0x21fe16,_0x4b7fe8=getClient(_0xf389ca['id'])[_0x458d8e(0x12d)],_0x1245ea=getClient(_0xf389ca['id'])[_0x458d8e(0x201)];_0xf389ca['on'](_0x458d8e(0x2ad),(_0x1cdea2,_0x25cb00)=>{const _0x53e047=_0x458d8e;if(validateAccess(_0x25cb00,_0x1245ea)[_0x53e047(0x126)]){if(pid[_0x4b7fe8])pid[_0x4b7fe8][_0x53e047(0x24d)]({'function':_0x53e047(0x1a4),'args':_0x1cdea2});}else logger['full'](_0x53e047(0x28d));}),_0xf389ca['on']('delete-alerts',(_0x4c7ce2,_0x1c04a8)=>{const _0xf458a5=_0x458d8e;if(validateAccess(_0x1c04a8,_0x1245ea)['allow']){if(pid[_0x4b7fe8])pid[_0x4b7fe8][_0xf458a5(0x24d)]({'function':_0xf458a5(0x29c),'args':_0x4c7ce2});}else logger[_0xf458a5(0x303)](_0xf458a5(0x13f));}),_0xf389ca['on'](_0x458d8e(0x2a4),(_0x3d23a1,_0x724620)=>{const _0x4e1958=_0x458d8e;if(validateAccess(_0x724620,_0x1245ea)['allow']){if(pid[_0x4b7fe8])pid[_0x4b7fe8][_0x4e1958(0x24d)]({'function':'getPortfolio','args':_0x3d23a1});}else logger[_0x4e1958(0x303)]('Unauthorized\x20attempt\x20to\x20get\x20portfolio');}),_0xf389ca['on'](_0x458d8e(0x233),(_0x4b79a5,_0x3b6128)=>{const _0x4c9900=_0x458d8e;if(validateAccess(_0x3b6128,_0x1245ea)['allow']){if(pid[_0x4b7fe8])pid[_0x4b7fe8]['send']({'function':'storeConfiguration','args':_0x4b79a5});}else logger[_0x4c9900(0x303)]('Unauthorized\x20attempt\x20to\x20store\x20configuration');}),_0xf389ca['on']('store-headless',(_0x3b7b1a,_0x3a617b)=>{const _0x5e4356=_0x458d8e;if(validateAccess(_0x3a617b,_0x1245ea)[_0x5e4356(0x126)]){if(pid[_0x4b7fe8])pid[_0x4b7fe8]['send']({'function':_0x5e4356(0x136),'args':_0x3b7b1a});}else logger[_0x5e4356(0x303)](_0x5e4356(0x1d5));}),_0xf389ca['on'](_0x458d8e(0x2d8),(_0x42bb62,_0x2eca80)=>{const _0xa39c3e=_0x458d8e;if(validateAccess(_0x2eca80,_0x1245ea)[_0xa39c3e(0x126)]){if(pid[_0x4b7fe8])pid[_0x4b7fe8]['send']({'function':_0xa39c3e(0x2dc),'args':_0x42bb62});}else logger['full'](_0xa39c3e(0x29f));}),_0xf389ca['on'](_0x458d8e(0x287),_0x36af92=>{const _0x146118=_0x458d8e;if(validateAccess(_0x36af92,_0x1245ea)[_0x146118(0x126)]){if(pid[_0x4b7fe8])pid[_0x4b7fe8]['send']({'function':'resetHistory','args':null});}else logger[_0x146118(0x303)](_0x146118(0x17f));}),_0xf389ca['on'](_0x458d8e(0x12a),_0x2e8803=>{const _0x3dd111=_0x458d8e;if(validateAccess(_0x2e8803,_0x1245ea)[_0x3dd111(0x126)]){if(pid[_0x4b7fe8])pid[_0x4b7fe8][_0x3dd111(0x24d)]({'function':_0x3dd111(0x17b),'args':null});}else logger[_0x3dd111(0x303)](_0x3dd111(0x27b));}),_0xf389ca['on'](_0x458d8e(0x2ee),(_0x456015,_0x28f0ab)=>{const _0x205c65=_0x458d8e;if(validateAccess(_0x28f0ab,_0x1245ea)[_0x205c65(0x126)]){if(pid[_0x4b7fe8])pid[_0x4b7fe8][_0x205c65(0x24d)]({'function':_0x205c65(0x219),'args':_0x456015});}else logger[_0x205c65(0x303)](_0x205c65(0x2ac));}),_0xf389ca['on']('cancel-loading',_0x4241f1=>{const _0x4a4b37=_0x458d8e;if(validateAccess(_0x4241f1,_0x1245ea)['allow']){if(pid[_0x4b7fe8])pid[_0x4b7fe8][_0x4a4b37(0x24d)]({'function':_0x4a4b37(0x2e4),'args':null});}else logger['full']('Unauthorized\x20attempt\x20to\x20cancel\x20loading\x20coins');}),_0xf389ca['on']('show-config',_0x56b7b7=>{const _0x32fe4a=_0x458d8e;if(validateAccess(_0x56b7b7,_0x1245ea)[_0x32fe4a(0x126)]){if(pid[_0x4b7fe8])pid[_0x4b7fe8][_0x32fe4a(0x24d)]({'function':_0x32fe4a(0x1dd),'args':null});}else logger[_0x32fe4a(0x303)](_0x32fe4a(0x1ba));}),_0xf389ca['on'](_0x458d8e(0x215),_0x3ae693=>{const _0x35db79=_0x458d8e;if(validateAccess(_0x3ae693,_0x1245ea)[_0x35db79(0x126)])updateBB('update');else logger[_0x35db79(0x303)](_0x35db79(0x137));}),_0xf389ca['on'](_0x458d8e(0x175),_0x8a8d78=>{const _0x718833=_0x458d8e;if(validateAccess(_0x8a8d78,_0x1245ea)['allow'])getMessages();else logger[_0x718833(0x303)]('Unauthorized\x20attempt\x20to\x20get\x20messages');}),_0xf389ca['on']('confirm-message',(_0x4ed3d3,_0x54fe7f)=>{const _0x46f634=_0x458d8e;if(validateAccess(_0x54fe7f,_0x1245ea)[_0x46f634(0x126)])confirmMessage(_0x4ed3d3);else logger['full']('Unauthorized\x20attempt\x20to\x20confirm\x20message');}),_0xf389ca['on'](_0x458d8e(0x19b),_0x24041f=>{const _0xf87c82=_0x458d8e;if(validateAccess(_0x24041f,_0x1245ea)['allow']){if(devices[_0x1245ea]['pidRefreshToken'])clearTimeout(devices[_0x1245ea][_0xf87c82(0x189)]);if(devices[_0x1245ea][_0xf87c82(0x1c6)])clearTimeout(devices[_0x1245ea][_0xf87c82(0x1c6)]);removeSocketListeners(getClient(_0xf389ca['id'])[_0xf87c82(0x201)]),addBlacklist(_0x1245ea),devices[_0x1245ea][_0xf87c82(0x217)]=null,devices[_0x1245ea][_0xf87c82(0x10f)]=null,devices[_0x1245ea][_0xf87c82(0x27d)][_0xf87c82(0x170)]=null,logger[_0xf87c82(0x20f)](_0xf87c82(0x23c)+_0x1245ea[_0xf87c82(0x2a9)](-0x8)),io['to'](getClient(_0xf389ca['id'])['uuid'])[_0xf87c82(0x1d0)]('status',{'access':{'allow':![],'reason':_0xf87c82(0x221),'token':null}});}else logger['full'](_0xf87c82(0x288));});}function removeSocketListeners(_0x7b8c01){const _0x25d300=_0x21fe16;getClientsWithUuid(_0x7b8c01)[_0x25d300(0x1f0)](_0x4b527e=>{const _0x1f3b34=_0x25d300;getSocket(_0x4b527e['id'])[_0x1f3b34(0x1bd)]();});}function cleanSettings(){const _0x47d6d4=_0x21fe16;let _0x7fd9e6=settings;return settings[_0x47d6d4(0x1d6)]&&settings['telegramToken']!=''&&(_0x7fd9e6={..._0x7fd9e6,'telegramToken':_0x47d6d4(0x116)}),settings['bbPassword']&&settings['bbPassword']!=''&&(_0x7fd9e6={..._0x7fd9e6,'bbPassword':_0x47d6d4(0x116)}),settings['marketcapApi']&&settings['marketcapApi']!=''&&(_0x7fd9e6={..._0x7fd9e6,'marketcapApi':_0x47d6d4(0x116)}),(settings[_0x47d6d4(0x1fb)]&&settings['bbPassword']==_0x47d6d4(0x1c1)||settings[_0x47d6d4(0x1d6)]&&settings['telegramToken']==_0x47d6d4(0x1c1)||settings[_0x47d6d4(0x2b5)]&&settings[_0x47d6d4(0x2b5)]==_0x47d6d4(0x1c1))&&(_0x7fd9e6={..._0x7fd9e6,'restored':{'password':settings[_0x47d6d4(0x1fb)]==_0x47d6d4(0x1c1),'telegram':settings[_0x47d6d4(0x1d6)]=='***','marketcap':settings[_0x47d6d4(0x2b5)]=='***'}}),_0x7fd9e6;}async function updateBB(_0x40d7da){const _0xcc7cce=_0x21fe16;await backupConfigFiles(),installingUpdate=!![],config[_0xcc7cce(0x1f0)](_0x18bec3=>{restartBot(_0x18bec3['botID']);});if(_0x40d7da==_0xcc7cce(0x2d2))process[_0xcc7cce(0x24d)]({'update':!![],'environment':environment},_0x4d789c=>{});else _0x40d7da==_0xcc7cce(0x292)&&process[_0xcc7cce(0x24d)]({'reinstall':!![],'environment':environment},_0x470965=>{});}function startBot(_0x39f0d7,_0x56b21d,_0xab628a){const _0x48b1a4=_0x21fe16;if(debugging)_0x39f0d7[_0x48b1a4(0x2c2)]('-d');let _0x21f98d=![];const _0x2b7a44=_0x39f0d7[0x0];_0x56b21d={..._0x56b21d,'stdio':[_0x48b1a4(0x241),'inherit',_0x48b1a4(0x241),_0x48b1a4(0x1f1)]},pid[_0x2b7a44]=childProcess['fork'](botfile,_0x39f0d7,_0x56b21d),pid[_0x2b7a44]['on'](_0x48b1a4(0x15c),_0x4c0dd8=>{const _0x11c88b=_0x48b1a4;switch(Object['keys'](_0x4c0dd8)[0x0]){case _0x11c88b(0x259):updateBotName(_0x2b7a44,_0x4c0dd8[_0x11c88b(0x259)]);break;case _0x11c88b(0x1f9):updateBotManager();break;case _0x11c88b(0x1b0):updateStatus(_0x2b7a44,_0x4c0dd8[_0x11c88b(0x1b0)]);break;case _0x11c88b(0x1ef):updateLive(_0x2b7a44,_0x4c0dd8['live']);break;case _0x11c88b(0x26a):updateLive(_0x2b7a44,_0x4c0dd8[_0x11c88b(0x26a)]),io['to'](_0x2b7a44)[_0x11c88b(0x1d0)](_0x11c88b(0x1b0),{'access':{'allow':![],'reason':_0x11c88b(0x132),'token':null}});break;case _0x11c88b(0x19f):_0x4c0dd8[_0x11c88b(0x19f)]==_0x11c88b(0x139)&&restartBot(_0x2b7a44);_0x4c0dd8[_0x11c88b(0x19f)]==_0x11c88b(0x275)&&toggleBot(_0x2b7a44,'disabled',_0x11c88b(0x300));break;case'telegram':sendTelegramBot(_0x2b7a44,_0x4c0dd8['telegram']);break;case _0x11c88b(0x1f3):sendTelegramMsg(_0x4c0dd8['telegrammsg']);break;case _0x11c88b(0x27c):io['to'](_0x2b7a44)[_0x11c88b(0x1d0)](_0x4c0dd8[_0x11c88b(0x27c)],_0x4c0dd8[_0x11c88b(0x2b2)]);break;}}),pid[_0x2b7a44]['on'](_0x48b1a4(0x314),function(_0x2fee05){if(_0x21f98d)return;_0x21f98d=!![],_0xab628a(_0x2fee05);}),pid[_0x2b7a44]['on'](_0x48b1a4(0x1a7),async function(_0x56b051){const _0x53d3e0=_0x48b1a4;if(terminating)return;if(installingUpdate){logger[_0x53d3e0(0x20f)](_0x53d3e0(0x2ff)),io[_0x53d3e0(0x252)]();return;}if(_0x21f98d)return;_0x21f98d=!![],_0xab628a(null);const _0x35780c=dbConfig[_0x53d3e0(0x141)]('bots')['find']({'botID':_0x2b7a44})['value']();_0x35780c&&(_0x35780c[_0x53d3e0(0x1b0)]==_0x53d3e0(0x1f7)||_0x35780c[_0x53d3e0(0x1b0)]==_0x53d3e0(0x2ed))&&(await sleep(0x3e8),updateLive(_0x2b7a44,_0x53d3e0(0x300)),logger['full'](_0x53d3e0(0x183)+_0x2b7a44),startBot([_0x2b7a44,userID],{'cwd':bbpath},function(_0x1e0b92){const _0x456bbd=_0x53d3e0;if(_0x1e0b92)logger[_0x456bbd(0x303)](_0x1e0b92);}));});}function stopBot(_0x4d313a){const _0x5083aa=_0x21fe16;getClientsWithBotID(_0x4d313a)[_0x5083aa(0x1f0)](_0x246bb0=>{const _0x4c818c=_0x5083aa;getSocket(_0x246bb0['id'])[_0x4c818c(0x242)](!![]),removeClient(_0x246bb0['id']);}),pid[_0x4d313a]&&(pid[_0x4d313a][_0x5083aa(0x275)](),pid[_0x4d313a]=null);}function stopAllBots(){const _0x1205aa=_0x21fe16;terminating=!![];const _0x4f9623=getEnabledBots();_0x4f9623[_0x1205aa(0x1f0)](_0x3130c8=>{const _0xbec774=_0x1205aa;stopBot(_0x3130c8[_0xbec774(0x21b)]);});}function restartBot(_0x5a7272){const _0x194349=_0x21fe16;if(pid[_0x5a7272])pid[_0x5a7272][_0x194349(0x275)]();}function addBot(){const _0x37c6f9=_0x21fe16;let _0x292fd3;for(let _0x1d3906=0x1;_0x1d3906<0x3e9;_0x1d3906++){_0x292fd3=_0x1d3906[_0x37c6f9(0x198)]()[_0x37c6f9(0x18d)](0x3,'0');let _0x5bcd6e=config['find'](_0x128111=>_0x128111[_0x37c6f9(0x21b)]==_0x292fd3);if(!_0x5bcd6e)break;}if(_0x292fd3===_0x37c6f9(0x168)){logger['full']('The\x20maximum\x20of\x20999\x20bots\x20has\x20been\x20reached');return;}logger[_0x37c6f9(0x303)]('Starting\x20new\x20bot\x20|\x20Bot\x20'+_0x292fd3),dbConfig[_0x37c6f9(0x141)](_0x37c6f9(0x248))[_0x37c6f9(0x2c2)]({'botID':_0x292fd3,'botname':_0x37c6f9(0x261)+_0x292fd3,'status':'new','live':''})[_0x37c6f9(0x19a)](),startBot([_0x292fd3,userID],{'cwd':bbpath},function(_0x4abffa){const _0x3c161e=_0x37c6f9;if(_0x4abffa)logger[_0x3c161e(0x303)](_0x4abffa);}),config=getConfiguration(),io['to'](_0x37c6f9(0x2ef))[_0x37c6f9(0x1d0)](_0x37c6f9(0x248),config),broadcastToBots(_0x37c6f9(0x248),JSON[_0x37c6f9(0x310)](config));}function deleteBot(_0x3730c3){const _0x4cdb1b=_0x21fe16;getClientsWithBotID(_0x3730c3)['forEach'](_0x5650f0=>{getSocket(_0x5650f0['id'])['disconnect'](!![]),removeClient(_0x5650f0['id']);}),dbConfig[_0x4cdb1b(0x141)](_0x4cdb1b(0x248))['remove']({'botID':_0x3730c3})[_0x4cdb1b(0x19a)](),logger[_0x4cdb1b(0x303)]('Deleted\x20Bot\x20'+_0x3730c3),stopBot(_0x3730c3);try{if(fs[_0x4cdb1b(0x2fd)](path[_0x4cdb1b(0x128)](configpath,'bot-'+_0x3730c3+_0x4cdb1b(0x264))))fs['unlinkSync'](path[_0x4cdb1b(0x128)](configpath,'bot-'+_0x3730c3+'-config.json'));if(fs['existsSync'](path[_0x4cdb1b(0x128)](configpath,_0x4cdb1b(0x1f6)+_0x3730c3+_0x4cdb1b(0x2bc))))fs['unlinkSync'](path['join'](configpath,_0x4cdb1b(0x1f6)+_0x3730c3+_0x4cdb1b(0x2bc)));if(fs['existsSync'](path[_0x4cdb1b(0x128)](configpath,_0x4cdb1b(0x1f6)+_0x3730c3+_0x4cdb1b(0x239))))fs['unlinkSync'](path[_0x4cdb1b(0x128)](configpath,_0x4cdb1b(0x1f6)+_0x3730c3+_0x4cdb1b(0x239)));if(fs[_0x4cdb1b(0x2fd)](path[_0x4cdb1b(0x128)](configpath,_0x4cdb1b(0x1f6)+_0x3730c3+_0x4cdb1b(0x208))))fs['unlinkSync'](path[_0x4cdb1b(0x128)](configpath,'bot-'+_0x3730c3+'-results.json'));}catch(_0x357829){if(_0x357829)logger[_0x4cdb1b(0x303)](_0x4cdb1b(0x2aa),_0x357829);}config=getConfiguration(),io['to'](_0x4cdb1b(0x2ef))[_0x4cdb1b(0x1d0)]('bots',config),broadcastToBots('bots',JSON[_0x4cdb1b(0x310)](config));}function toggleBot(_0x33c788,_0x3d0e66,_0x3c8f39){const _0xd60742=_0x21fe16;dbConfig[_0xd60742(0x141)](_0xd60742(0x248))[_0xd60742(0x20e)]({'botID':_0x33c788})[_0xd60742(0x1c9)]({'status':_0x3d0e66})[_0xd60742(0x1c9)]({'live':_0x3c8f39})['write']();if(_0x3d0e66=='enabled'||_0x3d0e66==_0xd60742(0x2ed))logger['full'](_0xd60742(0x18c)+_0x33c788),startBot([_0x33c788,userID],{'cwd':bbpath},function(_0x5b4040){const _0x33bb65=_0xd60742;if(_0x5b4040)logger[_0x33bb65(0x303)](_0x5b4040);});else(_0x3d0e66==_0xd60742(0x1b2)||_0x3d0e66==_0xd60742(0x243))&&(logger[_0xd60742(0x303)](_0xd60742(0x1a2)+_0x33c788),stopBot(_0x33c788));config=getConfiguration(),io['to'](_0xd60742(0x2ef))[_0xd60742(0x1d0)](_0xd60742(0x248),config),broadcastToBots(_0xd60742(0x248),JSON['stringify'](config));}function toggleStatus(_0x35c5c1){const _0x2159d0=_0x21fe16;let _0x5a8c32=dbConfig['get'](_0x2159d0(0x248))[_0x2159d0(0x20e)]({'botID':_0x35c5c1})['value'](),_0x5eb660;if(_0x5a8c32['status']===_0x2159d0(0x1f7))_0x5eb660=_0x2159d0(0x1b2);else{if(_0x5a8c32[_0x2159d0(0x1b0)]==='new')_0x5eb660=_0x2159d0(0x243);else{if(_0x5a8c32['status']===_0x2159d0(0x243))_0x5eb660='new';else{if(_0x5a8c32[_0x2159d0(0x1b0)]===_0x2159d0(0x1b2))_0x5eb660='enabled';}}}return _0x5eb660;}function updateStatus(_0xbb6d97,_0x3a3d28){const _0x3e86b1=_0x21fe16;dbConfig['get'](_0x3e86b1(0x248))[_0x3e86b1(0x20e)]({'botID':_0xbb6d97})[_0x3e86b1(0x1c9)]({'status':_0x3a3d28})[_0x3e86b1(0x19a)](),config=getConfiguration(),io['to'](_0x3e86b1(0x2ef))[_0x3e86b1(0x1d0)](_0x3e86b1(0x248),config),broadcastToBots('bots',JSON[_0x3e86b1(0x310)](config));}function updateLive(_0x51cea7,_0x11d0aa){const _0x853f8d=_0x21fe16;dbConfig[_0x853f8d(0x141)](_0x853f8d(0x248))['find']({'botID':_0x51cea7})[_0x853f8d(0x1c9)]({'live':_0x11d0aa})[_0x853f8d(0x19a)](),config=getConfiguration(),io['to'](_0x853f8d(0x2ef))['emit'](_0x853f8d(0x248),config),broadcastToBots('bots',JSON['stringify'](config));}function updateBotName(_0x2b8a3a,_0x5042c6){const _0x2a5cd8=_0x21fe16;dbConfig['get']('bots')[_0x2a5cd8(0x20e)]({'botID':_0x2b8a3a})['assign']({'botname':_0x5042c6})[_0x2a5cd8(0x19a)](),config=getConfiguration(),io['to'](_0x2a5cd8(0x2ef))[_0x2a5cd8(0x1d0)]('bots',config),broadcastToBots(_0x2a5cd8(0x248),JSON['stringify'](config));}function updateBotManager(){const _0x128e3=_0x21fe16;config=getConfiguration(),io['to'](_0x128e3(0x2ef))['emit'](_0x128e3(0x248),config),broadcastToBots(_0x128e3(0x248),JSON['stringify'](config));}function toggleBotMode(_0x1ae3f1){const _0xa3c185=_0x21fe16;if(pid[_0x1ae3f1])pid[_0x1ae3f1][_0xa3c185(0x24d)]({'function':_0xa3c185(0x2e2),'args':null});else{const _0x2efec1=configpath+'bot-'+_0x1ae3f1+_0xa3c185(0x264),_0x384921=fs['readFileSync'](_0x2efec1),_0x4fb8ff=JSON[_0xa3c185(0x1d4)](_0x384921),_0x44626c=_0x4fb8ff['bot'][0x0][_0xa3c185(0x1e9)];_0x4fb8ff[_0xa3c185(0x12d)][0x0]['headless']=!_0x44626c;const _0x37d427=JSON[_0xa3c185(0x310)](_0x4fb8ff,null,0x2);fs[_0xa3c185(0x17e)](_0x2efec1,_0x37d427),config=getConfiguration(),io['to']('botmanager')[_0xa3c185(0x1d0)](_0xa3c185(0x248),config),broadcastToBots('bots',JSON[_0xa3c185(0x310)](config));}}function validateTelegram(_0x3414b8){const _0x5c5a93=_0x21fe16;if(_0x3414b8[_0x5c5a93(0x186)][_0x5c5a93(0x146)]!=settings['telegramUsername']&&'@'+_0x3414b8[_0x5c5a93(0x186)]['username']!=settings[_0x5c5a93(0x1fa)]||_0x3414b8['chat']['id']!=settings['telegramChatId'])return sendTelegram(_0x3414b8['chat']['id'],_0x5c5a93(0x1e1),{'parse_mode':_0x5c5a93(0x2a0)}),![];return!![];}async function initTelegram(){const _0x3bc247=_0x21fe16;if(tgBot)tgBot[_0x3bc247(0x19f)](),tgBot=null,initTelegram();else{tgBot=new Telegraf(settings[_0x3bc247(0x1d6)]);let _0x569ea8='You\x20can\x20use\x20the\x20following\x20commands:\x0a';_0x569ea8+='\x0a',_0x569ea8+=_0x3bc247(0x255),_0x569ea8+=_0x3bc247(0x268),_0x569ea8+=_0x3bc247(0x1ec),_0x569ea8+=_0x3bc247(0x2d7),_0x569ea8+=_0x3bc247(0x297),_0x569ea8+=_0x3bc247(0x172),_0x569ea8+='/toggle\x20-\x20toggle\x20manual\x20vs\x20auto\x20mode\x0a',_0x569ea8+=_0x3bc247(0x12b),_0x569ea8+=_0x3bc247(0x19e),_0x569ea8+='/metrics\x20-\x20show\x20bot\x20performance\x0a',_0x569ea8+=_0x3bc247(0x313),_0x569ea8+=_0x3bc247(0x1ea),_0x569ea8+=_0x3bc247(0x2a5),_0x569ea8+=_0x3bc247(0x1db);let _0x1e17ab=_0x3bc247(0x2af);_0x1e17ab+='\x0a',_0x1e17ab+=_0x569ea8,tgBot[_0x3bc247(0x130)]((_0x5a2fa1,_0xac5aed)=>{const _0x333646=_0x3bc247;logger['simple'](getTimeStamp()+':\x20Bot\x20Mgr\x20>\x20Telegram\x20error\x20occured'),logger[_0x333646(0x20f)](_0x333646(0x228),_0x5a2fa1);}),tgBot[_0x3bc247(0x2f9)](async(_0x2ead60,_0x5d74cc)=>{const _0x3e06a7=_0x3bc247;if(!(!settings['telegramChatId']&&_0x2ead60[_0x3e06a7(0x2d2)][_0x3e06a7(0x15c)][_0x3e06a7(0x234)]==_0x3e06a7(0x25a))){if(!validateTelegram(_0x2ead60))return;}_0x5d74cc();}),tgBot[_0x3bc247(0x283)](_0x3bc247(0x223),async _0xa6f8e3=>{const _0x407a5d=_0x3bc247;if(!settings[_0x407a5d(0x22e)])updateSetting('telegramChatId',_0xa6f8e3[_0x407a5d(0x2a2)]['id']);updateSetting(_0x407a5d(0x318),!![]);if(!validateTelegram(_0xa6f8e3))return;await sendTelegram(_0xa6f8e3[_0x407a5d(0x2a2)]['id'],_0x1e17ab);}),tgBot[_0x3bc247(0x283)]('enable',async _0x498ac3=>{const _0x840c32=_0x3bc247;updateSetting(_0x840c32(0x318),!![]),await sendTelegram(_0x498ac3[_0x840c32(0x2a2)]['id'],_0x840c32(0x25f));}),tgBot['command']('disable',async _0x28d898=>{const _0x18e545=_0x3bc247;await sendTelegram(_0x28d898[_0x18e545(0x2a2)]['id'],_0x18e545(0x2c4)),updateSetting(_0x18e545(0x318),![]);}),tgBot[_0x3bc247(0x283)](_0x3bc247(0x14b),async _0x302941=>{const _0x5293d2=_0x3bc247,_0x4dd3c3=Markup[_0x5293d2(0x12f)]([Markup[_0x5293d2(0x2c1)][_0x5293d2(0x224)](_0x5293d2(0x281),_0x5293d2(0x2f5)),Markup[_0x5293d2(0x2c1)][_0x5293d2(0x224)](_0x5293d2(0x1b4),_0x5293d2(0x1f8)),Markup[_0x5293d2(0x2c1)]['callback']('All',_0x5293d2(0x2e8))]);_0x302941[_0x5293d2(0x144)]('Of\x20which\x20events\x20do\x20you\x20want\x20to\x20be\x20notified?',_0x4dd3c3);}),tgBot[_0x3bc247(0x2ab)](_0x3bc247(0x2f5),async _0x27baaf=>{const _0x43fca4=_0x3bc247;_0x27baaf[_0x43fca4(0x20a)](),updateSetting(_0x43fca4(0x296),'orders'),updateSetting('telegramEnabled',!![]),await sendTelegram(_0x27baaf[_0x43fca4(0x2a2)]['id'],_0x43fca4(0x197));}),tgBot['action'](_0x3bc247(0x1f8),async _0x35e9ee=>{const _0x66e967=_0x3bc247;_0x35e9ee['editMessageReplyMarkup'](),updateSetting(_0x66e967(0x296),'alerts'),updateSetting(_0x66e967(0x318),!![]),await sendTelegram(_0x35e9ee[_0x66e967(0x2a2)]['id'],_0x66e967(0x1da));}),tgBot[_0x3bc247(0x2ab)](_0x3bc247(0x2e8),async _0x493d3c=>{const _0x4174ed=_0x3bc247;_0x493d3c['editMessageReplyMarkup'](),updateSetting(_0x4174ed(0x296),_0x4174ed(0x30d)),updateSetting(_0x4174ed(0x318),!![]),await sendTelegram(_0x493d3c[_0x4174ed(0x2a2)]['id'],_0x4174ed(0x1c8));}),tgBot[_0x3bc247(0x283)](_0x3bc247(0x1b0),async _0x4d2ee1=>{const _0x584b0d=_0x3bc247,_0xab4eb3=getBotsWithMode();let _0x4440f6=_0x584b0d(0x178);config[_0x584b0d(0x1f0)](_0x199109=>{const _0x1fb7cf=_0x584b0d,_0x1b5133=_0xab4eb3[_0x1fb7cf(0x20e)](_0x162d99=>_0x162d99[_0x1fb7cf(0x21b)]==_0x199109[_0x1fb7cf(0x21b)])[_0x1fb7cf(0x13b)];_0x4440f6+=_0x1fb7cf(0x261)+_0x199109[_0x1fb7cf(0x21b)]+':\x20'+_0x199109['status']+'\x20|\x20'+_0x1b5133+'\x20|\x20'+_0x199109[_0x1fb7cf(0x1ef)]+'\x0a';}),_0x4440f6+='\x0a',_0x4440f6+=_0x584b0d(0x1ce),_0x4440f6+=!settings[_0x584b0d(0x318)]?'Notifications\x20disabled\x0a':_0x584b0d(0x2d6),_0x4440f6+=settings[_0x584b0d(0x318)]?settings[_0x584b0d(0x296)]==_0x584b0d(0x30d)?_0x584b0d(0x135):_0x584b0d(0x2f4)+settings['telegramEvents']+_0x584b0d(0x111):'',await sendTelegram(_0x4d2ee1[_0x584b0d(0x2a2)]['id'],_0x4440f6,{'parse_mode':'HTML'});}),tgBot['command'](_0x3bc247(0x139),async _0x50f4d0=>{const _0x162455=_0x3bc247,_0x1de192=getEnabledBots();if(_0x1de192[_0x162455(0x191)]==0x0)await sendTelegram(_0x50f4d0['chat']['id'],_0x162455(0x15e));else{if(_0x1de192[_0x162455(0x191)]>0x1)_0x1de192[_0x162455(0x2c2)]({'botID':'all'});let _0x36c074=[],_0x579764=[];const _0x439234=_0x1de192['length']%0x4==0x0||_0x1de192[_0x162455(0x191)]%0x4==0x3||_0x1de192['length']%0x3==0x1?0x4:0x3;let _0x2afe32=0x0;_0x1de192[_0x162455(0x1f0)]((_0x1c9041,_0x275fb6)=>{const _0x37a9f2=_0x162455;if(_0x275fb6%_0x439234==0x0)_0x579764=[];_0x579764['push'](Markup[_0x37a9f2(0x2c1)][_0x37a9f2(0x224)](_0x1c9041[_0x37a9f2(0x21b)]==_0x37a9f2(0x30d)?_0x37a9f2(0x2de):'Bot\x20'+_0x1c9041['botID'],_0x37a9f2(0x202)+_0x1c9041[_0x37a9f2(0x21b)])),_0x275fb6%_0x439234==0x0&&(_0x36c074[_0x2afe32]=_0x579764,_0x2afe32++);});const _0xd7cf26=Markup[_0x162455(0x12f)](_0x36c074);_0x50f4d0[_0x162455(0x144)](_0x162455(0x23d),_0xd7cf26);}}),tgBot[_0x3bc247(0x2ab)](/restart_(.+)/,async _0x1ef034=>{const _0x29cc8a=_0x3bc247,_0x147cbe=_0x1ef034[_0x29cc8a(0x2b3)][0x1];_0x1ef034[_0x29cc8a(0x20a)](),_0x147cbe=='all'?config[_0x29cc8a(0x1f0)](_0x58024b=>{const _0x473480=_0x29cc8a;restartBot(_0x58024b[_0x473480(0x21b)]);}):restartBot(_0x147cbe);}),tgBot[_0x3bc247(0x283)]('on',async _0x5cdbcf=>{const _0x672b70=_0x3bc247,_0x17f1ef=getDisabledBots();if(_0x17f1ef['length']==0x0)await sendTelegram(_0x5cdbcf[_0x672b70(0x2a2)]['id'],_0x672b70(0x1c0));else{if(_0x17f1ef[_0x672b70(0x191)]>0x1)_0x17f1ef[_0x672b70(0x2c2)]({'botID':_0x672b70(0x30d)});let _0x4ed7b2=[],_0x3d9ea9=[];const _0x508e27=_0x17f1ef['length']%0x4==0x0||_0x17f1ef[_0x672b70(0x191)]%0x4==0x3||_0x17f1ef[_0x672b70(0x191)]%0x3==0x1?0x4:0x3;let _0x1d6ff6=0x0;_0x17f1ef[_0x672b70(0x1f0)]((_0x515efc,_0x107d72)=>{const _0x25fb98=_0x672b70;if(_0x107d72%_0x508e27==0x0)_0x3d9ea9=[];_0x3d9ea9[_0x25fb98(0x2c2)](Markup[_0x25fb98(0x2c1)][_0x25fb98(0x224)](_0x515efc['botID']=='all'?_0x25fb98(0x2de):_0x25fb98(0x261)+_0x515efc[_0x25fb98(0x21b)],'on_'+_0x515efc[_0x25fb98(0x21b)])),_0x107d72%_0x508e27==0x0&&(_0x4ed7b2[_0x1d6ff6]=_0x3d9ea9,_0x1d6ff6++);});const _0x30505b=Markup[_0x672b70(0x12f)](_0x4ed7b2);_0x5cdbcf[_0x672b70(0x144)](_0x672b70(0x298),_0x30505b);}}),tgBot[_0x3bc247(0x2ab)](/on_(.+)/,async _0x44789b=>{const _0x5a4cc2=_0x3bc247,_0x1104ca=_0x44789b[_0x5a4cc2(0x2b3)][0x1];_0x44789b['editMessageReplyMarkup']();if(_0x1104ca=='all'){const _0x5c70f0=getDisabledBots();await sendTelegram(_0x44789b[_0x5a4cc2(0x2a2)]['id'],'Bot\x20Mgr\x20>\x20starting\x20all\x20bots'),_0x5c70f0['forEach'](_0x54df63=>{const _0x3bc695=_0x5a4cc2;if(_0x54df63[_0x3bc695(0x21b)]!='all')toggleBot(_0x54df63[_0x3bc695(0x21b)],toggleStatus(_0x54df63[_0x3bc695(0x21b)]),_0x3bc695(0x300));});}else await sendTelegram(_0x44789b[_0x5a4cc2(0x2a2)]['id'],'Bot\x20Mgr\x20>\x20starting\x20Bot\x20'+_0x1104ca),toggleBot(_0x1104ca,toggleStatus(_0x1104ca),_0x5a4cc2(0x300));}),tgBot[_0x3bc247(0x283)](_0x3bc247(0x125),async _0x43ded2=>{const _0x490a0b=_0x3bc247,_0x390ae0=getEnabledBots();if(_0x390ae0[_0x490a0b(0x191)]==0x0)await sendTelegram(_0x43ded2[_0x490a0b(0x2a2)]['id'],_0x490a0b(0x15e));else{if(_0x390ae0['length']>0x1)_0x390ae0[_0x490a0b(0x2c2)]({'botID':_0x490a0b(0x30d)});let _0x32c8c0=[],_0x36945b=[];const _0x2d904c=_0x390ae0['length']%0x4==0x0||_0x390ae0[_0x490a0b(0x191)]%0x4==0x3||_0x390ae0[_0x490a0b(0x191)]%0x3==0x1?0x4:0x3;let _0x32b2f0=0x0;_0x390ae0[_0x490a0b(0x1f0)]((_0x1745eb,_0x29337e)=>{const _0xbad0d4=_0x490a0b;if(_0x29337e%_0x2d904c==0x0)_0x36945b=[];_0x36945b['push'](Markup[_0xbad0d4(0x2c1)]['callback'](_0x1745eb['botID']==_0xbad0d4(0x30d)?_0xbad0d4(0x2de):_0xbad0d4(0x261)+_0x1745eb[_0xbad0d4(0x21b)],_0xbad0d4(0x21c)+_0x1745eb[_0xbad0d4(0x21b)])),_0x29337e%_0x2d904c==0x0&&(_0x32c8c0[_0x32b2f0]=_0x36945b,_0x32b2f0++);});const _0x11c1ad=Markup[_0x490a0b(0x12f)](_0x32c8c0);_0x43ded2[_0x490a0b(0x144)](_0x490a0b(0x199),_0x11c1ad);}}),tgBot[_0x3bc247(0x2ab)](/off_(.+)/,async _0x44c414=>{const _0x50642c=_0x3bc247,_0x17f0da=_0x44c414[_0x50642c(0x2b3)][0x1];_0x44c414[_0x50642c(0x20a)]();if(_0x17f0da=='all'){const _0x1c0832=getEnabledBots();await sendTelegram(_0x44c414[_0x50642c(0x2a2)]['id'],'Bot\x20Mgr\x20>\x20stopping\x20all\x20bots'),_0x1c0832['forEach'](_0x14b18b=>{const _0x45c875=_0x50642c;if(_0x14b18b[_0x45c875(0x21b)]!=_0x45c875(0x30d))toggleBot(_0x14b18b[_0x45c875(0x21b)],toggleStatus(_0x14b18b[_0x45c875(0x21b)]),_0x45c875(0x300));});}else await sendTelegram(_0x44c414[_0x50642c(0x2a2)]['id'],_0x50642c(0x306)+_0x17f0da),toggleBot(_0x17f0da,toggleStatus(_0x17f0da),_0x50642c(0x300));}),tgBot[_0x3bc247(0x283)](_0x3bc247(0x159),async _0xd2a80a=>{const _0x24e00a=_0x3bc247,_0xcea1a6=getEnabledBots();if(_0xcea1a6[_0x24e00a(0x191)]==0x0)await sendTelegram(_0xd2a80a[_0x24e00a(0x2a2)]['id'],_0x24e00a(0x15e));else{if(_0xcea1a6[_0x24e00a(0x191)]>0x1){let _0x248d7f=[],_0x4ab7c6=[];const _0x17210a=_0xcea1a6[_0x24e00a(0x191)]%0x4==0x0||_0xcea1a6[_0x24e00a(0x191)]%0x4==0x3||_0xcea1a6[_0x24e00a(0x191)]%0x3==0x1?0x4:0x3;let _0x3539e5=0x0;_0xcea1a6['forEach']((_0x3ca4a0,_0x51a3ed)=>{const _0x371e0e=_0x24e00a;if(_0x51a3ed%_0x17210a==0x0)_0x4ab7c6=[];_0x4ab7c6['push'](Markup[_0x371e0e(0x2c1)][_0x371e0e(0x224)]('Bot\x20'+_0x3ca4a0[_0x371e0e(0x21b)],'metrics_'+_0x3ca4a0[_0x371e0e(0x21b)])),_0x51a3ed%_0x17210a==0x0&&(_0x248d7f[_0x3539e5]=_0x4ab7c6,_0x3539e5++);});const _0x2969b8=Markup[_0x24e00a(0x12f)](_0x248d7f);_0xd2a80a[_0x24e00a(0x144)](_0x24e00a(0x1e0),_0x2969b8);}else{const _0x3ce971=_0xcea1a6[0x0]['botID'];if(pid[_0x3ce971])pid[_0x3ce971][_0x24e00a(0x24d)]({'function':_0x24e00a(0x148),'args':null});}}}),tgBot['action'](/metrics_(.+)/,async _0x6562d0=>{const _0xfbc506=_0x3bc247,_0x28489d=_0x6562d0[_0xfbc506(0x2b3)][0x1];_0x6562d0[_0xfbc506(0x20a)]();if(pid[_0x28489d])pid[_0x28489d][_0xfbc506(0x24d)]({'function':'sendMetricsTelegram','args':null});}),tgBot[_0x3bc247(0x283)]('portfolio',async _0x2f4f24=>{const _0x4ee5be=_0x3bc247,_0x525633=getEnabledBots();if(_0x525633['length']==0x0)await sendTelegram(_0x2f4f24['chat']['id'],_0x4ee5be(0x15e));else{if(_0x525633['length']>0x1){let _0x2e563e=[],_0x3a3415=[];const _0x3097ee=_0x525633['length']%0x4==0x0||_0x525633[_0x4ee5be(0x191)]%0x4==0x3||_0x525633[_0x4ee5be(0x191)]%0x3==0x1?0x4:0x3;let _0x1dd30f=0x0;_0x525633[_0x4ee5be(0x1f0)]((_0x215672,_0x17ecbe)=>{const _0x14d08f=_0x4ee5be;if(_0x17ecbe%_0x3097ee==0x0)_0x3a3415=[];_0x3a3415[_0x14d08f(0x2c2)](Markup[_0x14d08f(0x2c1)][_0x14d08f(0x224)](_0x14d08f(0x261)+_0x215672[_0x14d08f(0x21b)],_0x14d08f(0x276)+_0x215672[_0x14d08f(0x21b)])),_0x17ecbe%_0x3097ee==0x0&&(_0x2e563e[_0x1dd30f]=_0x3a3415,_0x1dd30f++);});const _0xf8043f=Markup[_0x4ee5be(0x12f)](_0x2e563e);_0x2f4f24[_0x4ee5be(0x144)](_0x4ee5be(0x127),_0xf8043f);}else{const _0x3736ca=_0x525633[0x0][_0x4ee5be(0x21b)];if(pid[_0x3736ca])pid[_0x3736ca]['send']({'function':'sendPortfolioTelegram','args':null});}}}),tgBot[_0x3bc247(0x2ab)](/portfolio_(.+)/,async _0x29cc51=>{const _0x3d23e0=_0x3bc247,_0x321801=_0x29cc51[_0x3d23e0(0x2b3)][0x1];_0x29cc51[_0x3d23e0(0x20a)]();if(pid[_0x321801])pid[_0x321801][_0x3d23e0(0x24d)]({'function':_0x3d23e0(0x1f4),'args':null});}),tgBot[_0x3bc247(0x283)](_0x3bc247(0x2d2),async _0x593a97=>{const _0x214900=_0x3bc247;await getMessages();if(!updateAvailable)await sendTelegram(_0x593a97[_0x214900(0x2a2)]['id'],'Your\x20installation\x20is\x20already\x20up\x20to\x20date');else{if(!validInstallation)await sendTelegram(_0x593a97[_0x214900(0x2a2)]['id'],'Your\x20installation\x20does\x20not\x20support\x20updating\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20update');else{const _0x1d22ab=Markup[_0x214900(0x12f)]([Markup[_0x214900(0x2c1)]['callback'](_0x214900(0x2e5),_0x214900(0x24e)),Markup[_0x214900(0x2c1)]['callback']('No',_0x214900(0x2c6))]);_0x593a97[_0x214900(0x144)](_0x214900(0x14d),_0x1d22ab);}}}),tgBot[_0x3bc247(0x2ab)](/update_(.+)/,async _0x30ebc9=>{const _0x34c8af=_0x3bc247,_0x5130af=_0x30ebc9[_0x34c8af(0x2b3)][0x1];_0x30ebc9[_0x34c8af(0x20a)](),_0x5130af=='yes'&&(await sendTelegram(_0x30ebc9['chat']['id'],_0x34c8af(0x14a)),updateBB(_0x34c8af(0x2d2))),_0x5130af=='no'&&await sendTelegram(_0x30ebc9[_0x34c8af(0x2a2)]['id'],'Ok,\x20consider\x20updating\x20Balance\x20Bot\x20later');}),tgBot['command'](_0x3bc247(0x292),async _0x275eb5=>{const _0xcd538a=_0x3bc247;if(!validInstallation)await sendTelegram(_0x275eb5[_0xcd538a(0x2a2)]['id'],'Your\x20installation\x20does\x20not\x20support\x20reinstalling\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20reinstallation');else{const _0x33007a=Markup[_0xcd538a(0x12f)]([Markup[_0xcd538a(0x2c1)][_0xcd538a(0x224)]('Yes','reinstall_yes'),Markup[_0xcd538a(0x2c1)][_0xcd538a(0x224)]('No',_0xcd538a(0x317))]);_0x275eb5[_0xcd538a(0x144)](_0xcd538a(0x156),_0x33007a);}}),tgBot['action'](/reinstall_(.+)/,async _0x5e79ba=>{const _0x42b619=_0x3bc247,_0x669004=_0x5e79ba['match'][0x1];_0x5e79ba[_0x42b619(0x20a)](),_0x669004==_0x42b619(0x278)&&(await sendTelegram(_0x5e79ba[_0x42b619(0x2a2)]['id'],_0x42b619(0x120)),updateBB(_0x42b619(0x292))),_0x669004=='no'&&await sendTelegram(_0x5e79ba['chat']['id'],_0x42b619(0x18a));}),tgBot[_0x3bc247(0x283)](_0x3bc247(0x176),async _0x2913b0=>{const _0x205a6e=_0x3bc247,_0x15e74d=getBotsWithMode();if(_0x15e74d['length']==0x0)await sendTelegram(_0x2913b0[_0x205a6e(0x2a2)]['id'],'No\x20bots\x20running\x20right\x20now');else{let _0x3a53aa=[],_0x25e5c7=[];const _0x2fd48a=0x2;let _0x31f81a=0x0;_0x15e74d[_0x205a6e(0x1f0)]((_0x4f7ddd,_0x249147)=>{const _0xd4ecc1=_0x205a6e;if(_0x249147%_0x2fd48a==0x0)_0x25e5c7=[];_0x25e5c7[_0xd4ecc1(0x2c2)](Markup[_0xd4ecc1(0x2c1)]['callback'](_0xd4ecc1(0x261)+_0x4f7ddd[_0xd4ecc1(0x21b)]+'\x20('+_0x4f7ddd[_0xd4ecc1(0x13b)]+')',_0xd4ecc1(0x282)+_0x4f7ddd[_0xd4ecc1(0x21b)])),_0x249147%_0x2fd48a==0x0&&(_0x3a53aa[_0x31f81a]=_0x25e5c7,_0x31f81a++);});const _0x14c235=Markup[_0x205a6e(0x12f)](_0x3a53aa);_0x2913b0[_0x205a6e(0x144)](_0x205a6e(0x110),_0x14c235);}}),tgBot[_0x3bc247(0x2ab)](/toggle_(.+)/,async _0x2c6835=>{const _0x49bf32=_0x3bc247,_0x2543da=_0x2c6835[_0x49bf32(0x2b3)][0x1];_0x2c6835[_0x49bf32(0x20a)]();const _0x2e4676=getBotsWithMode(),_0x1e2ba9=_0x2e4676[_0x49bf32(0x20e)](_0x3e9162=>_0x3e9162['botID']==_0x2543da),_0x1be17c=_0x1e2ba9['mode']==_0x49bf32(0x151)?_0x49bf32(0x27a):'auto';await sendTelegram(_0x2c6835['chat']['id'],_0x49bf32(0x269)+_0x2543da+_0x49bf32(0x163)+_0x1be17c+_0x49bf32(0x25d)),toggleBotMode(_0x2543da);}),tgBot[_0x3bc247(0x283)]('names',async _0x406d86=>{const _0x2a4f08=_0x3bc247;let _0x496bd6='';config[_0x2a4f08(0x1f0)](_0x4a8c8c=>{const _0x2f6779=_0x2a4f08;_0x496bd6+='Bot\x20'+_0x4a8c8c[_0x2f6779(0x21b)]+':\x20'+_0x4a8c8c[_0x2f6779(0x259)]+'\x0a';}),await sendTelegram(_0x406d86[_0x2a4f08(0x2a2)]['id'],_0x496bd6,{'parse_mode':_0x2a4f08(0x2a0)});}),tgBot[_0x3bc247(0x283)](_0x3bc247(0x2fc),async _0x319747=>{await sendTelegram(_0x319747['chat']['id'],_0x569ea8);}),process['once'](_0x3bc247(0x301),()=>tgBot[_0x3bc247(0x19f)](_0x3bc247(0x301))),process[_0x3bc247(0x149)](_0x3bc247(0x227),()=>tgBot['stop'](_0x3bc247(0x227))),tgBot[_0x3bc247(0x267)]();}}function disableTelegram(){const _0x21e721=_0x21fe16;tgBot&&tgBot[_0x21e721(0x19f)]();}async function sendTelegram(_0x21ad62,_0x8333ed,_0x565dc7){const _0x444562=_0x21fe16;_0x565dc7={..._0x565dc7,'disable_web_page_preview':!![]};try{await tgBot['telegram'][_0x444562(0x143)](_0x21ad62,_0x8333ed,_0x565dc7);}catch(_0x4116c4){console[_0x444562(0x2a8)](_0x444562(0x1c3),_0x4116c4);}}async function sendTelegramBot(_0xb12dd2,_0x5a38ca){const _0x1a4e7a=_0x21fe16;if(settings[_0x1a4e7a(0x318)]){if(settings[_0x1a4e7a(0x296)]==_0x1a4e7a(0x30d)||(_0x5a38ca[_0x1a4e7a(0x15b)]==_0x1a4e7a(0x314)||_0x5a38ca['type']==_0x1a4e7a(0x16c)||_0x5a38ca[_0x1a4e7a(0x15b)]==_0x1a4e7a(0x229))&&settings[_0x1a4e7a(0x296)]=='alerts'||_0x5a38ca['type']==_0x1a4e7a(0x18b)&&settings[_0x1a4e7a(0x296)]==_0x1a4e7a(0x26d)){if(tgBot&&settings[_0x1a4e7a(0x22e)]){if(_0x5a38ca[_0x1a4e7a(0x295)])await sendTelegram(settings['telegramChatId'],_0x5a38ca[_0x1a4e7a(0x259)]+_0x1a4e7a(0x1b9)+_0x5a38ca[_0x1a4e7a(0x153)]);else await sendTelegram(settings[_0x1a4e7a(0x22e)],_0x1a4e7a(0x261)+_0xb12dd2+'\x20>\x20'+_0x5a38ca['event']);}}}}async function sendTelegramMsg(_0x46fe48,_0x93227c=_0x21fe16(0x2a0)){const _0x1e7b47=_0x21fe16;return settings[_0x1e7b47(0x318)]&&tgBot&&settings[_0x1e7b47(0x22e)]?(await sendTelegram(settings[_0x1e7b47(0x22e)],_0x46fe48,{'parse_mode':_0x93227c}),!![]):![];}function getDeviceWithIp(_0x459256){const _0x1f9e14=_0x21fe16;return devices[_0x1f9e14(0x20e)](_0x35c7ee=>_0x35c7ee['ip']===_0x459256);}async function temporaryAccess2FA(_0x18d01b,_0x14f3e4){const _0x45e25c=_0x21fe16;let _0x3c0d6c=new Date(),_0x5de13=![];if(lastIpApproval){if(_0x3c0d6c-lastIpApproval<0x1388)_0x5de13=!![];}lastIpApproval=new Date();if(_0x5de13)return;if(tgBot&&settings[_0x45e25c(0x22e)]){const _0x5adbe5=uuidRandom();tmpStorage[_0x5adbe5]={'uuid':_0x18d01b,'externalip':_0x14f3e4};const _0x2df610=Markup['inlineKeyboard']([Markup[_0x45e25c(0x2c1)][_0x45e25c(0x224)](_0x45e25c(0x1c5),_0x45e25c(0x180)+_0x5adbe5),Markup['button']['callback'](_0x45e25c(0x263),_0x45e25c(0x115)+_0x5adbe5),Markup[_0x45e25c(0x2c1)][_0x45e25c(0x224)]('30\x20min',_0x45e25c(0x113)+_0x5adbe5),Markup['button'][_0x45e25c(0x224)](_0x45e25c(0x150),'tempaccess_reject_'+_0x5adbe5)]);await sendTelegram(settings['telegramChatId'],_0x45e25c(0x26c)+normalizeIP(_0x14f3e4)['show']+'\x20?',_0x2df610),tgBot[_0x45e25c(0x2ab)](/tempaccess_(.+)_(.+)/,async _0x49c42d=>{const _0x3ecba5=_0x45e25c,_0x18f70d=_0x49c42d[_0x3ecba5(0x2b3)][0x1],_0x20c443=_0x49c42d['match'][0x2],{uuid:_0x44b776,externalip:_0x2fd98a}=tmpStorage[_0x20c443];delete tmpStorage[_0x20c443],_0x49c42d[_0x3ecba5(0x20a)](),devices[_0x44b776]['telegramIpApproval']={'clientip':_0x2fd98a,'timestamp':new Date()[_0x3ecba5(0x206)](),'expiry':_0x18f70d},_0x18f70d!='reject'?(await sendTelegram(_0x49c42d[_0x3ecba5(0x2a2)]['id'],_0x3ecba5(0x274)+_0x18f70d+_0x3ecba5(0x30f),{'parse_mode':_0x3ecba5(0x2a0)}),io['to'](_0x44b776)['emit'](_0x3ecba5(0x1b0),{'access':{'allow':![],'reason':'reload','token':null}})):(await sendTelegram(_0x49c42d[_0x3ecba5(0x2a2)]['id'],_0x3ecba5(0x207)),io['to'](_0x44b776)[_0x3ecba5(0x1d0)](_0x3ecba5(0x1b0),{'access':{'allow':![],'reason':_0x3ecba5(0x2bf),'token':null}}));});}}async function loginAccess2FA(_0x40baf8,_0x297212){const _0x494512=_0x21fe16;if(tgBot&&settings[_0x494512(0x22e)]){const _0x870221=uuidRandom();tmpStorage[_0x870221]={'uuid':_0x40baf8,'externalip':_0x297212};const _0x4debd0=Markup[_0x494512(0x12f)]([Markup[_0x494512(0x2c1)][_0x494512(0x224)](_0x494512(0x30b),_0x494512(0x129)+loginExpiry+'_'+_0x870221),Markup[_0x494512(0x2c1)]['callback'](_0x494512(0x150),'login2fa_reject_'+_0x870221)]);await sendTelegram(settings[_0x494512(0x22e)],_0x494512(0x1f2)+normalizeIP(_0x297212)[_0x494512(0x25c)]+'\x20?',_0x4debd0),tgBot['action'](/login2fa_(.+)_(.+)/,async _0x345b42=>{const _0x4eb482=_0x494512,_0x481554=_0x345b42[_0x4eb482(0x2b3)][0x1],_0x10a560=_0x345b42[_0x4eb482(0x2b3)][0x2],{uuid:_0x57cefa,externalip:_0x45426c}=tmpStorage[_0x10a560];delete tmpStorage[_0x10a560],_0x345b42[_0x4eb482(0x20a)](),devices[_0x57cefa][_0x4eb482(0x10f)]={'clientip':_0x45426c,'timestamp':new Date()[_0x4eb482(0x206)](),'expiry':_0x481554},_0x481554!=_0x4eb482(0x150)?(await sendTelegram(_0x345b42[_0x4eb482(0x2a2)]['id'],_0x4eb482(0x20c),{'parse_mode':_0x4eb482(0x2a0)}),io['to'](_0x57cefa)['emit'](_0x4eb482(0x1b0),{'access':{'allow':![],'reason':'reload','token':null}})):(await sendTelegram(_0x345b42[_0x4eb482(0x2a2)]['id'],_0x4eb482(0x21a)),io['to'](_0x57cefa)[_0x4eb482(0x1d0)]('status',{'access':{'allow':![],'reason':'2FA\x20login\x20rejected','token':null}}));});}}function getConfiguration(){return getBotsWithMode();}function getEnabledBots(){const _0x3a2c22=_0x21fe16;return dbConfig['get']('bots')[_0x3a2c22(0x177)](_0x3a2c22(0x21b))[_0x3a2c22(0x21e)]({'status':_0x3a2c22(0x1f7)})[_0x3a2c22(0x1ff)]()||[];}function getDisabledBots(){const _0x555d74=_0x21fe16;return dbConfig['get'](_0x555d74(0x248))[_0x555d74(0x177)](_0x555d74(0x21b))[_0x555d74(0x21e)]({'status':_0x555d74(0x1b2)})[_0x555d74(0x1ff)]()||[];}function getBotAttributes(_0x587aa1){const _0x1149b9=_0x21fe16;let _0x3ff330={};const _0x3f76ce=configpath+_0x1149b9(0x1f6)+_0x587aa1+'-config.json',_0x2b5a09=fs[_0x1149b9(0x2fd)](_0x3f76ce);if(_0x2b5a09){const _0x7cd20a=fs['readFileSync'](_0x3f76ce);try{const _0x59ccc8=JSON['parse'](_0x7cd20a),_0x34622f=_0x59ccc8?_0x59ccc8[_0x1149b9(0x12d)][0x0][_0x1149b9(0x1e9)]:![];_0x3ff330[_0x1149b9(0x13b)]=_0x34622f?_0x1149b9(0x151):_0x1149b9(0x27a),_0x3ff330[_0x1149b9(0x259)]=_0x59ccc8?_0x59ccc8[_0x1149b9(0x12d)][0x0][_0x1149b9(0x259)]:'Bot\x20'+_0x587aa1;}catch(_0x573a69){_0x3ff330[_0x1149b9(0x13b)]='manual',_0x3ff330['botname']=_0x1149b9(0x261)+_0x587aa1;}}else _0x3ff330[_0x1149b9(0x13b)]='manual',_0x3ff330['botname']='Bot\x20'+_0x587aa1;return _0x3ff330;}function getBotsWithMode(){const _0x1a41ed=_0x21fe16,_0x22527f=dbConfig[_0x1a41ed(0x141)](_0x1a41ed(0x248))[_0x1a41ed(0x177)]('botID')[_0x1a41ed(0x1ff)]()||[];return _0x22527f[_0x1a41ed(0x1f0)](_0x400b2f=>{const _0x32223d=_0x1a41ed;let _0xc23a88=getBotAttributes(_0x400b2f[_0x32223d(0x21b)]);_0x400b2f[_0x32223d(0x13b)]=_0xc23a88['mode'];}),_0x22527f;}function getBotExchanges(){const _0x454ff1=_0x21fe16;let _0x44d381=[];const _0x43da32=dbConfig[_0x454ff1(0x141)]('bots')[_0x454ff1(0x177)]('botID')[_0x454ff1(0x1ff)]()||[];_0x43da32['forEach'](_0x1f0021=>{const _0x209cab=_0x454ff1;if(_0x1f0021[_0x209cab(0x1b0)]=='enabled'){const _0x51e7e1=configpath+'bot-'+_0x1f0021['botID']+_0x209cab(0x264),_0x3ef03d=fs[_0x209cab(0x2fd)](_0x51e7e1);let _0x4d123d;if(_0x3ef03d){const _0x299e3a=fs[_0x209cab(0x1b1)](_0x51e7e1);try{const _0x5a9a91=JSON[_0x209cab(0x1d4)](_0x299e3a);_0x4d123d=_0x5a9a91?_0x5a9a91[_0x209cab(0x12d)][0x0][_0x209cab(0x22c)]:null;}catch(_0x2a9dfa){}}if(_0x4d123d)_0x44d381[_0x209cab(0x2c2)](_0x4d123d);}});const _0x20625c=[...new Set(_0x44d381)][_0x454ff1(0x108)]();return _0x20625c;}async function initUser(){const _0x36690a=_0x21fe16;if(!settings['userid']){const _0x3f7673=uuidRandom();mixpanel[_0x36690a(0x184)](_0x3f7673),updateSetting('userid',_0x3f7673);}}async function initSecure(){const _0x47e11a=_0x21fe16;let _0x4f222d=getSecure();if(!_0x4f222d[_0x47e11a(0x253)](_0x47e11a(0x160))){let _0x16a975=await generateKeys();_0x4f222d['publicKey']=_0x16a975[_0x47e11a(0x258)],_0x4f222d['privateKey']=_0x16a975['privateKey'],_0x4f222d[_0x47e11a(0x160)]=crypto[_0x47e11a(0x246)](0x20)[_0x47e11a(0x198)]('hex');;storeSecure(_0x4f222d);}}function getSettings(){const _0x23ea51=_0x21fe16;return dbSettings['get'](_0x23ea51(0x16e))[_0x23ea51(0x1ff)]()||{};}function getSecure(){const _0x467810=_0x21fe16;return dbSecure['get'](_0x467810(0x251))['value']()||{};}function getBlacklist(){const _0x54bfe4=_0x21fe16;return dbSecure[_0x54bfe4(0x141)](_0x54bfe4(0x14c))[_0x54bfe4(0x1ff)]()||[];}function broadcastToBots(_0x577b4e,_0x4776fd){const _0x4f2366=_0x21fe16;config[_0x4f2366(0x1f0)](_0x4db90e=>{const _0x17556a=_0x4f2366;if(_0x4db90e[_0x17556a(0x1b0)]==_0x17556a(0x1f7)&&_0x4db90e[_0x17556a(0x1ef)]=='running'||_0x4db90e['status']==_0x17556a(0x2ed)&&_0x4db90e['live']==_0x17556a(0x24f)){if(pid[_0x4db90e[_0x17556a(0x21b)]])pid[_0x4db90e['botID']][_0x17556a(0x24d)]({[_0x577b4e]:_0x4776fd});}});}async function storeSettings(_0x43ef21,_0x48eda2=![]){const _0x23d0cf=_0x21fe16;_0x43ef21={...settings,..._0x43ef21};if(_0x48eda2&&_0x43ef21[_0x23d0cf(0x1fb)]!=_0x23d0cf(0x116)&&_0x43ef21[_0x23d0cf(0x1fb)]!=_0x23d0cf(0x1c1)&&_0x43ef21[_0x23d0cf(0x1fb)]!=''){const _0x414905=crypt[_0x23d0cf(0x311)](secure['privateKey'],_0x43ef21[_0x23d0cf(0x1fb)])[_0x23d0cf(0x15c)][_0x23d0cf(0x2bd)](_0x23d0cf(0x2b8))[0x0],_0x4d0935=bcrypt[_0x23d0cf(0x2ba)](_0x414905,saltRounds);_0x43ef21={..._0x43ef21,'bbPassword':_0x4d0935};}if(_0x48eda2&&_0x43ef21[_0x23d0cf(0x1d6)]!=_0x23d0cf(0x116)&&_0x43ef21[_0x23d0cf(0x1d6)]!=_0x23d0cf(0x1c1)&&_0x43ef21[_0x23d0cf(0x1d6)]!=''){const _0x32eb32=crypt[_0x23d0cf(0x311)](secure[_0x23d0cf(0x312)],_0x43ef21[_0x23d0cf(0x1d6)])[_0x23d0cf(0x15c)][_0x23d0cf(0x2bd)](_0x23d0cf(0x2b8))[0x0];_0x43ef21={..._0x43ef21,'telegramToken':_0x32eb32};}if(_0x48eda2&&_0x43ef21['marketcapApi']!=_0x23d0cf(0x116)&&_0x43ef21['marketcapApi']!=_0x23d0cf(0x1c1)&&_0x43ef21[_0x23d0cf(0x2b5)]!=''){const _0x2abb95=crypt[_0x23d0cf(0x311)](secure[_0x23d0cf(0x312)],_0x43ef21[_0x23d0cf(0x2b5)])[_0x23d0cf(0x15c)]['split']('|@|')[0x0];_0x43ef21={..._0x43ef21,'marketcapApi':_0x2abb95};}const _0x3e3a19=_0x43ef21['telegramToken']!=_0x23d0cf(0x116)&&_0x43ef21[_0x23d0cf(0x1d6)]!=settings[_0x23d0cf(0x1d6)]||_0x43ef21[_0x23d0cf(0x1fa)]!=settings[_0x23d0cf(0x1fa)],_0x287ac4=_0x43ef21[_0x23d0cf(0x1d6)]==''||_0x43ef21['telegramUsername']=='',_0x4fcca9=_0x43ef21[_0x23d0cf(0x2b5)]&&_0x43ef21['marketcapApi']!=_0x23d0cf(0x116)&&_0x43ef21['marketcapApi']!=settings[_0x23d0cf(0x1d6)];_0x3e3a19&&(_0x43ef21[_0x23d0cf(0x22e)]=null,_0x43ef21[_0x23d0cf(0x296)]=_0x23d0cf(0x30d));for(const [_0x4c80ed,_0x9992bc]of Object[_0x23d0cf(0x210)](_0x43ef21)){if(_0x4c80ed=='telegramToken'&&_0x9992bc==_0x23d0cf(0x116)){_0x43ef21[_0x23d0cf(0x1d6)]=settings[_0x23d0cf(0x1d6)];continue;};if(_0x4c80ed==_0x23d0cf(0x1fb)&&_0x9992bc==_0x23d0cf(0x116)){_0x43ef21[_0x23d0cf(0x1fb)]=settings[_0x23d0cf(0x1fb)];continue;};if(_0x4c80ed=='marketcapApi'&&_0x9992bc==_0x23d0cf(0x116)){_0x43ef21[_0x23d0cf(0x2b5)]=settings[_0x23d0cf(0x2b5)];continue;};dbSettings[_0x23d0cf(0x11b)]('settings.'+_0x4c80ed,_0x9992bc)[_0x23d0cf(0x19a)]();}settings=_0x43ef21,io['to']('botmanager')[_0x23d0cf(0x1d0)](_0x23d0cf(0x16e),cleanSettings()),broadcastToBots(_0x23d0cf(0x2ca),settings[_0x23d0cf(0x2ca)]),broadcastToBots(_0x23d0cf(0x2ea),settings[_0x23d0cf(0x2ea)]),broadcastToBots(_0x23d0cf(0x2b5),settings[_0x23d0cf(0x2b5)]);if(_0x3e3a19&&!_0x287ac4)initTelegram();if(_0x3e3a19&&_0x287ac4)disableTelegram();getAllClients()[_0x23d0cf(0x1f0)](_0x132114=>{const _0x4e298a=_0x23d0cf;getSocket(_0x132114['id'])['emit'](_0x4e298a(0x1b0),{'access':{'allow':![],'reason':'reload','token':null}});}),_0x4fcca9&&(await sleep(0xbb8),testMarketcapApi(_0x43ef21[_0x23d0cf(0x2b5)]));}async function testMarketcapApi(_0x4feeac){const _0x1177dc=_0x21fe16,_0x1d7c39=['BCT',_0x1177dc(0x140)];try{await axios[_0x1177dc(0x141)](_0x1177dc(0x222),{'headers':{'X-CMC_PRO_API_KEY':_0x4feeac},'params':{'symbol':_0x1d7c39[_0x1177dc(0x198)]()}});}catch(_0x491a07){_0x491a07['toString']()[_0x1177dc(0x319)](_0x1177dc(0x2b6))?(io['to'](_0x1177dc(0x2ef))[_0x1177dc(0x1d0)](_0x1177dc(0x1ee),_0x1177dc(0x185)),logger[_0x1177dc(0x303)](_0x1177dc(0x185))):(io['to'](_0x1177dc(0x2ef))[_0x1177dc(0x1d0)](_0x1177dc(0x1ee),'CoinMarketCap\x20data\x20could\x20not\x20be\x20retrieved\x20-\x20see\x20logs\x20for\x20details'),logger['full'](_0x1177dc(0x1af)),logger[_0x1177dc(0x20f)](_0x1177dc(0x2e7),_0x491a07[_0x1177dc(0x198)]()+_0x1177dc(0x28e)+_0x491a07[_0x1177dc(0x22b)]));return;}logger[_0x1177dc(0x20f)](_0x1177dc(0x1ac));}function updateSetting(_0x650839,_0x2e7751){const _0x3e01c7=_0x21fe16;dbSettings[_0x3e01c7(0x11b)]('settings.'+_0x650839,_0x2e7751)[_0x3e01c7(0x19a)](),settings=getSettings(),io['to'](_0x3e01c7(0x2ef))['emit']('settings',cleanSettings());}function storeSecure(_0x43dbd4){const _0x5a8fa5=_0x21fe16;dbSecure[_0x5a8fa5(0x141)](_0x5a8fa5(0x251))['push'](_0x43dbd4)[_0x5a8fa5(0x19a)](),secure=_0x43dbd4;}function addBlacklist(_0x2e0a13){const _0x4bc41f=_0x21fe16;cleanBlacklist();let _0x5cfde1;devices[_0x2e0a13]['telegramIpApproval']?_0x5cfde1=Math[_0x4bc41f(0x2e3)](devices[_0x2e0a13][_0x4bc41f(0x217)][_0x4bc41f(0x15a)],loginExpiry):_0x5cfde1=loginExpiry,dbSecure[_0x4bc41f(0x141)](_0x4bc41f(0x14c))[_0x4bc41f(0x2c2)]({'expiry':new Date()[_0x4bc41f(0x206)]()+_0x5cfde1*0x3c*0x3e8,'token':devices[_0x2e0a13]['access'][_0x4bc41f(0x170)]})[_0x4bc41f(0x19a)](),blacklist=dbSecure['get'](_0x4bc41f(0x14c))[_0x4bc41f(0x1ff)]();}function cleanBlacklist(){const _0x453475=_0x21fe16;let _0x19d2f7=dbSecure[_0x453475(0x141)](_0x453475(0x14c))[_0x453475(0x166)]()[_0x453475(0x1ff)](),_0x3635ee=new Date()[_0x453475(0x206)]();_0x19d2f7['forEach'](_0x318e2a=>{const _0x5303b5=_0x453475;_0x318e2a['expiry']<_0x3635ee&&dbSecure[_0x5303b5(0x141)](_0x5303b5(0x14c))[_0x5303b5(0x11a)]({'expiry':_0x318e2a[_0x5303b5(0x15a)]})[_0x5303b5(0x19a)]();});}function initStates(){let _0x7e1278=getConfiguration();_0x7e1278['forEach'](_0x2efb94=>{const _0xcd3bd2=_0x10d2;_0x2efb94[_0xcd3bd2(0x1ef)]=_0xcd3bd2(0x300);}),storeConfiguration(_0x7e1278);}function onKeys(){const _0x264d69=new RSA();return new Promise(_0x9f1ecb=>{const _0x251a45=_0x10d2;_0x264d69['generateKeyPairAsync']()[_0x251a45(0x2d1)](_0x3627a8=>{_0x9f1ecb(_0x3627a8);});});}async function generateKeys(){return await onKeys();}async function oneTimeMigration(){const _0xb0a0e3=_0x21fe16;let _0x1ede5b=getSettings(),_0x3146d1=![];!_0x1ede5b[_0xb0a0e3(0x253)](_0xb0a0e3(0x280))&&(_0x1ede5b['lastmsgtelegram']=0x0,_0x3146d1=!![]);!_0x1ede5b[_0xb0a0e3(0x253)](_0xb0a0e3(0x2cc))&&(_0x1ede5b[_0xb0a0e3(0x2cc)]=0x0,_0x3146d1=!![]);!_0x1ede5b[_0xb0a0e3(0x253)](_0xb0a0e3(0x16b))&&(_0x1ede5b[_0xb0a0e3(0x16b)]='0.0.0',_0x3146d1=!![]);!_0x1ede5b['hasOwnProperty'](_0xb0a0e3(0x2ea))&&(_0x1ede5b[_0xb0a0e3(0x2ea)]=![],_0x3146d1=!![]);!_0x1ede5b['hasOwnProperty'](_0xb0a0e3(0x2b5))&&(_0x1ede5b[_0xb0a0e3(0x2b5)]='',_0x3146d1=!![]);if(_0x3146d1)storeSettings(_0x1ede5b);try{fs[_0xb0a0e3(0x157)](configbackuppath,{'withFileTypes':!![]})[_0xb0a0e3(0x1f0)](_0xa8cc03=>{const _0x2b69c3=_0xb0a0e3;if(!_0xa8cc03[_0x2b69c3(0x2d0)]()){if(!_0xa8cc03[_0x2b69c3(0x1d9)][_0x2b69c3(0x240)](_0x2b69c3(0x164)))fs[_0x2b69c3(0x19d)](configbackuppath+_0xa8cc03[_0x2b69c3(0x1d9)]);}else fs[_0x2b69c3(0x213)](configbackuppath+_0xa8cc03[_0x2b69c3(0x1d9)],{'recursive':!![]});});}catch(_0xa15532){logger[_0xb0a0e3(0x20f)]('Error\x20removing\x20old\x20backup\x20files:',_0xa15532);}}function storeConfiguration(_0x3a7995){const _0x10c6ba=_0x21fe16;dbConfig['get'](_0x10c6ba(0x248))[_0x10c6ba(0x11a)]()[_0x10c6ba(0x19a)](),dbConfig[_0x10c6ba(0x141)]('bots')[_0x10c6ba(0x2c2)](..._0x3a7995)[_0x10c6ba(0x19a)](),config=_0x3a7995;}async function resetPassword(){const _0xcafc4c=_0x21fe16;if(tgBot&&settings['telegramChatId']){const _0x57dedd=Markup[_0xcafc4c(0x12f)]([Markup[_0xcafc4c(0x2c1)][_0xcafc4c(0x224)](_0xcafc4c(0x278),'resetpw_yes'),Markup[_0xcafc4c(0x2c1)][_0xcafc4c(0x224)]('no',_0xcafc4c(0x2d4))]);await sendTelegram(settings[_0xcafc4c(0x22e)],_0xcafc4c(0x14f),_0x57dedd),tgBot['action'](/resetpw_(.+)/,async _0x52708b=>{const _0x2613d7=_0xcafc4c,_0x1fb6df=_0x52708b[_0x2613d7(0x2b3)][0x1];_0x52708b['editMessageReplyMarkup']();if(_0x1fb6df!='no'){const _0x1523e7=0xf,_0x42e9be=_0x2613d7(0x1f5),_0x397b07=Array[_0x2613d7(0x186)](crypto['randomFillSync'](new Uint32Array(_0x1523e7)))[_0x2613d7(0x179)](_0x5f4ebb=>_0x42e9be[_0x5f4ebb%_0x42e9be[_0x2613d7(0x191)]])[_0x2613d7(0x128)](''),_0x25c7e2=bcrypt['hashSync'](_0x397b07,saltRounds);storeSettings({'bbPassword':_0x25c7e2}),await sendTelegram(_0x52708b[_0x2613d7(0x2a2)]['id'],'Password\x20has\x20been\x20reset\x20to:\x20'+_0x397b07,{'parse_mode':_0x2613d7(0x2a0)});}else await sendTelegram(_0x52708b[_0x2613d7(0x2a2)]['id'],_0x2613d7(0x174));});}}async function confirmRestore(_0x3d1a8,_0x5c19f7){const _0x104447=_0x21fe16;io['to'](_0x104447(0x2ef))['emit'](_0x104447(0x1ee),_0x104447(0x231),'success');if(tgBot&&settings[_0x104447(0x22e)]){const _0xbd8f1=uuidRandom();tmpStorage[_0xbd8f1]={'path':_0x3d1a8,'filename':_0x5c19f7};const _0x2cdc5c=Markup[_0x104447(0x12f)]([Markup[_0x104447(0x2c1)][_0x104447(0x224)](_0x104447(0x278),_0x104447(0x17c)+_0xbd8f1),Markup[_0x104447(0x2c1)][_0x104447(0x224)]('no','restore_no_'+_0xbd8f1)]);await sendTelegram(settings['telegramChatId'],_0x104447(0x2c0),_0x2cdc5c),tgBot[_0x104447(0x2ab)](/restore_(.+)_(.+)/,async _0x31ebea=>{const _0x527914=_0x104447,_0x68a29d=_0x31ebea['match'][0x1],_0x1a7cad=_0x31ebea['match'][0x2],{path:_0x7224b8,filename:_0x529a4a}=tmpStorage[_0x1a7cad];delete tmpStorage[_0x1a7cad],_0x31ebea[_0x527914(0x20a)](),_0x68a29d==_0x527914(0x278)?(logger[_0x527914(0x20f)](_0x527914(0x293)),await sendTelegram(_0x31ebea[_0x527914(0x2a2)]['id'],_0x527914(0x236),{'parse_mode':_0x527914(0x2a0)}),unzipFile(_0x7224b8,_0x529a4a)):(logger[_0x527914(0x20f)](_0x527914(0x2b4)),await sendTelegram(_0x31ebea[_0x527914(0x2a2)]['id'],_0x527914(0x2b4)));});}}function getServerTime(){const _0x360691=_0x21fe16,_0x45e330=new Date();return _0x45e330['getFullYear']()+'/'+(_0x45e330[_0x360691(0x23f)]()+0x1)[_0x360691(0x198)]()[_0x360691(0x18d)](0x2,'0')+'/'+_0x45e330[_0x360691(0x1fd)]()[_0x360691(0x198)]()[_0x360691(0x18d)](0x2,'0')+'\x20'+_0x45e330[_0x360691(0x182)]()[_0x360691(0x198)]()[_0x360691(0x18d)](0x2,'0')+':'+_0x45e330[_0x360691(0x1ab)]()['toString']()['padStart'](0x2,'0')+':'+_0x45e330[_0x360691(0x211)]()[_0x360691(0x198)]()[_0x360691(0x18d)](0x2,'0');}function getTimeStamp(){const _0x54d53e=_0x21fe16,_0x518d2e=shiftedTime();return _0x518d2e[_0x54d53e(0x2db)]()+'/'+(_0x518d2e[_0x54d53e(0x23f)]()+0x1)[_0x54d53e(0x198)]()[_0x54d53e(0x18d)](0x2,'0')+'/'+_0x518d2e[_0x54d53e(0x1fd)]()['toString']()[_0x54d53e(0x18d)](0x2,'0')+'\x20'+_0x518d2e[_0x54d53e(0x182)]()[_0x54d53e(0x198)]()['padStart'](0x2,'0')+':'+_0x518d2e[_0x54d53e(0x1ab)]()['toString']()[_0x54d53e(0x18d)](0x2,'0')+':'+_0x518d2e[_0x54d53e(0x211)]()[_0x54d53e(0x198)]()[_0x54d53e(0x18d)](0x2,'0');}function getCleanTimeStamp(){const _0x391f65=_0x21fe16,_0x396309=shiftedTime();return _0x396309[_0x391f65(0x2db)]()+(_0x396309[_0x391f65(0x23f)]()+0x1)['toString']()[_0x391f65(0x18d)](0x2,'0')+_0x396309[_0x391f65(0x1fd)]()[_0x391f65(0x198)]()[_0x391f65(0x18d)](0x2,'0')+'-'+_0x396309[_0x391f65(0x182)]()[_0x391f65(0x198)]()[_0x391f65(0x18d)](0x2,'0')+_0x396309[_0x391f65(0x1ab)]()['toString']()[_0x391f65(0x18d)](0x2,'0')+_0x396309[_0x391f65(0x211)]()[_0x391f65(0x198)]()['padStart'](0x2,'0');}function _0x10d2(_0x4a5ef1,_0xfd1768){const _0x27bb29=_0x4615();return _0x10d2=function(_0x4e1c19,_0x3608ed){_0x4e1c19=_0x4e1c19-0x108;let _0x4615de=_0x27bb29[_0x4e1c19];return _0x4615de;},_0x10d2(_0x4a5ef1,_0xfd1768);}function shiftedTime(){const _0x5db080=_0x21fe16,_0x176838=new Date();let _0x1f4467=_0x176838;if(settings[_0x5db080(0x2ca)]&&settings[_0x5db080(0x2ca)]!==0x0)_0x1f4467=fns[_0x5db080(0x30e)](_0x176838,{'hours':settings[_0x5db080(0x2ca)]});return _0x1f4467;}async function startScheduler(){const _0x244963=_0x21fe16,_0x105377=new Date()[_0x244963(0x265)](),_0x27a780=shiftedTime()[_0x244963(0x182)]();_0x27a780==0x4&&backupConfigFiles(),_0x27a780==0x0&&rotateLogFiles(),_0x105377%0x6==0x0&&triggerAnalytics(),_0x105377%0x6==0x0&&getMessages(),await sleep(schedulerInterval),startScheduler();}async function restoreBackupFile(_0x5ad8b7){const _0x376ccc=_0x21fe16;logger[_0x376ccc(0x20f)](_0x376ccc(0x232)+_0x5ad8b7);const _0x3c38c1=getBotsWithMode();_0x3c38c1[_0x376ccc(0x191)]>0x0?confirmRestore(configbackuppath,_0x5ad8b7):unzipFile(configbackuppath,_0x5ad8b7);}async function getBackupFiles(_0xb5145e=null){const _0x4b13e5=_0x21fe16;let _0x1c4373=[],_0x53bd8d=fs[_0x4b13e5(0x157)](configbackuppath,{'withFileTypes':!![]});_0x53bd8d[_0x4b13e5(0x108)]((_0x4fcb65,_0x172dfd)=>_0x4fcb65['name']<_0x172dfd[_0x4b13e5(0x1d9)]?0x1:_0x172dfd[_0x4b13e5(0x1d9)]<_0x4fcb65['name']?-0x1:0x0),_0x53bd8d[_0x4b13e5(0x1f0)](_0x9bdf3b=>{const _0x4784d7=_0x4b13e5;if(!_0x9bdf3b[_0x4784d7(0x2d0)]()&&_0x9bdf3b[_0x4784d7(0x1d9)]['startsWith'](_0x4784d7(0x164))&&_0x9bdf3b['name'][_0x4784d7(0x29d)]('.zip')){const _0x4f1e67=formatDate(fs[_0x4784d7(0x1c2)](configbackuppath+_0x9bdf3b[_0x4784d7(0x1d9)])[_0x4784d7(0x28a)]);_0x1c4373[_0x4784d7(0x2c2)]({'name':_0x9bdf3b[_0x4784d7(0x1d9)],'mtime':_0x4f1e67});}});if(_0xb5145e)io['to'](_0xb5145e)[_0x4b13e5(0x1d0)](_0x4b13e5(0x24a),_0x1c4373);else return _0x1c4373;}async function backupConfigFiles(){const _0x1dcb74=_0x21fe16;await zipFiles('backup-full');const _0x8a1afc=getCleanTimeStamp();fs[_0x1dcb74(0x11e)](zippath+_0x1dcb74(0x2fb),configbackuppath+(_0x1dcb74(0x164)+_0x8a1afc+_0x1dcb74(0x1d1)));let _0x2b518b=fs[_0x1dcb74(0x157)](configbackuppath,{'withFileTypes':!![]});_0x2b518b[_0x1dcb74(0x108)]((_0x2237ea,_0x210c20)=>_0x2237ea['name']<_0x210c20[_0x1dcb74(0x1d9)]?0x1:_0x210c20[_0x1dcb74(0x1d9)]<_0x2237ea[_0x1dcb74(0x1d9)]?-0x1:0x0),_0x2b518b[_0x1dcb74(0x191)]>maxBackups&&fs[_0x1dcb74(0x19d)](configbackuppath+_0x2b518b[_0x2b518b[_0x1dcb74(0x191)]-0x1]['name']);}function rotateLogFiles(){const _0x29c356=_0x21fe16,_0x129a2d=fs[_0x29c356(0x1c2)](logspath+_0x29c356(0x247)),_0x308cca=_0x129a2d['size']/0x400;if(_0x308cca>0x64){let _0x355187=fs[_0x29c356(0x157)](logspath,{'withFileTypes':!![]});_0x355187[_0x29c356(0x108)]((_0x2eb882,_0x4edbe9)=>_0x2eb882['name']<_0x4edbe9[_0x29c356(0x1d9)]?0x1:_0x4edbe9[_0x29c356(0x1d9)]<_0x2eb882[_0x29c356(0x1d9)]?-0x1:0x0),_0x355187[_0x29c356(0x1f0)](_0x4a4a43=>{const _0x4c33ef=_0x29c356;if(_0x4a4a43[_0x4c33ef(0x1d9)]==_0x4c33ef(0x192))fs['copyFileSync'](logspath+_0x4a4a43['name'],logspath+'output-003.log');if(_0x4a4a43['name']=='output-001.log')fs[_0x4c33ef(0x11e)](logspath+_0x4a4a43[_0x4c33ef(0x1d9)],logspath+'output-002.log');_0x4a4a43['name']==_0x4c33ef(0x247)&&(fs[_0x4c33ef(0x11e)](logspath+_0x4a4a43[_0x4c33ef(0x1d9)],logspath+_0x4c33ef(0x235)),fs['writeFileSync'](logspath+_0x4a4a43[_0x4c33ef(0x1d9)],''));});}}async function zipFiles(_0x5aa458){const _0x54c2f8=_0x21fe16;let _0x565419;if(_0x5aa458=='logs')_0x565419=logspath;if(_0x5aa458=='backup')_0x565419=configpath;if(_0x5aa458==_0x54c2f8(0x2a7))_0x565419=configpath;let _0x118661=fs[_0x54c2f8(0x157)](_0x565419,{'withFileTypes':!![]});const _0x56a828=new require(_0x54c2f8(0x28f))();_0x118661[_0x54c2f8(0x1f0)](_0x4a42f0=>{const _0x3742f7=_0x54c2f8;if(!_0x4a42f0[_0x3742f7(0x2d0)]()){let _0x5e58ec=fs[_0x3742f7(0x1b1)](_0x565419+_0x4a42f0[_0x3742f7(0x1d9)]);if(_0x5aa458==_0x3742f7(0x28c)){const _0x1e6acf=/^bot-[0-9]{3}-config.json$/,_0x4749e4=_0x1e6acf[_0x3742f7(0x122)](_0x4a42f0[_0x3742f7(0x1d9)]);if(_0x4749e4){const _0x15a6ff=JSON[_0x3742f7(0x1d4)](_0x5e58ec);if(_0x15a6ff[_0x3742f7(0x12d)][0x0]){_0x15a6ff[_0x3742f7(0x12d)][0x0][_0x3742f7(0x1eb)]=_0x3742f7(0x1c1),_0x15a6ff[_0x3742f7(0x12d)][0x0]['apiSecret']=_0x3742f7(0x1c1);if(_0x15a6ff[_0x3742f7(0x12d)][0x0][_0x3742f7(0x17a)])_0x15a6ff[_0x3742f7(0x12d)][0x0][_0x3742f7(0x17a)]=_0x3742f7(0x1c1);}_0x5e58ec=JSON[_0x3742f7(0x310)](_0x15a6ff,null,0x2);}if(_0x4a42f0[_0x3742f7(0x1d9)]==_0x3742f7(0x238)){const _0x2ff37b=JSON[_0x3742f7(0x1d4)](_0x5e58ec);if(_0x2ff37b[_0x3742f7(0x16e)][_0x3742f7(0x23a)])_0x2ff37b[_0x3742f7(0x16e)][_0x3742f7(0x23a)]=![];if(_0x2ff37b[_0x3742f7(0x16e)][_0x3742f7(0x1fb)])_0x2ff37b[_0x3742f7(0x16e)][_0x3742f7(0x1fb)]='***';if(_0x2ff37b[_0x3742f7(0x16e)][_0x3742f7(0x1d6)])_0x2ff37b[_0x3742f7(0x16e)][_0x3742f7(0x1d6)]=_0x3742f7(0x1c1);if(_0x2ff37b[_0x3742f7(0x16e)][_0x3742f7(0x22e)])_0x2ff37b[_0x3742f7(0x16e)]['telegramChatId']=null;if(_0x2ff37b['settings'][_0x3742f7(0x2b5)])_0x2ff37b[_0x3742f7(0x16e)][_0x3742f7(0x2b5)]=_0x3742f7(0x1c1);_0x5e58ec=JSON[_0x3742f7(0x310)](_0x2ff37b,null,0x2);}if(_0x4a42f0[_0x3742f7(0x1d9)]!=_0x3742f7(0x2ec))_0x56a828[_0x3742f7(0x29e)](_0x4a42f0[_0x3742f7(0x1d9)],_0x5e58ec);}else _0x56a828['file'](_0x4a42f0[_0x3742f7(0x1d9)],_0x5e58ec);}});const _0x4d8e81=_0x56a828['generate']({'base64':![],'compression':_0x54c2f8(0x2c5)});fs[_0x54c2f8(0x17e)](zippath+(_0x5aa458+_0x54c2f8(0x1d1)),_0x4d8e81,_0x54c2f8(0x145));}async function unzipFile(_0x24cc34,_0x37bedd){const _0x50b935=_0x21fe16;fs['readdirSync'](configpath,{'withFileTypes':!![]})[_0x50b935(0x1f0)](_0x18fd67=>{const _0x18e985=_0x50b935;if(!_0x18fd67[_0x18e985(0x2d0)]())fs['rmSync'](configpath+_0x18fd67[_0x18e985(0x1d9)]);});const _0x13a751=fs[_0x50b935(0x1b1)](_0x24cc34+_0x37bedd,_0x50b935(0x145)),_0x41d797=new require('node-zip')(_0x13a751,{'base64':![],'checkCRC32':!![]});Object[_0x50b935(0x25b)](_0x41d797[_0x50b935(0x26b)])[_0x50b935(0x1f0)](_0x7e6886=>{const _0x3f1bc4=_0x50b935,_0x414ab9=_0x41d797['files'][_0x7e6886];fs['writeFileSync'](configpath+_0x414ab9[_0x3f1bc4(0x1d9)],_0x414ab9[_0x3f1bc4(0x245)]);}),fs[_0x50b935(0x157)](temppath,{'withFileTypes':!![]})[_0x50b935(0x1f0)](_0x415512=>{const _0x550eab=_0x50b935;if(!_0x415512[_0x550eab(0x2d0)]())fs[_0x550eab(0x213)](temppath+_0x415512[_0x550eab(0x1d9)]);}),logger['debug']('Backup\x20file\x20unzipped\x20and\x20stored'),process[_0x50b935(0x24d)]({'restore':!![]},_0x4adeec=>{});}async function getPublicIp(){const _0x228367=_0x21fe16;try{const _0x4bf8e4=await axios['get'](_0x228367(0x12c));publicip=_0x4bf8e4[_0x228367(0x167)]['ip'];}catch(_0x11aaaf){}}async function triggerAnalytics(){const _0x1a69c4=_0x21fe16;if(!publicip)await getPublicIp();const _0x1824a3=getBotsWithMode();let _0xd6ef45=0x0;_0x1824a3[_0x1a69c4(0x1f0)](_0x165681=>{const _0x159e84=_0x1a69c4;if(_0x165681[_0x159e84(0x1b0)]==='enabled')_0xd6ef45++;});const _0x2bf0ee=getBotExchanges();mixpanel[_0x1a69c4(0x249)](_0x1a69c4(0x117),{'distinct_id':settings['userid'],'ip':publicip,'version':serverversion,'numbots':_0x1824a3[_0x1a69c4(0x191)],'numbotsenabled':_0xd6ef45,'exchanges':_0x2bf0ee,'environment':environment});}async function getMessages(){const _0x131247=_0x21fe16,_0x514f89=_0x131247(0x2dd),_0x5c721b=new GraphQLClient(_0x514f89),_0x5b64d5={'authorization':_0x131247(0x2eb)},_0x40e24f=serverversion['split']('.'),_0x10a837=_0x40e24f[0x0]+'.'+_0x40e24f[0x1],_0x4b2118=Math['min'](settings[_0x131247(0x280)],settings[_0x131247(0x2cc)]),_0x12f2c6={'last':parseInt(_0x4b2118),'bbm':_0x10a837},_0x4de51f=gql`
            query getMessages($bbm: String!, $last: Int!) {
                messages(where: {
                    number_gt: $last
                    OR: [
                    {bbvReceive: "any"},
                    {bbvReceive_contains: $bbm}
                    ]
                    archived_not: true
                }, orderBy: number_ASC) {
                    id
                    number
                    bbvReceive
                    bbvNew
                    title
                    message
                    dialogWidth
                    lock
                }
            }
            `;let _0x5488fe;try{_0x5488fe=await _0x5c721b['request'](_0x4de51f,_0x12f2c6,_0x5b64d5);}catch(_0x54e480){}if(_0x5488fe&&_0x5488fe[_0x131247(0x187)]){let _0x290eed=settings[_0x131247(0x280)];newMessages=[];for(const _0x5bf4bc of _0x5488fe[_0x131247(0x187)]){newMessages[_0x131247(0x2c2)](_0x5bf4bc);let _0xc02979=![];_0x5bf4bc[_0x131247(0x17d)]&&(updateSetting('latestversion',_0x5bf4bc['bbvNew']),_0xc02979=isNewerVersion(serverversion,_0x5bf4bc[_0x131247(0x17d)])||serverversion==_0x5bf4bc[_0x131247(0x17d)]);if(!_0xc02979&&_0x5bf4bc[_0x131247(0x147)]>_0x290eed){if(_0x5bf4bc[_0x131247(0x118)]===_0x131247(0x277)||serverversion['startsWith'](_0x5bf4bc['bbvReceive'])){let _0x25e388=''+_0x5bf4bc[_0x131247(0x161)]+'\x0a\x0a'+_0x5bf4bc[_0x131247(0x15c)];const _0x36f7df=await sendTelegramMsg(toTelegramMarkdown(_0x25e388),'Markdown');if(_0x36f7df)_0x290eed=_0x5bf4bc[_0x131247(0x147)];}}}updateAvailable=isNewerVersion(settings[_0x131247(0x16b)],serverversion),updateSetting(_0x131247(0x280),_0x290eed),emitMessages();}}function emitMessages(){const _0x413e95=_0x21fe16,_0x296c3c=settings[_0x413e95(0x2cc)];let _0x478178=[];newMessages[_0x413e95(0x1f0)](_0x27a816=>{const _0x2763cd=_0x413e95;_0x27a816[_0x2763cd(0x147)]>_0x296c3c&&_0x478178['push'](_0x27a816);}),_0x478178[_0x413e95(0x191)]>0x0&&getAllClients()['forEach'](_0x31c205=>{const _0x471eed=_0x413e95;getSocket(_0x31c205['id'])['emit'](_0x471eed(0x15c),_0x478178);});}function confirmMessage(_0x18fee0){const _0x1b91ef=_0x21fe16;updateSetting(_0x1b91ef(0x2cc),Number(_0x18fee0));}function isNewerVersion(_0x4b2dfc,_0x3d780a){const _0x4a2c38=_0x21fe16,_0x2f900f=_0x3d780a[_0x4a2c38(0x2bd)]('.'),_0x17679e=_0x4b2dfc[_0x4a2c38(0x2bd)]('.');for(var _0x5b3fe2=0x0;_0x5b3fe2<_0x17679e[_0x4a2c38(0x191)];_0x5b3fe2++){const _0x54da2a=~~_0x17679e[_0x5b3fe2],_0x386ef7=~~_0x2f900f[_0x5b3fe2];if(_0x54da2a>_0x386ef7)return!![];if(_0x54da2a<_0x386ef7)return![];}return![];}function toTelegramMarkdown(_0x1ac124){const _0x764580=_0x21fe16,_0x31360b=/(^|[^\*])\*{1}([^\*.]+?)\*{1}([^\*]|$)/gim,_0x1de339=/\*{2}(.+?)\*{2}/gim;return _0x1ac124=_0x1ac124[_0x764580(0x266)](_0x31360b,_0x764580(0x1de))[_0x764580(0x266)](_0x1de339,_0x764580(0x26f)),_0x1ac124;}async function validateConfigFile(){const _0xec3e9=_0x21fe16,_0x869cb5=dbConfig[_0xec3e9(0x141)]('bots')[_0xec3e9(0x177)](_0xec3e9(0x21b))['value']()||[];if(_0x869cb5[_0xec3e9(0x191)]==0x0){let _0x4fbda3=0x0,_0x4bce36=[];const _0x2d6ba6=/^bot-([0-9]{3})-config.json$/,_0x2cc099=fs['readdirSync'](configpath);_0x2cc099[_0xec3e9(0x1f0)](_0x47ef6e=>{const _0x46a129=_0xec3e9,_0xc21f48=_0x2d6ba6[_0x46a129(0x2be)](_0x47ef6e);if(_0xc21f48){const _0xd43fc0=_0xc21f48[0x1];let _0x44f2fc=getBotAttributes(_0xd43fc0);_0x4bce36[_0x46a129(0x2c2)]({'botID':_0xd43fc0,'botname':_0x44f2fc['botname'],'status':_0x46a129(0x1b2),'live':'stopped'}),_0x4fbda3++;}}),_0x4fbda3!=0x0&&(dbConfig[_0xec3e9(0x141)](_0xec3e9(0x248))[_0xec3e9(0x1c9)](_0x4bce36)[_0xec3e9(0x19a)](),config=_0x4bce36,restoredConfigFile=_0x4fbda3);}}async function restoreConfigNotify(_0xe7b24e){const _0x36dc9d=_0x21fe16;let _0x43699b;if(restoredConfigFile==0x1)_0x43699b='NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bot\x20is\x20disabled\x20by\x20default\x20-\x20enable\x20if\x20you\x20want\x20it\x20to\x20run';else _0x43699b=_0x36dc9d(0x279);if(_0xe7b24e)io['to'](_0x36dc9d(0x2ef))['emit'](_0x36dc9d(0x1ee),_0x43699b);else{logger[_0x36dc9d(0x10c)](_0x36dc9d(0x216)),logger[_0x36dc9d(0x10c)](_0x43699b),logger[_0x36dc9d(0x10c)](_0x36dc9d(0x216)),logger[_0x36dc9d(0x10c)]('');if(tgBot&&settings['telegramChatId']&&settings[_0x36dc9d(0x296)]!=_0x36dc9d(0x26d))await sendTelegram(settings[_0x36dc9d(0x22e)],'Bot\x20Mgr\x20>\x20'+_0x43699b);}}function validateCredentials(_0x34ca14,_0x2dc050){const _0x5cdd2d=_0x21fe16;if(_0x34ca14[_0x5cdd2d(0x146)]==settings[_0x5cdd2d(0x1a3)]&&bcrypt[_0x5cdd2d(0x152)](_0x34ca14[_0x5cdd2d(0x2a6)],settings[_0x5cdd2d(0x1fb)])){if(settings[_0x5cdd2d(0x2fa)])return{'allow':![],'reason':_0x5cdd2d(0x225),'token':null};else{const _0x405809=generateLoginToken(_0x2dc050);return{'allow':!![],'reason':'login\x20token\x20generated','token':_0x405809};}}else return{'allow':![],'reason':_0x5cdd2d(0x200),'token':null};}function refreshToken(_0x4ce0d5){const _0x4cde6e=generateLoginToken(_0x4ce0d5);return{'allow':!![],'reason':'login\x20token\x20generated','token':_0x4cde6e};}function validateAccess(_0x359786,_0x99500c,_0x16091b){const _0x2f23f6=_0x21fe16,_0x4d31d6=_0x16091b?_0x16091b:devices[_0x99500c]['ip'];let _0x3a12c8;const _0x32ab79=_0x17c2b1=>{const _0x1ebc27=_0x10d2;if(settings[_0x1ebc27(0x23a)]){if(settings[_0x1ebc27(0x2fa)]){if(telegram2FaApproved(_0x99500c)){const _0x7c79f7=generateLoginToken(_0x99500c);return{'allow':!![],'reason':'2FA\x20login\x20token\x20generated','token':_0x7c79f7};}else return{'allow':![],'reason':_0x1ebc27(0x270),'token':null};}else return _0x3a12c8=validToken(_0x17c2b1,_0x99500c),_0x3a12c8['hasOwnProperty'](_0x1ebc27(0x229))?{'allow':!![],'reason':_0x1ebc27(0x22f),'token':_0x17c2b1}:{'allow':![],'reason':_0x1ebc27(0x270),'token':null};}else return{'allow':!![],'reason':_0x1ebc27(0x2df),'token':null};};if(settings[_0x2f23f6(0x30c)]){let _0x2f4e39=[...settings[_0x2f23f6(0x181)],_0x2f23f6(0x195),_0x2f23f6(0x271),'127.0.0.1'];if(_0x2f4e39[_0x2f23f6(0x319)](_0x4d31d6))return _0x32ab79(_0x359786);else{_0x3a12c8=validToken(_0x359786,_0x99500c);if(_0x3a12c8[_0x2f23f6(0x253)](_0x2f23f6(0x229)))return _0x32ab79(_0x359786);else{if(telegramIpApproved(_0x99500c)){const _0x22559f=generateToken(_0x99500c);return _0x3a12c8=_0x32ab79(_0x359786),_0x3a12c8[_0x2f23f6(0x126)]?{'allow':!![],'reason':_0x2f23f6(0x1a8),'token':_0x22559f}:_0x3a12c8;}else return settings[_0x2f23f6(0x27f)]?{'allow':![],'reason':_0x2f23f6(0x124),'token':null}:{'allow':![],'reason':_0x2f23f6(0x22a),'token':null};}}}else return _0x32ab79(_0x359786);}function timelyDecrypt(_0x4dad79,_0x472322,_0x4cb904='@'){const _0xcfb3b6=_0x21fe16;if(_0x4dad79)try{const _0x33de6b=crypt[_0xcfb3b6(0x311)](secure[_0xcfb3b6(0x312)],_0x4dad79)[_0xcfb3b6(0x15c)],_0x252415=_0x33de6b[_0xcfb3b6(0x2bd)](_0x4cb904)[0x0],_0x110036=_0x33de6b['split'](_0x4cb904)[0x1],_0x17bdd9=new Date()['getTime']();if(_0x472322){if(_0x17bdd9-_0x110036<maxSecretAge*0x3e8)return _0x252415;else return![];}else return _0x252415;}catch(_0x47a10b){return![];}else return![];}const validToken=(_0x803032,_0x131cb8)=>{const _0x56e69f=_0x21fe16,_0x39e7d7=devices[_0x131cb8]['ip'];if(!_0x803032)return{'error':_0x56e69f(0x308)};for(let _0x27e80b of blacklist){if(_0x27e80b[_0x56e69f(0x170)]==_0x803032)return{'error':'Token\x20blacklisted'};}let _0x5ef785;try{_0x5ef785=jwt[_0x56e69f(0x1cd)](_0x803032,secure['secret']+_0x131cb8);}catch{return{'error':_0x56e69f(0x109)};}if(!_0x5ef785[_0x56e69f(0x253)](_0x56e69f(0x2cf))&&!_0x5ef785[_0x56e69f(0x253)]('username')||!_0x5ef785[_0x56e69f(0x253)](_0x56e69f(0x158)))return{'error':_0x56e69f(0x1ae)};if(!_0x5ef785[_0x56e69f(0x253)]('username')&&_0x5ef785['hasOwnProperty'](_0x56e69f(0x2cf))){const {clientip:_0x300f5d}=_0x5ef785;return _0x39e7d7==_0x300f5d?{'success':'User\x20has\x20been\x20validated'}:{'error':_0x56e69f(0x209)};}else{if(_0x5ef785['hasOwnProperty'](_0x56e69f(0x146))&&_0x5ef785[_0x56e69f(0x253)](_0x56e69f(0x2cf))){const {username:_0xc256e7,clientip:_0x4a458c}=_0x5ef785;return settings['bbUsername']==_0xc256e7&&_0x39e7d7==_0x4a458c?{'success':_0x56e69f(0x226)}:{'error':'Invalid\x20username\x20or\x20IP\x20address'};}}},generateLoginToken=_0x1b4a06=>{const _0x430dd5=_0x21fe16;if(_0x1b4a06){const _0x543255=devices[_0x1b4a06]['ip'];return jwt['sign']({'username':settings[_0x430dd5(0x1a3)],'clientip':_0x543255},secure[_0x430dd5(0x160)]+_0x1b4a06,{'expiresIn':tokenRefresh*0x3c,'allowInsecureKeySizes':!![]});}else return![];},generateToken=_0x166353=>{const _0x366440=_0x21fe16;if(_0x166353){const _0x2a8922=devices[_0x166353]['ip'];return jwt[_0x366440(0x1e8)]({'clientip':_0x2a8922},secure[_0x366440(0x160)]+_0x166353,{'expiresIn':devices[_0x166353][_0x366440(0x217)][_0x366440(0x15a)]*0x3c,'allowInsecureKeySizes':!![]});}else return![];},telegramIpApproved=_0x4594dc=>{const _0x94b34d=_0x21fe16;let _0x323428=![];return devices[_0x4594dc]['telegramIpApproval']&&devices[_0x4594dc][_0x94b34d(0x217)][_0x94b34d(0x15a)]!=_0x94b34d(0x150)&&(_0x323428=devices[_0x4594dc][_0x94b34d(0x217)][_0x94b34d(0x2cf)]==devices[_0x4594dc]['ip']&&new Date()[_0x94b34d(0x206)]()-devices[_0x4594dc]['telegramIpApproval'][_0x94b34d(0x272)]<devices[_0x4594dc][_0x94b34d(0x217)][_0x94b34d(0x15a)]*0x3c*0x3e8),_0x323428;},telegram2FaApproved=_0x2d0cae=>{const _0xa536fc=_0x21fe16;let _0x4ae6c8=![];return devices[_0x2d0cae]['telegram2FaApproval']&&devices[_0x2d0cae][_0xa536fc(0x10f)][_0xa536fc(0x15a)]!=_0xa536fc(0x150)&&(_0x4ae6c8=devices[_0x2d0cae]['telegram2FaApproval'][_0xa536fc(0x2cf)]==devices[_0x2d0cae]['ip']&&new Date()[_0xa536fc(0x206)]()-devices[_0x2d0cae][_0xa536fc(0x10f)]['timestamp']<devices[_0x2d0cae][_0xa536fc(0x10f)][_0xa536fc(0x15a)]*0x3c*0x3e8),_0x4ae6c8;},normalizeIP=_0x21dd34=>{const _0x41d150=_0x21fe16;let _0x16353b=null,_0x5607b1=null;if(ipaddr['isValid'](_0x21dd34)){const _0x586303=ipaddr['parse'](_0x21dd34);_0x586303[_0x41d150(0x1d2)]()===_0x41d150(0x10b)?(_0x586303[_0x41d150(0x1e7)]()&&(_0x16353b=_0x586303[_0x41d150(0x1fc)]()[_0x41d150(0x198)]()),_0x5607b1=_0x586303[_0x41d150(0x198)]()):(_0x16353b=_0x586303['toString'](),_0x5607b1=_0x586303[_0x41d150(0x1e4)]()[_0x41d150(0x198)]());}return{'show':_0x16353b?_0x16353b:_0x5607b1,'store':_0x5607b1};};function formatDate(_0x4214f3){const _0x350acc=_0x21fe16;return _0x4214f3[_0x350acc(0x2db)]()+'/'+(_0x4214f3['getMonth']()+0x1)[_0x350acc(0x198)]()[_0x350acc(0x18d)](0x2,'0')+'/'+_0x4214f3[_0x350acc(0x1fd)]()['toString']()[_0x350acc(0x18d)](0x2,'0')+'\x20'+_0x4214f3['getHours']()['toString']()[_0x350acc(0x18d)](0x2,'0')+':'+_0x4214f3[_0x350acc(0x1ab)]()[_0x350acc(0x198)]()[_0x350acc(0x18d)](0x2,'0')+':'+_0x4214f3[_0x350acc(0x211)]()[_0x350acc(0x198)]()[_0x350acc(0x18d)](0x2,'0');}function sleep(_0x432722){return new Promise(_0x300ea6=>setTimeout(_0x300ea6,_0x432722));}