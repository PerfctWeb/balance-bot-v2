const _0x413fdc=_0x4c53;(function(_0x55d1f0,_0xaa7319){const _0x259541=_0x4c53,_0x2ba8ca=_0x55d1f0();while(!![]){try{const _0x1b254e=parseInt(_0x259541(0x2c7))/0x1+-parseInt(_0x259541(0x2d3))/0x2+-parseInt(_0x259541(0x269))/0x3*(-parseInt(_0x259541(0x25c))/0x4)+parseInt(_0x259541(0x2a7))/0x5+-parseInt(_0x259541(0x2a9))/0x6*(-parseInt(_0x259541(0x240))/0x7)+parseInt(_0x259541(0x1df))/0x8+-parseInt(_0x259541(0x1af))/0x9;if(_0x1b254e===_0xaa7319)break;else _0x2ba8ca['push'](_0x2ba8ca['shift']());}catch(_0x2bbf6e){_0x2ba8ca['push'](_0x2ba8ca['shift']());}}}(_0xa3f4,0xd49b3));const _0x19cd42=function(){let _0x5c86a6=!![];return function(_0x13ebdd,_0x491964){const _0x45a6ef=_0x5c86a6?function(){const _0xe8e9ff=_0x4c53;if(_0x491964){const _0x3f86e0=_0x491964[_0xe8e9ff(0x11a)](_0x13ebdd,arguments);return _0x491964=null,_0x3f86e0;}}:function(){};return _0x5c86a6=![],_0x45a6ef;};}(),_0x58c83d=_0x19cd42(this,function(){const _0x18de6c=_0x4c53;return _0x58c83d[_0x18de6c(0x186)]()[_0x18de6c(0x26e)]('(((.+)+)+)+$')[_0x18de6c(0x186)]()[_0x18de6c(0x14e)](_0x58c83d)['search']('(((.+)+)+)+$');});_0x58c83d();'use strict';process[_0x413fdc(0x203)][_0x413fdc(0x2e1)]=0x1;const childProcess=require(_0x413fdc(0x1ad)),fs=require('fs'),fns=require(_0x413fdc(0x13c)),low=require(_0x413fdc(0x2e0)),FileSync=require(_0x413fdc(0x2c5)),path=require(_0x413fdc(0x1ce)),crypto=require(_0x413fdc(0x109)),Crypt=require(_0x413fdc(0x1c8))[_0x413fdc(0x2ba)],RSA=require('hybrid-crypto-js')[_0x413fdc(0x261)],bcrypt=require(_0x413fdc(0x185)),jwt=require(_0x413fdc(0x295)),ipaddr=require(_0x413fdc(0x239)),argv=require(_0x413fdc(0x133))(process[_0x413fdc(0x2fd)][_0x413fdc(0x303)](0x2))[_0x413fdc(0x2fd)],uuidRandom=require('uuid-random'),{Telegraf,Markup}=require(_0x413fdc(0x152)),Mixpanel=require('mixpanel'),axios=require(_0x413fdc(0x1f7)),{GraphQLClient,gql}=require(_0x413fdc(0x1c1)),util=require(_0x413fdc(0x16f)),fileUpload=require(_0x413fdc(0x268)),{networkInterfaces}=require('os'),PORT=argv['port']||_0x413fdc(0x1e7),pattern=/^[0-9]{2,4}$/;!pattern[_0x413fdc(0x142)](PORT)&&(console[_0x413fdc(0x1a2)](_0x413fdc(0x20a)+PORT+_0x413fdc(0x1f3)),process[_0x413fdc(0x252)](0x1));const HOST=argv[_0x413fdc(0x23e)]||null,userID=argv[_0x413fdc(0x151)]||'',debugging=argv['d']||![],nodeversion=process[_0x413fdc(0x259)][_0x413fdc(0x2ee)];let bbpath=_0x413fdc(0x13a),bbpath2='';const botfile=_0x413fdc(0x16b),configfile='bb-config.json',settingsfile=_0x413fdc(0x1ab),securefile=_0x413fdc(0x168),environment=require('./'+bbpath2+_0x413fdc(0x16a))[_0x413fdc(0x1ac)]||_0x413fdc(0x2f2),maxBackups=0xa;let validInstallation=!![];!fs[_0x413fdc(0x236)](bbpath+botfile)&&(bbpath='',validInstallation=![]);function _0xa3f4(){const _0x188473=['toggleBotMode','express-fileupload','141Caompp','privateKey','initclient','build2','inlineKeyboard','search','telegramChatId','-performance.json','getFullYear','SIGINT','api-eu.mixpanel.com','blacklist','Starting\x20new\x20bot\x20|\x20Bot\x20','/toggle\x20-\x20toggle\x20manual\x20vs\x20auto\x20mode\x0a','apiKey','new-disabled','Access\x20enabled\x20for\x20','logs','************','\x1b[0m','Bearer\x20eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImdjbXMtbWFpbi1wcm9kdWN0aW9uIn0.eyJ2ZXJzaW9uIjozLCJpYXQiOjE2MjE2NjgzMzgsImF1ZCI6WyJodHRwczovL2FwaS1ldS1jZW50cmFsLTEuZ3JhcGhjbXMuY29tL3YyL2Nrb3l0enYzbG90a3kwMXc1OWdsYWNlN3kvbWFzdGVyIiwiaHR0cHM6Ly9tYW5hZ2VtZW50LW5leHQuZ3JhcGhjbXMuY29tIl0sImlzcyI6Imh0dHBzOi8vbWFuYWdlbWVudC5ncmFwaGNtcy5jb20vIiwic3ViIjoiYjZlOTBmODAtZmEzYS00ODJmLWE0NTAtMTY3YTFmZTliNzIzIiwianRpIjoiY2tvemZnaWE0Mno4bTAxdzU5bHU5ZTA3NSJ9.cEJ5isSubzX1ymlpkfyvfgZ6zyUMFiFOVaD4N84NoEOxwGZ8DtYM1k4DlCjoeCcTR8Ftr43bIGDxR4apANAG_-wf9Nge9T2MAuKa9z2sCWA5jnYtTHYU-x1Hx_ShpHAl1wPjrSpTMquV3bRlKQBm6EQTreoaQZgBXY25ClLbVzXFcohcDn3RGi3hHVRvxNLr0F7ETwFJnbowm9UX66vz2SP-5-u-CBKUxSipKMO5za0MZiIWoprSdE0f22xVXp8up3k_6-5x22mS88P2OFgMXoA-UBFS8nz6jRE_fRULzCouKYyJG3oQ10ovuZ1M729GQ0rMv9fkJroVKyS4i8KgglwPPBwQbaD2LCJXINKXYC65DmKyJ9UjWxQ9Lv6akcnkT7CkeqEqzwLnCEQgZEmJS_PBFDu40LMS8UbnwDcntJznA8rH_jsD7IkMdyRyXmns6fbLOc91Q1idBCk-VqUzkL0FzfscCVpkg1J7kGtGeW4YEWhWyPze4ZO4IxM9WRoSsCDUOx3EXklA0WSdR2M6IRnoFL-qoawOLQaaPACy8-QGmaAL6N6fuMIHUWavOTYnyLip0oyy74sUHz4S4sx4mAf5pexlvDcxM_6RIRnCQ84THsM2KwpoWkpR-F2s4pIyfYYn-4R7MNENfPGxNm4INjBYrCOWyZN_vXHGBa4uw2U','<b>Telegram\x20Bot\x20Status:</b>\x0a','startsWith','login2fa_reject_','settings.','Unauthorized\x20attempt\x20to\x20delete\x20bot','login\x20token\x20generated','latestversion','pidExpireLogin','Starting\x20Balance\x20Bot\x20reinstallation','filter','resetHistory','index.html','Unauthorized\x20attempt\x20to\x20store\x20configuration','Node.js\x20v','update_yes','new','uuid','editMessageReplyMarkup','backup/','\x20(1)','/start','value','Yes','jsonwebtoken','Orders','https://api.ipify.org?format=json','#RES#\x20','sockets','telegram2FaApproval','staging','warning','ipv6','reinstall','help','find','config_orders','store-settings','accept','sendMetricsTelegram','bbPassword','Bot\x20','2695105HKisDM','Unauthorized\x20attempt\x20to\x20update\x20bot','199278bjPnvI','number','Which\x20bot\x20do\x20you\x20want\x20to\x20stop?','auto','update-bot','remoteAddress','randomBytes','0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@-#$','settings','Unauthorized\x20attempt\x20to\x20update\x20settings','temporary\x20access\x20not\x20allowed','logged\x20out','/help\x20-\x20show\x20available\x20commands\x0a','timestamp','restart_','error','\x20mode','Crypt','reply','deleteHistoryAlerts','max','showConfig','command','Telegram\x20error:','NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bots\x20are\x20disabled\x20by\x20default\x20-\x20enable\x20those\x20you\x20want\x20to\x20run','download','Unauthorized\x20attempt\x20to\x20get\x20events','Invalid\x20authentication\x20token\x20(1)','lowdb/adapters/FileSync','exchange','1617168MlwNmy','/disable\x20-\x20disable\x20notifications\x0a','allow','Alerts','Unauthorized\x20attempt\x20to\x20get\x20starting\x20balances','\x1b[33m','Logged\x20out\x20user\x20...','toggle_','IPv4','name','\x20|\x20','track','910858oxPVei','stopped','Invalid\x20IP\x20address','headers','logs/','storeConfiguration','removeAllListeners','writeFileSync','/upload-backup','success','params','\x1b[35m','restore-backup-file','lowdb','NTBA_FIX_319','login\x20token\x20valid','telegramEnabled','tempaccess_15_','Unauthorized\x20attempt\x20to\x20show\x20configuration','handshake','/:bot/history','::ffff:127.0.0.1','store-fiat','#RES#\x20if\x20running\x20locally\x0a','telegramIpApproval','telegrammsg','login\x20required','node','/status\x20-\x20show\x20bot(s)\x20status\x0a','botmanager','store','production','push','-events.json','reject','2FA\x20login\x20required','login\x20not\x20required','backup-full','bot-','getSeconds','The\x20maximum\x20of\x20999\x20bots\x20has\x20been\x20reached','bots','argv','2FA\x20required','botID','bbvReceive','***','isDirectory','slice','stop','split',')\x20\x20\x20|\x20Bot\x20','store-configuration','secret','crypto','decrypt','family','hasOwnProperty','secure','Stopping\x20Bot\x20Manager\x20and\x20starting\x20update\x20process','messages','Markdown','*$1*','\x20only\x0a','cloneDeep','\x20|\x20user:\x20...','show','restart','Network\x20Interfaces:','reason','Enabled\x20Bot\x20','apply','invalid\x20credentials','remove','Unauthorized\x20attempt\x20to\x20place\x20market\x20order','getStartingBalances','function','restore_yes_','-----------------------------------------------------------------------------------','Which\x20bot\x20do\x20you\x20want\x20to\x20restart?','No\x20authentication\x20token','running','delete-bot','bot','Ok,\x20will\x20send\x20alert\x20notifications\x20only','/update\x20-\x20update\x20Balance\x20Bot\x0a','Bot\x20Mgr\x20>\x20toggling\x20Bot\x20','assign','reinstall_no','add-bot','userid','Unauthorized\x20attempt\x20to\x20cancel\x20loading\x20coins','disable','length','30\x20min','=>\x20Go\x20to\x20#CYA#http://','yargs/yargs','No\x20bots\x20running\x20right\x20now','randomFillSync','Bot\x20Mgr\x20>\x20stopping\x20all\x20bots','exec','yes','server','bb/','2FA','date-fns','delete-alerts','manual','Unauthorized\x20attempt\x20to\x20reset\x20bot\x20history','get','generateKeyPairAsync','test','Ok,\x20will\x20send\x20both\x20order\x20and\x20alert\x20notifications','Unauthorized\x20attempt\x20to\x20get\x20messages','ipc','apiPassword','cancelLoading','Session\x20expired\x20for\x20user\x20...',':\x20Bot\x20Mgr\x20>\x20[DEBUG]\x20','\x20(2)','Failed\x20to\x20download\x20','Unauthorized\x20attempt\x20to\x20get\x20portfolio','Bot\x20Mgr\x20>\x20starting\x20Bot\x20','constructor','Error\x20removing\x20old\x20backup\x20files:','bbvNew','user','telegraf','1000','Login\x20accepted','resetpw_no','telegram','logout','/restart\x20-\x20restart\x20bot(s)\x0a','callback','internal','send','cancel-loading','version','verify','For\x20which\x20bot\x20do\x20you\x20want\x20the\x20metrics?','update_no','zip/','order','showname','config/','full','backup-files','getDate','bb-secure.json','access','version.json','bot.js','Notifications\x20disabled','get-logs','/:bot/portfolio','util','files','#RES#\x20if\x20running\x20on\x20server','defaults','Please\x20confirm\x20restoring\x20in\x20your\x20Telegram\x20bot','use','then','disconnect','launch','clientip','backup','connection','Unauthorized\x20attempt\x20to\x20update\x20Balance\x20Bot','storeFiat','show-config','address','Invalid\x20username\x20or\x20IP\x20address','action','lastmsgtelegram','lastmsgemitted','http','$1_$2_$3','bcryptjs','toString','headless','login','Token\x20blacklisted','placeOrder','Bot\x20Mgr\x20>\x20','/:bot/configuration','enable','access\x20timeout','portfolio_','readdirSync','SIGTERM','auth','Notifications\x20types:\x20orders\x20and\x20alerts\x0a','temp/','HTML','uncaughtException','toggle-bot-mode','restore_no_','RSA-OAEP','status','token','simple','once','started','isIPv4MappedAddress','User\x20has\x20been\x20validated','telegramToken','log','resetpw_yes','Are\x20you\x20sure\x20you\x20want\x20to\x20reinstall\x20Balance\x20Bot\x20now?','set','password','Server','config_all','Unauthorized\x20attempt\x20to\x20add\x20bot','kill','bb-settings.json','environment','child_process','temporary\x20token\x20generated','22598181bBrPXL','Ok,\x20reinstalling\x20Balance\x20Bot\x20canceled','off','on_','confirm-message','getHours','getUTCHours','copyFileSync','<b>Balance\x20Bot\x20Status:</b>\x0a','tempaccess_reject_','All','All\x20bots\x20running\x20right\x20now','get-messages','Disabled\x20Bot\x20','node-zip','getTime','update','mtime','graphql-request','connected','mkdirSync','config','write','Unauthorized\x20user\x20-\x20make\x20sure\x20you\x27ve\x20entered\x20your\x20<b>personal</b>\x20Telegram\x20username\x20in\x20the\x20Bot\x20Manager\x27s\x20settings','username','hybrid-crypto-js','output-003.log','::1','emitHistory','https://api-eu-central-1.graphcms.com/v2/ckoytzv3lotky01w59glace7y/master','Welcome\x20to\x20your\x20personal\x20Balance\x20Bot\x20Telegram\x20bot!\x0a','path','f2aRequired','Restore\x20backup\x20file\x20','sign','kind','button','botname','/reinstall\x20-\x20reinstall\x20Balance\x20Bot\x0a','0.0.0','\x1b[36m','keys','Invalid\x20authentication\x20token\x20(2)','Notifications\x20enabled','Unknown\x20client\x20attempting\x20to\x20retrieve\x20list\x20of\x20backup\x20files','updatebotmanager','output-000.log','forEach','6915880XpIvJN','/enable\x20-\x20enable\x20notifications\x0a','Restarting\x20Bot\x20','/off\x20-\x20stop\x20bot(s)\x0a','/:bot/coins','All\x20bots','add','telegramEvents','3000','reinstall_yes','bbUsername','padStart','telegramUsername','fork','get-backup-files','emit','reset-password','\x20to\x20','start','Backup\x20file\x20uploaded',',\x20must\x20be\x20a\x204\x20digit\x20number','>\x20Set\x20up\x20your\x20first\x20bot\x20in\x20the\x20Bot\x20Manager!','Starting\x20Balance\x20Bot\x20update','socket','axios','Ok,\x20consider\x20updating\x20Balance\x20Bot\x20later','sendMessage','parse','store-headless','statSync','Unauthorized\x20attempt\x20to\x20store\x20fiat\x20configuration','args','Bot\x20Mgr\x20>\x20stopping\x20Bot\x20','message','clients','alerts','env','-config.json','Deleted\x20Bot\x20','readFileSync','timeshift','/portfolio\x20-\x20show\x20bot\x20portfolio\x0a','private','Error:\x20Invalid\x20argument\x20','backup-full@','place-order','mode','getMonth','Restore\x20process\x20confirmed','title','expiry','\x1b[31m','sort','Unauthorized\x20attempt\x20to\x20upload\x20file\x20(1)','Unauthorized\x20attempt\x20to\x20retrieve\x20list\x20of\x20backup\x20files','from','orders','Restore\x20process\x20aborted','event','onepagemode','Do\x20you\x20want\x20to\x20reset\x20your\x20password?','Notifications\x20disabled\x0a','stringify','Temporary\x20access\x20rejected','-results.json','publicKey','build','output-001.log','sendFile','live','unlinkSync','portfolio','getMinutes','temporary\x20access\x20rejected','sendPortfolioTelegram','join','sortBy','post','Allow\x20temporary\x20access\x20from\x20IP\x20address\x20','Unauthorized\x20attempt\x20to\x20store\x20headless\x20configuration','chat','apiSecret','Starting\x20#RED#Balance\x20Bot\x20v','file',':\x20Bot\x20Mgr\x20>\x20Telegram\x20error\x20occured','static','output-002.log','existsSync','express','size','ipaddr.js','text',':\x20Bot\x20Mgr\x20>\x20','map','/metrics\x20-\x20show\x20bot\x20performance\x0a','host','Unauthorized\x20attempt\x20to\x20restore\x20backup\x20file','14kjmKKC','replace','Unauthorized\x20attempt\x20to\x20delete\x20alerts','Unauthorized\x20attempt\x20to\x20reinstall\x20Balance\x20Bot','binary','compareSync','disabled','names','\x20minutes','match','hex','rmSync','pidRefreshToken','Unauthorized\x20attempt\x20to\x20log\x20out','min','127.0.0.1','all','enabled','exit','debug','Unauthorized\x20attempt\x20to\x20download\x20','Password\x20reset\x20rejected','format','update-bb','15\x20min','versions','Of\x20which\x20events\x20do\x20you\x20want\x20to\x20be\x20notified?','catch','63836XGaRvw','/names\x20-\x20show\x20bot\x20names\x0a','type','(staging)','reload','RSA','.zip','tkn','any','DEFLATE','inherit'];_0xa3f4=function(){return _0x188473;};return _0xa3f4();}const {addClient,getAllClients,removeClient,getClient,getClientsWithBotID,getClientsWithUuid}=require('./'+bbpath2+_0x413fdc(0x201)),configpath=userID?bbpath+_0x413fdc(0x164)+userID+'/':bbpath+_0x413fdc(0x164),configbackuppath=configpath+_0x413fdc(0x290),logspath=userID?bbpath+_0x413fdc(0x2d7)+userID+'/':bbpath+'logs/',zippath=userID?bbpath+_0x413fdc(0x161)+userID+'/':bbpath+_0x413fdc(0x161),loggerfile=fs['createWriteStream'](logspath+'/output-000.log',{'flags':'a'}),temppath=userID?bbpath+_0x413fdc(0x194)+userID+'/':bbpath+_0x413fdc(0x194);!fs[_0x413fdc(0x236)](configpath)&&fs['mkdirSync'](configpath);!fs[_0x413fdc(0x236)](configbackuppath)&&fs[_0x413fdc(0x1c3)](configbackuppath);!fs[_0x413fdc(0x236)](logspath)&&fs[_0x413fdc(0x1c3)](logspath);!fs[_0x413fdc(0x236)](zippath)&&fs[_0x413fdc(0x1c3)](zippath);!fs[_0x413fdc(0x236)](temppath)&&fs['mkdirSync'](temppath);const adapter=new FileSync(configpath+configfile),dbConfig=low(adapter);dbConfig[_0x413fdc(0x172)]({'bots':[]})[_0x413fdc(0x1c5)]();const adapter2=new FileSync(configpath+settingsfile),dbSettings=low(adapter2);dbSettings[_0x413fdc(0x172)]({'settings':{'timeshift':0x0,'loginRequired':![],'bbUsername':'','bbPassword':'','f2aRequired':![],'lastmsgtelegram':0x0,'lastmsgemitted':0x0,'latestversion':_0x413fdc(0x1d6),'onepagemode':![]}})['write']();const adapter3=new FileSync(configpath+securefile),dbSecure=low(adapter3);dbSecure['defaults']({'secure':{},'blacklist':[]})[_0x413fdc(0x1c5)]();let crypt=new Crypt({'md':'sha256','rsaStandard':_0x413fdc(0x199)});const saltRounds=0xa,mixpanel=Mixpanel['init']('6b67f3d61ee94b8f5c80b4affef4c4d9',{'host':_0x413fdc(0x273)});let config=getConfiguration(),settings=getSettings(),secure=getSecure(),blacklist=getBlacklist(),tgBot;if(settings[_0x413fdc(0x1a1)]&&(settings[_0x413fdc(0x1a1)]!=''&&settings[_0x413fdc(0x1a1)]!=_0x413fdc(0x301))&&settings[_0x413fdc(0x1eb)]&&settings['telegramUsername']!='')initTelegram();const parseColor=(_0x140652,_0x370d91)=>{const _0x57bf3d=_0x413fdc,_0x25f084=/#[A-Z]{3}#/g;if(typeof _0x140652=='string'){!_0x370d91?_0x140652=_0x140652[_0x57bf3d(0x241)](_0x25f084,''):(_0x140652=_0x140652[_0x57bf3d(0x241)](/#BLU#/g,'\x1b[34m'),_0x140652=_0x140652['replace'](/#RED#/g,_0x57bf3d(0x212)),_0x140652=_0x140652[_0x57bf3d(0x241)](/#YEL#/g,_0x57bf3d(0x2cc)),_0x140652=_0x140652[_0x57bf3d(0x241)](/#MAG#/g,_0x57bf3d(0x2de)),_0x140652=_0x140652[_0x57bf3d(0x241)](/#CYA#/g,_0x57bf3d(0x1d7)),_0x140652=_0x140652['replace'](/#RES#/g,_0x57bf3d(0x27c)));;}return _0x140652;},logger={'screen':_0x47f531=>{const _0x4d6445=_0x413fdc;console[_0x4d6445(0x1a2)](parseColor(_0x47f531,!![]));},'simple':_0x1c3778=>{const _0xcf0fae=_0x413fdc;console[_0xcf0fae(0x1a2)](parseColor(_0x1c3778,!![])),loggerfile[_0xcf0fae(0x1c5)](util[_0xcf0fae(0x256)](parseColor(_0x1c3778,![]))+'\x0a');},'full':async _0x52e4b5=>{const _0x1aeb97=_0x413fdc,_0x274bd2=getTimeStamp()+_0x1aeb97(0x23b)+_0x52e4b5;console['log'](parseColor(_0x274bd2,!![])),loggerfile[_0x1aeb97(0x1c5)](util[_0x1aeb97(0x256)](parseColor(_0x274bd2,![]))+'\x0a');if(tgBot&&settings[_0x1aeb97(0x26f)]&&settings[_0x1aeb97(0x1e6)]!=_0x1aeb97(0x217))await sendTelegram(settings[_0x1aeb97(0x26f)],_0x1aeb97(0x18b)+parseColor(_0x52e4b5,![]));},'debug':async(_0x2e264d,_0x19fc73='')=>{const _0x2b683a=_0x413fdc,_0x273ef5=getTimeStamp()+_0x2b683a(0x149)+_0x2e264d;if(debugging)console[_0x2b683a(0x1a2)](parseColor(_0x273ef5,!![]));loggerfile['write'](util[_0x2b683a(0x256)](parseColor(_0x273ef5,![]))+'\x0a');if(_0x19fc73){if(debugging)console['log'](_0x19fc73);loggerfile[_0x2b683a(0x1c5)](util[_0x2b683a(0x256)](_0x19fc73)+'\x0a');}}};let terminating=![];process['on'](_0x413fdc(0x196),function(_0x2087f4){const _0x131f23=_0x413fdc;logger[_0x131f23(0x19c)](_0x2087f4);}),process['on']('exit',()=>{const _0x34ed17=_0x413fdc;stopAllBots(),process[_0x34ed17(0x252)](0x0);}),process['on']('SIGTERM',()=>{const _0x4b033b=_0x413fdc;stopAllBots(),process[_0x4b033b(0x252)](0x0);}),process['on'](_0x413fdc(0x272),()=>{const _0x29b6d9=_0x413fdc;stopAllBots(),process[_0x29b6d9(0x252)](0x0);});let restoredConfigFile=0x0,newBot=![],pid=[];const serverversion=require('./'+bbpath2+_0x413fdc(0x16a))[_0x413fdc(0x15d)],maxSecretAge=0xa,loginExpiry=0x4*0x3c,tokenRefresh=0x5;let tmpStorage={},devices=[],lastIpApproval,pidScheduler,installingUpdate=![],publicip,newMessages=[],updateAvailable=![];const express=require(_0x413fdc(0x237)),app=express(),http=require(_0x413fdc(0x183))['createServer'](app);app[_0x413fdc(0x174)](fileUpload({'useTempFiles':!![]})),app[_0x413fdc(0x140)]('/download/:type',async(_0x5c9b04,_0x6a1108)=>{const _0x163983=_0x413fdc,_0x5549d0=_0x5c9b04[_0x163983(0x2dd)]['type'],_0x5447e1=getClientsWithBotID(_0x163983(0x2f0)),_0x4e53bc=_0x5c9b04[_0x163983(0x2d6)]['uuid'],_0x5f2ec4=timelyDecrypt(_0x4e53bc,![]),_0x1d6c7c=_0x5447e1['find'](_0x14cab8=>_0x14cab8[_0x163983(0x28e)]==_0x5f2ec4);if(_0x1d6c7c){const _0x43c52e=normalizeIP(_0x5c9b04['socket']['remoteAddress'])[_0x163983(0x2f1)],_0x506e1d=_0x5c9b04[_0x163983(0x2d6)][_0x163983(0x263)];if(validateAccess(_0x506e1d,_0x5f2ec4,_0x43c52e)[_0x163983(0x2c9)])_0x5549d0==_0x163983(0x179)&&await backupConfigFiles(),await zipFiles(_0x5549d0),_0x6a1108[_0x163983(0x2c2)](zippath+(_0x5549d0+_0x163983(0x262)),_0x2dd242=>{const _0x2a2f64=_0x163983;_0x2dd242&&(logger[_0x2a2f64(0x165)](_0x2a2f64(0x14b)+_0x5549d0),logger['simple'](_0x2dd242));});else logger[_0x163983(0x165)](_0x163983(0x254)+_0x5549d0+_0x163983(0x291));}else logger[_0x163983(0x165)](_0x163983(0x254)+_0x5549d0+_0x163983(0x14a));}),app[_0x413fdc(0x22c)](_0x413fdc(0x2db),async(_0x123f7e,_0xf93c1c)=>{const _0x2358a5=_0x413fdc,_0x5e230e=getClientsWithBotID('botmanager'),_0x310fbf=_0x123f7e[_0x2358a5(0x2d6)][_0x2358a5(0x28e)],_0x3bad3f=timelyDecrypt(_0x310fbf,![]),_0x1fa181=_0x5e230e[_0x2358a5(0x2a0)](_0x483838=>_0x483838[_0x2358a5(0x28e)]==_0x3bad3f);logger[_0x2358a5(0x253)](_0x2358a5(0x1f2));if(_0x1fa181){const _0x24f07c=normalizeIP(_0x123f7e[_0x2358a5(0x1f6)]['remoteAddress'])[_0x2358a5(0x2f1)],_0x4dcfcd=_0x123f7e[_0x2358a5(0x2d6)][_0x2358a5(0x263)];if(validateAccess(_0x4dcfcd,_0x3bad3f,_0x24f07c)[_0x2358a5(0x2c9)]){if(_0x123f7e[_0x2358a5(0x170)]){const _0x302d31=_0x123f7e[_0x2358a5(0x170)]['backupfile'];await _0x302d31['mv'](temppath+_0x302d31[_0x2358a5(0x2d0)]),_0xf93c1c['send']({'status':!![],'message':'File\x20uploaded'});const _0x43c7e1=getBotsWithMode();_0x43c7e1['length']>0x0?confirmRestore(temppath,_0x302d31[_0x2358a5(0x2d0)]):unzipFile(temppath,_0x302d31[_0x2358a5(0x2d0)]);}}else logger[_0x2358a5(0x165)](_0x2358a5(0x214));}else logger['full']('Unauthorized\x20attempt\x20to\x20upload\x20file\x20(2)');}),app[_0x413fdc(0x174)](express[_0x413fdc(0x234)](path[_0x413fdc(0x22a)](__dirname,bbpath2,_0x413fdc(0x26c)))),app[_0x413fdc(0x174)](express['static'](path[_0x413fdc(0x22a)](__dirname,bbpath2,_0x413fdc(0x221)))),app[_0x413fdc(0x140)]('/',function(_0x20c667,_0x5792d0){const _0x177e8e=_0x413fdc;_0x5792d0[_0x177e8e(0x223)](path['join'](__dirname,bbpath2,_0x177e8e(0x26c),_0x177e8e(0x289)));}),app[_0x413fdc(0x140)]('/:bot',function(_0x5eb23a,_0x33baf2){const _0x547695=_0x413fdc;_0x33baf2[_0x547695(0x223)](path[_0x547695(0x22a)](__dirname,bbpath2,_0x547695(0x221),_0x547695(0x289)));}),app[_0x413fdc(0x140)](_0x413fdc(0x16e),(_0x1958e9,_0x4872bd)=>{const _0x39f3eb=_0x413fdc;_0x4872bd[_0x39f3eb(0x223)](path[_0x39f3eb(0x22a)](__dirname,bbpath2,'build',_0x39f3eb(0x289)));}),app[_0x413fdc(0x140)]('/:bot/performance',(_0x90c8ce,_0x3ca8b8)=>{const _0x47fe42=_0x413fdc;_0x3ca8b8[_0x47fe42(0x223)](path['join'](__dirname,bbpath2,_0x47fe42(0x221),_0x47fe42(0x289)));}),app[_0x413fdc(0x140)](_0x413fdc(0x1e3),(_0x1493d6,_0x56d22e)=>{const _0x2f10b2=_0x413fdc;_0x56d22e[_0x2f10b2(0x223)](path[_0x2f10b2(0x22a)](__dirname,bbpath2,_0x2f10b2(0x221),_0x2f10b2(0x289)));}),app[_0x413fdc(0x140)](_0x413fdc(0x2e7),(_0x570c80,_0x5c2877)=>{const _0x5d1445=_0x413fdc;_0x5c2877['sendFile'](path[_0x5d1445(0x22a)](__dirname,bbpath2,_0x5d1445(0x221),_0x5d1445(0x289)));}),app[_0x413fdc(0x140)](_0x413fdc(0x18c),(_0x3bbcd2,_0x5214d4)=>{const _0xcee2af=_0x413fdc;_0x5214d4['sendFile'](path[_0xcee2af(0x22a)](__dirname,bbpath2,_0xcee2af(0x221),_0xcee2af(0x289)));}),app[_0x413fdc(0x140)]('/:bot/support',(_0x2a1dba,_0x2c0f20)=>{const _0x3de9bb=_0x413fdc;_0x2c0f20[_0x3de9bb(0x223)](path['join'](__dirname,bbpath2,_0x3de9bb(0x221),'index.html'));});if(HOST)http['listen'](PORT,HOST);else http['listen'](PORT);const io=require('socket.io')(http,{});init();async function init(){await validateConfigFile(),await initUser(),await initSecure(),oneTimeMigration(),cleanBlacklist(),initStates(),await startServer();if(restoredConfigFile)restoreConfigNotify(![]);startSocket(),startScheduler(),triggerAnalytics(),getMessages(),reloadBotManager();}function getServerIP(){const _0x470639=_0x413fdc;let _0xfc6497='[ip-address]';const _0x490c6d=networkInterfaces(),_0x12ecfd={};for(const _0xde4310 of Object[_0x470639(0x1d8)](_0x490c6d)){for(const _0x200efb of _0x490c6d[_0xde4310]){if((_0x200efb[_0x470639(0x10b)]==_0x470639(0x2cf)||_0x200efb[_0x470639(0x10b)]==0x4)&&!_0x200efb[_0x470639(0x15a)]){const _0x23a9ae=ipaddr['parse'](_0x200efb[_0x470639(0x17e)])['range']();_0x23a9ae!=_0x470639(0x209)&&(!_0x12ecfd[_0xde4310]&&(_0x12ecfd[_0xde4310]=[]),_0x12ecfd[_0xde4310][_0x470639(0x2f3)](_0x200efb[_0x470639(0x17e)]),_0xfc6497=_0x200efb[_0x470639(0x17e)]);}}}return{'serverip':_0xfc6497,'netinterfaces':_0x12ecfd};}async function startServer(){const _0xd5a07b=_0x413fdc,{serverip:_0x5101d6,netinterfaces:_0x591941}=getServerIP();logger['simple'](''),logger[_0xd5a07b(0x19c)](_0xd5a07b(0x121)),await logger[_0xd5a07b(0x165)](_0xd5a07b(0x231)+serverversion+_0xd5a07b(0x298)+(environment==_0xd5a07b(0x29b)?_0xd5a07b(0x25f):'')+'\x0a'+('=>\x20Go\x20to\x20#CYA#http://127.0.0.1:'+PORT+_0xd5a07b(0x2ea))+(_0xd5a07b(0x132)+_0x5101d6+':'+PORT+_0xd5a07b(0x171))),logger[_0xd5a07b(0x19c)](_0xd5a07b(0x121));if(config[_0xd5a07b(0x130)]!=0x0)for(const _0x25f290 of config){const _0x291e11=_0x25f290[_0xd5a07b(0x20d)]=='auto'?'a':'m';if(_0x25f290['status']==_0xd5a07b(0x251)||_0x25f290[_0xd5a07b(0x19a)]==_0xd5a07b(0x28d))await logger[_0xd5a07b(0x165)]('Starting\x20('+_0x291e11+')\x20|\x20Bot\x20'+_0x25f290[_0xd5a07b(0x2ff)]+_0xd5a07b(0x2d1)+_0x25f290[_0xd5a07b(0x1d4)]),startBot([_0x25f290[_0xd5a07b(0x2ff)],userID],{'cwd':bbpath},function(_0x435cbe){const _0x175f47=_0xd5a07b;if(_0x435cbe)logger[_0x175f47(0x165)](_0x435cbe);});else(_0x25f290[_0xd5a07b(0x19a)]=='disabled'||_0x25f290[_0xd5a07b(0x19a)]==_0xd5a07b(0x278))&&await logger[_0xd5a07b(0x165)]('Idling\x20('+_0x291e11+_0xd5a07b(0x306)+_0x25f290[_0xd5a07b(0x2ff)]+_0xd5a07b(0x2d1)+_0x25f290[_0xd5a07b(0x1d4)]);}else!newBot&&logger[_0xd5a07b(0x19c)](_0xd5a07b(0x1f4));if(newBot)addBot();logger[_0xd5a07b(0x19c)](_0xd5a07b(0x121)),logger[_0xd5a07b(0x19c)](''),await logger['debug'](_0xd5a07b(0x28b)+nodeversion),await logger['debug'](_0xd5a07b(0x117),_0x591941);}function startSocket(){const _0x547724=_0x413fdc;io['on'](_0x547724(0x17a),_0x1c05fe=>{const _0x3b9263=_0x547724;let _0x351a75,_0x3d55c8,_0x526707,_0x5b5eda,_0x24374b;const _0x4bc241=_0x1c05fe[_0x3b9263(0x2e6)][_0x3b9263(0x2d6)]['referer'];_0x3d55c8=_0x4bc241[_0x3b9263(0x249)](/bot[0-9]{3}/);if(_0x3d55c8)_0x526707=_0x3d55c8[0x0]['match'](/[0-9]{3}/);if(_0x526707)_0x351a75=_0x526707[0x0];else _0x351a75=_0x3b9263(0x2f0);const _0x1b178e=_0x1c05fe[_0x3b9263(0x2e6)][_0x3b9263(0x192)]['encryptedUuid'];if(!_0x1b178e)_0x1c05fe['emit'](_0x3b9263(0x19a),{'publicKey':secure['publicKey']});else{_0x5b5eda=timelyDecrypt(_0x1b178e,![]);if(!_0x5b5eda)_0x1c05fe[_0x3b9263(0x1ee)](_0x3b9263(0x19a),{'publicKey':secure['publicKey']});else{_0x24374b=normalizeIP(_0x1c05fe['conn'][_0x3b9263(0x2ae)])['store'];if(!devices[_0x5b5eda])devices[_0x5b5eda]={'uuid':_0x5b5eda,'access':{'token':null}};devices[_0x5b5eda]['ip']=_0x24374b;const _0x21bf31=addClient(_0x1c05fe['id'],_0x5b5eda,_0x351a75);setAccess(_0x21bf31),emitMessages(),_0x1c05fe['on'](_0x3b9263(0x188),_0x4fd1cd=>{const _0x5cd162=_0x3b9263,_0x53b900=timelyDecrypt(_0x4fd1cd[_0x5cd162(0x1a6)]);if(_0x53b900){_0x4fd1cd={'username':_0x4fd1cd['username'],'password':_0x53b900},devices[_0x5b5eda]['access']=validateCredentials(_0x4fd1cd,_0x5b5eda);if(devices[_0x5b5eda][_0x5cd162(0x169)][_0x5cd162(0x2c9)]==![]&&devices[_0x5b5eda][_0x5cd162(0x169)][_0x5cd162(0x118)]==_0x5cd162(0x2f6))_0x1c05fe['emit'](_0x5cd162(0x19a),{'access':devices[_0x5b5eda][_0x5cd162(0x169)]}),loginAccess2FA(_0x5b5eda,_0x24374b);else{if(devices[_0x5b5eda][_0x5cd162(0x169)]['allow']==![]&&devices[_0x5b5eda][_0x5cd162(0x169)]['reason']==_0x5cd162(0x11b))_0x1c05fe[_0x5cd162(0x1ee)](_0x5cd162(0x19a),{'access':devices[_0x5b5eda][_0x5cd162(0x169)]});else devices[_0x5b5eda][_0x5cd162(0x169)][_0x5cd162(0x2c9)]&&devices[_0x5b5eda][_0x5cd162(0x169)][_0x5cd162(0x118)]==_0x5cd162(0x283)&&(getClientsWithUuid(_0x5b5eda)[_0x5cd162(0x1de)](_0x1b6526=>{setAccess(_0x1b6526);}),logger['debug']('Logged\x20in\x20user\x20...'+_0x5b5eda[_0x5cd162(0x303)](-0x8)),setTokenRefresh(_0x5b5eda),setSessionTimeout('login',_0x5b5eda));}}else logger['full']('Unauthorized\x20login\x20attempt\x20(timeout)');}),_0x1c05fe['on'](_0x3b9263(0x1ef),()=>{resetPassword();}),_0x1c05fe['on'](_0x3b9263(0x176),_0xe84daa=>{removeClient(_0x1c05fe['id']);}),_0x351a75==_0x3b9263(0x2f0)&&(restoredConfigFile&&(restoreConfigNotify(!![]),restoredConfigFile=0x0));}}});}function initClient(_0x4d7338){const _0x4208ea=_0x413fdc;if(_0x4d7338!=_0x4208ea(0x2f0)&&config[_0x4208ea(0x277)]!=''){if(pid[_0x4d7338])pid[_0x4d7338][_0x4208ea(0x15b)]({'function':_0x4208ea(0x26b),'args':null});}_0x4d7338!='botmanager'&&broadcastToBots(_0x4208ea(0x2fc),JSON[_0x4208ea(0x21d)](config));}function reloadBotManager(){const _0x221293=_0x413fdc;getClientsWithBotID(_0x221293(0x2f0))[_0x221293(0x1de)](_0xc24c58=>{getSocket(_0xc24c58['id'])['emit']('status',{'access':{'allow':![],'reason':'reload','token':null}});});}function getSocket(_0x5976af){const _0x5695e7=_0x413fdc;return io[_0x5695e7(0x299)][_0x5695e7(0x299)]['get'](_0x5976af);}function setAccess(_0x11ba05){const _0x39b4da=_0x413fdc,_0x1335e4=getSocket(_0x11ba05['id']),_0x3c9c37=_0x11ba05[_0x39b4da(0x28e)],_0x4695a2=_0x11ba05[_0x39b4da(0x126)];devices[_0x3c9c37]['access']=validateAccess(devices[_0x3c9c37][_0x39b4da(0x169)][_0x39b4da(0x19b)],_0x3c9c37),logger[_0x39b4da(0x253)]('Setting\x20access:\x20'+devices[_0x3c9c37][_0x39b4da(0x169)]['reason']+'\x20|\x20client:\x20...'+_0x11ba05['id']['slice'](-0x8)+_0x39b4da(0x114)+_0x3c9c37['slice'](-0x8)),_0x1335e4[_0x39b4da(0x22a)](_0x3c9c37);if(devices[_0x3c9c37][_0x39b4da(0x169)][_0x39b4da(0x2c9)]){_0x1335e4[_0x39b4da(0x22a)](_0x4695a2);if(_0x4695a2==_0x39b4da(0x2f0))initializeSocketBotManager(_0x1335e4);else initializeSocketBot(_0x1335e4);initClient(_0x4695a2);}devices[_0x3c9c37][_0x39b4da(0x169)][_0x39b4da(0x19b)]&&devices[_0x3c9c37][_0x39b4da(0x169)][_0x39b4da(0x118)]==_0x39b4da(0x1ae)&&setSessionTimeout(_0x39b4da(0x13b),_0x3c9c37),devices[_0x3c9c37][_0x39b4da(0x169)][_0x39b4da(0x19b)]&&devices[_0x3c9c37][_0x39b4da(0x169)][_0x39b4da(0x118)]=='2FA\x20login\x20token\x20generated'&&setSessionTimeout('login',_0x3c9c37),_0x1335e4[_0x39b4da(0x1ee)]('status',{'status':_0x11ba05[_0x39b4da(0x139)],'serverversion':serverversion,'environment':environment,'servertime':getServerTime(),'access':devices[_0x3c9c37][_0x39b4da(0x169)],'externalip':devices[_0x3c9c37]['ip'],'publicKey':secure[_0x39b4da(0x220)],'userid':settings['userid'],'validInstallation':validInstallation}),devices[_0x3c9c37][_0x39b4da(0x169)][_0x39b4da(0x2c9)]==![]&&devices[_0x3c9c37][_0x39b4da(0x169)][_0x39b4da(0x118)]==_0x39b4da(0x2fe)&&temporaryAccess2FA(_0x3c9c37,devices[_0x3c9c37]['ip']);}function setSessionTimeout(_0x37aaa5,_0x5f0b1f){const _0x2a112b=_0x413fdc;let _0x1dbde9;if(_0x37aaa5=='login')_0x1dbde9=loginExpiry*0x3c*0x3e8;else _0x1dbde9=devices[_0x5f0b1f][_0x2a112b(0x2eb)][_0x2a112b(0x211)]*0x3c*0x3e8-(new Date()[_0x2a112b(0x1be)]()-devices[_0x5f0b1f]['telegramIpApproval'][_0x2a112b(0x2b6)]);if(devices[_0x5f0b1f][_0x2a112b(0x285)])clearTimeout(devices[_0x5f0b1f][_0x2a112b(0x285)]);devices[_0x5f0b1f][_0x2a112b(0x285)]=setTimeout(()=>{const _0x2e5cfd=_0x2a112b;if(devices[_0x5f0b1f][_0x2e5cfd(0x24c)])clearTimeout(devices[_0x5f0b1f][_0x2e5cfd(0x24c)]);removeSocketListeners(_0x5f0b1f),addBlacklist(_0x5f0b1f),devices[_0x5f0b1f]['telegramIpApproval']=null,devices[_0x5f0b1f]['telegram2FaApproval']=null,devices[_0x5f0b1f][_0x2e5cfd(0x169)][_0x2e5cfd(0x19b)]=null,logger[_0x2e5cfd(0x253)](_0x2e5cfd(0x148)+_0x5f0b1f[_0x2e5cfd(0x303)](-0x8)),devices[_0x5f0b1f][_0x2e5cfd(0x169)]=validateAccess(devices[_0x5f0b1f][_0x2e5cfd(0x169)][_0x2e5cfd(0x19b)],_0x5f0b1f),!(devices[_0x5f0b1f][_0x2e5cfd(0x169)][_0x2e5cfd(0x2c9)]&&devices[_0x5f0b1f]['access'][_0x2e5cfd(0x118)]==_0x2e5cfd(0x2f7))&&(_0x37aaa5==_0x2e5cfd(0x188)?io['to'](_0x5f0b1f)[_0x2e5cfd(0x1ee)]('status',{'access':{'allow':![],'reason':_0x2e5cfd(0x18e),'token':null}}):io['to'](_0x5f0b1f)[_0x2e5cfd(0x1ee)](_0x2e5cfd(0x19a),{'access':{'allow':![],'reason':'temporary\x20access\x20timeout','token':null}})),devices[_0x5f0b1f][_0x2e5cfd(0x169)]['token']=null;},_0x1dbde9);}function setTokenRefresh(_0x765e3a){const _0x3d3c37=_0x413fdc;if(devices[_0x765e3a][_0x3d3c37(0x24c)])clearTimeout(devices[_0x765e3a][_0x3d3c37(0x24c)]);devices[_0x765e3a][_0x3d3c37(0x24c)]=setTimeout(()=>{const _0xf2069c=_0x3d3c37;getClientsWithUuid(_0x765e3a)['length']!=0x0?(devices[_0x765e3a]['access']=refreshToken(_0x765e3a),io['to'](_0x765e3a)[_0xf2069c(0x1ee)](_0xf2069c(0x19a),{'status':_0xf2069c(0x1c2),'serverversion':serverversion,'environment':environment,'servertime':getServerTime(),'access':devices[_0x765e3a][_0xf2069c(0x169)],'externalip':devices[_0x765e3a]['ip'],'publicKey':secure['publicKey'],'validInstallation':validInstallation}),setTokenRefresh(_0x765e3a)):clearTimeout(devices[_0x765e3a][_0xf2069c(0x24c)]);},(tokenRefresh-0x1)*0x3c*0x3e8);}function initializeSocketBotManager(_0xa3310c){const _0x5e6f9e=_0x413fdc,_0x5583a6=getClient(_0xa3310c['id'])[_0x5e6f9e(0x28e)];_0xa3310c[_0x5e6f9e(0x1ee)](_0x5e6f9e(0x2fc),config),_0xa3310c[_0x5e6f9e(0x1ee)](_0x5e6f9e(0x2b1),cleanSettings()),_0xa3310c['on'](_0x5e6f9e(0x12c),_0x25dccb=>{const _0x1b084b=_0x5e6f9e;if(validateAccess(_0x25dccb,_0x5583a6)['allow'])addBot();else logger[_0x1b084b(0x165)](_0x1b084b(0x1a9));}),_0xa3310c['on'](_0x5e6f9e(0x2ad),(_0x15a2d4,_0x17b329)=>{const _0x350f00=_0x5e6f9e;if(validateAccess(_0x17b329,_0x5583a6)[_0x350f00(0x2c9)])toggleBot(_0x15a2d4[_0x350f00(0x2ff)],_0x15a2d4[_0x350f00(0x19a)],_0x15a2d4[_0x350f00(0x224)]);else logger[_0x350f00(0x165)](_0x350f00(0x2a8));}),_0xa3310c['on'](_0x5e6f9e(0x197),(_0x236f57,_0x20a4e8)=>{const _0x5150bb=_0x5e6f9e;if(validateAccess(_0x20a4e8,_0x5583a6)['allow'])toggleBotMode(_0x236f57);else logger[_0x5150bb(0x165)](_0x5150bb(0x2a8));}),_0xa3310c['on'](_0x5e6f9e(0x125),(_0x12c156,_0x2313d3)=>{const _0x32474c=_0x5e6f9e;if(validateAccess(_0x2313d3,_0x5583a6)[_0x32474c(0x2c9)])deleteBot(_0x12c156);else logger[_0x32474c(0x165)](_0x32474c(0x282));}),_0xa3310c['on'](_0x5e6f9e(0x2a2),(_0x3c2b24,_0x13f8d6)=>{const _0x12dbd0=_0x5e6f9e;if(validateAccess(_0x13f8d6,_0x5583a6)['allow'])storeSettings(_0x3c2b24,!![]);else logger[_0x12dbd0(0x165)](_0x12dbd0(0x2b2));}),_0xa3310c['on'](_0x5e6f9e(0x257),_0x37b324=>{const _0x237b2b=_0x5e6f9e;if(validateAccess(_0x37b324,_0x5583a6)['allow'])updateBB(_0x237b2b(0x1bf));else logger[_0x237b2b(0x165)](_0x237b2b(0x17b));}),_0xa3310c['on']('reinstall-bb',_0x2b2885=>{const _0x37b646=_0x5e6f9e;if(validateAccess(_0x2b2885,_0x5583a6)[_0x37b646(0x2c9)])updateBB(_0x37b646(0x29e));else logger[_0x37b646(0x165)](_0x37b646(0x243));}),_0xa3310c['on'](_0x5e6f9e(0x1ed),_0x2dcf8a=>{const _0x56b0a7=_0x5e6f9e;if(validateAccess(_0x2dcf8a,_0x5583a6)[_0x56b0a7(0x2c9)]){const _0x3f5a05=getClient(_0xa3310c['id']);if(_0x3f5a05)getBackupFiles(_0x3f5a05[_0x56b0a7(0x28e)]);else logger[_0x56b0a7(0x165)](_0x56b0a7(0x1db));}else logger[_0x56b0a7(0x165)](_0x56b0a7(0x215));}),_0xa3310c['on'](_0x5e6f9e(0x2df),(_0x88f920,_0x5aa2d0)=>{const _0x3ddc80=_0x5e6f9e;if(validateAccess(_0x5aa2d0,_0x5583a6)[_0x3ddc80(0x2c9)])restoreBackupFile(_0x88f920);else logger[_0x3ddc80(0x165)](_0x3ddc80(0x23f));}),_0xa3310c['on'](_0x5e6f9e(0x1bb),_0x112d51=>{const _0x45b442=_0x5e6f9e;if(validateAccess(_0x112d51,_0x5583a6)[_0x45b442(0x2c9)])getMessages();else logger['full']('Unauthorized\x20attempt\x20to\x20get\x20messages');}),_0xa3310c['on'](_0x5e6f9e(0x1b3),(_0x74c408,_0x5b8d25)=>{const _0x61ea20=_0x5e6f9e;if(validateAccess(_0x5b8d25,_0x5583a6)[_0x61ea20(0x2c9)])confirmMessage(_0x74c408);else logger['full']('Unauthorized\x20attempt\x20to\x20confirm\x20message');}),_0xa3310c['on'](_0x5e6f9e(0x157),_0x23bc90=>{const _0x5b4942=_0x5e6f9e;if(validateAccess(_0x23bc90,_0x5583a6)[_0x5b4942(0x2c9)]){if(devices[_0x5583a6][_0x5b4942(0x24c)])clearTimeout(devices[_0x5583a6][_0x5b4942(0x24c)]);if(devices[_0x5583a6][_0x5b4942(0x285)])clearTimeout(devices[_0x5583a6][_0x5b4942(0x285)]);removeSocketListeners(getClient(_0xa3310c['id'])[_0x5b4942(0x28e)]),addBlacklist(_0x5583a6),devices[_0x5583a6][_0x5b4942(0x2eb)]=null,devices[_0x5583a6][_0x5b4942(0x29a)]=null,devices[_0x5583a6][_0x5b4942(0x169)]['token']=null,logger[_0x5b4942(0x253)](_0x5b4942(0x2cd)+_0x5583a6[_0x5b4942(0x303)](-0x8)),io['to'](getClient(_0xa3310c['id'])[_0x5b4942(0x28e)])[_0x5b4942(0x1ee)](_0x5b4942(0x19a),{'access':{'allow':![],'reason':_0x5b4942(0x2b4),'token':null}});}else logger['full'](_0x5b4942(0x24d));});}function initializeSocketBot(_0x3bde14){const _0x4c2ac9=_0x413fdc,_0x119017=getClient(_0x3bde14['id'])['bot'],_0x39db25=getClient(_0x3bde14['id'])[_0x4c2ac9(0x28e)];_0x3bde14['on'](_0x4c2ac9(0x16d),(_0x1ce44f,_0x54d6b9)=>{const _0x275ba0=_0x4c2ac9;if(validateAccess(_0x54d6b9,_0x39db25)[_0x275ba0(0x2c9)]){if(pid[_0x119017])pid[_0x119017][_0x275ba0(0x15b)]({'function':_0x275ba0(0x1cb),'args':_0x1ce44f});}else logger['full'](_0x275ba0(0x2c3));}),_0x3bde14['on'](_0x4c2ac9(0x13d),(_0xa7726e,_0x1b7bc7)=>{const _0x4f84a8=_0x4c2ac9;if(validateAccess(_0x1b7bc7,_0x39db25)['allow']){if(pid[_0x119017])pid[_0x119017][_0x4f84a8(0x15b)]({'function':_0x4f84a8(0x2bc),'args':_0xa7726e});}else logger[_0x4f84a8(0x165)](_0x4f84a8(0x242));}),_0x3bde14['on']('get-portfolio',(_0x324348,_0x593d17)=>{const _0x327c87=_0x4c2ac9;if(validateAccess(_0x593d17,_0x39db25)[_0x327c87(0x2c9)]){if(pid[_0x119017])pid[_0x119017][_0x327c87(0x15b)]({'function':'getPortfolio','args':_0x324348});}else logger[_0x327c87(0x165)](_0x327c87(0x14c));}),_0x3bde14['on'](_0x4c2ac9(0x307),(_0x39adc0,_0x4c8ad4)=>{const _0xbdc584=_0x4c2ac9;if(validateAccess(_0x4c8ad4,_0x39db25)[_0xbdc584(0x2c9)]){if(pid[_0x119017])pid[_0x119017]['send']({'function':_0xbdc584(0x2d8),'args':_0x39adc0});}else logger[_0xbdc584(0x165)](_0xbdc584(0x28a));}),_0x3bde14['on'](_0x4c2ac9(0x1fb),(_0x419b5f,_0x2d9bbc)=>{const _0x4c0340=_0x4c2ac9;if(validateAccess(_0x2d9bbc,_0x39db25)[_0x4c0340(0x2c9)]){if(pid[_0x119017])pid[_0x119017]['send']({'function':'storeHeadless','args':_0x419b5f});}else logger[_0x4c0340(0x165)](_0x4c0340(0x22e));}),_0x3bde14['on'](_0x4c2ac9(0x2e9),(_0x2548e5,_0x4b26c1)=>{const _0x445105=_0x4c2ac9;if(validateAccess(_0x4b26c1,_0x39db25)[_0x445105(0x2c9)]){if(pid[_0x119017])pid[_0x119017]['send']({'function':_0x445105(0x17c),'args':_0x2548e5});}else logger[_0x445105(0x165)](_0x445105(0x1fd));}),_0x3bde14['on']('reset-history',_0x2c0166=>{const _0x56633f=_0x4c2ac9;if(validateAccess(_0x2c0166,_0x39db25)[_0x56633f(0x2c9)]){if(pid[_0x119017])pid[_0x119017]['send']({'function':_0x56633f(0x288),'args':null});}else logger['full'](_0x56633f(0x13f));}),_0x3bde14['on']('get-starting-balances',_0x518c9a=>{const _0x268c32=_0x4c2ac9;if(validateAccess(_0x518c9a,_0x39db25)['allow']){if(pid[_0x119017])pid[_0x119017][_0x268c32(0x15b)]({'function':_0x268c32(0x11e),'args':null});}else logger[_0x268c32(0x165)](_0x268c32(0x2cb));}),_0x3bde14['on'](_0x4c2ac9(0x20c),(_0x30c111,_0x485bf4)=>{const _0x2e0b37=_0x4c2ac9;if(validateAccess(_0x485bf4,_0x39db25)['allow']){if(pid[_0x119017])pid[_0x119017][_0x2e0b37(0x15b)]({'function':_0x2e0b37(0x18a),'args':_0x30c111});}else logger['full'](_0x2e0b37(0x11d));}),_0x3bde14['on'](_0x4c2ac9(0x15c),_0x147d98=>{const _0x46645e=_0x4c2ac9;if(validateAccess(_0x147d98,_0x39db25)[_0x46645e(0x2c9)]){if(pid[_0x119017])pid[_0x119017][_0x46645e(0x15b)]({'function':_0x46645e(0x147),'args':null});}else logger[_0x46645e(0x165)](_0x46645e(0x12e));}),_0x3bde14['on'](_0x4c2ac9(0x17d),_0x53ec50=>{const _0x5719ec=_0x4c2ac9;if(validateAccess(_0x53ec50,_0x39db25)['allow']){if(pid[_0x119017])pid[_0x119017][_0x5719ec(0x15b)]({'function':_0x5719ec(0x2be),'args':null});}else logger['full'](_0x5719ec(0x2e5));}),_0x3bde14['on'](_0x4c2ac9(0x257),_0xa3d4e2=>{const _0x127031=_0x4c2ac9;if(validateAccess(_0xa3d4e2,_0x39db25)[_0x127031(0x2c9)])updateBB(_0x127031(0x1bf));else logger[_0x127031(0x165)](_0x127031(0x17b));}),_0x3bde14['on'](_0x4c2ac9(0x1bb),_0xee6bcb=>{const _0x165f78=_0x4c2ac9;if(validateAccess(_0xee6bcb,_0x39db25)[_0x165f78(0x2c9)])getMessages();else logger['full'](_0x165f78(0x144));}),_0x3bde14['on'](_0x4c2ac9(0x1b3),(_0x21ba21,_0x54fc04)=>{if(validateAccess(_0x54fc04,_0x39db25)['allow'])confirmMessage(_0x21ba21);else logger['full']('Unauthorized\x20attempt\x20to\x20confirm\x20message');}),_0x3bde14['on']('logout',_0x4da782=>{const _0x449a6b=_0x4c2ac9;if(validateAccess(_0x4da782,_0x39db25)[_0x449a6b(0x2c9)]){if(devices[_0x39db25][_0x449a6b(0x24c)])clearTimeout(devices[_0x39db25][_0x449a6b(0x24c)]);if(devices[_0x39db25][_0x449a6b(0x285)])clearTimeout(devices[_0x39db25]['pidExpireLogin']);removeSocketListeners(getClient(_0x3bde14['id'])['uuid']),addBlacklist(_0x39db25),devices[_0x39db25]['telegramIpApproval']=null,devices[_0x39db25][_0x449a6b(0x29a)]=null,devices[_0x39db25][_0x449a6b(0x169)][_0x449a6b(0x19b)]=null,logger[_0x449a6b(0x253)](_0x449a6b(0x2cd)+_0x39db25[_0x449a6b(0x303)](-0x8)),io['to'](getClient(_0x3bde14['id'])[_0x449a6b(0x28e)])[_0x449a6b(0x1ee)]('status',{'access':{'allow':![],'reason':_0x449a6b(0x2b4),'token':null}});}else logger[_0x449a6b(0x165)](_0x449a6b(0x24d));});}function removeSocketListeners(_0x13f766){const _0x162222=_0x413fdc;getClientsWithUuid(_0x13f766)[_0x162222(0x1de)](_0x2e86c2=>{const _0x155892=_0x162222;getSocket(_0x2e86c2['id'])[_0x155892(0x2d9)]();});}function cleanSettings(){const _0x959e51=_0x413fdc;let _0xc4d2cd=settings;return settings[_0x959e51(0x1a1)]&&settings['telegramToken']!=''&&(_0xc4d2cd={..._0xc4d2cd,'telegramToken':_0x959e51(0x27b)}),settings[_0x959e51(0x2a5)]&&settings[_0x959e51(0x2a5)]!=''&&(_0xc4d2cd={..._0xc4d2cd,'bbPassword':'************'}),(settings['bbPassword']&&settings[_0x959e51(0x2a5)]==_0x959e51(0x301)||settings['telegramToken']&&settings[_0x959e51(0x1a1)]=='***')&&(_0xc4d2cd={..._0xc4d2cd,'restored':{'password':settings[_0x959e51(0x2a5)]==_0x959e51(0x301),'telegram':settings[_0x959e51(0x1a1)]==_0x959e51(0x301)}}),_0xc4d2cd;}async function updateBB(_0x574820){const _0x50b9ff=_0x413fdc;await backupConfigFiles(),installingUpdate=!![],config['forEach'](_0x4bcf95=>{const _0xe3de6b=_0x4c53;restartBot(_0x4bcf95[_0xe3de6b(0x2ff)]);});if(_0x574820==_0x50b9ff(0x1bf))process['send']({'update':!![],'environment':environment},_0x16b468=>{});else _0x574820==_0x50b9ff(0x29e)&&process['send']({'reinstall':!![],'environment':environment},_0x5c1f4e=>{});}function startBot(_0x33ee7d,_0x4cfda1,_0x41b5c1){const _0x1235c3=_0x413fdc;if(debugging)_0x33ee7d[_0x1235c3(0x2f3)]('-d');let _0x3863a9=![];const _0x5c8787=_0x33ee7d[0x0];_0x4cfda1={..._0x4cfda1,'stdio':[_0x1235c3(0x266),_0x1235c3(0x266),'inherit',_0x1235c3(0x145)]},pid[_0x5c8787]=childProcess[_0x1235c3(0x1ec)](botfile,_0x33ee7d,_0x4cfda1),pid[_0x5c8787]['on'](_0x1235c3(0x200),_0x5a614a=>{const _0x5d2fe8=_0x1235c3;switch(Object[_0x5d2fe8(0x1d8)](_0x5a614a)[0x0]){case _0x5d2fe8(0x1d4):updateBotName(_0x5c8787,_0x5a614a[_0x5d2fe8(0x1d4)]);break;case _0x5d2fe8(0x1dc):updateBotManager();break;case'status':updateStatus(_0x5c8787,_0x5a614a['status']);break;case _0x5d2fe8(0x224):updateLive(_0x5c8787,_0x5a614a[_0x5d2fe8(0x224)]);break;case _0x5d2fe8(0x19e):updateLive(_0x5c8787,_0x5a614a['started']),io['to'](_0x5c8787)[_0x5d2fe8(0x1ee)](_0x5d2fe8(0x19a),{'access':{'allow':![],'reason':'reload','token':null}});break;case'stop':_0x5a614a[_0x5d2fe8(0x304)]==_0x5d2fe8(0x116)&&restartBot(_0x5c8787);_0x5a614a[_0x5d2fe8(0x304)]==_0x5d2fe8(0x1aa)&&toggleBot(_0x5c8787,'disabled',_0x5d2fe8(0x2d4));break;case _0x5d2fe8(0x156):sendTelegramBot(_0x5c8787,_0x5a614a[_0x5d2fe8(0x156)]);break;case _0x5d2fe8(0x2ec):sendTelegramMsg(_0x5a614a[_0x5d2fe8(0x2ec)]);break;case _0x5d2fe8(0x11f):io['to'](_0x5c8787)[_0x5d2fe8(0x1ee)](_0x5a614a[_0x5d2fe8(0x11f)],_0x5a614a[_0x5d2fe8(0x1fe)]);break;}}),pid[_0x5c8787]['on'](_0x1235c3(0x2b8),function(_0x137182){if(_0x3863a9)return;_0x3863a9=!![],_0x41b5c1(_0x137182);}),pid[_0x5c8787]['on']('exit',async function(_0x54ca68){const _0x4f5b44=_0x1235c3;if(terminating)return;if(installingUpdate){logger[_0x4f5b44(0x253)](_0x4f5b44(0x10e)),io['close']();return;}if(_0x3863a9)return;_0x3863a9=!![],_0x41b5c1(null);const _0x1c2a00=dbConfig[_0x4f5b44(0x140)](_0x4f5b44(0x2fc))[_0x4f5b44(0x2a0)]({'botID':_0x5c8787})[_0x4f5b44(0x293)]();_0x1c2a00&&(_0x1c2a00[_0x4f5b44(0x19a)]==_0x4f5b44(0x251)||_0x1c2a00[_0x4f5b44(0x19a)]==_0x4f5b44(0x28d))&&(await sleep(0x3e8),updateLive(_0x5c8787,'stopped'),logger[_0x4f5b44(0x165)](_0x4f5b44(0x1e1)+_0x5c8787),startBot([_0x5c8787,userID],{'cwd':bbpath},function(_0x1fc62a){const _0x186751=_0x4f5b44;if(_0x1fc62a)logger[_0x186751(0x165)](_0x1fc62a);}));});}function stopBot(_0x174f8f){const _0x2ca95a=_0x413fdc;getClientsWithBotID(_0x174f8f)[_0x2ca95a(0x1de)](_0x2e8432=>{const _0x428ab9=_0x2ca95a;getSocket(_0x2e8432['id'])[_0x428ab9(0x176)](!![]),removeClient(_0x2e8432['id']);}),pid[_0x174f8f]&&(pid[_0x174f8f]['kill'](),pid[_0x174f8f]=null);}function stopAllBots(){const _0x1d8b2d=_0x413fdc;terminating=!![];const _0x59b572=getEnabledBots();_0x59b572[_0x1d8b2d(0x1de)](_0x1c6dfe=>{stopBot(_0x1c6dfe['botID']);});}function restartBot(_0x3898fe){const _0x287e1e=_0x413fdc;if(pid[_0x3898fe])pid[_0x3898fe][_0x287e1e(0x1aa)]();}function addBot(){const _0x1b4a64=_0x413fdc;let _0x3e4870;for(let _0x166842=0x1;_0x166842<0x3e9;_0x166842++){_0x3e4870=_0x166842['toString']()[_0x1b4a64(0x1ea)](0x3,'0');let _0x1deac9=config[_0x1b4a64(0x2a0)](_0x3ebee8=>_0x3ebee8['botID']==_0x3e4870);if(!_0x1deac9)break;}if(_0x3e4870===_0x1b4a64(0x153)){logger[_0x1b4a64(0x165)](_0x1b4a64(0x2fb));return;}logger['full'](_0x1b4a64(0x275)+_0x3e4870),dbConfig[_0x1b4a64(0x140)](_0x1b4a64(0x2fc))['push']({'botID':_0x3e4870,'botname':_0x1b4a64(0x2a6)+_0x3e4870,'status':'new','live':''})[_0x1b4a64(0x1c5)](),startBot([_0x3e4870,userID],{'cwd':bbpath},function(_0x92abac){const _0x1fa57f=_0x1b4a64;if(_0x92abac)logger[_0x1fa57f(0x165)](_0x92abac);}),config=getConfiguration(),io['to'](_0x1b4a64(0x2f0))['emit'](_0x1b4a64(0x2fc),config),broadcastToBots(_0x1b4a64(0x2fc),JSON['stringify'](config));}function deleteBot(_0x4af75f){const _0x107f07=_0x413fdc;getClientsWithBotID(_0x4af75f)[_0x107f07(0x1de)](_0x6474f4=>{getSocket(_0x6474f4['id'])['disconnect'](!![]),removeClient(_0x6474f4['id']);}),dbConfig[_0x107f07(0x140)](_0x107f07(0x2fc))[_0x107f07(0x11c)]({'botID':_0x4af75f})['write'](),logger[_0x107f07(0x165)](_0x107f07(0x205)+_0x4af75f),stopBot(_0x4af75f);try{if(fs[_0x107f07(0x236)](path[_0x107f07(0x22a)](configpath,_0x107f07(0x2f9)+_0x4af75f+_0x107f07(0x204))))fs[_0x107f07(0x225)](path[_0x107f07(0x22a)](configpath,_0x107f07(0x2f9)+_0x4af75f+_0x107f07(0x204)));if(fs[_0x107f07(0x236)](path[_0x107f07(0x22a)](configpath,_0x107f07(0x2f9)+_0x4af75f+_0x107f07(0x2f4))))fs[_0x107f07(0x225)](path[_0x107f07(0x22a)](configpath,_0x107f07(0x2f9)+_0x4af75f+_0x107f07(0x2f4)));if(fs['existsSync'](path[_0x107f07(0x22a)](configpath,'bot-'+_0x4af75f+_0x107f07(0x270))))fs['unlinkSync'](path['join'](configpath,_0x107f07(0x2f9)+_0x4af75f+_0x107f07(0x270)));if(fs[_0x107f07(0x236)](path['join'](configpath,_0x107f07(0x2f9)+_0x4af75f+_0x107f07(0x21f))))fs[_0x107f07(0x225)](path['join'](configpath,_0x107f07(0x2f9)+_0x4af75f+'-results.json'));}catch(_0x8b5777){if(_0x8b5777)logger[_0x107f07(0x165)]('Error\x20while\x20deleting\x20config\x20files:\x20',_0x8b5777);}config=getConfiguration(),io['to'](_0x107f07(0x2f0))['emit'](_0x107f07(0x2fc),config),broadcastToBots(_0x107f07(0x2fc),JSON['stringify'](config));}function toggleBot(_0x1504d3,_0xc2c732,_0x2bce80){const _0x5950b9=_0x413fdc;dbConfig[_0x5950b9(0x140)](_0x5950b9(0x2fc))['find']({'botID':_0x1504d3})['assign']({'status':_0xc2c732})[_0x5950b9(0x12a)]({'live':_0x2bce80})['write']();if(_0xc2c732==_0x5950b9(0x251)||_0xc2c732==_0x5950b9(0x28d))logger[_0x5950b9(0x165)](_0x5950b9(0x119)+_0x1504d3),startBot([_0x1504d3,userID],{'cwd':bbpath},function(_0x40b5f2){const _0x1c610b=_0x5950b9;if(_0x40b5f2)logger[_0x1c610b(0x165)](_0x40b5f2);});else(_0xc2c732==_0x5950b9(0x246)||_0xc2c732==_0x5950b9(0x278))&&(logger['full'](_0x5950b9(0x1bc)+_0x1504d3),stopBot(_0x1504d3));config=getConfiguration(),io['to'](_0x5950b9(0x2f0))[_0x5950b9(0x1ee)](_0x5950b9(0x2fc),config),broadcastToBots('bots',JSON['stringify'](config));}function toggleStatus(_0x2e0011){const _0x339427=_0x413fdc;let _0x33179c=dbConfig[_0x339427(0x140)]('bots')['find']({'botID':_0x2e0011})[_0x339427(0x293)](),_0x283de1;if(_0x33179c[_0x339427(0x19a)]==='enabled')_0x283de1=_0x339427(0x246);else{if(_0x33179c['status']===_0x339427(0x28d))_0x283de1=_0x339427(0x278);else{if(_0x33179c[_0x339427(0x19a)]==='new-disabled')_0x283de1=_0x339427(0x28d);else{if(_0x33179c[_0x339427(0x19a)]===_0x339427(0x246))_0x283de1=_0x339427(0x251);}}}return _0x283de1;}function updateStatus(_0x393407,_0x35c201){const _0x2fe396=_0x413fdc;dbConfig[_0x2fe396(0x140)](_0x2fe396(0x2fc))['find']({'botID':_0x393407})[_0x2fe396(0x12a)]({'status':_0x35c201})[_0x2fe396(0x1c5)](),config=getConfiguration(),io['to']('botmanager')[_0x2fe396(0x1ee)](_0x2fe396(0x2fc),config),broadcastToBots(_0x2fe396(0x2fc),JSON[_0x2fe396(0x21d)](config));}function updateLive(_0x4c26a6,_0xfa4806){const _0x50d857=_0x413fdc;dbConfig[_0x50d857(0x140)]('bots')[_0x50d857(0x2a0)]({'botID':_0x4c26a6})[_0x50d857(0x12a)]({'live':_0xfa4806})[_0x50d857(0x1c5)](),config=getConfiguration(),io['to']('botmanager')[_0x50d857(0x1ee)](_0x50d857(0x2fc),config),broadcastToBots(_0x50d857(0x2fc),JSON['stringify'](config));}function updateBotName(_0x2ee3c4,_0x3025db){const _0x24a636=_0x413fdc;dbConfig[_0x24a636(0x140)]('bots')[_0x24a636(0x2a0)]({'botID':_0x2ee3c4})[_0x24a636(0x12a)]({'botname':_0x3025db})['write'](),config=getConfiguration(),io['to'](_0x24a636(0x2f0))[_0x24a636(0x1ee)](_0x24a636(0x2fc),config),broadcastToBots(_0x24a636(0x2fc),JSON[_0x24a636(0x21d)](config));}function updateBotManager(){const _0x44e04b=_0x413fdc;config=getConfiguration(),io['to'](_0x44e04b(0x2f0))[_0x44e04b(0x1ee)](_0x44e04b(0x2fc),config),broadcastToBots('bots',JSON[_0x44e04b(0x21d)](config));}function toggleBotMode(_0x50488e){const _0x30bca4=_0x413fdc;if(pid[_0x50488e])pid[_0x50488e][_0x30bca4(0x15b)]({'function':_0x30bca4(0x267),'args':null});else{const _0x1b42b7=configpath+_0x30bca4(0x2f9)+_0x50488e+_0x30bca4(0x204),_0x5c4b98=fs[_0x30bca4(0x206)](_0x1b42b7),_0x419019=JSON[_0x30bca4(0x1fa)](_0x5c4b98),_0x551384=_0x419019[_0x30bca4(0x126)][0x0][_0x30bca4(0x187)];_0x419019[_0x30bca4(0x126)][0x0]['headless']=!_0x551384;const _0x5bb133=JSON[_0x30bca4(0x21d)](_0x419019,null,0x2);fs[_0x30bca4(0x2da)](_0x1b42b7,_0x5bb133),config=getConfiguration(),io['to'](_0x30bca4(0x2f0))['emit'](_0x30bca4(0x2fc),config),broadcastToBots(_0x30bca4(0x2fc),JSON['stringify'](config));}}function validateTelegram(_0x21cecb){const _0x80c898=_0x413fdc;if(_0x21cecb['from']['username']!=settings[_0x80c898(0x1eb)]&&'@'+_0x21cecb[_0x80c898(0x216)]['username']!=settings['telegramUsername']||_0x21cecb[_0x80c898(0x22f)]['id']!=settings[_0x80c898(0x26f)])return sendTelegram(_0x21cecb['chat']['id'],_0x80c898(0x1c6),{'parse_mode':_0x80c898(0x195)}),![];return!![];}async function initTelegram(){const _0x39694f=_0x413fdc;if(tgBot)tgBot[_0x39694f(0x304)](),tgBot=null,initTelegram();else{tgBot=new Telegraf(settings[_0x39694f(0x1a1)]);let _0x2aafa9='You\x20can\x20use\x20the\x20following\x20commands:\x0a';_0x2aafa9+='\x0a',_0x2aafa9+=_0x39694f(0x1e0),_0x2aafa9+=_0x39694f(0x2c8),_0x2aafa9+='/config\x20-\x20notification\x20types\x20to\x20receive\x0a',_0x2aafa9+=_0x39694f(0x158),_0x2aafa9+='/on\x20-\x20start\x20bot(s)\x0a',_0x2aafa9+=_0x39694f(0x1e2),_0x2aafa9+=_0x39694f(0x276),_0x2aafa9+=_0x39694f(0x25d),_0x2aafa9+=_0x39694f(0x2ef),_0x2aafa9+=_0x39694f(0x23d),_0x2aafa9+=_0x39694f(0x208),_0x2aafa9+=_0x39694f(0x128),_0x2aafa9+=_0x39694f(0x1d5),_0x2aafa9+=_0x39694f(0x2b5);let _0x2806a5=_0x39694f(0x1cd);_0x2806a5+='\x0a',_0x2806a5+=_0x2aafa9,tgBot[_0x39694f(0x25b)]((_0x4afc85,_0x5558a0)=>{const _0x36cd71=_0x39694f;logger[_0x36cd71(0x19c)](getTimeStamp()+_0x36cd71(0x233)),logger[_0x36cd71(0x253)]('Telegraf\x20error:',_0x4afc85);}),tgBot[_0x39694f(0x174)](async(_0xb17f83,_0x17401d)=>{const _0x43299e=_0x39694f;if(!(!settings[_0x43299e(0x26f)]&&_0xb17f83[_0x43299e(0x1bf)][_0x43299e(0x200)][_0x43299e(0x23a)]==_0x43299e(0x292))){if(!validateTelegram(_0xb17f83))return;}_0x17401d();}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x1f1),async _0x2a4411=>{const _0x36a11a=_0x39694f;if(!settings[_0x36a11a(0x26f)])updateSetting('telegramChatId',_0x2a4411['chat']['id']);updateSetting(_0x36a11a(0x2e3),!![]);if(!validateTelegram(_0x2a4411))return;await sendTelegram(_0x2a4411[_0x36a11a(0x22f)]['id'],_0x2806a5);}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x18d),async _0x430d9b=>{const _0x2b9ace=_0x39694f;updateSetting('telegramEnabled',!![]),await sendTelegram(_0x430d9b['chat']['id'],_0x2b9ace(0x1da));}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x12f),async _0x547f2c=>{const _0xfad9bf=_0x39694f;await sendTelegram(_0x547f2c[_0xfad9bf(0x22f)]['id'],_0xfad9bf(0x16c)),updateSetting(_0xfad9bf(0x2e3),![]);}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x1c4),async _0x2795c6=>{const _0xc510e2=_0x39694f,_0x22a9aa=Markup[_0xc510e2(0x26d)]([Markup['button'][_0xc510e2(0x159)](_0xc510e2(0x296),_0xc510e2(0x2a1)),Markup[_0xc510e2(0x1d3)][_0xc510e2(0x159)](_0xc510e2(0x2ca),'config_alerts'),Markup[_0xc510e2(0x1d3)]['callback'](_0xc510e2(0x1b9),_0xc510e2(0x1a8))]);_0x2795c6['reply'](_0xc510e2(0x25a),_0x22a9aa);}),tgBot[_0x39694f(0x180)](_0x39694f(0x2a1),async _0x5b9654=>{const _0x22c34c=_0x39694f;_0x5b9654[_0x22c34c(0x28f)](),updateSetting(_0x22c34c(0x1e6),_0x22c34c(0x217)),updateSetting(_0x22c34c(0x2e3),!![]),await sendTelegram(_0x5b9654['chat']['id'],'Ok,\x20will\x20send\x20order\x20notifications\x20only');}),tgBot[_0x39694f(0x180)]('config_alerts',async _0x5e6f45=>{const _0x396d01=_0x39694f;_0x5e6f45[_0x396d01(0x28f)](),updateSetting('telegramEvents',_0x396d01(0x202)),updateSetting('telegramEnabled',!![]),await sendTelegram(_0x5e6f45['chat']['id'],_0x396d01(0x127));}),tgBot[_0x39694f(0x180)](_0x39694f(0x1a8),async _0x459a4d=>{const _0x2a73c6=_0x39694f;_0x459a4d[_0x2a73c6(0x28f)](),updateSetting('telegramEvents',_0x2a73c6(0x250)),updateSetting(_0x2a73c6(0x2e3),!![]),await sendTelegram(_0x459a4d[_0x2a73c6(0x22f)]['id'],_0x2a73c6(0x143));}),tgBot['command']('status',async _0x5b6481=>{const _0x405379=_0x39694f,_0x471e5b=getBotsWithMode();let _0x370b12=_0x405379(0x1b7);config[_0x405379(0x1de)](_0x18a1b9=>{const _0x1f49f7=_0x405379,_0x536fb6=_0x471e5b['find'](_0x1d0688=>_0x1d0688['botID']==_0x18a1b9[_0x1f49f7(0x2ff)])[_0x1f49f7(0x20d)];_0x370b12+=_0x1f49f7(0x2a6)+_0x18a1b9[_0x1f49f7(0x2ff)]+':\x20'+_0x18a1b9[_0x1f49f7(0x19a)]+_0x1f49f7(0x2d1)+_0x536fb6+_0x1f49f7(0x2d1)+_0x18a1b9['live']+'\x0a';}),_0x370b12+='\x0a',_0x370b12+=_0x405379(0x27e),_0x370b12+=!settings['telegramEnabled']?_0x405379(0x21c):'Notifications\x20enabled\x0a',_0x370b12+=settings[_0x405379(0x2e3)]?settings[_0x405379(0x1e6)]==_0x405379(0x250)?_0x405379(0x193):'Notifications\x20types:\x20'+settings[_0x405379(0x1e6)]+_0x405379(0x112):'',await sendTelegram(_0x5b6481[_0x405379(0x22f)]['id'],_0x370b12,{'parse_mode':_0x405379(0x195)});}),tgBot['command'](_0x39694f(0x116),async _0x2cce63=>{const _0x223e2a=_0x39694f,_0x4c3532=getEnabledBots();if(_0x4c3532[_0x223e2a(0x130)]==0x0)await sendTelegram(_0x2cce63[_0x223e2a(0x22f)]['id'],'No\x20bots\x20running\x20right\x20now');else{if(_0x4c3532[_0x223e2a(0x130)]>0x1)_0x4c3532[_0x223e2a(0x2f3)]({'botID':_0x223e2a(0x250)});let _0x4af470=[],_0x513aa0=[];const _0x42e731=_0x4c3532[_0x223e2a(0x130)]%0x4==0x0||_0x4c3532[_0x223e2a(0x130)]%0x4==0x3||_0x4c3532[_0x223e2a(0x130)]%0x3==0x1?0x4:0x3;let _0x42006c=0x0;_0x4c3532['forEach']((_0xbea180,_0x3f17bd)=>{const _0xd51d0=_0x223e2a;if(_0x3f17bd%_0x42e731==0x0)_0x513aa0=[];_0x513aa0[_0xd51d0(0x2f3)](Markup[_0xd51d0(0x1d3)][_0xd51d0(0x159)](_0xbea180[_0xd51d0(0x2ff)]==_0xd51d0(0x250)?'All\x20bots':_0xd51d0(0x2a6)+_0xbea180['botID'],_0xd51d0(0x2b7)+_0xbea180['botID'])),_0x3f17bd%_0x42e731==0x0&&(_0x4af470[_0x42006c]=_0x513aa0,_0x42006c++);});const _0x5964f4=Markup['inlineKeyboard'](_0x4af470);_0x2cce63[_0x223e2a(0x2bb)](_0x223e2a(0x122),_0x5964f4);}}),tgBot['action'](/restart_(.+)/,async _0x295940=>{const _0xf87f4c=_0x39694f,_0x6bde2=_0x295940[_0xf87f4c(0x249)][0x1];_0x295940[_0xf87f4c(0x28f)](),_0x6bde2=='all'?config[_0xf87f4c(0x1de)](_0x285b7a=>{const _0x2701fb=_0xf87f4c;restartBot(_0x285b7a[_0x2701fb(0x2ff)]);}):restartBot(_0x6bde2);}),tgBot[_0x39694f(0x2bf)]('on',async _0x1de7ae=>{const _0x48836f=_0x39694f,_0x340fa1=getDisabledBots();if(_0x340fa1[_0x48836f(0x130)]==0x0)await sendTelegram(_0x1de7ae[_0x48836f(0x22f)]['id'],_0x48836f(0x1ba));else{if(_0x340fa1[_0x48836f(0x130)]>0x1)_0x340fa1[_0x48836f(0x2f3)]({'botID':_0x48836f(0x250)});let _0x1c9a1c=[],_0x2fb0bb=[];const _0x6cec4a=_0x340fa1[_0x48836f(0x130)]%0x4==0x0||_0x340fa1[_0x48836f(0x130)]%0x4==0x3||_0x340fa1[_0x48836f(0x130)]%0x3==0x1?0x4:0x3;let _0x205fd5=0x0;_0x340fa1[_0x48836f(0x1de)]((_0x371b7b,_0x56679d)=>{const _0x3aff90=_0x48836f;if(_0x56679d%_0x6cec4a==0x0)_0x2fb0bb=[];_0x2fb0bb[_0x3aff90(0x2f3)](Markup['button'][_0x3aff90(0x159)](_0x371b7b[_0x3aff90(0x2ff)]==_0x3aff90(0x250)?_0x3aff90(0x1e4):_0x3aff90(0x2a6)+_0x371b7b['botID'],_0x3aff90(0x1b2)+_0x371b7b[_0x3aff90(0x2ff)])),_0x56679d%_0x6cec4a==0x0&&(_0x1c9a1c[_0x205fd5]=_0x2fb0bb,_0x205fd5++);});const _0x3e505b=Markup[_0x48836f(0x26d)](_0x1c9a1c);_0x1de7ae[_0x48836f(0x2bb)]('Which\x20bot\x20do\x20you\x20want\x20to\x20start?',_0x3e505b);}}),tgBot[_0x39694f(0x180)](/on_(.+)/,async _0x4214d7=>{const _0x1c0415=_0x39694f,_0x4f4309=_0x4214d7[_0x1c0415(0x249)][0x1];_0x4214d7[_0x1c0415(0x28f)]();if(_0x4f4309=='all'){const _0x53613d=getDisabledBots();await sendTelegram(_0x4214d7[_0x1c0415(0x22f)]['id'],'Bot\x20Mgr\x20>\x20starting\x20all\x20bots'),_0x53613d['forEach'](_0x22bf34=>{const _0x3565a9=_0x1c0415;if(_0x22bf34[_0x3565a9(0x2ff)]!='all')toggleBot(_0x22bf34[_0x3565a9(0x2ff)],toggleStatus(_0x22bf34[_0x3565a9(0x2ff)]),'stopped');});}else await sendTelegram(_0x4214d7['chat']['id'],_0x1c0415(0x14d)+_0x4f4309),toggleBot(_0x4f4309,toggleStatus(_0x4f4309),'stopped');}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x1b1),async _0x4ae2d7=>{const _0x1d2cb6=_0x39694f,_0x3ddb49=getEnabledBots();if(_0x3ddb49[_0x1d2cb6(0x130)]==0x0)await sendTelegram(_0x4ae2d7[_0x1d2cb6(0x22f)]['id'],'No\x20bots\x20running\x20right\x20now');else{if(_0x3ddb49['length']>0x1)_0x3ddb49[_0x1d2cb6(0x2f3)]({'botID':_0x1d2cb6(0x250)});let _0x9e7853=[],_0x36060a=[];const _0x4db733=_0x3ddb49[_0x1d2cb6(0x130)]%0x4==0x0||_0x3ddb49[_0x1d2cb6(0x130)]%0x4==0x3||_0x3ddb49[_0x1d2cb6(0x130)]%0x3==0x1?0x4:0x3;let _0x3c3898=0x0;_0x3ddb49[_0x1d2cb6(0x1de)]((_0x3144a4,_0xdb9fe1)=>{const _0x171a3c=_0x1d2cb6;if(_0xdb9fe1%_0x4db733==0x0)_0x36060a=[];_0x36060a[_0x171a3c(0x2f3)](Markup[_0x171a3c(0x1d3)]['callback'](_0x3144a4['botID']=='all'?_0x171a3c(0x1e4):'Bot\x20'+_0x3144a4[_0x171a3c(0x2ff)],'off_'+_0x3144a4[_0x171a3c(0x2ff)])),_0xdb9fe1%_0x4db733==0x0&&(_0x9e7853[_0x3c3898]=_0x36060a,_0x3c3898++);});const _0x648d12=Markup[_0x1d2cb6(0x26d)](_0x9e7853);_0x4ae2d7[_0x1d2cb6(0x2bb)](_0x1d2cb6(0x2ab),_0x648d12);}}),tgBot['action'](/off_(.+)/,async _0xed1443=>{const _0x2d7bef=_0x39694f,_0x23ee73=_0xed1443[_0x2d7bef(0x249)][0x1];_0xed1443['editMessageReplyMarkup']();if(_0x23ee73==_0x2d7bef(0x250)){const _0x2fae3=getEnabledBots();await sendTelegram(_0xed1443[_0x2d7bef(0x22f)]['id'],_0x2d7bef(0x136)),_0x2fae3[_0x2d7bef(0x1de)](_0x56f57e=>{const _0x4e089a=_0x2d7bef;if(_0x56f57e[_0x4e089a(0x2ff)]!='all')toggleBot(_0x56f57e[_0x4e089a(0x2ff)],toggleStatus(_0x56f57e[_0x4e089a(0x2ff)]),_0x4e089a(0x2d4));});}else await sendTelegram(_0xed1443['chat']['id'],_0x2d7bef(0x1ff)+_0x23ee73),toggleBot(_0x23ee73,toggleStatus(_0x23ee73),_0x2d7bef(0x2d4));}),tgBot[_0x39694f(0x2bf)]('metrics',async _0x1c67d4=>{const _0x51622f=_0x39694f,_0x1f00e6=getEnabledBots();if(_0x1f00e6[_0x51622f(0x130)]==0x0)await sendTelegram(_0x1c67d4[_0x51622f(0x22f)]['id'],_0x51622f(0x134));else{if(_0x1f00e6[_0x51622f(0x130)]>0x1){let _0x213340=[],_0x2e6d34=[];const _0x79f3a8=_0x1f00e6[_0x51622f(0x130)]%0x4==0x0||_0x1f00e6[_0x51622f(0x130)]%0x4==0x3||_0x1f00e6[_0x51622f(0x130)]%0x3==0x1?0x4:0x3;let _0x44dbbd=0x0;_0x1f00e6[_0x51622f(0x1de)]((_0x21dde6,_0x32fbfc)=>{const _0x47713d=_0x51622f;if(_0x32fbfc%_0x79f3a8==0x0)_0x2e6d34=[];_0x2e6d34[_0x47713d(0x2f3)](Markup[_0x47713d(0x1d3)][_0x47713d(0x159)](_0x47713d(0x2a6)+_0x21dde6['botID'],'metrics_'+_0x21dde6[_0x47713d(0x2ff)])),_0x32fbfc%_0x79f3a8==0x0&&(_0x213340[_0x44dbbd]=_0x2e6d34,_0x44dbbd++);});const _0x353441=Markup[_0x51622f(0x26d)](_0x213340);_0x1c67d4[_0x51622f(0x2bb)](_0x51622f(0x15f),_0x353441);}else{const _0x518452=_0x1f00e6[0x0][_0x51622f(0x2ff)];if(pid[_0x518452])pid[_0x518452]['send']({'function':_0x51622f(0x2a4),'args':null});}}}),tgBot[_0x39694f(0x180)](/metrics_(.+)/,async _0x17f47a=>{const _0x59801c=_0x39694f,_0x26199c=_0x17f47a[_0x59801c(0x249)][0x1];_0x17f47a[_0x59801c(0x28f)]();if(pid[_0x26199c])pid[_0x26199c][_0x59801c(0x15b)]({'function':_0x59801c(0x2a4),'args':null});}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x226),async _0x1cef4b=>{const _0x1283be=_0x39694f,_0x3a5160=getEnabledBots();if(_0x3a5160[_0x1283be(0x130)]==0x0)await sendTelegram(_0x1cef4b['chat']['id'],'No\x20bots\x20running\x20right\x20now');else{if(_0x3a5160['length']>0x1){let _0x4a0339=[],_0x57d89b=[];const _0x2d0716=_0x3a5160[_0x1283be(0x130)]%0x4==0x0||_0x3a5160[_0x1283be(0x130)]%0x4==0x3||_0x3a5160['length']%0x3==0x1?0x4:0x3;let _0x496704=0x0;_0x3a5160['forEach']((_0xd5eefb,_0x14796f)=>{const _0xa860ac=_0x1283be;if(_0x14796f%_0x2d0716==0x0)_0x57d89b=[];_0x57d89b[_0xa860ac(0x2f3)](Markup[_0xa860ac(0x1d3)]['callback']('Bot\x20'+_0xd5eefb[_0xa860ac(0x2ff)],_0xa860ac(0x18f)+_0xd5eefb[_0xa860ac(0x2ff)])),_0x14796f%_0x2d0716==0x0&&(_0x4a0339[_0x496704]=_0x57d89b,_0x496704++);});const _0x3ef7e9=Markup[_0x1283be(0x26d)](_0x4a0339);_0x1cef4b[_0x1283be(0x2bb)]('For\x20which\x20bot\x20do\x20you\x20want\x20the\x20portfolio?',_0x3ef7e9);}else{const _0x117e7b=_0x3a5160[0x0][_0x1283be(0x2ff)];if(pid[_0x117e7b])pid[_0x117e7b][_0x1283be(0x15b)]({'function':_0x1283be(0x229),'args':null});}}}),tgBot['action'](/portfolio_(.+)/,async _0xd411d9=>{const _0x886951=_0x39694f,_0x269048=_0xd411d9[_0x886951(0x249)][0x1];_0xd411d9['editMessageReplyMarkup']();if(pid[_0x269048])pid[_0x269048][_0x886951(0x15b)]({'function':_0x886951(0x229),'args':null});}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x1bf),async _0xcd1401=>{const _0x2eb5a6=_0x39694f;await getMessages();if(!updateAvailable)await sendTelegram(_0xcd1401['chat']['id'],'Your\x20installation\x20is\x20already\x20up\x20to\x20date');else{if(!validInstallation)await sendTelegram(_0xcd1401[_0x2eb5a6(0x22f)]['id'],'Your\x20installation\x20does\x20not\x20support\x20updating\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20update');else{const _0x2d3140=Markup[_0x2eb5a6(0x26d)]([Markup[_0x2eb5a6(0x1d3)]['callback'](_0x2eb5a6(0x294),_0x2eb5a6(0x28c)),Markup[_0x2eb5a6(0x1d3)][_0x2eb5a6(0x159)]('No',_0x2eb5a6(0x160))]);_0xcd1401['reply']('Are\x20you\x20sure\x20you\x20want\x20to\x20update\x20Balance\x20Bot\x20now?',_0x2d3140);}}}),tgBot['action'](/update_(.+)/,async _0x4f5e02=>{const _0x284afe=_0x39694f,_0x941653=_0x4f5e02[_0x284afe(0x249)][0x1];_0x4f5e02[_0x284afe(0x28f)](),_0x941653==_0x284afe(0x138)&&(await sendTelegram(_0x4f5e02['chat']['id'],_0x284afe(0x1f5)),updateBB(_0x284afe(0x1bf))),_0x941653=='no'&&await sendTelegram(_0x4f5e02[_0x284afe(0x22f)]['id'],_0x284afe(0x1f8));}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x29e),async _0xb68a5e=>{const _0x3b900=_0x39694f;if(!validInstallation)await sendTelegram(_0xb68a5e[_0x3b900(0x22f)]['id'],'Your\x20installation\x20does\x20not\x20support\x20reinstalling\x20from\x20Telegram.\x20Please\x20perform\x20a\x20manual\x20reinstallation');else{const _0x1996ec=Markup[_0x3b900(0x26d)]([Markup[_0x3b900(0x1d3)][_0x3b900(0x159)](_0x3b900(0x294),_0x3b900(0x1e8)),Markup[_0x3b900(0x1d3)]['callback']('No',_0x3b900(0x12b))]);_0xb68a5e[_0x3b900(0x2bb)](_0x3b900(0x1a4),_0x1996ec);}}),tgBot[_0x39694f(0x180)](/reinstall_(.+)/,async _0x1e51d4=>{const _0xc09e0d=_0x39694f,_0x9bf9ff=_0x1e51d4['match'][0x1];_0x1e51d4[_0xc09e0d(0x28f)](),_0x9bf9ff=='yes'&&(await sendTelegram(_0x1e51d4['chat']['id'],_0xc09e0d(0x286)),updateBB(_0xc09e0d(0x29e))),_0x9bf9ff=='no'&&await sendTelegram(_0x1e51d4[_0xc09e0d(0x22f)]['id'],_0xc09e0d(0x1b0));}),tgBot[_0x39694f(0x2bf)]('toggle',async _0x590394=>{const _0x184890=_0x39694f,_0x17cc84=getBotsWithMode();if(_0x17cc84[_0x184890(0x130)]==0x0)await sendTelegram(_0x590394[_0x184890(0x22f)]['id'],_0x184890(0x134));else{let _0x17c58e=[],_0x391b1a=[];const _0x617eaf=0x2;let _0x4a5280=0x0;_0x17cc84[_0x184890(0x1de)]((_0x102305,_0x357a6a)=>{const _0x383665=_0x184890;if(_0x357a6a%_0x617eaf==0x0)_0x391b1a=[];_0x391b1a[_0x383665(0x2f3)](Markup[_0x383665(0x1d3)][_0x383665(0x159)]('Bot\x20'+_0x102305[_0x383665(0x2ff)]+'\x20('+_0x102305[_0x383665(0x20d)]+')',_0x383665(0x2ce)+_0x102305[_0x383665(0x2ff)])),_0x357a6a%_0x617eaf==0x0&&(_0x17c58e[_0x4a5280]=_0x391b1a,_0x4a5280++);});const _0x4d8f1c=Markup[_0x184890(0x26d)](_0x17c58e);_0x590394[_0x184890(0x2bb)]('Which\x20bot\x20do\x20you\x20want\x20to\x20toggle?',_0x4d8f1c);}}),tgBot['action'](/toggle_(.+)/,async _0x20e68a=>{const _0x2c4a18=_0x39694f,_0x251af6=_0x20e68a[_0x2c4a18(0x249)][0x1];_0x20e68a['editMessageReplyMarkup']();const _0x159464=getBotsWithMode(),_0x58d069=_0x159464[_0x2c4a18(0x2a0)](_0x23f3d4=>_0x23f3d4[_0x2c4a18(0x2ff)]==_0x251af6),_0x504440=_0x58d069[_0x2c4a18(0x20d)]==_0x2c4a18(0x2ac)?'manual':_0x2c4a18(0x2ac);await sendTelegram(_0x20e68a['chat']['id'],_0x2c4a18(0x129)+_0x251af6+_0x2c4a18(0x1f0)+_0x504440+_0x2c4a18(0x2b9)),toggleBotMode(_0x251af6);}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x247),async _0x268377=>{const _0xf64472=_0x39694f;let _0x595801='';config['forEach'](_0x20cf49=>{const _0x40eb05=_0x4c53;_0x595801+='Bot\x20'+_0x20cf49['botID']+':\x20'+_0x20cf49[_0x40eb05(0x1d4)]+'\x0a';}),await sendTelegram(_0x268377[_0xf64472(0x22f)]['id'],_0x595801,{'parse_mode':_0xf64472(0x195)});}),tgBot[_0x39694f(0x2bf)](_0x39694f(0x29f),async _0x1ec01b=>{const _0xe6bb4b=_0x39694f;await sendTelegram(_0x1ec01b[_0xe6bb4b(0x22f)]['id'],_0x2aafa9);}),process[_0x39694f(0x19d)]('SIGINT',()=>tgBot[_0x39694f(0x304)](_0x39694f(0x272))),process[_0x39694f(0x19d)](_0x39694f(0x191),()=>tgBot[_0x39694f(0x304)]('SIGTERM')),tgBot[_0x39694f(0x177)]();}}function disableTelegram(){const _0x4548ce=_0x413fdc;tgBot&&tgBot[_0x4548ce(0x304)]();}async function sendTelegram(_0x181f6e,_0x5013f3,_0xe10ca9){const _0x51bbfa=_0x413fdc;_0xe10ca9={..._0xe10ca9,'disable_web_page_preview':!![]};try{await tgBot[_0x51bbfa(0x156)][_0x51bbfa(0x1f9)](_0x181f6e,_0x5013f3,_0xe10ca9);}catch(_0x259546){console[_0x51bbfa(0x1a2)](_0x51bbfa(0x2c0),_0x259546);}}async function sendTelegramBot(_0x2c384d,_0x184f4d){const _0x2a80b3=_0x413fdc;if(settings[_0x2a80b3(0x2e3)]){if(settings[_0x2a80b3(0x1e6)]==_0x2a80b3(0x250)||(_0x184f4d[_0x2a80b3(0x25e)]=='error'||_0x184f4d['type']==_0x2a80b3(0x29c)||_0x184f4d[_0x2a80b3(0x25e)]==_0x2a80b3(0x2dc))&&settings['telegramEvents']==_0x2a80b3(0x202)||_0x184f4d['type']==_0x2a80b3(0x162)&&settings[_0x2a80b3(0x1e6)]=='orders'){if(tgBot&&settings[_0x2a80b3(0x26f)]){if(_0x184f4d[_0x2a80b3(0x163)])await sendTelegram(settings[_0x2a80b3(0x26f)],_0x184f4d['botname']+'\x20>\x20'+_0x184f4d[_0x2a80b3(0x219)]);else await sendTelegram(settings[_0x2a80b3(0x26f)],_0x2a80b3(0x2a6)+_0x2c384d+'\x20>\x20'+_0x184f4d[_0x2a80b3(0x219)]);}}}}async function sendTelegramMsg(_0x2693c3,_0x2106a7='HTML'){const _0x388672=_0x413fdc;return settings[_0x388672(0x2e3)]&&tgBot&&settings[_0x388672(0x26f)]?(await sendTelegram(settings[_0x388672(0x26f)],_0x2693c3,{'parse_mode':_0x2106a7}),!![]):![];}function getDeviceWithIp(_0x1b8133){return devices['find'](_0x5950d3=>_0x5950d3['ip']===_0x1b8133);}async function temporaryAccess2FA(_0x20a429,_0x559a72){const _0x2ca30=_0x413fdc;let _0x2ad9c5=new Date(),_0x5c55d1=![];if(lastIpApproval){if(_0x2ad9c5-lastIpApproval<0x1388)_0x5c55d1=!![];}lastIpApproval=new Date();if(_0x5c55d1)return;if(tgBot&&settings[_0x2ca30(0x26f)]){const _0x558547=uuidRandom();tmpStorage[_0x558547]={'uuid':_0x20a429,'externalip':_0x559a72};const _0x560b17=Markup[_0x2ca30(0x26d)]([Markup[_0x2ca30(0x1d3)]['callback']('5\x20min','tempaccess_5_'+_0x558547),Markup[_0x2ca30(0x1d3)][_0x2ca30(0x159)](_0x2ca30(0x258),_0x2ca30(0x2e4)+_0x558547),Markup[_0x2ca30(0x1d3)][_0x2ca30(0x159)](_0x2ca30(0x131),'tempaccess_30_'+_0x558547),Markup[_0x2ca30(0x1d3)]['callback'](_0x2ca30(0x2f5),_0x2ca30(0x1b8)+_0x558547)]);await sendTelegram(settings['telegramChatId'],_0x2ca30(0x22d)+normalizeIP(_0x559a72)[_0x2ca30(0x115)]+'\x20?',_0x560b17),tgBot['action'](/tempaccess_(.+)_(.+)/,async _0x5921cf=>{const _0x3fe60a=_0x2ca30,_0x3356db=_0x5921cf[_0x3fe60a(0x249)][0x1],_0x5eb5a9=_0x5921cf[_0x3fe60a(0x249)][0x2],{uuid:_0x58195a,externalip:_0x9a9702}=tmpStorage[_0x5eb5a9];delete tmpStorage[_0x5eb5a9],_0x5921cf[_0x3fe60a(0x28f)](),devices[_0x58195a][_0x3fe60a(0x2eb)]={'clientip':_0x9a9702,'timestamp':new Date()[_0x3fe60a(0x1be)](),'expiry':_0x3356db},_0x3356db!=_0x3fe60a(0x2f5)?(await sendTelegram(_0x5921cf[_0x3fe60a(0x22f)]['id'],_0x3fe60a(0x279)+_0x3356db+_0x3fe60a(0x248),{'parse_mode':_0x3fe60a(0x195)}),io['to'](_0x58195a)[_0x3fe60a(0x1ee)](_0x3fe60a(0x19a),{'access':{'allow':![],'reason':_0x3fe60a(0x260),'token':null}})):(await sendTelegram(_0x5921cf[_0x3fe60a(0x22f)]['id'],_0x3fe60a(0x21e)),io['to'](_0x58195a)[_0x3fe60a(0x1ee)](_0x3fe60a(0x19a),{'access':{'allow':![],'reason':_0x3fe60a(0x228),'token':null}}));});}}async function loginAccess2FA(_0x2e2fb4,_0x410536){const _0x506a13=_0x413fdc;if(tgBot&&settings[_0x506a13(0x26f)]){const _0xe0becc=uuidRandom();tmpStorage[_0xe0becc]={'uuid':_0x2e2fb4,'externalip':_0x410536};const _0x2b2667=Markup[_0x506a13(0x26d)]([Markup[_0x506a13(0x1d3)]['callback'](_0x506a13(0x2a3),'login2fa_'+loginExpiry+'_'+_0xe0becc),Markup['button'][_0x506a13(0x159)](_0x506a13(0x2f5),_0x506a13(0x280)+_0xe0becc)]);await sendTelegram(settings['telegramChatId'],'Allow\x20login\x20from\x20IP\x20address\x20'+normalizeIP(_0x410536)['show']+'\x20?',_0x2b2667),tgBot[_0x506a13(0x180)](/login2fa_(.+)_(.+)/,async _0x278717=>{const _0x2b42cb=_0x506a13,_0x4181c3=_0x278717['match'][0x1],_0x48b5dd=_0x278717[_0x2b42cb(0x249)][0x2],{uuid:_0x3245d3,externalip:_0x7f9a7e}=tmpStorage[_0x48b5dd];delete tmpStorage[_0x48b5dd],_0x278717['editMessageReplyMarkup'](),devices[_0x3245d3][_0x2b42cb(0x29a)]={'clientip':_0x7f9a7e,'timestamp':new Date()[_0x2b42cb(0x1be)](),'expiry':_0x4181c3},_0x4181c3!=_0x2b42cb(0x2f5)?(await sendTelegram(_0x278717['chat']['id'],_0x2b42cb(0x154),{'parse_mode':'HTML'}),io['to'](_0x3245d3)[_0x2b42cb(0x1ee)](_0x2b42cb(0x19a),{'access':{'allow':![],'reason':'reload','token':null}})):(await sendTelegram(_0x278717[_0x2b42cb(0x22f)]['id'],'Login\x20rejected'),io['to'](_0x3245d3)[_0x2b42cb(0x1ee)]('status',{'access':{'allow':![],'reason':'2FA\x20login\x20rejected','token':null}}));});}}function getConfiguration(){return getBotsWithMode();}function getEnabledBots(){const _0x3a0fab=_0x413fdc;return dbConfig['get'](_0x3a0fab(0x2fc))[_0x3a0fab(0x22b)]('botID')[_0x3a0fab(0x287)]({'status':'enabled'})[_0x3a0fab(0x293)]()||[];}function getDisabledBots(){const _0x19b0d4=_0x413fdc;return dbConfig['get']('bots')['sortBy'](_0x19b0d4(0x2ff))[_0x19b0d4(0x287)]({'status':_0x19b0d4(0x246)})[_0x19b0d4(0x293)]()||[];}function getBotAttributes(_0x151272){const _0x2f84ea=_0x413fdc;let _0xa5686a={};const _0x544d53=configpath+_0x2f84ea(0x2f9)+_0x151272+'-config.json',_0x33b5b0=fs[_0x2f84ea(0x236)](_0x544d53);if(_0x33b5b0){const _0xc8d2bc=fs[_0x2f84ea(0x206)](_0x544d53);try{const _0x45411f=JSON['parse'](_0xc8d2bc),_0x2c78a0=_0x45411f?_0x45411f[_0x2f84ea(0x126)][0x0][_0x2f84ea(0x187)]:![];_0xa5686a['mode']=_0x2c78a0?_0x2f84ea(0x2ac):_0x2f84ea(0x13e),_0xa5686a[_0x2f84ea(0x1d4)]=_0x45411f?_0x45411f[_0x2f84ea(0x126)][0x0][_0x2f84ea(0x1d4)]:_0x2f84ea(0x2a6)+_0x151272;}catch(_0x95a9de){_0xa5686a[_0x2f84ea(0x20d)]=_0x2f84ea(0x13e),_0xa5686a[_0x2f84ea(0x1d4)]=_0x2f84ea(0x2a6)+_0x151272;}}else _0xa5686a['mode']='manual',_0xa5686a[_0x2f84ea(0x1d4)]=_0x2f84ea(0x2a6)+_0x151272;return _0xa5686a;}function getBotsWithMode(){const _0x1f2103=_0x413fdc,_0x2bdf51=dbConfig[_0x1f2103(0x140)](_0x1f2103(0x2fc))['sortBy'](_0x1f2103(0x2ff))[_0x1f2103(0x293)]()||[];return _0x2bdf51[_0x1f2103(0x1de)](_0x15111c=>{const _0x5ad15e=_0x1f2103;let _0x5bbecb=getBotAttributes(_0x15111c[_0x5ad15e(0x2ff)]);_0x15111c[_0x5ad15e(0x20d)]=_0x5bbecb[_0x5ad15e(0x20d)];}),_0x2bdf51;}function getBotExchanges(){const _0x108cd8=_0x413fdc;let _0x1ab261=[];const _0x598751=dbConfig[_0x108cd8(0x140)](_0x108cd8(0x2fc))['sortBy'](_0x108cd8(0x2ff))[_0x108cd8(0x293)]()||[];_0x598751[_0x108cd8(0x1de)](_0x362d70=>{const _0x1045ee=_0x108cd8;if(_0x362d70[_0x1045ee(0x19a)]==_0x1045ee(0x251)){const _0x39ad2b=configpath+_0x1045ee(0x2f9)+_0x362d70[_0x1045ee(0x2ff)]+_0x1045ee(0x204),_0xdb00d5=fs[_0x1045ee(0x236)](_0x39ad2b);let _0x3d110f;if(_0xdb00d5){const _0x35f9c0=fs[_0x1045ee(0x206)](_0x39ad2b);try{const _0x4942a6=JSON[_0x1045ee(0x1fa)](_0x35f9c0);_0x3d110f=_0x4942a6?_0x4942a6['bot'][0x0][_0x1045ee(0x2c6)]:null;}catch(_0x40141c){}}if(_0x3d110f)_0x1ab261['push'](_0x3d110f);}});const _0x4b8a75=[...new Set(_0x1ab261)][_0x108cd8(0x213)]();return _0x4b8a75;}async function initUser(){const _0x48b120=_0x413fdc;if(!settings['userid']){const _0xff4c02=uuidRandom();mixpanel['alias'](_0xff4c02),updateSetting(_0x48b120(0x12d),_0xff4c02);}}async function initSecure(){const _0x5568a9=_0x413fdc;let _0x23674a=getSecure();if(!_0x23674a[_0x5568a9(0x10c)](_0x5568a9(0x108))){let _0x3fe151=await generateKeys();_0x23674a['publicKey']=_0x3fe151['publicKey'],_0x23674a['privateKey']=_0x3fe151[_0x5568a9(0x26a)],_0x23674a['secret']=crypto[_0x5568a9(0x2af)](0x20)[_0x5568a9(0x186)](_0x5568a9(0x24a));;storeSecure(_0x23674a);}}function getSettings(){const _0x308d0d=_0x413fdc;return dbSettings[_0x308d0d(0x140)](_0x308d0d(0x2b1))[_0x308d0d(0x293)]()||{};}function getSecure(){const _0x5b9c95=_0x413fdc;return dbSecure['get'](_0x5b9c95(0x10d))[_0x5b9c95(0x293)]()||{};}function getBlacklist(){return dbSecure['get']('blacklist')['value']()||[];}function broadcastToBots(_0x159632,_0x113f31){const _0x1ecdc9=_0x413fdc;config[_0x1ecdc9(0x1de)](_0x3eaef1=>{const _0x2e35bd=_0x1ecdc9;if(_0x3eaef1['status']==_0x2e35bd(0x251)&&_0x3eaef1[_0x2e35bd(0x224)]==_0x2e35bd(0x124)||_0x3eaef1[_0x2e35bd(0x19a)]==_0x2e35bd(0x28d)&&_0x3eaef1[_0x2e35bd(0x224)]==_0x2e35bd(0x124)){if(pid[_0x3eaef1[_0x2e35bd(0x2ff)]])pid[_0x3eaef1[_0x2e35bd(0x2ff)]]['send']({[_0x159632]:_0x113f31});}});}function storeSettings(_0x4ba2df,_0x3df970=![]){const _0x5acc40=_0x413fdc;_0x4ba2df={...settings,..._0x4ba2df};if(_0x3df970&&_0x4ba2df[_0x5acc40(0x2a5)]!=_0x5acc40(0x27b)&&_0x4ba2df[_0x5acc40(0x2a5)]!=_0x5acc40(0x301)&&_0x4ba2df[_0x5acc40(0x2a5)]!=''){const _0x432323=crypt[_0x5acc40(0x10a)](secure[_0x5acc40(0x26a)],_0x4ba2df['bbPassword'])[_0x5acc40(0x200)]['split']('@')[0x0],_0x1e9d18=bcrypt['hashSync'](_0x432323,saltRounds);_0x4ba2df={..._0x4ba2df,'bbPassword':_0x1e9d18};}if(_0x3df970&&_0x4ba2df[_0x5acc40(0x1a1)]!=_0x5acc40(0x27b)&&_0x4ba2df[_0x5acc40(0x1a1)]!='***'&&_0x4ba2df[_0x5acc40(0x1a1)]!=''){const _0xfca018=crypt[_0x5acc40(0x10a)](secure[_0x5acc40(0x26a)],_0x4ba2df[_0x5acc40(0x1a1)])[_0x5acc40(0x200)][_0x5acc40(0x305)]('@')[0x0];_0x4ba2df={..._0x4ba2df,'telegramToken':_0xfca018};}const _0x2de272=_0x4ba2df[_0x5acc40(0x1a1)]!=_0x5acc40(0x27b)&&_0x4ba2df[_0x5acc40(0x1a1)]!=settings[_0x5acc40(0x1a1)]||_0x4ba2df[_0x5acc40(0x1eb)]!=settings[_0x5acc40(0x1eb)],_0x1e7a4e=_0x4ba2df[_0x5acc40(0x1a1)]==''||_0x4ba2df[_0x5acc40(0x1eb)]=='';_0x2de272&&(_0x4ba2df['telegramChatId']=null,_0x4ba2df[_0x5acc40(0x1e6)]=_0x5acc40(0x250));for(const [_0x29f73e,_0xd41a9b]of Object['entries'](_0x4ba2df)){if(_0x29f73e==_0x5acc40(0x1a1)&&_0xd41a9b==_0x5acc40(0x27b)){_0x4ba2df['telegramToken']=settings['telegramToken'];continue;};if(_0x29f73e==_0x5acc40(0x2a5)&&_0xd41a9b=='************'){_0x4ba2df[_0x5acc40(0x2a5)]=settings[_0x5acc40(0x2a5)];continue;};dbSettings['set'](_0x5acc40(0x281)+_0x29f73e,_0xd41a9b)[_0x5acc40(0x1c5)]();}settings=_0x4ba2df,io['to'](_0x5acc40(0x2f0))['emit'](_0x5acc40(0x2b1),cleanSettings()),broadcastToBots('timeshift',settings['timeshift']),broadcastToBots('onepagemode',settings[_0x5acc40(0x21a)]);if(_0x2de272&&!_0x1e7a4e)initTelegram();if(_0x2de272&&_0x1e7a4e)disableTelegram();getAllClients()[_0x5acc40(0x1de)](_0x2b9941=>{const _0x1378a3=_0x5acc40;getSocket(_0x2b9941['id'])[_0x1378a3(0x1ee)](_0x1378a3(0x19a),{'access':{'allow':![],'reason':_0x1378a3(0x260),'token':null}});});}function updateSetting(_0x4bcb87,_0x15b3ac){const _0x2e348e=_0x413fdc;dbSettings[_0x2e348e(0x1a5)]('settings.'+_0x4bcb87,_0x15b3ac)['write'](),settings=getSettings(),io['to']('botmanager')[_0x2e348e(0x1ee)](_0x2e348e(0x2b1),cleanSettings());}function storeSecure(_0x22c243){const _0x3262e2=_0x413fdc;dbSecure[_0x3262e2(0x140)](_0x3262e2(0x10d))['push'](_0x22c243)[_0x3262e2(0x1c5)](),secure=_0x22c243;}function addBlacklist(_0x4fff39){const _0x32a831=_0x413fdc;cleanBlacklist();let _0x5e96b8;devices[_0x4fff39][_0x32a831(0x2eb)]?_0x5e96b8=Math[_0x32a831(0x2bd)](devices[_0x4fff39]['telegramIpApproval']['expiry'],loginExpiry):_0x5e96b8=loginExpiry,dbSecure['get'](_0x32a831(0x274))[_0x32a831(0x2f3)]({'expiry':new Date()[_0x32a831(0x1be)]()+_0x5e96b8*0x3c*0x3e8,'token':devices[_0x4fff39][_0x32a831(0x169)][_0x32a831(0x19b)]})[_0x32a831(0x1c5)](),blacklist=dbSecure[_0x32a831(0x140)](_0x32a831(0x274))['value']();}function cleanBlacklist(){const _0x4629e3=_0x413fdc;let _0x4f6003=dbSecure[_0x4629e3(0x140)](_0x4629e3(0x274))[_0x4629e3(0x113)]()[_0x4629e3(0x293)](),_0x51f9a6=new Date()[_0x4629e3(0x1be)]();_0x4f6003[_0x4629e3(0x1de)](_0x3160c9=>{const _0x4130b5=_0x4629e3;_0x3160c9[_0x4130b5(0x211)]<_0x51f9a6&&dbSecure['get']('blacklist')[_0x4130b5(0x11c)]({'expiry':_0x3160c9[_0x4130b5(0x211)]})['write']();});}function initStates(){const _0x5e9403=_0x413fdc;let _0x1a2a7a=getConfiguration();_0x1a2a7a[_0x5e9403(0x1de)](_0x4a8c80=>{const _0x177e3e=_0x5e9403;_0x4a8c80[_0x177e3e(0x224)]=_0x177e3e(0x2d4);}),storeConfiguration(_0x1a2a7a);}function onKeys(){const _0x13db1f=new RSA();return new Promise(_0x5f8394=>{const _0x59c1e2=_0x4c53;_0x13db1f[_0x59c1e2(0x141)]()[_0x59c1e2(0x175)](_0x4351ae=>{_0x5f8394(_0x4351ae);});});}async function generateKeys(){return await onKeys();}async function oneTimeMigration(){const _0x15d16c=_0x413fdc;let _0x2ce83b=getSettings(),_0x183214=![];!_0x2ce83b[_0x15d16c(0x10c)](_0x15d16c(0x181))&&(_0x2ce83b[_0x15d16c(0x181)]=0x0,_0x183214=!![]);!_0x2ce83b[_0x15d16c(0x10c)]('lastmsgemitted')&&(_0x2ce83b[_0x15d16c(0x182)]=0x0,_0x183214=!![]);!_0x2ce83b[_0x15d16c(0x10c)]('latestversion')&&(_0x2ce83b[_0x15d16c(0x284)]='0.0.0',_0x183214=!![]);!_0x2ce83b['hasOwnProperty'](_0x15d16c(0x21a))&&(_0x2ce83b[_0x15d16c(0x21a)]=![],_0x183214=!![]);if(_0x183214)storeSettings(_0x2ce83b);try{fs[_0x15d16c(0x190)](configbackuppath,{'withFileTypes':!![]})['forEach'](_0x577040=>{const _0x1fcd45=_0x15d16c;if(!_0x577040[_0x1fcd45(0x302)]()){if(!_0x577040[_0x1fcd45(0x2d0)]['startsWith'](_0x1fcd45(0x20b)))fs['unlinkSync'](configbackuppath+_0x577040[_0x1fcd45(0x2d0)]);}else fs[_0x1fcd45(0x24b)](configbackuppath+_0x577040[_0x1fcd45(0x2d0)],{'recursive':!![]});});}catch(_0x3858dd){logger[_0x15d16c(0x253)](_0x15d16c(0x14f),_0x3858dd);}}function storeConfiguration(_0x5f3a24){const _0x3e0f8f=_0x413fdc;dbConfig[_0x3e0f8f(0x140)](_0x3e0f8f(0x2fc))[_0x3e0f8f(0x11c)]()['write'](),dbConfig['get'](_0x3e0f8f(0x2fc))[_0x3e0f8f(0x2f3)](..._0x5f3a24)[_0x3e0f8f(0x1c5)](),config=_0x5f3a24;}async function resetPassword(){const _0x459262=_0x413fdc;if(tgBot&&settings[_0x459262(0x26f)]){const _0x59bf41=Markup['inlineKeyboard']([Markup[_0x459262(0x1d3)][_0x459262(0x159)](_0x459262(0x138),_0x459262(0x1a3)),Markup[_0x459262(0x1d3)][_0x459262(0x159)]('no',_0x459262(0x155))]);await sendTelegram(settings[_0x459262(0x26f)],_0x459262(0x21b),_0x59bf41),tgBot[_0x459262(0x180)](/resetpw_(.+)/,async _0x18f8e6=>{const _0x25770a=_0x459262,_0x3e8213=_0x18f8e6[_0x25770a(0x249)][0x1];_0x18f8e6[_0x25770a(0x28f)]();if(_0x3e8213!='no'){const _0x1d4a2b=0xf,_0x32cfc5=_0x25770a(0x2b0),_0x2cfa05=Array[_0x25770a(0x216)](crypto[_0x25770a(0x135)](new Uint32Array(_0x1d4a2b)))[_0x25770a(0x23c)](_0x5e8cda=>_0x32cfc5[_0x5e8cda%_0x32cfc5[_0x25770a(0x130)]])[_0x25770a(0x22a)](''),_0x95f0fc=bcrypt['hashSync'](_0x2cfa05,saltRounds);storeSettings({'bbPassword':_0x95f0fc}),await sendTelegram(_0x18f8e6['chat']['id'],'Password\x20has\x20been\x20reset\x20to:\x20'+_0x2cfa05,{'parse_mode':_0x25770a(0x195)});}else await sendTelegram(_0x18f8e6['chat']['id'],_0x25770a(0x255));});}}async function confirmRestore(_0x44081c,_0x26e7c9){const _0x157a0c=_0x413fdc;io['to'](_0x157a0c(0x2f0))['emit']('notification',_0x157a0c(0x173),_0x157a0c(0x2dc));if(tgBot&&settings[_0x157a0c(0x26f)]){const _0x4e7a8d=uuidRandom();tmpStorage[_0x4e7a8d]={'path':_0x44081c,'filename':_0x26e7c9};const _0x3c83bf=Markup[_0x157a0c(0x26d)]([Markup[_0x157a0c(0x1d3)][_0x157a0c(0x159)](_0x157a0c(0x138),_0x157a0c(0x120)+_0x4e7a8d),Markup['button'][_0x157a0c(0x159)]('no',_0x157a0c(0x198)+_0x4e7a8d)]);await sendTelegram(settings[_0x157a0c(0x26f)],'Do\x20you\x20want\x20to\x20restore\x20your\x20installation?\x20NOTE:\x20this\x20will\x20replace\x20your\x20current\x20settings\x20and\x20bot(s)',_0x3c83bf),tgBot[_0x157a0c(0x180)](/restore_(.+)_(.+)/,async _0x45245a=>{const _0x4907c3=_0x157a0c,_0x28a58b=_0x45245a[_0x4907c3(0x249)][0x1],_0x46fc66=_0x45245a[_0x4907c3(0x249)][0x2],{path:_0x214853,filename:_0x3e8b0b}=tmpStorage[_0x46fc66];delete tmpStorage[_0x46fc66],_0x45245a[_0x4907c3(0x28f)](),_0x28a58b==_0x4907c3(0x138)?(logger[_0x4907c3(0x253)](_0x4907c3(0x20f)),await sendTelegram(_0x45245a[_0x4907c3(0x22f)]['id'],'Restoring\x20bot(s)\x20from\x20backup',{'parse_mode':_0x4907c3(0x195)}),unzipFile(_0x214853,_0x3e8b0b)):(logger[_0x4907c3(0x253)](_0x4907c3(0x218)),await sendTelegram(_0x45245a[_0x4907c3(0x22f)]['id'],_0x4907c3(0x218)));});}}function getServerTime(){const _0x1322c4=_0x413fdc,_0x3c1d2f=new Date();return _0x3c1d2f[_0x1322c4(0x271)]()+'/'+(_0x3c1d2f[_0x1322c4(0x20e)]()+0x1)[_0x1322c4(0x186)]()['padStart'](0x2,'0')+'/'+_0x3c1d2f[_0x1322c4(0x167)]()['toString']()[_0x1322c4(0x1ea)](0x2,'0')+'\x20'+_0x3c1d2f[_0x1322c4(0x1b4)]()[_0x1322c4(0x186)]()[_0x1322c4(0x1ea)](0x2,'0')+':'+_0x3c1d2f['getMinutes']()[_0x1322c4(0x186)]()['padStart'](0x2,'0')+':'+_0x3c1d2f[_0x1322c4(0x2fa)]()[_0x1322c4(0x186)]()[_0x1322c4(0x1ea)](0x2,'0');}function getTimeStamp(){const _0x1cc18e=_0x413fdc,_0x45c06b=shiftedTime();return _0x45c06b[_0x1cc18e(0x271)]()+'/'+(_0x45c06b[_0x1cc18e(0x20e)]()+0x1)[_0x1cc18e(0x186)]()['padStart'](0x2,'0')+'/'+_0x45c06b['getDate']()[_0x1cc18e(0x186)]()[_0x1cc18e(0x1ea)](0x2,'0')+'\x20'+_0x45c06b['getHours']()['toString']()[_0x1cc18e(0x1ea)](0x2,'0')+':'+_0x45c06b[_0x1cc18e(0x227)]()['toString']()[_0x1cc18e(0x1ea)](0x2,'0')+':'+_0x45c06b['getSeconds']()[_0x1cc18e(0x186)]()[_0x1cc18e(0x1ea)](0x2,'0');}function getCleanTimeStamp(){const _0xc843ab=_0x413fdc,_0x577c89=shiftedTime();return _0x577c89['getFullYear']()+(_0x577c89[_0xc843ab(0x20e)]()+0x1)[_0xc843ab(0x186)]()['padStart'](0x2,'0')+_0x577c89[_0xc843ab(0x167)]()[_0xc843ab(0x186)]()[_0xc843ab(0x1ea)](0x2,'0')+'-'+_0x577c89[_0xc843ab(0x1b4)]()['toString']()[_0xc843ab(0x1ea)](0x2,'0')+_0x577c89[_0xc843ab(0x227)]()[_0xc843ab(0x186)]()[_0xc843ab(0x1ea)](0x2,'0')+_0x577c89[_0xc843ab(0x2fa)]()[_0xc843ab(0x186)]()[_0xc843ab(0x1ea)](0x2,'0');}function shiftedTime(){const _0x277f9d=_0x413fdc,_0x511051=new Date();let _0x6d0a20=_0x511051;if(settings[_0x277f9d(0x207)]&&settings[_0x277f9d(0x207)]!==0x0)_0x6d0a20=fns[_0x277f9d(0x1e5)](_0x511051,{'hours':settings[_0x277f9d(0x207)]});return _0x6d0a20;}function startScheduler(){const _0xa085a2=_0x413fdc,_0x5920ef=new Date()[_0xa085a2(0x1b5)](),_0x3eb4e2=shiftedTime()['getHours']();_0x3eb4e2==0x4&&backupConfigFiles();_0x3eb4e2==0x0&&rotateLogFiles();_0x5920ef%0x6==0x0&&triggerAnalytics();_0x5920ef%0x6==0x0&&getMessages();if(pidScheduler)clearTimeout(pidScheduler);pidScheduler=setTimeout(()=>{startScheduler();},0x3c*0x3c*0x3e8);}async function restoreBackupFile(_0x277a09){const _0x1d63ae=_0x413fdc;logger['debug'](_0x1d63ae(0x1d0)+_0x277a09);const _0x2042de=getBotsWithMode();_0x2042de['length']>0x0?confirmRestore(configbackuppath,_0x277a09):unzipFile(configbackuppath,_0x277a09);}async function getBackupFiles(_0x415bfd=null){const _0x2cae94=_0x413fdc;let _0x12c65f=[],_0x3d576d=fs['readdirSync'](configbackuppath,{'withFileTypes':!![]});_0x3d576d[_0x2cae94(0x213)]((_0x5d4a61,_0x4438ac)=>_0x5d4a61['name']<_0x4438ac[_0x2cae94(0x2d0)]?0x1:_0x4438ac['name']<_0x5d4a61['name']?-0x1:0x0),_0x3d576d[_0x2cae94(0x1de)](_0xc0bfb2=>{const _0x599145=_0x2cae94;if(!_0xc0bfb2[_0x599145(0x302)]()&&_0xc0bfb2['name'][_0x599145(0x27f)](_0x599145(0x20b))&&_0xc0bfb2[_0x599145(0x2d0)]['endsWith'](_0x599145(0x262))){const _0x20e1ab=formatDate(fs[_0x599145(0x1fc)](configbackuppath+_0xc0bfb2[_0x599145(0x2d0)])[_0x599145(0x1c0)]);_0x12c65f[_0x599145(0x2f3)]({'name':_0xc0bfb2[_0x599145(0x2d0)],'mtime':_0x20e1ab});}});if(_0x415bfd)io['to'](_0x415bfd)[_0x2cae94(0x1ee)](_0x2cae94(0x166),_0x12c65f);else return _0x12c65f;}async function backupConfigFiles(){const _0x3bace6=_0x413fdc;await zipFiles(_0x3bace6(0x2f8));const _0x58f068=getCleanTimeStamp();fs[_0x3bace6(0x1b6)](zippath+'backup-full.zip',configbackuppath+(_0x3bace6(0x20b)+_0x58f068+_0x3bace6(0x262)));let _0x1d740d=fs[_0x3bace6(0x190)](configbackuppath,{'withFileTypes':!![]});_0x1d740d[_0x3bace6(0x213)]((_0x3f1d16,_0x4ca515)=>_0x3f1d16['name']<_0x4ca515[_0x3bace6(0x2d0)]?0x1:_0x4ca515[_0x3bace6(0x2d0)]<_0x3f1d16[_0x3bace6(0x2d0)]?-0x1:0x0),_0x1d740d[_0x3bace6(0x130)]>maxBackups&&fs[_0x3bace6(0x225)](configbackuppath+_0x1d740d[_0x1d740d['length']-0x1][_0x3bace6(0x2d0)]);}function rotateLogFiles(){const _0x3b8416=_0x413fdc,_0x1d9a99=fs[_0x3b8416(0x1fc)](logspath+_0x3b8416(0x1dd)),_0x1c1c91=_0x1d9a99[_0x3b8416(0x238)]/0x400;if(_0x1c1c91>0x64){let _0x544ea7=fs['readdirSync'](logspath,{'withFileTypes':!![]});_0x544ea7[_0x3b8416(0x213)]((_0x2e2930,_0x5cc371)=>_0x2e2930['name']<_0x5cc371[_0x3b8416(0x2d0)]?0x1:_0x5cc371[_0x3b8416(0x2d0)]<_0x2e2930[_0x3b8416(0x2d0)]?-0x1:0x0),_0x544ea7[_0x3b8416(0x1de)](_0x18e6c4=>{const _0x13f406=_0x3b8416;if(_0x18e6c4[_0x13f406(0x2d0)]==_0x13f406(0x235))fs[_0x13f406(0x1b6)](logspath+_0x18e6c4[_0x13f406(0x2d0)],logspath+_0x13f406(0x1c9));if(_0x18e6c4[_0x13f406(0x2d0)]==_0x13f406(0x222))fs[_0x13f406(0x1b6)](logspath+_0x18e6c4[_0x13f406(0x2d0)],logspath+_0x13f406(0x235));_0x18e6c4['name']==_0x13f406(0x1dd)&&(fs['copyFileSync'](logspath+_0x18e6c4[_0x13f406(0x2d0)],logspath+_0x13f406(0x222)),fs['writeFileSync'](logspath+_0x18e6c4[_0x13f406(0x2d0)],''));});}}async function zipFiles(_0x7afb47){const _0x5e2b4c=_0x413fdc;let _0x143d7d;if(_0x7afb47==_0x5e2b4c(0x27a))_0x143d7d=logspath;if(_0x7afb47=='backup')_0x143d7d=configpath;if(_0x7afb47==_0x5e2b4c(0x2f8))_0x143d7d=configpath;let _0x4b7722=fs['readdirSync'](_0x143d7d,{'withFileTypes':!![]});const _0x3b58e1=new require(_0x5e2b4c(0x1bd))();_0x4b7722[_0x5e2b4c(0x1de)](_0x508cb4=>{const _0x2b0a06=_0x5e2b4c;if(!_0x508cb4[_0x2b0a06(0x302)]()){let _0x5c3693=fs[_0x2b0a06(0x206)](_0x143d7d+_0x508cb4['name']);if(_0x7afb47==_0x2b0a06(0x179)){const _0x540843=/^bot-[0-9]{3}-config.json$/,_0xcac8d=_0x540843[_0x2b0a06(0x142)](_0x508cb4[_0x2b0a06(0x2d0)]);if(_0xcac8d){const _0x5754b2=JSON[_0x2b0a06(0x1fa)](_0x5c3693);if(_0x5754b2[_0x2b0a06(0x126)][0x0]){_0x5754b2['bot'][0x0][_0x2b0a06(0x277)]=_0x2b0a06(0x301),_0x5754b2[_0x2b0a06(0x126)][0x0][_0x2b0a06(0x230)]=_0x2b0a06(0x301);if(_0x5754b2['bot'][0x0][_0x2b0a06(0x146)])_0x5754b2[_0x2b0a06(0x126)][0x0][_0x2b0a06(0x146)]=_0x2b0a06(0x301);}_0x5c3693=JSON['stringify'](_0x5754b2,null,0x2);}if(_0x508cb4[_0x2b0a06(0x2d0)]==_0x2b0a06(0x1ab)){const _0x8e153d=JSON['parse'](_0x5c3693);if(_0x8e153d[_0x2b0a06(0x2b1)]['loginRequired'])_0x8e153d[_0x2b0a06(0x2b1)]['loginRequired']=![];if(_0x8e153d[_0x2b0a06(0x2b1)][_0x2b0a06(0x2a5)])_0x8e153d[_0x2b0a06(0x2b1)][_0x2b0a06(0x2a5)]='***';if(_0x8e153d[_0x2b0a06(0x2b1)][_0x2b0a06(0x1a1)])_0x8e153d[_0x2b0a06(0x2b1)][_0x2b0a06(0x1a1)]=_0x2b0a06(0x301);if(_0x8e153d[_0x2b0a06(0x2b1)]['telegramChatId'])_0x8e153d[_0x2b0a06(0x2b1)][_0x2b0a06(0x26f)]=null;_0x5c3693=JSON[_0x2b0a06(0x21d)](_0x8e153d,null,0x2);}if(_0x508cb4[_0x2b0a06(0x2d0)]!='bb-secure.json')_0x3b58e1[_0x2b0a06(0x232)](_0x508cb4['name'],_0x5c3693);}else _0x3b58e1[_0x2b0a06(0x232)](_0x508cb4[_0x2b0a06(0x2d0)],_0x5c3693);}});const _0x21002f=_0x3b58e1['generate']({'base64':![],'compression':_0x5e2b4c(0x265)});fs[_0x5e2b4c(0x2da)](zippath+(_0x7afb47+_0x5e2b4c(0x262)),_0x21002f,_0x5e2b4c(0x244));}async function unzipFile(_0x3df225,_0x24fea5){const _0x30cb17=_0x413fdc;fs[_0x30cb17(0x190)](configpath,{'withFileTypes':!![]})[_0x30cb17(0x1de)](_0x720ca1=>{if(!_0x720ca1['isDirectory']())fs['rmSync'](configpath+_0x720ca1['name']);});const _0x3b42c6=fs[_0x30cb17(0x206)](_0x3df225+_0x24fea5,_0x30cb17(0x244)),_0x573358=new require(_0x30cb17(0x1bd))(_0x3b42c6,{'base64':![],'checkCRC32':!![]});Object[_0x30cb17(0x1d8)](_0x573358[_0x30cb17(0x170)])[_0x30cb17(0x1de)](_0x3278ac=>{const _0x17e9d2=_0x30cb17,_0xba88c5=_0x573358[_0x17e9d2(0x170)][_0x3278ac];fs[_0x17e9d2(0x2da)](configpath+_0xba88c5[_0x17e9d2(0x2d0)],_0xba88c5['_data']);}),fs['readdirSync'](temppath,{'withFileTypes':!![]})['forEach'](_0x272118=>{const _0x589325=_0x30cb17;if(!_0x272118[_0x589325(0x302)]())fs[_0x589325(0x24b)](temppath+_0x272118[_0x589325(0x2d0)]);}),logger[_0x30cb17(0x253)]('Backup\x20file\x20unzipped\x20and\x20stored'),process[_0x30cb17(0x15b)]({'restore':!![]},_0x29f9a7=>{});}async function getPublicIp(){const _0xff28fc=_0x413fdc;try{const _0x53561a=await axios[_0xff28fc(0x140)](_0xff28fc(0x297));publicip=_0x53561a['data']['ip'];}catch(_0x463e68){}}async function triggerAnalytics(){const _0x1cbe81=_0x413fdc;if(!publicip)await getPublicIp();const _0x19786c=getBotsWithMode();let _0x4420c2=0x0;_0x19786c['forEach'](_0x587135=>{const _0x11b6b5=_0x4c53;if(_0x587135['status']===_0x11b6b5(0x251))_0x4420c2++;});const _0x33bdbe=getBotExchanges();mixpanel[_0x1cbe81(0x2d2)](_0x1cbe81(0x1a7),{'distinct_id':settings[_0x1cbe81(0x12d)],'ip':publicip,'version':serverversion,'numbots':_0x19786c['length'],'numbotsenabled':_0x4420c2,'exchanges':_0x33bdbe,'environment':environment});}function _0x4c53(_0x525be5,_0x7d9e7f){const _0x55c408=_0xa3f4();return _0x4c53=function(_0x58c83d,_0x19cd42){_0x58c83d=_0x58c83d-0x108;let _0xa3f49e=_0x55c408[_0x58c83d];return _0xa3f49e;},_0x4c53(_0x525be5,_0x7d9e7f);}async function getMessages(){const _0x3d0e15=_0x413fdc,_0x36c62c=_0x3d0e15(0x1cc),_0x4a98ad=new GraphQLClient(_0x36c62c),_0x12689c={'authorization':_0x3d0e15(0x27d)},_0x185f53=serverversion[_0x3d0e15(0x305)]('.'),_0x29c801=_0x185f53[0x0]+'.'+_0x185f53[0x1],_0xd21ebc=Math[_0x3d0e15(0x24e)](settings[_0x3d0e15(0x181)],settings[_0x3d0e15(0x182)]),_0x38de86={'last':parseInt(_0xd21ebc),'bbm':_0x29c801},_0x29db48=gql`
            query getMessages($bbm: String!, $last: Int!) {
                messages(where: {
                    number_gt: $last
                    OR: [
                    {bbvReceive: "any"},
                    {bbvReceive_contains: $bbm}
                    ]
                    archived_not: true
                }, orderBy: number_ASC) {
                    id
                    number
                    bbvReceive
                    bbvNew
                    title
                    message
                    dialogWidth
                    lock
                }
            }
            `;let _0x1b813d;try{_0x1b813d=await _0x4a98ad['request'](_0x29db48,_0x38de86,_0x12689c);}catch(_0x3cbe1f){}if(_0x1b813d&&_0x1b813d[_0x3d0e15(0x10f)]){let _0x447eea=settings[_0x3d0e15(0x181)];newMessages=[];for(const _0x336667 of _0x1b813d[_0x3d0e15(0x10f)]){newMessages[_0x3d0e15(0x2f3)](_0x336667);let _0x48c0bc=![];_0x336667[_0x3d0e15(0x150)]&&(updateSetting('latestversion',_0x336667['bbvNew']),_0x48c0bc=isNewerVersion(serverversion,_0x336667[_0x3d0e15(0x150)])||serverversion==_0x336667['bbvNew']);if(!_0x48c0bc&&_0x336667[_0x3d0e15(0x2aa)]>_0x447eea){if(_0x336667['bbvReceive']===_0x3d0e15(0x264)||serverversion['startsWith'](_0x336667[_0x3d0e15(0x300)])){let _0xa8c55c=''+_0x336667[_0x3d0e15(0x210)]+'\x0a\x0a'+_0x336667['message'];const _0x232d6a=await sendTelegramMsg(toTelegramMarkdown(_0xa8c55c),_0x3d0e15(0x110));if(_0x232d6a)_0x447eea=_0x336667[_0x3d0e15(0x2aa)];}}}updateAvailable=isNewerVersion(settings[_0x3d0e15(0x284)],serverversion),updateSetting('lastmsgtelegram',_0x447eea),emitMessages();}}function emitMessages(){const _0x2f95a9=_0x413fdc,_0x149d78=settings[_0x2f95a9(0x182)];let _0x262da2=[];newMessages['forEach'](_0xc1a5b1=>{const _0xc33152=_0x2f95a9;_0xc1a5b1['number']>_0x149d78&&_0x262da2[_0xc33152(0x2f3)](_0xc1a5b1);}),_0x262da2['length']>0x0&&getAllClients()['forEach'](_0x17fd02=>{const _0x2e57dd=_0x2f95a9;getSocket(_0x17fd02['id'])['emit'](_0x2e57dd(0x200),_0x262da2);});}function confirmMessage(_0x5cc9e9){const _0x520353=_0x413fdc;updateSetting(_0x520353(0x182),Number(_0x5cc9e9));}function isNewerVersion(_0x5ecfcf,_0x23900a){const _0x1cb5b0=_0x413fdc,_0x14174e=_0x23900a[_0x1cb5b0(0x305)]('.'),_0x449222=_0x5ecfcf[_0x1cb5b0(0x305)]('.');for(var _0x37bef8=0x0;_0x37bef8<_0x449222['length'];_0x37bef8++){const _0x39334c=~~_0x449222[_0x37bef8],_0xf606db=~~_0x14174e[_0x37bef8];if(_0x39334c>_0xf606db)return!![];if(_0x39334c<_0xf606db)return![];}return![];}function toTelegramMarkdown(_0x2c5679){const _0xb4bb09=_0x413fdc,_0x368be4=/(^|[^\*])\*{1}([^\*.]+?)\*{1}([^\*]|$)/gim,_0x13fe44=/\*{2}(.+?)\*{2}/gim;return _0x2c5679=_0x2c5679[_0xb4bb09(0x241)](_0x368be4,_0xb4bb09(0x184))['replace'](_0x13fe44,_0xb4bb09(0x111)),_0x2c5679;}async function validateConfigFile(){const _0x4bb49d=_0x413fdc,_0x3c43d1=dbConfig[_0x4bb49d(0x140)](_0x4bb49d(0x2fc))[_0x4bb49d(0x22b)]('botID')['value']()||[];if(_0x3c43d1[_0x4bb49d(0x130)]==0x0){let _0x216778=0x0,_0x34908e=[];const _0x5c4be6=/^bot-([0-9]{3})-config.json$/,_0x5f2d41=fs[_0x4bb49d(0x190)](configpath);_0x5f2d41[_0x4bb49d(0x1de)](_0x54b269=>{const _0x4627b9=_0x4bb49d,_0x10cd08=_0x5c4be6[_0x4627b9(0x137)](_0x54b269);if(_0x10cd08){const _0x22d877=_0x10cd08[0x1];let _0x546004=getBotAttributes(_0x22d877);_0x34908e[_0x4627b9(0x2f3)]({'botID':_0x22d877,'botname':_0x546004['botname'],'status':'disabled','live':_0x4627b9(0x2d4)}),_0x216778++;}}),_0x216778!=0x0&&(dbConfig[_0x4bb49d(0x140)](_0x4bb49d(0x2fc))[_0x4bb49d(0x12a)](_0x34908e)[_0x4bb49d(0x1c5)](),config=_0x34908e,restoredConfigFile=_0x216778);}}async function restoreConfigNotify(_0x25143e){const _0x1bdc7d=_0x413fdc;let _0x166d74;if(restoredConfigFile==0x1)_0x166d74='NOTE:\x0aYour\x20bb-config.json\x20file\x20got\x20corrupted,\x20but\x20it\x20has\x20been\x20restored!\x20\x0aYour\x20bot\x20is\x20disabled\x20by\x20default\x20-\x20enable\x20if\x20you\x20want\x20it\x20to\x20run';else _0x166d74=_0x1bdc7d(0x2c1);if(_0x25143e)io['to'](_0x1bdc7d(0x2f0))[_0x1bdc7d(0x1ee)]('notification',_0x166d74);else{logger[_0x1bdc7d(0x19c)](_0x1bdc7d(0x121)),logger[_0x1bdc7d(0x19c)](_0x166d74),logger[_0x1bdc7d(0x19c)](_0x1bdc7d(0x121)),logger['simple']('');if(tgBot&&settings[_0x1bdc7d(0x26f)]&&settings[_0x1bdc7d(0x1e6)]!=_0x1bdc7d(0x217))await sendTelegram(settings[_0x1bdc7d(0x26f)],'Bot\x20Mgr\x20>\x20'+_0x166d74);}}function validateCredentials(_0x4db56a,_0x534db3){const _0x8597a2=_0x413fdc;if(_0x4db56a[_0x8597a2(0x1c7)]==settings['bbUsername']&&bcrypt[_0x8597a2(0x245)](_0x4db56a[_0x8597a2(0x1a6)],settings[_0x8597a2(0x2a5)])){if(settings['f2aRequired'])return{'allow':![],'reason':_0x8597a2(0x2f6),'token':null};else{const _0x4d2712=generateLoginToken(_0x534db3);return{'allow':!![],'reason':'login\x20token\x20generated','token':_0x4d2712};}}else return{'allow':![],'reason':_0x8597a2(0x11b),'token':null};}function refreshToken(_0xab034c){const _0x270e66=_0x413fdc,_0x17f0f1=generateLoginToken(_0xab034c);return{'allow':!![],'reason':_0x270e66(0x283),'token':_0x17f0f1};}function validateAccess(_0x3a40c7,_0x19b8f2,_0xa13734){const _0x51b50a=_0x413fdc,_0x28e5ca=_0xa13734?_0xa13734:devices[_0x19b8f2]['ip'];let _0x826c98;const _0x5cc8ab=_0x24a634=>{const _0x2bcc8c=_0x4c53;if(settings['loginRequired']){if(settings[_0x2bcc8c(0x1cf)]){if(telegram2FaApproved(_0x19b8f2)){const _0x3ca3d0=generateLoginToken(_0x19b8f2);return{'allow':!![],'reason':'2FA\x20login\x20token\x20generated','token':_0x3ca3d0};}else return{'allow':![],'reason':_0x2bcc8c(0x2ed),'token':null};}else return _0x826c98=validToken(_0x24a634,_0x19b8f2),_0x826c98[_0x2bcc8c(0x10c)]('success')?{'allow':!![],'reason':_0x2bcc8c(0x2e2),'token':_0x24a634}:{'allow':![],'reason':_0x2bcc8c(0x2ed),'token':null};}else return{'allow':!![],'reason':_0x2bcc8c(0x2f7),'token':null};};if(settings['whitelistEnabled']){let _0x4b75ed=[...settings['whitelist'],_0x51b50a(0x1ca),_0x51b50a(0x2e8),_0x51b50a(0x24f)];if(_0x4b75ed['includes'](_0x28e5ca))return _0x5cc8ab(_0x3a40c7);else{_0x826c98=validToken(_0x3a40c7,_0x19b8f2);if(_0x826c98['hasOwnProperty'](_0x51b50a(0x2dc)))return _0x5cc8ab(_0x3a40c7);else{if(telegramIpApproved(_0x19b8f2)){const _0x5d087e=generateToken(_0x19b8f2);return _0x826c98=_0x5cc8ab(_0x3a40c7),_0x826c98[_0x51b50a(0x2c9)]?{'allow':!![],'reason':'temporary\x20token\x20generated','token':_0x5d087e}:_0x826c98;}else return settings['temporaryAccessAllowed']?{'allow':![],'reason':_0x51b50a(0x2fe),'token':null}:{'allow':![],'reason':_0x51b50a(0x2b3),'token':null};}}}else return _0x5cc8ab(_0x3a40c7);}function timelyDecrypt(_0x1dc02e,_0x1e3bc9=!![]){const _0x39e0c5=_0x413fdc;if(_0x1dc02e)try{const _0x5aeaa0=crypt[_0x39e0c5(0x10a)](secure[_0x39e0c5(0x26a)],_0x1dc02e)[_0x39e0c5(0x200)],_0x35cdd8=_0x5aeaa0['split']('@')[0x0],_0x1edcf9=_0x5aeaa0[_0x39e0c5(0x305)]('@')[0x1],_0x562a70=new Date()[_0x39e0c5(0x1be)]();if(_0x1e3bc9){if(_0x562a70-_0x1edcf9<maxSecretAge*0x3e8)return _0x35cdd8;else return![];}else return _0x35cdd8;}catch(_0x457126){return![];}else return![];}const validToken=(_0x417e8b,_0xd11d82)=>{const _0xd278ff=_0x413fdc,_0x475d17=devices[_0xd11d82]['ip'];if(!_0x417e8b)return{'error':_0xd278ff(0x123)};for(let _0x15d7ad of blacklist){if(_0x15d7ad['token']==_0x417e8b)return{'error':_0xd278ff(0x189)};}let _0x44f009;try{_0x44f009=jwt[_0xd278ff(0x15e)](_0x417e8b,secure['secret']+_0xd11d82);}catch{return{'error':_0xd278ff(0x2c4)};}if(!_0x44f009[_0xd278ff(0x10c)](_0xd278ff(0x178))&&!_0x44f009[_0xd278ff(0x10c)](_0xd278ff(0x1c7))||!_0x44f009[_0xd278ff(0x10c)]('exp'))return{'error':_0xd278ff(0x1d9)};if(!_0x44f009[_0xd278ff(0x10c)](_0xd278ff(0x1c7))&&_0x44f009[_0xd278ff(0x10c)](_0xd278ff(0x178))){const {clientip:_0x70c84e}=_0x44f009;return _0x475d17==_0x70c84e?{'success':_0xd278ff(0x1a0)}:{'error':_0xd278ff(0x2d5)};}else{if(_0x44f009[_0xd278ff(0x10c)](_0xd278ff(0x1c7))&&_0x44f009[_0xd278ff(0x10c)](_0xd278ff(0x178))){const {username:_0x58a955,clientip:_0x14c744}=_0x44f009;return settings['bbUsername']==_0x58a955&&_0x475d17==_0x14c744?{'success':_0xd278ff(0x1a0)}:{'error':_0xd278ff(0x17f)};}}},generateLoginToken=_0x426318=>{const _0x1e4314=_0x413fdc;if(_0x426318){const _0x546f0d=devices[_0x426318]['ip'];return jwt[_0x1e4314(0x1d1)]({'username':settings[_0x1e4314(0x1e9)],'clientip':_0x546f0d},secure[_0x1e4314(0x108)]+_0x426318,{'expiresIn':tokenRefresh*0x3c,'allowInsecureKeySizes':!![]});}else return![];},generateToken=_0x9b79bf=>{const _0x55f206=_0x413fdc;if(_0x9b79bf){const _0x167ba2=devices[_0x9b79bf]['ip'];return jwt[_0x55f206(0x1d1)]({'clientip':_0x167ba2},secure[_0x55f206(0x108)]+_0x9b79bf,{'expiresIn':devices[_0x9b79bf][_0x55f206(0x2eb)][_0x55f206(0x211)]*0x3c,'allowInsecureKeySizes':!![]});}else return![];},telegramIpApproved=_0x3611ce=>{const _0x3f7357=_0x413fdc;let _0xa59612=![];return devices[_0x3611ce][_0x3f7357(0x2eb)]&&devices[_0x3611ce][_0x3f7357(0x2eb)][_0x3f7357(0x211)]!=_0x3f7357(0x2f5)&&(_0xa59612=devices[_0x3611ce][_0x3f7357(0x2eb)]['clientip']==devices[_0x3611ce]['ip']&&new Date()[_0x3f7357(0x1be)]()-devices[_0x3611ce][_0x3f7357(0x2eb)][_0x3f7357(0x2b6)]<devices[_0x3611ce][_0x3f7357(0x2eb)][_0x3f7357(0x211)]*0x3c*0x3e8),_0xa59612;},telegram2FaApproved=_0x4f0871=>{const _0x335a1d=_0x413fdc;let _0x41cd83=![];return devices[_0x4f0871]['telegram2FaApproval']&&devices[_0x4f0871][_0x335a1d(0x29a)][_0x335a1d(0x211)]!=_0x335a1d(0x2f5)&&(_0x41cd83=devices[_0x4f0871][_0x335a1d(0x29a)][_0x335a1d(0x178)]==devices[_0x4f0871]['ip']&&new Date()[_0x335a1d(0x1be)]()-devices[_0x4f0871]['telegram2FaApproval'][_0x335a1d(0x2b6)]<devices[_0x4f0871][_0x335a1d(0x29a)][_0x335a1d(0x211)]*0x3c*0x3e8),_0x41cd83;},normalizeIP=_0x3ad074=>{const _0x602890=_0x413fdc;let _0x12a578=null,_0x41b166=null;if(ipaddr['isValid'](_0x3ad074)){const _0x4fbc65=ipaddr[_0x602890(0x1fa)](_0x3ad074);_0x4fbc65[_0x602890(0x1d2)]()===_0x602890(0x29d)?(_0x4fbc65[_0x602890(0x19f)]()&&(_0x12a578=_0x4fbc65['toIPv4Address']()[_0x602890(0x186)]()),_0x41b166=_0x4fbc65[_0x602890(0x186)]()):(_0x12a578=_0x4fbc65[_0x602890(0x186)](),_0x41b166=_0x4fbc65['toIPv4MappedAddress']()[_0x602890(0x186)]());}return{'show':_0x12a578?_0x12a578:_0x41b166,'store':_0x41b166};};function formatDate(_0x505ee9){const _0x4913a5=_0x413fdc;return _0x505ee9['getFullYear']()+'/'+(_0x505ee9[_0x4913a5(0x20e)]()+0x1)['toString']()[_0x4913a5(0x1ea)](0x2,'0')+'/'+_0x505ee9[_0x4913a5(0x167)]()['toString']()[_0x4913a5(0x1ea)](0x2,'0')+'\x20'+_0x505ee9[_0x4913a5(0x1b4)]()[_0x4913a5(0x186)]()[_0x4913a5(0x1ea)](0x2,'0')+':'+_0x505ee9['getMinutes']()[_0x4913a5(0x186)]()[_0x4913a5(0x1ea)](0x2,'0')+':'+_0x505ee9['getSeconds']()[_0x4913a5(0x186)]()[_0x4913a5(0x1ea)](0x2,'0');}function sleep(_0x15b05a){return new Promise(_0x2283c6=>setTimeout(_0x2283c6,_0x15b05a));}